<s> Hi Here's a request for XSLT 2, possibly also applying to XPath 2 and related technologies.  </s>
<s> Problem Summary: Current drafts of XSLT 2 / XPath 2 don't provide error recovery facilities.  </s>
<s> This current limitation results in various problems: an XSLT  </s>
<s> application can not finish it's job, even if it could continue after the  </s>
<s> error.  </s>
<s> The app should be able to deal with error if it can handle it, so that the transfomation can continue.  </s>
<s> Scenario, Problem Details:  </s>
<s> The input document references a file, via facilities specific to the  </s>
<s> input's language (not via generic mechanisms such as XInclude, XML external entity references, etc).  </s>
<s> The transformation application handles this with the unparsed-text()  </s>
<s> function; here's a snippet: select="resolve-uri(@fileref,base-uri(/))"/ If the path supplied by the fileref attribute doesn't point to a file, then my XSLT processor raises a fatal error [1], and aborts the transformation.  </s>
<s> Especially in cases where there is no human supervision, eg when the whole thing runs on the server, this is inacceptable.  </s>
<s> This is a very common scenario.  </s>
<s> Solution, Request: Please add error recovery facilities [2] to XSLT 2 / XPath 2. The syntax for the mechanism could look like this: XSLT 2: An analog mechanism might also make sense as addition to XPath 2. "An error that is not detected until a source document is being  </s>
<s> transformed is referred to as a dynamic error.  </s>
<s> Some dynamic errors are  </s>
<s> classed as recoverable errors.  </s>
<s> When a recoverable error occurs, this  </s>
<s> specification allows the processor either to signal the error (by  </s>
<s> reporting the error condition and terminating execution) or to take a  </s>
<s> defined recovery action and continue processing.  </s>
<s> It is  </s>
<s> implementation-defined whether the error is signaled or the recovery  </s>
<s> action is taken.  </s>
<s> If the implementation does choose to take recovery action, it must take the recovery action defined in this specification."  </s>
<s> I need a way to specify the recovery action to be taken.  </s>
<s> No matter what  </s>
<s> the processor chooses to do in the absence of this user specified  </s>
<s> recovery action (abort or recover); when a user supplied action is present (xsl:rescue), all processors must carry it out if the first action failed.  </s>
<s> Alternatives  </s>
<s> There are various solutions specific to the problem described in the  </s>
<s> scenario.  </s>
<s> They solve this specific problem, but don't address the underlying general issue.  </s>
<s> A function resource-exists() for example would solve the problem  </s>
<s> encountered in the specific use case described above, but it would not  </s>
<s> help in all other cases where user supplied error recovery action is  </s>
<s> required.  </s>
<s> Use Case: See Scenario.  </s>
<s> Possible Issues: The "rollback" issue mentioned in [3] should be solvable.  </s>
<s> AFAICS, Rollback of the result tree should not be required.  </s>
<s> One possible solution might be:  </s>
<s> Any action contained in xsl:try is only carried out if the complete contents of the xsl:try succeed.  </s>
<s> If one or more action fails, then none of them are carried out.  </s>
<s> They are simulated/attempted/tested first, without affecting the result tree.  </s>
<s> This can represent a performance penalty, but where reliability  </s>
<s> and predictable program execution is of high importance, this most often  </s>
<s> is acceptable.  </s>
<s> Then the actions contained inside xsl:rescue are carried out.  </s>
<s> Discussion: Please also see  </s>
<s> Tobi [1] "[ERR119] It is a dynamic error if a URI cannot be used to retrieve a resource containing text.  </s>
<s> This is a recoverable error.  </s>
<s> The processor must either signal the error, or must recover by treating the URI as if it referenced a resource containing a zero-length string."  </s>
<s> [2] Analog to begin-rescue (eg in Ruby), try-catch, etc in other languages.  </s>
<s> [3]  </s>
<s> I encountered a problem of a somewhat similar nature using XSLT 1.0, using the document function.  </s>
<s> In certain scenarios, using Java, the user could make a "document()" reference to a document that might not be there, or might not parse correctly, and I wanted to be able to handle the error in the XSLT, not in the Java code.  </s>
<s> My work-around was to always return a document via the URIResolver, just that sometimes it would have special "error" content.  </s>
<s> I mention this in the context of this suggestion to note that it might make more sense  </s>
<s> with a different syntax.  </s>
<s> Two alternatives suggest themselves to me: A) Within an "xsl:do" block, have multiple "xsl:rescue" blocks with the appropriate "match" attributes.  </s>
<s> B) Forgo the "xsl:do" and "xsl:rescue" altogether.  </s>
<s> Instead, the xsl:try implicitly does an xsl:apply-templates / on the xml of the error message, should an error occur.  </s>
<s> Note that the "mode" on the "xsl:try" would be passed through to the xsl:apply-templates / Actually, now that I think about it, option (B) seems like a pretty good fit for an extension element if it doesn't end up in the spec.  </s>
<s> Of course, it might make sense for implementations to eventually agree on what the error info-set looks like.  </s>
<s> -Eric.  </s>
<s> As posted on xsl list: From David Carlisle It's actually an error to refer to a document that is not there.  </s>
<s> Your XSLT system may just give up at that point and stop.  </s>
<s> If so there is nothing you can do from within the stylesheet.  </s>
<s> However the XSLT spec does say what the processor must do if it does not die at that point: it has to return an empty node set, in which case if $Description holds the file name, both of those should work and be true if the document is there and false otherwise.  </s>
<s> $Descriptions will either be an empty node set or a set consisting of a single / node, depending on whether the document is there or not.  </s>
<s> HTH DaveP.  </s>
<s> NOTICE: The information contained in this email and any attachments is confidential and may be legally privileged.  </s>
<s> If you are not the intended recipient you are hereby notified that you must not use, disclose, distribute, copy, print or rely on this email's content.  </s>
<s> If  </s>
<s> you are not the intended recipient, please notify the sender immediately and then delete the email and any attachments from your system.  </s>
<s> RNIB has made strenuous efforts to ensure that emails and any attachments generated by its staff are free from viruses.  </s>
<s> However, it cannot accept any responsibility for any viruses which are transmitted.  </s>
<s> We therefore recommend you scan all attachments.  </s>
<s> Please note that the statements and views expressed in this email and any attachments are those of the author and do not necessarily represent those of RNIB.  </s>
<s> RNIB Registered Charity Number: 226227 Website: http://www.rnib.org.uk  </s>
<s> re Dave, please see "Alternatives There are various solutions specific to the problem described in the scenario.  </s>
<s> They solve this specific problem, but don't address the underlying general issue."  </s>
<s> The solution described in does not work if the processor chooses to abort the transformation (conformant), as David C. states in the very same text.  </s>
<s> Tobi  </s>
<s> The document() situation is certainly one of the main use-cases for this capability, but it is not the only one - XSLT 2.0 and XPath 2.0 define many more dynamic errors than 1.0 did.  </s>
<s> Most of these are preventable (this is why we added the "castable" operator, so that you could preempt errors in casting) but not all.  </s>
<s> It's true that writing your own URIResolver gives you a way of handling the document() errors, assuming you are in the Java world.  </s>
<s> Michael Kay  </s>
<s> I am personally sympathetic to this requirement.  </s>
<s> We had an attempt to define try/catch functionality at the XPath level.  </s>
<s> The attempt failed partly because people thought the language was getting too big and complicated, and partly because XQuery has decided not to updates at this version (there is a feeling that try/catch probably interacts with  </s>
<s> transactions and rollback, and that it therefore needs to be designed with  </s>
<s> update in mind).  </s>
<s> I don't think these arguments should stop us doing a try/catch in XSLT.  </s>
<s> Apart from deciding the precise syntax, the issues that we need to address  </s>
<s> are: (a) how does it interact with the option for implementations to recover from certain errors?  </s>
<s> (b) what information about the error is made available in the "catch" block (and how)?  </s>
<s> (c) what do we say about "rollback", i.e. about lasting effects of instructions in the try block (for example, xsl:result-document).  </s>
<s> I will ask for this to go on the WG agenda.  </s>
<s> Michael Kay  </s>
<s> html#00593 Tobi [1] "[ERR119] It is a dynamic error if a URI cannot be used to retrieve a resource containing text.  </s>
<s> This is a recoverable error.  </s>
<s> The processor must either signal the error, or must recover by treating the URI as if it referenced a resource containing a zero-length string."  </s>
<s> [2] Analog to begin-rescue (eg in Ruby), try-catch, etc in other languages.  </s>
<s> [3] http://www.biglist.com/lists/xsl-list/archives/200306/msg00614.html  </s>
<s> MK said:  </s>
<s> Another reason to re-consider the split point between query and xslt?  </s>
<s> I think the WG have it badly wrong.  </s>
<s> regards DaveP NOTICE: The information contained in this email and any attachments is confidential and may be legally privileged.  </s>
<s> If you are not the intended recipient you are hereby notified that you must not use, disclose, distribute, copy, print or rely on this email's content.  </s>
<s> If  </s>
<s> you are not the intended recipient, please notify the sender immediately and then delete the email and any attachments from your system.  </s>
<s> RNIB has made strenuous efforts to ensure that emails and any attachments generated by its staff are free from viruses.  </s>
<s> However, it cannot accept any responsibility for any viruses which are transmitted.  </s>
<s> We therefore recommend you scan all attachments.  </s>
<s> Please note that the statements and views expressed in this email and any attachments are those of the author and do not necessarily represent those of RNIB.  </s>
<s> RNIB Registered Charity Number: 226227 Website: http://www.rnib.org.uk  </s>
<s> Hi Dave, I don't understand your comment well enough to respond.  </s>
<s> Could you please explain in a little more detail?  </s>
<s> Jonathan  </s>
<s> Could you explain what you mean by "it", and what you think we should do differently?  </s>
<s> Michael Kay  </s>
<s> Mike quoted an example of a mismatch between xquery and xslt requirements.  </s>
<s> Its my belief that the split point, xquery and xslt, is way too far down, i.e. too much is lumped together as being common, too little is either query or xslt.  </s>
<s> The architecture of that split appeared when someone determined that there was commonality, true, but the split point appears badly designed IMO.  </s>
<s> I remain totally unconvinced that the area of common need is anywhere near as large as is currently posited by the design.  </s>
<s> As usual, I'll quote the typing as the most gross error.  </s>
<s> Apparently needed in query, certainly not in XSLT.  </s>
<s> regards DaveP.  </s>
<s> From: Jonathan Robie [mailto:jonathan.robie@datadirect-technologies.com]  </s>
<s> Sent: 20 June 2003 16:39 public-qt-comments@w3.org  </s>
<s> Subject: RE: rescue; error recovery facilities needed  </s>
<s> NOTICE: The information contained in this email and any attachments is confidential and may be legally privileged.  </s>
<s> If you are not the intended recipient you are hereby notified that you must not use, disclose, distribute, copy, print or rely on this email's content.  </s>
<s> If you are not the intended recipient, please notify the sender immediately and then delete the email and any attachments from your system.  </s>
<s> RNIB has made strenuous efforts to ensure that emails and any attachments generated by its staff are free from viruses.  </s>
<s> However, it cannot accept any responsibility for any viruses which are transmitted.  </s>
<s> We therefore recommend you scan all attachments.  </s>
<s> Please note that the statements and views expressed in this email and any attachments are those of the author and do not necessarily represent those of RNIB.  </s>
<s> RNIB Registered Charity Number: 226227 Website: http://www.rnib.org.uk  </s>
<s> I think the data typing is needed when handling structured data  </s>
<s> applications, and is not needed (much) when handling narrative text.  </s>
<s> Many people seem to be under the impression that XQuery is designed to  </s>
<s> handle data and XSLT is designed to handle text.  </s>
<s> This is not the case.  </s>
<s> Both  </s>
<s> languages have explicit requirements to handle the full spectrum of XML  </s>
<s> applications.  </s>
<s> Michael Kay  </s>
<s> I completely agree.  </s>
<s> Jonathan  </s>
<s> MK:  </s>
<s> JR:  </s>
<s> Where please gentlemen?  </s>
<s> your requirements.  </s>
<s> regards DaveP.  </s>
<s> NOTICE: The information contained in this email and any attachments is confidential and may be legally privileged.  </s>
<s> If you are not the intended recipient you are hereby notified that you must not use, disclose, distribute, copy, print or rely on this email's content.  </s>
<s> If you are not the intended recipient, please notify the sender immediately and then delete the email and any attachments from your system.  </s>
<s> RNIB has made strenuous efforts to ensure that emails and any attachments generated by its staff are free from viruses.  </s>
<s> However, it cannot accept any responsibility for any viruses which are transmitted.  </s>
<s> We therefore recommend you scan all attachments.  </s>
<s> Please note that the statements and views expressed in this email and any attachments are those of the author and do not necessarily represent those of RNIB.  </s>
<s> RNIB Registered Charity Number: 226227 Website: http://www.rnib.org.uk  </s>
<s> The XML Query Requirements includes a Usage Scenarios section which mentions being able to process all of "human readable documents", "data-oriented documents" and "mixed-model documents".  </s>
<s> And Section "XML Query Functionality" outlines the requirements to be able to operate on both Schema types and text values.  </s>
<s> I do not know how someone could have drawn the conclusion:  </s>
<s> if they had actually read the XML Query Requirements as quoted above.  </s>
<s> Maybe this perception is caused more by the implementation profile for early XSLT 2.0 and XQuery 1.0 implementations.  </s>
<s> But this is not something that is under our control.  </s>
<s> /paulc Paul Cotton, Microsoft Canada 17 Eleanor Drive, Nepean, Ontario K2E 6A3  </s>
<s> Hi :) Since this [1] wanders off-subject for the thread [2], perhaps you guys want to start a new thread?  </s>
<s> It would make it much easier for people to follow threads they're interested in, and it would increase the quality of the archives.  </s>
<s> TIA, Tobi [1] [2] "rescue; error recovery facilities needed"  </s>
<s> The first two stated goals, right at the beginning of section 1 of the XSLT requirements document that you cite, are: * Simplify manipulation of XML Schema-typed content * Simplify manipulation of string content Michael Kay  </s>
<s> It can also be very useful in the case where you're picking "fields" out of narrative text -- e.g. where in the middle of a news story stock ticker symbols are handled separately, with a database lookup to insert the company name and (for online presentation) maybe a link to their web site.  </s>
<s> Another example might be a part number mentioned in a repair manual.  </s>
<s> Or a date in a history text.  </s>
<s> Demand for typing in XML came from many communities, not just (for example) database people.  </s>
<s> Yes. I think a lot of experimentation is needed before there's good shared understanding of the benefits of typing, and whether they were worth the price... "colour all headings green", "lists should be collapsible" are attractive but maybe weak use cases.  </s>
<s> The biggest advantages that I see, though, are (1) having a family of specs that fit together well,  </s>
<s> and (2) having the XSLT and XML Query processors detect more errors before they happen.  </s>
<s> Scripting languages (e.g. Perl) are also moving  </s>
<s> in this direction.  </s>
<s> Liam Liam Quin, W3C XML Activity Lead, liam@w3.org,  </s>
<s> http://www.w3.org/People/Quin/  </s>
<s> Unfortunately though there are real worries in the community that the majority of "errors" detected by the typing in Xpath2 will be essentially spurious errors.  </s>
<s> constructs that worked in xpath 1 will fail to work in xpath 2 because of the smaller number of places where implicit coercions happen.  </s>
<s> So this has all the signs of being an error detecting device that generates more errors than it detects.  </s>
<s> David  </s>
<s> Sorry Michael.  </s>
<s> I was reading the requirements not the goals.  </s>
<s> Even there I see I'm wrong.  </s>
<s> See requirement 3. Not quite quote to handle the full spectrum of XML applications.  </s>
<s> /quote , see 2.1 but it does reference xsd.  </s>
<s> regards DaveP.  </s>
<s> NOTICE: The information contained in this email and any attachments is confidential and may be legally privileged.  </s>
<s> If you are not the intended recipient you are hereby notified that you must not use, disclose, distribute, copy, print or rely on this email's content.  </s>
<s> If you are not the intended recipient, please notify the sender immediately and then delete the email and any attachments from your system.  </s>
<s> RNIB has made strenuous efforts to ensure that emails and any attachments generated by its staff are free from viruses.  </s>
<s> However, it cannot accept any responsibility for any viruses which are transmitted.  </s>
<s> We therefore recommend you scan all attachments.  </s>
<s> Please note that the statements and views expressed in this email and any attachments are those of the author and do not necessarily represent those of RNIB.  </s>
<s> RNIB Registered Charity Number: 226227 Website: http://www.rnib.org.uk  </s>

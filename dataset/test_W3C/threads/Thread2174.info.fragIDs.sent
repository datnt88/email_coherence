<s> What follows is text for the (currently TBS) section on Content-MD5 header.  </s>
<s> There are objections to it, but rough consensus is believed to exist.  </s>
<s> The most likely outcome of the objections (IMHO) is that a new header for content integrity and authentication mechanisms will be proposed for HTTP/1.2.  </s>
<s> If there are any problems you have with this, please let me know, or I will believe enough consensus exists to make add this to the 1.1 draft to close this issue.  </s>
<s> 10.13Content-MD5 The Content-MD5 entity-header field is an MD5 digest of the entity-body,  </s>
<s> as defined in [RFC 1864], for the purpose of providing an end-to-end  </s>
<s> integrity check of the entity-body.  </s>
<s> ContentMD5= "Content-MD5" ":" digest  </s>
<s> digest= base64 of 128 bit MD5 digest as per RFC 1864  </s>
<s> The Content-MD5 header may optionally be generated by origin servers, and functions as an integrity check of the entity-body.  </s>
<s> Only  </s>
<s> origin-servers may generate the Content-MD5 headers: proxies and  </s>
<s> gateways MUST NOT generate it, as this would defeat its value and an  </s>
<s> end-to-end integrity check.  </s>
<s> Any recipient of the entity-body, including gateways and proxies, MAY check that the digest value in the header  </s>
<s> matches that of the entity-body as received.  </s>
<s> When being generated, the MD5 digest is computed based on the value of the entity-body after Content-Encoding (if any) but before  </s>
<s> Transfer-Encoding (if any) is applied; when being checked, after  </s>
<s> Transfer-Encoding has been removed, but before Content-Encoding has been removed.  </s>
<s> There are several ways in which the application of Content-MD5 to HTTP entity-bodies differs from its application to MIME entity-bodies.  </s>
<s> One is that HTTP, unlike MIME, does not use Content-Transfer-Encoding, and does use Transfer-Encoding and Content-Encoding.  </s>
<s> Another is that, unlike  </s>
<s> MIME, the digest is computed over the entire entity-body, even if it  </s>
<s> happens to be a MIME multi-part content-type.  </s>
<s> (Note that the multi-part  </s>
<s> bodies may themselves have Content-MD5 headers.) Another is that HTTP more frequently uses binary content types than MIME, so it is worth noting that in such cases, the byte order used to compute the digest is network byte order.  </s>
<s> Lastly, the canonical form of text types in HTTP includes several line break conventions, so conversion to CR-LF is not  </s>
<s> always required before computing or checking the digest: any acceptable convention should be left unaltered for inclusion in the digest.  </s>
<s> Note: the net result of the above is that the digest is  </s>
<s> computed on the content that would be sent over-the-wire, in  </s>
<s> network byte order, but prior to any transfer coding being applied.  </s>
<s> Redmond, WA 98052  </s>
<s> I am having a hell of a time keeping connected to the discussions -- our network and workstations keep failing due to multiple power failures and server problems.  </s>
<s> Typos and rough wording changes:  </s>
<s> field provides an MD5 digest ...  </s>
<s> RFC 1864 [xx],  </s>
<s> Content-MD5 = "Content-MD5" ":" md5-digest md5-digest = base64 of 128 bit MD5 digest as per RFC 1864  </s>
<s> The Content-MD5 header may be generated by an origin server to function as an integrity check of the entity-body.  </s>
<s> Only,  </s>
<s> header field; proxies and  </s>
<s> value as an  </s>
<s> in this header field  </s>
<s> The above is too terse.  </s>
<s> The MD5 digest is computed based on the content of the entity body,  </s>
<s> including any Content-Encoding that has been applied, but not including  </s>
<s> any Transfer-Encoding.  </s>
<s> If the entity is received with a Transfer-Encoding, that encoding must be removed prior to checking the Content-MD5 value against the received entity.  </s>
<s> may be computed  </s>
<s> be a "multipart" type.  </s>
<s> ...  </s>
<s> so conversion of all line breaks to CRLF form is not  </s>
<s> Note: the net result of the above is that the digest is  </s>
<s> Why not just say that and leave out the rest?  </s>
<s> I think the note is far more effective (and more likely to always be accurate) then the paragraph above it.  </s>
<s> ...Roy T. Fielding  </s>
<s> Department of Information &amp; Computer Science (fielding@ics.uci.edu)  </s>
<s> From: Roy T. Fielding[SMTP:fielding@avron.ICS.UCI.EDU] Subject: Re: (INTEGOK) rough consensus  </s>
<s> ] I like all the suggested wording changes.  </s>
<s> Note: the net result of the above is that the digest is  </s>
<s> How about switching: the note will be the definitive text, the paragraph above it the explanation/motivational note?  </s>
<s> I think the explanaority paragraph is useful to relate RFC 1864 to the HTTP context; if everyone else thinks its redundant, I can be persuaded to remove it.  </s>
<s> Send me private opinions on the utility -- no need to clutter the list: a one liner with "useful" or "not useful" will do.  </s>
<s> Paul  </s>
<s> No, you really should remove the claim to be per RFC 1864 since the spec as given has no connection with RFC1864 except in using the same hash function.  </s>
<s> RFC 1864 in sofar as it says anything states that the entity is canonicalized  </s>
<s> before the digest is applied.  </s>
<s> I believe that we have (rightly) decided not to  </s>
<s> introduce the canonicalization step.  </s>
<s> Therefore we are not doing the base64 of the digest "per RFC1864)" we are doing the base64 of the digest.  </s>
<s> No, Roy this is wrong the disgest IS computed.  </s>
<s> If the digest is there the value is MD5(entity) there is no provision to allow MD5(cononical(entity)).  </s>
<s> As specified I think that we are being given a pig in a poke.  </s>
<s> If one gets a Content-MD5 header with this spec one will not know what the digest was calculated on.  </s>
<s> Are implementations to be required to perform both checks on the offchance that canonicalisation was used?  </s>
<s> If people want to reuse an existing tag then they should accept whatever baggage goes with it.  </s>
<s> If that involves irrelevant canonicalization steps then so be it.  </s>
<s> If the spec diverges one should specify a new tag.  </s>
<s> Phill  </s>
<s> To compute an MD5 signature for textual material,  </s>
<s> I would like to see the following applied:  </s>
<s> o trailing white space stripped o remaining whitespace reduced to single blanks o CR/LF ignored The justification for this is that something cut-n-pasted should still pass.  </s>
<s> No, we're not going to splice the TCP stream and insert cut-n-pasted text, but the above will make digests work on the widest range of interoperable platforms.  </s>
<s> What I'm saying is that cut-n-paste-ability isn't the goal, it represents a sample of the kind of mangling that might happen when the text crosses some boundaries.  </s>
<s> Interoperability is the goal.  </s>
<s> Make MD5 verification work cross-platform.  </s>
<s> Rick Troth troth@casita.houston.tx.us , Houston, Texas, USA  </s>
<s> I basically agree with Roy about this section -- the simpler the prose is on this point, the better.  </s>
<s> However, there is still one problem remaining: The use of the term "network byte order".  </s>
<s> It is wrong to use this term in this context.  </s>
<s> Network byte order refers quite specifically to the ordering of bytes in network address information.  </s>
<s> It is not only nonsensical to talk about a generic sequence of octets being in network byte order, it is outright incorrect, as there may be media types defined with embedded network address information in them that isn't presented in network byte order.  </s>
<s> The bytes ungoing checksumming are in whatever order the media type puts them in for transfer of the content across the wire.  </s>
<s> Ned  </s>

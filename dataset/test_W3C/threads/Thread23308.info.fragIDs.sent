<s> -- SVG WG is asking for feedback - event propagation -- Hi, SVG provides a way to reference an entire SVG document using the  </s>
<s> image element.  </s>
<s> The referenced document has its own DOM tree, animations, scripting, and so DOM event propagation.  </s>
<s> The SVG WG had an  </s>
<s> issue regarding how the event propagation is supposed to work in such an environment (2 documents, one referencing another) and we would like to have feedback from the DOM WG. Scenario [A]: 1. A.svg references a SVG document using the image tag.  </s>
<s> 2. B.svg is the referenced SVG document (with a rect and a circle for example): Q1: Does both the bar() and foo() methods are invoked?  </s>
<s> Q2: If both are invoked, which one is first?  </s>
<s> Scenario [B]: B.svg Q3: If I click on the circle, which anchor is activated?  </s>
<s> Q4: Which part of the SVG image is sensitive to events?  </s>
<s> We had three different options: 1.  </s>
<s> The image element is a black box.  </s>
<s> A mouse click on the image will only generate an event in the referenced document.  </s>
<s> Scenario[A]: bar() is invoked.  </s>
<s> Scenario[B]: myDocument2.svg is now the current document.  </s>
<s> The side effect is that the author of the referencing document can not override the behavior of the referenced document and does not control what happens.  </s>
<s> We though that's going to be confusing for our users.  </s>
<s> 2. Both the referenced and the referencing document will receive a mouse event.  </s>
<s> The event propagation happens first in the referenced document (full capture and bubbling phase) and once it's completed, the referencing document will dispatch a mouse event.  </s>
<s> Scenario[A]: bar() is invoked then foo() are invoked Scenario[B]: myDocument.svg is now the current document.  </s>
<s> 3. Try to unify the event propagation mecanism across documents.  </s>
<s> Do a full capture from the referencing root element to the target element of the referenced document.  </s>
<s> Then, do the full bubbling phase from the target of the referenced document to the root element of the referencing document.  </s>
<s> Scenario[A]: bar() is invoked then foo() are invoked Scenario[B]: myDocument.svg is now the current document.  </s>
<s> The implementation of 3. is a bit tricky and it means that we have to mutate twice the event during propagation (to go from referencing document to the referenced document during the capture phase and the opposite for the bubbling phase).  </s>
<s> Futhermore, plugins might not be able to do that.  </s>
<s> The SVG WG has choosen option 2 so far and we will provide an errata to the SVG specification.  </s>
<s> Before that, we are willing to hear feedback/comments/issues from the DOM WG. How event propagation is working in a multiple namespaces environment for example or how event propagation is working with plugins might help us a lot to choose the best option.  </s>
<s> Thanks in advance, Thierry.  </s>
<s> The DOM hasn't specified event propigation between document trees.  </s>
<s> It looks like it would be easy to implement bubbling, at least, by simply installing an event handler on the root of the referenced tree that "bridges" (re-posts) the event to the referencing tree's image/ node.  </s>
<s> Capture may be more difficult to emulate, mostly because (as far as I can remember) the event target doesn't tell us whether a capture occurred and decided to block further processing, so the "bridge" handler doesn't know what to do about captures lower in the referenced tree.  </s>
<s> If this is an issue, the question becomes one of whether it should be handled by having SVG extend the events APIs or by doing that at the DOM level.  </s>
<s> But for bubbling, having SVG create a bridge handler when it builds the image/ reference seems to work perfectly well and produce the expected results (inner document sees the event before outer, and can cancel further processing, just as if it has been inserted at this point in the document tree) Joe Kesselman / IBM Research  </s>
<s> It seems that such a bridge would have to be created by the outer layer and declare a handler on the inner layer.  </s>
<s> What seems to be missing to me is the way for the outer layer to discover the document node of the embedded layer so it could register such a thing.  </s>
<s> I do not think that seperate trees should be automatically connected.  </s>
<s> Such a mechanism should be carefully considered.  </s>
<s> In some cases it would violate security to permit them to even be manually bridged, because since the trees were loaded from seperate URIs, it could be from seperate domains and bridging them could lead to one domain being able to appropriate the trust of another.  </s>
<s> Ray Whitmer rayw@netscape.com  </s>
<s> In some cases it would violate security to permit them to even be  </s>
<s> manually bridged If the DOM Event APIs are exposed, I don't see any way to prevent a relationship from being established manually -- at least not within the scope of the DOM as currently designed.  </s>
<s> This sounds like an issue for a security-aware subclass of the DOM, and I don't think that flavor is even on the Open Issues List yet.  </s>
<s> It may come closest to the read-only DOM proposal, or perhaps the transactional proposal... but I think one can make a good case for it being best left as something for higher-level code to define and deal with, since different contexts may have significantly different concerns.  </s>
<s> Joe Kesselman / IBM Research  </s>

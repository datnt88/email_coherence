<s> I'm sure nobody is surprised to hear me say that I believe the treatment of cannonicalization of objects in draft 01 of the spec still needs some work.  </s>
<s> Under the new spec, a server is compliant if it serves up ASCII plaintext as having, say CRs as line delimiters.  </s>
<s> A client, however, is compliant if it recognizes only CRLFs as line delimiters (recognizing CRs is recommended for tolerance but not required.)  </s>
<s> So different implementations may both be compilant with the spec but not interoperate properly.  </s>
<s> I hope we can agree that is not OK. Mind you, I don't even know what exactly the current spec is saying.  </s>
<s> If we are effectively requiring all implementations to understand all non-canonical forms that exist, I think we need to enumerate exactly what they are.  </s>
<s> Other than line breaks, I have no idea what non-canonical representations clients (and servers, for that matter) must understand.  </s>
<s> In the interest not of philosophical purity (as Phil H-B might say, screw philosophical purity) but making something clear and reasonable,  </s>
<s> I'd suggest something like the following phrasing: Conversion to canonical form: Internet media types [cite 1590] are registered in a canonical form.  </s>
<s> In general, Object-Bodies transferred via HTTP must be represented in the appropriate canonical form prior to the application of Content-Encoding and/or Content-Transfer-Encoding, if any, and transmission.  </s>
<s> Object-Bodies with a Content-Type of text/*, however, may represent line breaks not only in the canonical form of CRLF, but also as CR or LF alone, used consistently within an Object-Body.  </s>
<s> Conforming implementations *must* accept any of these three byte sequences as representing a single line break in text/* Object-Bodies.  </s>
<s> RATIONALE: A handful of different local representations of textual files exists in current practice.  </s>
<s> Conversion to canonical form can pose a significant performance loss, while understanding different line break representations is not an inordinate burden, nor an excessive requirement beyond current practice.  </s>
<s> Part of the question is whether it's implicit that all text/* types are ASCII-based and that CR and LF are the appropriate interpretations of octets 0D and 0A.  </s>
<s> The newest draft of MIME calls for such, as does section A.2 in the current HTTP draft, so I stuck to that path.  </s>
<s> I'm not thrilled about requiring implementations to accept different line break sequences, but we kind of have to either: 1. Require all implementations to canonicalize 2. Require all implementations to understand certain specific non-canonical forms (and say exactly what they are) 3. Require some kind of negotiation process by which servers and clients can indicate what variations each can understand We seem to mostly have consensus that 1) is a potentially too expensive.  </s>
<s> I think 3) is more complexity than we particularly want to endure right now [it would lead to something like "Accept-Encoding: unix-linebreaks" or maybe "Content-Transfer-Encoding: 8bit-sloppy-eol".]  </s>
<s> That leaves 2), which is probably what will come closest to satisfying folks.  </s>
<s> - Marc  </s>
<s> Marc VanHeyningen URL:http://www.cs.indiana.edu/hyplan/mvanheyn.html  </s>
<s> As long as we're going to redefine the Internet media types to be "as registered for MIME with some exceptions", I think we might as well handle the character set issue as well as the EOL convention one.  </s>
<s> That is: object types in HTTP denote the corresponding Internet Media Type as defined in RFC 1521 and are registered via the procedure outlined in RFC 1590.  </s>
<s> However, HTTP makes two modifications to the interpretation of "text/*" media types:  </s>
<s> a) the default character set (if no charset parameter is supplied) is  </s>
<s> ISO-8859-1, not US-ASCII.  </s>
<s> b) no requirement is placed that documents which *could* be interpreted as US-ASCII must be labelled such.  </s>
<s> (This was a MIME requirement, but shouldn't be for HTTP).  </s>
<s> c) the end of line convention depends on the character set.  </s>
<s> In particular, while US-ASCII requires 'CR LF' as a character set, the end of line in ISO-8859-1 may consist of a single CR a single LF a combined CR LF and recievers must be prepared to determine the end of line convention used in the text/ type.  </s>
<s> d) character sets such as UNICODE (where the data is represented as a sequence of pairs of octets representing the hex coding of the data) are allowed.  </s>
<s> (This is apparently not true in the latest MIME draft).  </s>
<s> e) character sets must be registered for use within HTTP; in addition to the current information that is included in the character set registration by IANA, the registration must describe the end of line convention for the character set, and include information about how to map the character set definition into other character sets or icons.  </s>
<s> The HTTP standard should define use of character sets US-ASCII and ISO-8859-1, at the least, and probably could include descriptions of UNICODE-1-1 (two octets per character), UNICODE-1-1-UTF-8 and UNICODE-1-1-UTF-7 as per RFC1641 and RFC1642.  </s>
<s> I'm happier with a definition that defines how clients are supposed to *interpret* the data than one that speaks of 'canonicalization' or 'conversion', or where it is somehow the transport (HTTP) that is messing up.  </s>
<s> I like both proposals, and will endeavor to fit both within the next draft.  </s>
<s> I think it is reasonable to include both how HTTP interprets media types and what procedure is needed to transform HTTP objects to conformant MIME objects.  </s>
<s> Thanks for the detailed explanations, ......Roy Fielding ICS Grad Student, University of California, Irvine USA  </s>
<s> I was just on the verge of finishing up a paper explaining the issues, and proposing use of UTF etc.  </s>
<s> I will still send this out as it's relevant for browser writers, and HTML authors.  </s>
<s> Just to clarify, in Larry's proposal, the Accept-charset is not required because we can do the same thing via:  </s>
<s> However, how do we handle text/sgml, text/plaintext etc? Can they be handled the same way, or do we still need Accept-charset.  </s>
<s> I will be sending out my text tommorrow.  </s>
<s> They do seem rather intertwined.  </s>
<s> I, of course, have an absurdly naive hope that, because the MIME folks have not yet set this issue into even RFC-level stone let alone STD-level stone, it might be possible for MIME and HTTP to doe it the same way.  </s>
<s> As I read the MIME spec, it says that US-ASCII text "should" be labeled as US-ASCII and not some superset like ISO-8859-1 (and, in general, meta-data should be specify the lowest common denominator possible for understanding.) I guess I don't really see the advantage of changing the default in this fashion, though I don't see it as a big problem either.  </s>
<s> I just worry that a nontrivial subset of people think that allowing 8859-1 addresses cross-linguistic use, which of course it doesn't except for a few languages in a small part of the world.  </s>
<s> Environments where US-ASCII can be displayed but 8859-1 cannot are still plentiful; I'm using one right now, and run it under Lynx all the time (and have 8859-1 characters quietly converted to graphical gibberish, which is not ideal behavior.)  </s>
<s> Hmmm... I guess I don't see the connection.  </s>
<s> Is broadening the acceptable representations for EOL in 8859-1 significantly less radical, more in line with current practice, or in some other meaningful way preferable to just doing it for US-ASCII?  </s>
<s> [ some stuff I mostly agree with deleted ]  </s>
<s> I think it's the same thing by different terms; as long as the specification is clear and not guesswork-oriented.  </s>
<s> Marc VanHeyningen URL:http://www.cs.indiana.edu/hyplan/mvanheyn.html  </s>
<s> Yep.  </s>
<s> Yep.  </s>
<s> All text/* types use the charset parameter.  </s>
<s> SGML would likely be application/sgml, and its character set is defined in one of the declarations, though it could also have a charset paramenter if that's how they define the media type.  </s>
<s> ......Roy Fielding ICS Grad Student, University of California, Irvine USA  </s>
<s> Accept-charset could be included as a possible shorthand for multiplexing acceptable charset parameters for ALL types that have a 'charset' parameter, but I think it is only worthwhile if the client accepts multiple charsets and multiple types that take a charset parameter.  </s>
<s> I'm not sure it's worth the complexity of the model, or whether we want a more general way of multiplexing parameters for the types that are named by accept clauses, and I don't think it belongs in the standard without at least a little implementation experience.  </s>
<s> I would like to see it in there, but II will leave the reasoning until I send out my paperr.  </s>
<s> The last sentence I can agree with.  </s>
<s> Hence I will not push strongly for Accept-charset: until it actually appears to be needed.  </s>
<s> Until then, the charset parameter will suffice.  </s>
<s> I'm *very* glad that content parsing is now a function of the character encoding system.  </s>
<s> This will simplify many things.  </s>

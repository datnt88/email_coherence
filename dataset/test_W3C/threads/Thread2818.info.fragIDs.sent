<s> Something interesting has come up that's one of: a bug or infelicity in my server, or a bug or infelicity in Netscape 4.5 Netscape 4.5 sends an HTTP/1.0 request with Accept-Encoding: gzip header.  </s>
<s> A web site has a paper.ps.Z file, i.e., Content-type:  </s>
<s> application/postscript, Content-Encoding: compress.  </s>
<s> When NS 4.5 tries  </s>
<s> to GET the paper, my server returns 406 Not Acceptable, because "compress" is not one of the accepted encodings.  </s>
<s> There seem to be two (not mutually exclusive) conclusions to draw: 1) Netscape 4.5 should send Accept-Encoding: gzip, compress, because gzip (well, the gzip program, anyway) understands the Unix compress format.  </s>
<s> 2) My server should not send 406, since it's only a SHOULD requirement anyway.  </s>
<s> Or perhaps it should send 406 only for HTTP/1.1 requests.  </s>
<s> Opinions/comments? Dave Kristol  </s>
<s> Dave, Content negotiation is hard, ain't it?  </s>
<s> I think you have run into an "infelicity" rather than a true bug, and that the infelicty is shared between server and client.  </s>
<s> It seems quite likely that the Netscape 4.5 client is using a gzip plugin  </s>
<s> or program capable of handling compress, so it would be better  </s>
<s> were it configured to send an Accept-Encoding header which indicated that capability.  </s>
<s> The server can't presume that, though, as someone might have implemented a library which did gzip encoding but not compress encoding (for licensing or religious reasons).  </s>
<s> The infelicity on the server side is that it is sending  </s>
<s> out pre-compressed files in a single format.  </s>
<s> In the best of all  </s>
<s> possible worlds it would always have the non-compressed format  </s>
<s> available, or would be applying the compression on the fly based on the accepted encodings, or even removing the compression on the fly.  </s>
<s> Since the Accept-Encoding header has a default inclusion of "No Encoding", that would guarantee that *something* was always available.  </s>
<s> Not really a bug in either case, just an infelicity.  </s>
<s> regards, Ted Hardie PS. Today is my last day at NASA; mail will be forwarded, but communication after November 11th should go to me as hardie@equinix.com  </s>
<s> I think gzip and compress are different encodings.  </s>
<s> The fact that a program called "gzip" understands both is not relevant.  </s>
<s> me too ...  </s>
<s> What does your server do if a client sends a request with *no* Accept-Encoding?  </s>
<s> I think that's what it should do in this case.  </s>
<s> (E.g. send it as application/octet-stream). It is quite likely that there will be clients which support some content encodings but not all the ones you support.  </s>
<s> I don't think you want your server to be in the situation where it completely refuses to serve a file to such clients.  </s>
<s> Better I think is that the server maintain two versions or in this case, uncompress on the fly ... or send a choice page that lets the user click the link for the explicit file... my assumption being that the request was for the resource w/o the _Z ... if the _Z is requested, then John's approach is reasonable ... one of the things missed in this whole mess is that the user *MAY* simply want the file delivered unmolested and saved on the hard drive.  </s>
<s> It is quite inconvenient for me when something is unziped or uncompressed by browsers, servers, etc. Dave Morris  </s>
<s> I think gzip and compress are different encodings.  </s>
<s> The fact that a program called "gzip" understands both is not relevant.  </s>
<s> What does your server do if a client sends a request with *no* Accept-Encoding?  </s>
<s> I think that's what it should do in this case.  </s>
<s> (E.g. send it as application/octet-stream).  </s>
<s> It is quite likely that there will be clients which support some content encodings but not all the ones you support.  </s>
<s> I don't think you want your server to be in the situation where it completely refuses to serve a file to such clients.  </s>
<s> John Franks john@math.nwu.edu  </s>
<s> Dave Kristol:  </s>
<s> Netscape would be allowed to include 'compress' in its Accept-Encoding line, but there is nothing in the spec which says that it should.  </s>
<s> If the above paper is available in ps.Z version only (so we don't have content negotiation in the sense of multiple variants) I would never send a 406.  </s>
<s> The 1.1 spec says: Note: HTTP/1.1 servers are allowed to return responses which are not acceptable according to the accept headers sent in the request.  </s>
<s> In some cases, this may even be preferable to sending a 406 response.  </s>
<s> and your situation is one of the 'some cases'.  </s>
<s> In your case I would return the document with Content-type: application/x-compress (MIME type from memory, I may be wrong) which will probably result in the end user having to handle the top-level .ps  </s>
<s> format by hand, but at least it will prevent compressed data from being fed into a postscript helper application.  </s>
<s> In fact I would say that, given the current installed base and if you are aiming for maximum interoperability, if a server is in the situation of only being able to send .ps.Z, it should always serve it with the above content-type, and never with the content-type/content-encoding values you mention above.  </s>
<s> If it is going to switch headers on a case by case basis, it should add the appropriate headers to disable proxy caching.  </s>
<s> Your scenario is really a case where a server has to choose between evils: really fixing the problem involves having the content author change the .ps.Z into .ps, or a choice between .ps and .ps.gz.  </s>
<s> Koen.  </s>
<s> See section 3.5; I believe it is clear on the topic.  </s>
<s> The tokens refer to algorithms; not programs.  </s>
<s> gzipAn encoding format produced by the file compression program ``gzip'' (GNU zip) as described in RFC 1952 [25].  </s>
<s> This format is a Lempel-Ziv coding (LZ77) with a 32 bit CRC.  </s>
<s> compress The encoding format produced by the common UNIX file compression program ``compress''.  </s>
<s> This format is an adaptive Lempel-Ziv-Welch coding (LZW).  </s>
<s> Use of program names for the identification of encoding formats is not desirable and is discouraged for future encodings.  </s>
<s> Their use here is representative of historical practice, not good design.  </s>
<s> For compatibility with previous implementations of HTTP, applications SHOULD consider ``x-gzip''  </s>
<s> and ``x-compress'' to be equivalent to ``gzip'' and ``compress'' respectively.  </s>
<s> That a particular implementation chooses to use a gzip program that happens to also handle compress is an implementation issue; it should declare what algorithms it actually implements.  </s>
<s> Note the historical note.  </s>
<s> We been here before, and done this folks.  </s>
<s> - Jim  </s>
<s> [N.B.  </s>
<s> I never received John Franks's message, either directly, or via the mailing list.]  </s>
<s> Yup, folks, I really did know they are different encodings.  </s>
<s> My point was that perhaps NS 4.5 was able to decode both "gzip" and "compress" encodings because the gzip *program* can decode both.  </s>
<s> Just a hunch, although I was told privately that NS 4.5 probably cannot decode "compress".  </s>
<s> I think Koen's remarks were most appropriate about not sending 406 in the absence of negotiation.  </s>
<s> However, I don't agree with the idea of sending Content-type: application/x-compress, except in a nice theoretical world.  </s>
<s> Browsers that don't send Accept-Encoding work quite nicely with my server (assuming they understand x-compress).  </s>
<s> So I'm more inclined just to ignore Accept-Encoding.  </s>
<s> To John Franks's (apparent) question, what do I send in the absence of Accept-Encoding: I send Content-Type: application/postscript and Content-Encoding: x-compress.  </s>
<s> I would not send application/octet-stream.  </s>
<s> I disagree mildly with Dave Morris's unhappiness that browsers, etc., might uncompress something for him.  </s>
<s> What *I* want varies with the situation.  </s>
<s> If I have a viewer for PostScript or PDF, for example, I want the incoming compressed object to be uncompressed and passed to the viewer.  </s>
<s> OTOH, if I'm saving a file, I *don't* want the object to be uncompressed.  </s>
<s> (Maybe that's what he meant.)  </s>
<s> Thanks for the many comments.  </s>
<s> Dave Kristol  </s>
<s> Yikes!  </s>
<s> If you reference LZW in the HTTP spec, then RFC 2026 section 10.3.2 comes  </s>
<s> into effect.  </s>
<s> That means you have to document the Unisys patent in the spec and the IETF executive director will have to contact Unisys with a request for openly specified, reasonable, non-discriminatory licensing terms.  </s>
<s> - Chris  </s>
<s> I just tested and Netscape 4.5 for Unix seems to handle gzip and compress just fine.  </s>
<s> Here a file xxx.ps.Z was requested (presumably with Accept-Encoding only containing gzip) and a compressed ps document was returned with Content-Encoding x-compress and Content-type application/postscript.  </s>
<s> NS properly uncompressed it and handed it off to the postscript viewer.  </s>
<s> I think I agree with this.  </s>
<s> It is current practice in HTTP/1.0 so it should continue there, at least.  </s>
<s> But I think Dave may be right and this is good behavior in 1.1.  </s>
<s> Any disagreement?  </s>
<s> Given that this behavior does not fail ungracefully in current 1.0 browsers, I would assume that 1.1 browsers would also do something reasonable (save to disk) when they can't handle a given content encoding.  </s>
<s> Well, on reflection, I think you are right.  </s>
<s> And that's what my server does too.  </s>
<s> :)  </s>
<s> Again I agree with this behavior, but I am not sure the protocol has something to say about it.  </s>
<s> John Franks john@math.nwu.edu  </s>
<s> If you want to bring this to the attention of the IESG, the IESG may decide to attach a note to the HTTP draft specification that the use of the "compress" encoding might be covered by patent claims, and I may need to ask the implementations surveyed for implementation of content-encoding whether they have "taken adequate steps to comply with any such rights, or claimed rights".  </s>
<s> However, the "significant implementation and successful operational experience" with the use of the "compress" encoding leads me to assert that there is no barrier to the use of "compress" in advancing to Draft Standard status.  </s>
<s> I'll review this with the area directors, though.  </s>
<s> Larry  </s>
<s> From: Chris Newman Chris.Newman@innosoft.com  </s>
<s> Date: Tue, 03 Nov 1998 14:44:39 -0800 (PST) Subject: Re: Netscape 4.5 and HTTP/1.1 Accept-Encoding  </s>
<s> I don't think we have a problem here: compress is not required for interoperability, is essentially deprecated (by deflate and gzip), and it is not a normative reference (beyond saying it is what a program does).  </s>
<s> And it is documenting existing practice (i.e. was in even RFC 1945, I think).  </s>
<s> - Jim  </s>

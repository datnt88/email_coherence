<s> I have a question about interface EntityReference.  </s>
<s> EntityReference definition has following sentence.  </s>
<s> (on WD-DOM -19980720) The replacement value, if it is available, will appear  </s>
<s> in the child list of the EntityReference.  </s>
<s> If two or more entity references which reference same entity appered in one document, many copies of replacement value are created in the DOM object tree?  </s>
<s> KAZUMI Saito FUJITSU Laboratories Ltd.  </s>
<s> Since replacement value doesn't change after the entity has been created, I think you'd wind up with many _references_ to the replacement value but only need one copy.  </s>
<s> True?  </s>
<s> as long as the user sees an Entity each time they walk through the EntityReference, you can implement the actual object any way you want.  </s>
<s> So yes, your interpretation matches mine.  </s>
<s> There is often a difference between the logical structure of the DOM (what the script writer sees) and the implementation of that structure.  </s>
<s> Lauren  </s>
<s> It is very difficult to implement this any way but by making actual copies, because each occurrance of the Entity has to have, or appear to have, the correct parentNode and sibling links.  </s>
<s> On the other hand, it's very _easy_ to implement if you have a TreeIterator or some such, because then the iterator can hide the actual structure and descend into the Entity rather than its reference.  </s>
<s> That's what we're doing in our implementation.  </s>
<s> We are essentially filtering documents, so we have to be able to reconstruct them on the output in a form identical to the input.  </s>
<s> We leave the EntityReference nodes in the tree, and our iterators do the replacement on the fly.  </s>
<s> This brings up a weak point in both the XML and the DOM specs -- no consideration at all is given to the possibility that one might want to _output_ a document, in which case replacing each EntityReference with its corresponding Entity is WRONG.  </s>
<s> The whole assumption is that the parser is a front-end for an application that doesn't want to know about the _real_  </s>
<s> structure of the document.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> To be more correct, all the direct descendants of an EntityReference have to have the "correct" parent and siblings.  </s>
<s> Entity only lives in DocumentType.  </s>
<s> the _real_  </s>
<s> This is less true of the DOM.  </s>
<s> The ability to naively write out a document and get pretty much the right structure has been an important goal.  </s>
<s> In message "RE: EntityReference", Gavin Thomas Nicol wrote...  </s>
<s> Thank you, I recognized some problems about EntityRefernce implementation.  </s>
<s> Why "The replacement value, if it is available, will appear in the child list of the EntityReference" ?  </s>
<s> I have believed the DOM Object tree is another representation of XML (text) file.  </s>
<s> Then EntityReference needs only entity's identifier not replacement value, I think.  </s>
<s> x x x  </s>
<s> This neatly illustrates a point I have been trying to make for some time, namely that the behavior required by the specification is appropriate for some DOM applications, BUT NOT ALL.  </s>
<s> In a scripting application, which the DOM is clearly aimed at, replacing entity references with their values, keeping nodelists up-to-date with a file being read in, and constructing nonce parents for nodes under construction, are all appropriate.  </s>
<s> What I want to see is SOME consideration in the specification for different kinds of applications, such as server-side processing, document transformation, syntactic verification, indexing, and editing, for which these behaviors are NOT appropriate.  </s>
<s> I want the specification to make it clear that these behaviors are OPTIONAL, and required only in applications where they make sense.  </s>
<s> Please note: I'm not asking for any extensions, and I'm not asking for any changes whatever in the attributes and methods defined in the interfaces.  </s>
<s> All I'm asking for is changes in the _descriptions of the semantics_ of those interfaces, and mainly by changing "is" or "must" to "may".  </s>
<s> Is that too much to ask?  </s>
<s> What I really want is the right to claim that my code "implements the DOM" instead of having to say: "implements the interfaces defined by the DOM specification, but with the major changes in the semantics necessary for an efficient implementation of my application".  </s>
<s> I think that the DOM continues in its present course, it is in danger of becoming the ``Scripting Object Model'' and being essentially useless for any other purpose.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> For better or worse, the Level 1 DOM is being driven by the need for a standard that allows Dynamic HTML scripts that interoperate between the NS and MS browsers.  </s>
<s> We are, to a certain extent, rushing the spec out the door to avoid missing the window of opportunity provided by the 5.0 releases of the browsers, because if we miss it, the opportunity is gone forever.  </s>
<s> Clearly full-blown XML support and serious consideration of server-side processing has suffered from this.  </s>
<s> Level 2 *can* address these issues much more effectively, and one possibility for Level 2 is a minimal DOM (perhaps synchronized with some subset of XML that others may be defining).  </s>
<s> It's  </s>
<s> important for people who care about them to make their needs known, via  </s>
<s> their W3C reps, by joining the W3C, by regularly looking for Level 2 information on our Web site and participating on this mailing list, etc.  </s>
<s> Just how much time do we have?  </s>
<s> In the interests of moving things along, let me make some very specific suggestions: 1. in Document under "getElementsByTagName" add: In an application in which a Document is being read in or constructed in parallel with other processing, the NodeList returned by getElementsByTagName must be ``live'' in the sense of being continually appended to whenever a new Element with the given tag  </s>
<s> name is added to the Document.  </s>
<s> 2. in Node: add: boolean inDocument(); This will allow ``orphan'' nodes to be identified without requiring each Document to have an identifiable DocumentFragment that contains newly-created nodes.  </s>
<s> It does not preclude such a fragment, however.  </s>
<s> clarify: whether the "name" attribute of an Element is the same as the the result of getTagName on that Element.  </s>
<s> replace: attribute wstring nodeValue; with: attribute wstring data; attribute NodeList nodeValue; There needs to be some verbiage to the effect that if a node has children, then nodeValue must contain the result of substituting all entity references with their values in those children, and data must contain the result of converting nodeValue to a string.  </s>
<s> If the Node is an EntityReference, then its nodeValue must be the nodeValue of the corresponding Entity.  </s>
<s> (Alternatively, nodeValue could be added to Entity, EntityReference, and Attribute, but I think it's better in Node.) The effect of this is to permit both string-valued nodes like Text and node-valued nodes like Entity and EntityReference.  </s>
<s> This will also make it possible to remove the "data" attribute from Data.  </s>
<s> Another effect will be to make the substitution of entity references with their values take place lazily at the point where those values are actually used.  </s>
<s> It might be better if there were a method, getValue(), instead of the attribute nodeValue().  </s>
<s> 3. in EntityReference: replace: ``The replacement value, if it is available, will appear in the child list of the EntityReference.'' with: ``The replacement value, if it is available, will appear in the nodeValue of the EntityReference.'' 4. It would be useful if there were an extension of NodeList corresponding to what used to be EditableNodeList, i.e. a NodeList you could modify.  </s>
<s> I'm doing the latter now.  </s>
<s> Unfortunately our small research group is a subsidiary of a large company, so it will take a while before I can move the necessary two requests (for full and affiliate memberships) through a set of management on either side of the Pacific.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> Essentially none.  </s>
<s> The spec must go to the W3C ASAP, by the middle of next week at the latest.  </s>
<s> We're discussing this, although there seems to be some confusion as to why this is necesary to you and others who have suggested it.  </s>
<s> As for your other suggestions, I'll take a close look at them the next pass thru the spec.  </s>

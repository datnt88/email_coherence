The XQuery spec section 2.1.1.1 mentions "Base URI" as part of the
static context, and that it is used by xf:document. However, it
doesn't actually define it. The Functions and Operator spec says
the default base URI is "of the stylesheet element containing the
call to the document function". But what is a "stylesheet
element"? Is it defined anywhere? The only thing I can think of is
that it is the uri of the actual XQuery source code. But this seems
rather useless. It's like saying that the default directory used
by a fopen in a C program is the directory containing the C program
source.
If an XQuery program can be compiled on one machine, and then moved
to a completely different machine (which of course it can) then the
concept of "base URI of the stylesheet element contaning the call to
the document function" becomes are really bad idea.
I suggest changing it so the the Base URI is defined by the execution
enevironment, not the compilation environment, of the XQuery program,
and in an implementation-defined manner.
--Per Bothner
per@bothner.com http://www.bothner.com/per/
This is a cut-and-paste error; the specification of the document() function
was transferred from the XSLT specification. The reference should now be to
the static context. And XQuery needs to define how this variable in the
static context will be initialized (it will probably just say that it's
implementation dependent).
The
only thing I can think of is that it is the uri of the actual
XQuery source code. But this seems rather useless.
Possibly. But it's the normal convention on the web that when one file
contains a reference to another, the reference is considered to be relative
to the file in which the reference was contained. Yes, this makes it
difficult to move files around: which is one reason xml:base was invented.
But of course, an XQuery expression, not being an XML document, cannot take
advantage of xml:base. In practice I think it's most likely that queries
will use absolute URIs.
Thanks for the comment.
Michael Kay
But it is *not* the source file that contains the reference.
The filename is an expression that is calculated at run-time.
And the normal convention for when a filename is calculated
at run-time, then the reference is relative to the current
*run-time* context (directory).
The spec for the document() function distinguishes the case where the
argument is a string from the case where it is a node. In the first case,
the base URI is taken from the static context, in the second case, it is the
base URI of the node containing the relative URI. The first case is designed
primarily for the situation where the value is a string literal. In the case
of a computed string, you can select an alternative base URI by supplying
the second parameter to the document() function. This, I think, was designed
to enable you to supply a run-time base URI. Perhaps the spec should be
refined so that the second argument is also allowed to be a string, rather
than necessarily a node.
Which of course is difficult because there is no convenient
way for an application to get an absolute url from the
execution environment - i.e. no way reasonable way to get a
string parameter from the environment. I suggested way to do
that in the posting "Variable Declaration in Query Prolog"
from March
(http://lists.w3.org/Archives/Public/www-xml-query-comments/2002Mar/0007.htm
l).
I was disappointed to not get a response of this, since I think this is an
essential
feature for practical use of XQuery.
I think there is a good argument for allowing a query to take parameters, in
the same way as stylesheets can. On the other hand, there is an alternative
argument that a query with parameters is no different from a function, and
if you want this capability the right way to provide it is to allow the API
to invoke an XQuery function directly.
Michael Kay

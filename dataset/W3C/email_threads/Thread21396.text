Hi folks,
I have installed the ZAnnot server o OS X (fairly easy to do) and on Windows
(ridiculously easy). I will shortly have written up instructions for
installation and configuration to make them run. But if anyone else has
installed the ZAnnot server on Windows they might be able to help me out...
I had no problem posting Annotations to it, but for some reason it will not
return them to me. I tested using the ruby command-line annodemo tools at
doesn't get anything. The same tools work fine to post to the server, and the
annotations are shown in the server management interface, and on Moc OS X the
same tools all work fine. I have only tested on Windows using localhost and
annotating local files (I don't have a Windows machine that I can set up as
an online server at the moment).
Any help available?
The very rough draft of instructions that I am working on is at
if anyone wants a preview of an unstable and incomplete draft...
cheers
Chaals
Post: 21 Mitchell street, FOOTSCRAY Vic 3011, Australia or
W3C, 2004 Route des Lucioles, 06902 Sophia Antipolis Cedex, France
* Charles McCathieNevile charles@w3.org [2003-01-18 20:24-0500]
Thanks, this is a good start. I'm trying to test this under Debian. Brief notes so far:
apt-get install zope
...just worked. It sets up a user and runs the server for you too.
Default Zope port: seems to be 9673 rather than 8080, currently at least. This
confused me for a few minutes.
aside:
I was out of luck when I tried to reconfigure Zope by running:
dpkg --configure zope
I had to remove and reinstall it, deleting some files by hand, as the only
quick way I could find to blank down the admin user I'd created and start afresh.
apt-get remove zope
rm -rf /var/lib/zope
The reason I re-installed was for some reason, when I first set up an admin
user I followed your guide and asked for a restriction to 'localhost' for domain, but
the way my box is set up, that doesn't work and I couldn't log in as the Zope
administrator.
What I did next:
action: selected 'acl_users' folder.
msg: "there are no users defined."
action: selected [Add...] button
msg: "To add a new user, enter ... (user details)"
action: I created a user 'annouser', and selected 'manager' from Roles, then [Add...]
msg: The following users have been defined. Click on the name of a user to edit that user.
So now everything _except_ the Annotations stuff is set up fine.
There isn't a Debian package of ZAnnot that I'm aware of, so (via Google --
Charles can you add a link to the ZAnnot pages?) I follow the instructions in
Here's what I did to install ZAnnot on top of my working Zope system:
cd lib/python/Products/
cd /usr/lib/zope/lib/python/Products; wget http://www.zope.org/Members/Crouton/ZAnnot/ZAnnot-0.3.tgz
tar -zxvf ZAnnot-0.3.tgz
zopectl restart
Then closing browser and restarting it, I log into http://localhost:9673/manage/
as the annouser I just created.
I'm now at step: "3. Add an annotation server object" of the
howto, and this is where I get lost.
I don't know enough about Zope, ZANnot etc to know if my setup is OK. From the
ZAnnot README I just unpacked:
Setting up your annotation server
Add an instance of the 'Annotation Server' object somewhere in
your Zope site. That's it, you're ready to go! You may want to
create accounts for users allowed to post annotations. See the
Zope documentation for instructions on how to create and manage
users.
At this point, I can't see an 'Annotation Server' type in the
'Select type to add' form widget at http://localhost:9673/manage/
...should it appear alongside 'File', 'Folder', 'DTML Document' etc etc?
I've also tried restartign the server through the Zope Web interface. No joy.
Nosing a bit further, under Control_Panel, 'Product Management', I find a list
of Zope addons, ie. 'Products'. Helpfully, ZAnnot is listed as:
ZAnnot (Broken product ZAnnot)
...complete with an icon indicating a broken installation. Selecting that
gets me some useful debug information:
Import Traceback
Traceback (most recent call last):
File "/usr/lib/zope/lib/python/OFS/Application.py", line 531, in import_product
product=__import__(pname, global_dict, global_dict, silly)
File "/usr/lib/zope/lib/python/Products/ZAnnot/__init__.py", line 1, in ?
import ZAnnot
File "/usr/lib/zope/lib/python/Products/ZAnnot/ZAnnot.py", line 15, in ?
from AnnotRequestParser import AnnotRequestParser
File "/usr/lib/zope/lib/python/Products/ZAnnot/AnnotRequestParser.py", line 8, in ?
import xml.parsers.expat
ImportError: No module named xml.parsers.expat
At this point I realise I have no idea which version of Python Zope is using,
there are a couple on the system. I assume 2.1 as that's what 'python' is:
/usr/bin/python -v
# /usr/lib/python2.1/site.pyc matches /usr/lib/python2.1/site.py
So I do:
apt-cache search python | grep -i xml
...to find likely looking packages, and correctly guess that:
apt-get install python2.1-xml
zopectl restart
....will do the business.
Revisiting the control panel in Zope after it restarts, Anno stuff is OK and
appears in the 'select type to add' dropdown.
I successfully create a folder called 'anno' and a server inside it called 'server'.
Seems OK so far, but I've not tested things further yet. Visiting
the browser just hangs. Not sure if that is because there's no data there, because
the access control settings are wrong, or some other reason.
Anyway, I'm nearly there! Will revisit this later in the week. Any tips welcomed...
cheers,
Dan
Presumably this is to do with the way debian is set up. I'll note it..
Yep, did that about 10 minutes before your message :-)
I suggested apt-getting python2.1-xml in my instructions. With minimal
experience of debain packages and no test sytem I am open to all
suggestions...
If you configure your favourite annotea client to post anotations to and get
them from http://localhost:9673/anno/server you should be able to annotate
something, and then query for annotations on that thing and get the results.
Unlike the W3C server I don't think the ZAnnot server provides a default
HTML form interface - if you don't talk annotea to it you get no joy...
cheers, and thanks for your results...
chaals
I put my windows machine online, and annotated a header on the W3C homepage.
As always, the ZAnnot server handled it fine, and this time Amaya could find
the annotation as well. So I am wondering what Amaya sends as the URI ift is
looking for annotations for when they are of the form file://
I next annotated http://www.example.org using the ruby annopost and tried to
load the annotation in Amaya. It told me there was an orphan annotation, and
then couldn't load it because it couldn't find annotest.w3.org (which must be
hard-coded in there somewhere, because I haven't put it in any config stuff.
Finally, I cannot delete my username - in the configuration box for Annotea
User I keep deleting it and Amaya keeps putting it back.
(and I still cannot get anything from the Zope server running on Windows
using the ruby annoget tool, although it works fine on OS X.)
cheers
Chaals
Post: 21 Mitchell street, FOOTSCRAY Vic 3011, Australia or
W3C, 2004 Route des Lucioles, 06902 Sophia Antipolis Cedex, France
"Charles McCathieNevile" charles@w3.org wrote in message
news:Pine.LNX.4.30.0301182018390.7127-100000@tux.w3.org...
out...
not
it
the
the
and
as
If you want me to chuck it onto a windows server, I'll offer up one of mine
to the cause, and we can then have a publically available one to play
against.
Jim.
* Jim Ley jim@jibbering.com [2003-01-19 16:40-0000]
Sounds good to me. Soon we might have enough of these to start investigating
service discovery and query routing between them...
Dan
That would be great Jim.
The install is about a 5-minute process, and on windows it sets you up as the
manager during the install so you just need to add the annotation server
object, give it an id and title, then set the security properies.
Cheers
Chaals
Post: 21 Mitchell street, FOOTSCRAY Vic 3011, Australia or
W3C, 2004 Route des Lucioles, 06902 Sophia Antipolis Cedex, France
Charles,
Your bug report is incomplete. As you're using your ruby tools, can you
copy the result of your query? I can't help you much without that.
If it says orphan annotation it means that your XPointer was invalid or
obsolete.
Do you mean Annotations rather than Annotea?
That works for me. Did you press the "Apply" button? What are the
access rights on your ~/.amaya/thot.rc file?
-jose
Well, I think I understand one bit of wierdness - the server isn't returning
a context, or at least not always. But there are other oddities noted
below...
(I can't tell which are Amaya and which are ZAnnot and whether any are due to
the annotools. More testing required :(
cheers
Chaals
My annotation posted was on the document as a whole, got a 200 OK response
from the server and appeared as a normal annotation in the server. When Amaya
got to the page it went looking for an annotation server I had never asked it
to look for. (This is the wierdest thing that happened)
Testing it on a unix system does something a little less odd - it finds the
annotation, (I made one using http://www.w3.org/ as an external body) but in
trying to load it I get the following body
406 Not Acceptable
Not Acceptable
An appropriate representation of the requested resource /Overview.var could
not be found on this server.
Available variants:
Overview.html , type text/html, charset utf-8
Yep.
I think I did. This is on a windows system, using a default amaya 7.1 release
install. The oddd thing is it updates the servers when I change them without
a problem - it just keeps putting back a username when I delete it. (I can't
find a log of requests on the Zope server, and I don't have my windows
machine handy to look at now - I will check these again later.
My unix Amaya 7.1 (release distribution of source compiled under fink on Mac
OS X) keeps proposing a username too.
Post: 21 Mitchell street, FOOTSCRAY Vic 3011, Australia or
W3C, 2004 Route des Lucioles, 06902 Sophia Antipolis Cedex, France
Sorry I haven't had a chance to respond to your emails. Busy week at
work :( If your windows machine is online, would you be willing to give
me an account so I could take a look at what might be going on?
Thanks!
--Brent
"The programmer, like the poet, works only slightly removed from pure
thought-stuff. He builds his castles in the air, from air, creating
by exertion of the imagination. Few media of creation are so
flexible, so easy to polish and rework, so readily capable of
realizing grand conceptual structures."
-- Frederick Brooks, Jr., The Mythical Man Month
Brent,
thanks for the response. I haven't got it online :( As near as I could tell,
when there was no difference between the context and the thing being
annotated it was just not returning a context, and so Amaya thought it was an
orphan, but I am not sure about that.
I have no idea why the annoget.rb wasn't working - that seeems to be windows
wierdness, since the same code works fine under Mac OS X running ruby.
I am hoping Jim Ley will set up a windows server with ZAnnot so we can test
against that. (But other volunteers would be appreciated...)
cheers
Chaals
Post: 21 Mitchell street, FOOTSCRAY Vic 3011, Australia or
W3C, 2004 Route des Lucioles, 06902 Sophia Antipolis Cedex, France
Aha. My problem was using the development version of Ruby - for some reason
my scripts don't work under the latest version. (And my second problem was
some wierd de-install when I switched versions and it didn't work).
(My Amaya keeps refusing to accept a blank annotations user option, but
that's pretty minor)
Cheers
Chaals
Post: 21 Mitchell street, FOOTSCRAY Vic 3011, Australia or
W3C, 2004 Route des Lucioles, 06902 Sophia Antipolis Cedex, France
* Charles McCathieNevile charles@w3.org [2003-01-26 08:27-0500]
Yup, I've had cgi/net troubles with the 1.7 Ruby dev't versions,
rolling back to the latest stable worked for me (on windows/cygwin, fwiw).
Dan
"Charles McCathieNevile" charles@w3.org wrote in message
news:Pine.LNX.4.30.0301260819490.14555-100000@tux.w3.org...
reason
Does this mean there's no longer a need for me to get a ZAnnot system
installed?
Jim.
Well, we don't need it for figuring out why it doesn't seem to work, becuase
it does work. But it would be nice to have one running to look at issues that
arise from working with multiple servers.
cheers
chaals
Post: 21 Mitchell street, FOOTSCRAY Vic 3011, Australia or
W3C, 2004 Route des Lucioles, 06902 Sophia Antipolis Cedex, France

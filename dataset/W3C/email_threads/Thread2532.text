he following got dropped on the floor, but for good cleanlyness
reasons, I'm sending it to the list in case someone has some problem with
declaring it closed, as it was marked otherwise in the issues list.
- Jim Gettys
I sent the appended message to the list 12 days ago. While a few other
messages with the same Subject: line appeared on the list after
I posted that message, none were in direct response to it.
Therefore, I suggest that you treat this issue as CLOSED,
with the resolution being the two-paragraph update to section
13.9 proposed in this message.
-Jeff
------- Forwarded Message
Return-Path: http-wg-request@cuckoo.hpl.hp.com
Received: by acetes.pa.dec.com; id AA18655; Wed, 16 Apr 97 14:47:13 -0700
Received: by pobox1.pa.dec.com; id AA08115; Wed, 16 Apr 97 14:47:12 -0700
Received: from palrel1.hp.com by mail2.digital.com (5.65 EXP 4/12/95 for V3.2/1.0/WV)id AA19122; Wed, 16 Apr 1997 14:42:56 -0700
Received: from cuckoo.hpl.hp.com (cuckoo.hpl.hp.com [15.144.62.116]) by palrel1.hp.com with ESMTP (8.7.5/8.7.3) id OAA02734; Wed, 16 Apr 1997 14:41:50 -0700 (PDT)
Received: (from procmail@localhost) by cuckoo.hpl.hp.com (8.7.1/8.7.1) id RAA17737; Wed, 16 Apr 1997 17:41:29 -0400 (EDT)
Resent-Date: Wed, 16 Apr 1997 17:41:29 -0400 (EDT)
Message-Id: 9704162132.AA18610@acetes.pa.dec.com
From: Jeffrey Mogul mogul@nospam.org
Subject: Re: Issues-list item "CACHING-CGI"
Date: Wed, 16 Apr 97 14:32:40 MDT
Sender: mogul@pa.dec.com
Resent-Message-Id: "nRG-O3.0.1L4.4UKLp"@cuckoo
Resent-From: http-wg@cuckoo.hpl.hp.com
X-Mailing-List: http-wg@cuckoo.hpl.hp.com archive/latest/3081
X-Loop: http-wg@cuckoo.hpl.hp.com
Precedence: list
Resent-Sender: http-wg-request@cuckoo.hpl.hp.com
Wow, things are confused. Part of this is my fault, for writing
something that wasn't as precise as it should have been.
Most of the confusion is on the part of people who do not distinguish
between "what a CGI script should send" and "what a cache should do
when a CGI script doesn't send what it should have sent".
OF COURSE, CGI-generated responses (and all other origin server
responses, too) should include either an explicit "don't cache
this" marking (e.g., "Cache-control: max-age=0") or an explicit
expiration time. Of course, of course, of course.
That wasn't the question. The question (which I stated too
informally) was "what happens when the response is NOT clearly
marked as to cachability?" This is a *different* question.
Current practice seems to be split. Ari says that the CERN
and Netscape proxies never cache a response without a Last-Modified
header. (With HTTP/1.1, this rule would presumably change to
"without either a Last-Modifed or Etag header.") However,
the practice in the Squid world seems to be different. I'm
not sure I fully understand the Squid code, but the version
I looked at seems to allow caching of a response without
a Last-Modified header.
I was tasked by the working group meeting last week to address the
specific issue of CGI, not the larger issue of whether a response
without Last-Modified should be cached. based on my belief that the
HTTP/1.1 spec should not discourage caching unnecessarily (reflecting
what Roy wrote earlier, that the Web "depends on accurate caching to
reduce network costs"), I constructed my proposed Note to reflect the
looser approach used by Squid.
So let's take these issues separately. If someone wants to
propose a specification change (or a new Note for the spec)
that says "do not cache responses without a Last-Modified header",
that's fine with me, although it would be a good idea to
combine this proposal with evidence (from a real-life proxy)
that this doesn't significantly reduce caching in today's Internet.
Back to the CACHING-CGI issue. My original proposal was sloppy
in that it didn't make a distinction between "cache and reuse
without revalidation" or "cache but must revalidate". And I
forgot to include "htbin" as being more or less equivalent
to "cgi-bin" (and yes, there are still lots of htbin URLs in
active use). Also, I violated the informal rule that Notes should
not use terms like "SHOULD".
Here's a revised version, to replace the second paragraph
in section 13.9:
Some HTTP/1.0 cache operators have found that it is dangerous
to cache and reuse without revalidation responses to requests
for URLs that include any of the strings "cgi-bin", "htbin", or
"?", because applications have traditionally used these URLs in
conjunction with operations with significant side effects for
GET or HEAD methods. However, if such a response includes an
explicit, future, expiration time, then this implies that the
response may be cached and reused without revalidation until it
expires. If such a response includes a Last-Modified or Etag
header, this implies that the response may be reused after
revalidation (or without revalidation if explicitly fresh).
A cache MUST NOT assign a heuristic expiration time to a
response for a URL that includes the strings "htbin", "cgi-bin", or
"?" in its rel_path part. If such a response does not
carry an explicit expiration time, it must be treated as
if it expires immediately.
This does two things: (1) it clarifies that a cache can indeed
follow its usual caching with "?" and "cgi-bin" responses, if
they are explicitly marked to allow caching, and (2) we tighten
up the rules on assigning heuristic expiration times for such
responses, because of the known risks of this specific situation.
- -Jeff
------- End of Forwarded Message
I'm pretty sure I said this before, but I don't know what list.
I am completely opposed to this change. It is inaccurate to say that
caching and reusing such responses is "dangerous". The *only* reason
*some* caches do not provide heuristic caching of such responses is
because the presence of query-based parameters make it unlikely to get
a second "hit" on the cache, and because the the absence of a Last-Modified
(and now Etag) makes it impossible to do an efficient update. In any case,
this is an optimization which is dependent on the context and number of
users of the cache, and not a requirement of the protocol.
The protocol already provides mechanisms for marking a response as
non-cachable. All other responses to a GET request are cachable.
....Roy
I can't speak for the motivation of old cache authors, but I can speak as
an HTTP/1.0 application author from before any RFCs when one had to
reverse engineer everything and the empirical behavior I observed was that
GET requests which included a query part were not cached.
I support the behavior for handling HTTP/1.1 responses strictly
conforming to Roy's position but I believe somthing like Jeff's
proposed wording is necessary when the 1.1 cache is covering a 1.0
server.
Dave Morris
I support the behavior for handling HTTP/1.1 responses strictly
conforming to Roy's position but I believe somthing like Jeff's
proposed wording is necessary when the 1.1 cache is covering a 1.0
server.
I would go along with this, except that I see no way that a proxy
in a chain of several proxies can reliably determine whether the
origin server is HTTP/1.0. E.g., if you have this configuration:
Origin_server----Proxy_p1-----Proxy_p2------client
how does Proxy_p2 know for sure that the Origin_server is not
HTTP/1.0?
Given that, there certainly are many cases where a proxy
can reliably know that the origin server is definitely HTTP/1.1.
For example, Proxy_p1 knows that it's talking to the origin
server, and it knows what HTTP-version is sent in the response
status-line. Or, if the response includes a header that could
only have been added by an HTTP/1.1 server (e.g., Cache-Control).
So, one possible rewording of the proposed resolution would be
to change:
A cache MUST NOT assign a heuristic expiration time to a
response for a URL that includes the strings "htbin", "cgi-bin", or
"?" in its rel_path part. If such a response does not
carry an explicit expiration time, it must be treated as
if it expires immediately.
to this:
A cache MUST NOT assign a heuristic expiration time to a
response for a URL that includes the strings "htbin",
"cgi-bin", or "?" in its rel_path part, if the response might
have been generated by an HTTP/1.0 (or earlier) origin server.
If such a response does not carry an explicit expiration time,
it must be treated as if it expires immediately.
-Jeff
Jim Gettys:
Hi Jim,
Yes, I have a problem with marking this issue as closed, so please
don't mark it as closed.
Like Roy, I am opposed to the wording:
The strongest wording I would support here would be `A cache should
[lowercase!] be careful in assigning ...'.
Koen.
Don't panic, I'm not marking it closed.
That is why I sent it to the list, in case there were issues that
had not been aired due to the mishandling of the issue.
- Jim
In most cases, yes, but the relevant question is why they are not cached.
The reason given by all of the cache maintainers I talked to at the
Geneva, Chicago, Boston, Paris, and Santa Clara WWW conferences is that
attempts to cache those responses led to poor hit frequency on the cache.
In other words, it is a performance optimization and does not need to
be written into the protocol.
Why? Why is it "necessary" to force a cachable response to be non-cachable?
HTTP/1.0 had its own mechanisms for indicating cachability, and the presence
or absence of "?" or "cgi-bin" or "htbin" does not indicate anything.
It is a fundamentally bad idea to associate any URL pattern with a particular
HTTP functionality, because it breaks the separation between those two
protocols.
....Roy

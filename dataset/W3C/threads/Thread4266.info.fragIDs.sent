<s> XPath 2 does not allow nested sequences.  </s>
<s> I believe that this is a mistake and one which will be difficult to correct in the future.  </s>
<s> I don't know how widely this has been discussed, but I found this: It didn't exactly warm my heart.  </s>
<s> Nobody could justify the current situation as anything more than "the way things evolved".  </s>
<s> "I accept that the above isn't a conclusive argument that we've done the right thing; I present it more as a post-hoc explanation of how the language came to be like it is."  </s>
<s> It seems to me that this is the same sort of "simplifying" arbitrary limitation that left real sequences out of XPath 1.  </s>
<s> Once you've said that nested sequences are flattened it will be VERY hard to fix in XPath 3! I can't off the top of my head think of a relatively clean way to evolve from the current model and syntax to one that allows true nested sequences.  </s>
<s> So let's get this right the first time!  </s>
<s> The specification itself has the following example: "The following example transforms the input document into a list in which each author's name appears only once, followed by a list of titles of books written by that author." for $a in distinct-values(//author) return ($a, for $b in //book[author = $a] return $b/title) It seems much more likely that you'd like a sequence of pairs.  </s>
<s> Otherwise, how do you differentiate the authors' names fro the book titles in the sequence that is returned?  </s>
<s> There are very few circumstances under which you would just not care about the distinction.  </s>
<s> I can already imagine myself gritting my teeth working around these sorts of situations.  </s>
<s> Furhermore, it makes the language harder to learn (and perhaps implement!), not easier, because people are used to nested sequences from every other sequence manipulation language going back to the fifties (with the possible exception of Perl 4).  </s>
<s> Paul Prescod  </s>
<s> I think that very few use cases have come up over the last couple of years that require nested sequences, which justifies the original decision not to provide them.  </s>
<s> I also think it would be quite confusing to have two separate  </s>
<s> mechanisms for managing trees in XPath, one based on XML and the other based on nested sequences, but supporting a completely different set of constraints and operators.  </s>
<s> If we do ever want to add nested sequences, I don't think it's difficult; we would just add a new kind of item called a sequence-reference.  </s>
<s> It's certainly too late to contemplate this kind of change at this stage of the proceedings, without a much better justification than an unwarm heart.  </s>
<s> Michael Kay  </s>
<s> Then I'd suggest you remove the example from the specification because it clearly calls out for something more than what is in XPath 2.0.  </s>
<s> There is no need for a mechanism to "manage trees."  </s>
<s> People who put sequences within sequences end up with trees, just because that is how the underlying universe works.  </s>
<s> People uncomfortable with that notion will simply not put sequences within sequences.  </s>
<s> XPath already has formidable tree manipulation constructs for the same reason Lisp and Python are great at dealing with trees.  </s>
<s> Lists of lists are managed with the same tools as lists of simple values.  </s>
<s> What other features would you need?  </s>
<s> And what would this expression mean in this hypothetical XPath 3: (a, (b, c), d, (e, f))  </s>
<s> It may be late but it would be wrong of me to not say that I expect this is going to lead to problems.  </s>
<s> You don't have to put the feature in, but I would strongly suggest you don't make it difficult for yourself to fix the mistake if it turns out to be one.  </s>
<s> Reserve sequence within sequence syntax and semantics.  </s>
<s> In my mind, you are defying 40 years of practical experience in computer science with the decision that the expression above should be flattened.  </s>
<s> I could be wrong but I believe that Perl 4 did that flattening trick and Perl 5 had to hack around that decision by introducing a "reference" feature.  </s>
<s> The result was a total mess.  </s>
<s> "For a lot of people (including me), this was one of the hardest things to pick up in Perl.  </s>
<s> But once you learn it, you open up a lot of possibilitites.  </s>
<s> If you're a programmer, try to imagine programming C without data structures!  </s>
<s> That was what things were like in Perl 4. Now, with Perl 5, we can make data structures, but it had to be implemented in such a way that Perl 4 code would still run properly.  </s>
<s> As a result, sometimes there is a little bit of inconsistency."  </s>
<s> Paul Prescod  </s>
<s> Hi Paul, The example in the spec is rather abstract.  </s>
<s> Perhaps you have some more concrete example that can illustrate the usability problem you see?  </s>
<s> This part I do not understand.  </s>
<s> XPath and XQuery are designed for operations on forests of XML nodes or values.  </s>
<s> XML does not have anything like nested lists - it does have nested elements, which we support.  </s>
<s> Given the rich data structures already available in XML, people can easily create intermediate structures if they need them.  </s>
<s> For instance, if you are frustrated by not being able to create nested sequences like (1, (2, 3), ( ) ), you can create the following: temp i { 1 } /i i { 2, 3 } If we really needed something along these lines, I suppose we could use subscripts for this: let $c := (1, (2, 3), ( ) ) return out At first blush, you might expect the following output: Is that what you are thinking of?  </s>
<s> If so, I don't think that parentheses should be the list constructor that supports nested lists, because we use them for precedence in expressions, and I think the two meanings would conflict.  </s>
<s> If we added such a feature, I would hope we would use a different syntax.  </s>
<s> For instance: list(1, list(2,3), ()) But this would require big changes to the language and the data model, and I have not yet seen a strong case for this feature.  </s>
<s> Most of the features in XQuery have been justified by use cases like those in our use cases document.  </s>
<s> The best way to lobby for a feature is to write up a set of use cases that strongly demonstrate the need for that feature.  </s>
<s> At this stage in our development, they should point out real problems that would result if we did not add the feature.  </s>
<s> Lisp and Python are significantly different languages than XQuery, though there are similarities.  </s>
<s> I think XQuery probably omits at least several important features found in any given language.  </s>
<s> Which is a good thing, of course.  </s>
<s> Just what it does now, I think.  </s>
<s> If we want to add your suggested feature in the future, we could have list constructors, eg:  </s>
<s> list(a, list(b, c), d, list(e, f))  </s>
<s> At any rate, parentheses in XPath or XQuery already have several meanings, and I would hate to overload them with yet another meaning.  </s>
<s> If we added this feature, I would hope we would not do it using parentheses as the syntax.  </s>
<s> I know that parentheses have that meaning in Lisp.  </s>
<s> I like Lisp.  </s>
<s> I don't think XQuery is Lisp.  </s>
<s> I read the URL.  </s>
<s> The author is saying that you need richer data types than Perl 4 had.  </s>
<s> XQuery has much richer data types than Perl 4, since it is based on XML, which can model just about anything.  </s>
<s> It's quite possible that we will find other types that we could add in future versions of XQuery, but I don't see an overwhelming argument for this feature in XQuery 1.0.  </s>
<s> Let's ship what we have and get some industry experience first.  </s>
<s> Jonathan  </s>
<s> It would mean the same as it means in XPath 2. If we provided a new kind of item in the type system, we would need to provide new syntax to support it, for example (a, seq-ref(b, c), d, seq-ref(e, f)) But personally, I don't see this happening.  </s>
<s> The reason that sequences have been added to XPath is to support list-valued nodes in XML Schema.  </s>
<s> I would be greatly surprised if XML Schema is ever enhanced to support lists-of-lists, and if it isn't, then there is no need for XPath to support them either.  </s>
<s> The idea of sequence flattening in XPath 2.0 is completely consistent with the way path expressions work in XPath 1.0, where the construct a/b/c gives a flat node-set rather than a set of sets of sets.  </s>
<s> Michael Kay  </s>

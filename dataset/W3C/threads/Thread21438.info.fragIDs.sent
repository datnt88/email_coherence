<s> Hi there,  </s>
<s> We're building an RDF API and a decentralized search system on top of it for something called the Plex.  </s>
<s> Now we need a storage system for it, and I know you have experience in this area.  </s>
<s> Some thoughts so far: IronDoc.  </s>
<s> Unfortunately it is still vaporware.  </s>
<s> BerkeleyDB.  </s>
<s> Doesn't scale as well as Mathew (my partner, cced) wants -- he imagines 60GB stores.  </s>
<s> Also, I don't know the most efficient way to store RDF triples in key-value dictionaries.  </s>
<s> Thanks for any help you can provide.  </s>
<s> Please ask questions.  </s>
<s> BTW, I'm cc-ing www-archive so this message is archived to the Web -- you can of course quote it as you wish.  </s>
<s> "Aaron Swartz" | The Semantic Web http://www.aaronsw.com/  </s>
<s> | i'm working to make it happen  </s>
<s> Aaron,  </s>
<s> I wrote a lengthy reply you can link at my weblog here:  </s>
<s> scaling irondoc @ Aaron Swartz is interested in an RDF store that scales big.  </s>
<s> Of course IronDoc is vaporware and will stay so for months.  </s>
<s> I no longer try to give folks an impression it'll be soup soon.  </s>
<s> But it doesn't hurt to answer hypothetical usage questions.  </s>
<s> Thinking hypothetically is one way to analyze option context.  </s>
<s> In the following, please remember IronDoc is not available.  </s>
<s> I'd planned only to support up to four gigabyte files at first.  </s>
<s> Aaron is considering size figures more on the order of 60GB.  </s>
<s> This is rather big as content goes these days.  </s>
<s> A big disk size.  </s>
<s> I think I have useful advice to give about planning for failure.  </s>
<s> Everything fails.  </s>
<s> Partly cuz my code sucks and so does yours.  </s>
<s> But even if our code was quite fabulous, everything still fails.  </s>
<s> This is because entropy is inevitable, just like death and taxes.  </s>
<s> Systems only get more unstable.  </s>
<s> New ones replace old ones.  </s>
<s> So systems are more robust when they plan for partial failure.  </s>
<s> A system designed for partial failure tolerates some entropy.  </s>
<s> This prevents knife-edge total failure when a small part goes.  </s>
<s> Recovering from partial failure means rebuilding broken parts.  </s>
<s> This only works if you have some still good redundant copies.  </s>
<s> A 60GB database sounds a bit like all eggs in a basket to me.  </s>
<s> Or at least an engineer could make that mistake using 60 gigs.  </s>
<s> At least part of it will certainly fail sometime in normal use.  </s>
<s> So you'd want a design that didn't stall the whole thing then.  </s>
<s> Industrial databases have a measure of redundancy already.  </s>
<s> That's a good reason to use one.  </s>
<s> But value costs something.  </s>
<s> Okay, suppose you hate to use some high end db like Oracle.  </s>
<s> Or you lack the funds, etc.  </s>
<s> What do you do then?  </s>
<s> Is it free?  </s>
<s> You can be safe with a free database by using redundancy.  </s>
<s> I'd recommend a lot of write-only logging for later recovery.  </s>
<s> This is less chancy if you can accept tiny losses after damage.  </s>
<s> If you don't keep three copies, then I'd be worried about it.  </s>
<s> Keeping a lot of copies is more app practice than a db feature.  </s>
<s> So the remaining problem is how to scale huge with free code.  </s>
<s> The full 60GB db might be separated into numerous pieces.  </s>
<s> Decentralization is always a good idea, even in the cental db.  </s>
<s> Your biggest problem might be with single very large indexes.  </s>
<s> Typically the best scaling dictionary format is a type of btree.  </s>
<s> For a 60GB db, I could see one index going over 4GB in size.  </s>
<s> Or at least, you'd certainly worry about it.  </s>
<s> It could happen.  </s>
<s> If you used a 64-bit free database, it would double overhead.  </s>
<s> 32 bits is more space efficient if you can partition the space.  </s>
<s> It's likely possible to put one btree into many separate files.  </s>
<s> I just haven't thought about it before.  </s>
<s> It seems very doable.  </s>
<s> For example, a btree root could use special children pointers.  </s>
<s> They would put the child subtree refs in separate file spaces.  </s>
<s> Until a file got too big, all children would go into one file.  </s>
<s> At some point, the root node uses another file when it splits.  </s>
<s> Okay, here's more detail.  </s>
<s> Consider one btree inside one file.  </s>
<s> For a tree of height N, a full tree might fit into a single file.  </s>
<s> If the tree gets higher, the node format must use bigger refs.  </s>
<s> Or maybe the namespace for a child subtree can be just a byte.  </s>
<s> This allows clumping namespace bytes at one end of a node.  </s>
<s> So keeping between-file references sorted is not too ungainly.  </s>
<s> However, transacting multiple files is not easy.  </s>
<s> Ask anybody.  </s>
<s> (I think low end solutions solve it by igoring the problem.) irondoc target usage @ IronDoc could scale huge using techniques like the above.  </s>
<s> But I was aiming for a smaller target in my near term plans.  </s>
<s> I want something scaling from very small to moderately big.  </s>
<s> The idea is to replace feeble tiny ad hoc single file solutions.  </s>
<s> Many folks code a quick and dirty solution that doesn't scale.  </s>
<s> Typically this don't work once the db doesn't fit in memory.  </s>
<s> IronDoc mainly aims to solve this size transition gracefully.  </s>
<s> It lets you code a new hobby project without much design.  </s>
<s> Then it wouldn't suck as it scaled ten thousand times bigger.  </s>
<s> The idea is to jump from 100K files to 1GB near painlessly.  </s>
<s> That's four orders of magnitude, which is good in a first try.  </s>
<s> It ought to work very well for personal user sized databases.  </s>
<s> But as you get ever bigger, the risk factor keeps increasing.  </s>
<s> Obviously the cost of loss goes up the more you have to lose.  </s>
<s> Protection agaist loss starts to cost more than time efficiency.  </s>
<s> Since IronDoc is pre 1.0 vaporware, it's dumb to think 2.0.  </s>
<s> But a later db version could easily be written for 64-bit files.  </s>
<s> It would only involve a mildly ugly port of the 32-bit source.  </s>
<s> Simpler is better in first versions.  </s>
<s> And I want to cover small.  </s>
<s> (Folks worried about 64-bit versions of Quilt five years ago.) Speaking of feeble formats, I mean Microsoft docfile format.  </s>
<s> I'm not denigrating the random feeble formats of all readers.  </s>
<s> (If you want a personal insult, ask first and then get in line.) Actually, I don't care much about invading docfile's space.  </s>
<s> I just needed to give you a specific target for your umbrage.  </s>
<s> Thanks so much.  </s>
<s> For you and Mathew, here are my two key questions: 1) For our initial versions, what free database should we use?  </s>
<s> [ I'm imagining a three-month time frame for a prototype.  </s>
<s> ] 2) In a dbm which only exports a dict, how do we store RDF triples?  </s>
<s> [ Ideally, we'd not have to duplicate a lot of data.  </s>
<s> ] These are the problems we need to solve, I think.  </s>
<s> I'm interested in your recommendations.  </s>
<s> A full response to David is below.  </s>
<s> ? I'll start with answering a semi-public email Aaron sent me.  </s>
<s> ?  </s>
<s> (I'm much happier being able to write for a public mode.)  </s>
<s> Same here.  </s>
<s> I like sharing with others, as you do.  </s>
<s> Plus, building an archive is helpful later on.  </s>
<s> Indeed.  </s>
<s> I was a rather surprised when Mathew gave me that number.  </s>
<s> He did say he'd be willing to take it in 2GB chunks.  </s>
<s> I left out some context.  </s>
<s> The DB is part of a larger system.  </s>
<s> It's part of a network, where other nodes are storing that data too.  </s>
<s> This sounds very useful for our prototypes.  </s>
<s> Or simple clients.  </s>
<s> (BTW, some pages on your site are out of date.  </s>
<s> Your index is awfully old: The header here still says Oct01: Writing in short sentences like this is fun.) "Aaron Swartz" | Swhack Weblog http://www.aaronsw.com/  </s>
<s> | something different every day  </s>

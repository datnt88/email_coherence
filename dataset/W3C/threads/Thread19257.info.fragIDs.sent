<s> Hi all,  </s>
<s> When an element is drawn, its corresponding boxes are processed.  </s>
<s> Now the  </s>
<s> code in RedrawFrameBottom loops through all planes and renders the boxes in  </s>
<s> their depth order.  </s>
<s> There is code in there that also makes sure that the "dirty rectangle" or  </s>
<s> clipping area intersects the box before it (box) is drawn.  </s>
<s> My question is,  </s>
<s> how does the rendering system ensure that, if there's 2 boxes (small box  </s>
<s> inside a bigger box), and the bigger box intersects the clipping area but  </s>
<s> the smaller box doesn't, that the smaller box will still be rendered?  </s>
<s> Since  </s>
<s> only the bigger box intersects the clipping area, it is redrawn but then if  </s>
<s> it clears the area that it covers, the smaller box inside of it will be  </s>
<s> drawn over.  </s>
<s> Since the smaller box doesn't intersect the clipping area, it is  </s>
<s> never redrawn.  </s>
<s> Even if you put the bigger box in a deeper plane (higher number), the  </s>
<s> rendering doesn't appear to take into consideration that the "background" of  </s>
<s> the smaller box (essentially the bigger box!) has changed, and therefore the  </s>
<s> smaller box, even if it doesn't intersect the clipping area, must be drawn.  </s>
<s> Are there some rules in defining the boxes that prevent the above from  </s>
<s> happening?  </s>
<s> Should the "smaller" box really have the same dimensions as the  </s>
<s> "bigger" box?  </s>
<s> Maybe I made a mistake in defining my boxes?  </s>
<s> Any help would be appreciated!  </s>
<s> Thanks, -An  </s>
<s> Hi all, The local changes I put in RedrawFrameTop/RedrawFrameBottom that appear to  </s>
<s> solve this problem are implemented as... (1) If a box is drawn, its bounding rectangle is added to a list of dirty rectangles.  </s>
<s> The current clip region is also OR'ed with the region covered by this bounding rectangle to make a new clip region for the DC. (2) When a box is checked for intersection, it is now also checked with the  </s>
<s> list of dirty rectangles from (1) above.  </s>
<s> If it intersects any of the dirty  </s>
<s> rectangles, it will be redrawn EVEN if it did not intersect the frame's clip  </s>
<s> rectangle.  </s>
<s> This allows smaller inner boxes to be redrawn if their container  </s>
<s> is redrawn, even if the smaller inner box does not intersect the frame's clip rectangle.  </s>
<s> At first I thought a quicker way to solve this was to not just check for intersection between the box and the frame's clip rectangle, but also compare the enclosing box of the box with the frame's clip rectangle.  </s>
<s> However, I couldn't think of a way to effectively differentiate between a "real" enclosing box (say Submit_Input encloses Value_Box) and the default enclosing box (Body encloses Submit_Input).  </s>
<s> So in this latter case, if you intersected Body with the frame's clip rectangle, it would always intersect...or so I think...making us redraw the Submit_Input box even if we don't have to.  </s>
<s> So anyway, what I wanted to know was if I was just wasting my time implementing the code to do (1) and (2).  </s>
<s> Maybe I've got some wrong assumptions about how boxes can be defined in the P file? :-) For a fuller description of what I thought the problem was, see my previous e-mail.  </s>
<s> Anyone interested in looking at the modifications, let me know.  </s>
<s> :-)  </s>
<s> Thanks, -An  </s>
<s> how does the rendering system ensure that, if there's 2 boxes (small box  </s>
<s> inside a bigger box), and the bigger box intersects the clipping area but  </s>
<s> the smaller box doesn't, that the smaller box will still be rendered?  </s>
<s> Since  </s>
<s> only the bigger box intersects the clipping area, it is redrawn but then if  </s>
<s> it clears the area that it covers, the smaller box inside of it will be  </s>
<s> drawn over.  </s>
<s> Since the smaller box doesn't intersect the clipping area, it is  </s>
<s> never redrawn.  </s>
<s> In-reply-to: Your message of Wed, 27 Oct 1999 11:13:48 -0400."  </s>
<s> A box which intersects the clipping area is rendered.  </s>
<s> In fact only the part of  </s>
<s> box within the clipping area is displayed.  </s>
<s> If the smaller box is out of the clipping area, it's not rendered.  </s>
<s> Normally the clear is also limited by the clipping area.  </s>
<s> So the smaller box should not be cleared.  </s>
<s> I'm not sure that the work is well done, but we planned to take into account that some boxes have a background to compute the right clipping area.  </s>
<s> Did you detected a case where that happens.  </s>
<s> That should work when the bigger box has presentation rules: Background: color + FillPattern: backgroundcolor + Showbox  </s>
<s> Irene.  </s>
<s> Thanks for the response Irene.  </s>
<s> Please see my comments below.  </s>
<s> Also, please see my other response sent earlier today.  </s>
<s> Thank you.  </s>
<s> -An  </s>
<s> The case I am thinking of is a smaller box inside a big box: (see below in fix width font) | |small| | | big | | | clip | The big box will intersect and redraw.  </s>
<s> The smaller box will not intersect and not be updated.  </s>
<s> But the bigger box may overwrite the smaller box?  </s>
<s> Yes, only the clipping area is cleared.  </s>
<s> But when the bigger box redraws, the smaller box will be overdrawn.  </s>
<s> I modified some P boxes that is my test case.  </s>
<s> Basically, the button draws a filled P box (button shape) that is the bigger box and the value (button text) is drawn inside of it.  </s>
<s> I don't know if any of the unmodified Amaya elements have this problem...but maybe it's not easy to produce a test case.  </s>
<s> In this case, is the bigger box is considered a filled box?  </s>
<s> Then the processing is done first, before any of the other boxes get rendered, right?  </s>
<s> But then the smaller enclosed box will still not intersect with clip rectangle so they will not update.  </s>

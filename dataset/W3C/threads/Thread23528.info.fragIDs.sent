<s> Hi,  </s>
<s> I'm trying to implement the method LSSerializer.writeToString and would  </s>
<s> like to know what encoding declaration should be written if serializing the document node.  </s>
<s> Should it always be "UTF-16", or should it be the current xmlEncoding (e.g. ISO-8859-1)?  </s>
<s> What about if the DOMString is UTF-16LE encoded, as in our implementation: should it always be "UTF-16" or "UTF-16LE" in this case?  </s>
<s> Any hints?  </s>
<s> I did not find any explicit information.  </s>
<s> The specs say: "this method completely ignores all the encoding information available", but I'm not sure about what this really means.  </s>
<s> NOTE: After 2 months (!) of efforts to subscribe to this list, I received the first mail from the list (2004-01-28).  </s>
<s> Since it is the only one I received until now, I'm not sure if everything's working well: is  </s>
<s> there simply not much traffic (I really did not expect that!), or does  </s>
<s> the list have problems dispatching mails?  </s>
<s> Thanks in advance, Kasimier Buchcik  </s>
<s> Traffic on this list tends to be episodic.  </s>
<s> Someone will bring up a specific  </s>
<s> question about the working draft our about something particularly fuzzy in a past recommendation, it'll get batted around for a few days, and then die out again once the Working Group understands the question and has either answered it or has decided they need time to think about it.  </s>
<s> How much is happening thus depends on how badly people are confused, or how strongly they disagree with a detail of a published draft.  </s>
<s> The DOM working group's internal mailing lists are much more active, of course.  </s>
<s> Joe Kesselman, IBM Next-Generation Web Technologies: XML, XSL and more.  </s>
<s> "The world changed profoundly and unpredictably the day Tim Berners Lee got bitten by a radioactive spider." -- Rafe Culpin, in r.m.filk  </s>
<s> Hi,  </s>
<s> Hmm, a pity.  </s>
<s> I see.  </s>
<s> And I have an uneasy feeling that my question will likely not be answered; so I should set up a bot to resend it once a week.  </s>
<s> Well, for the sake of the DOM: I hope that!  </s>
<s> At least I thank you for showing me that there does exist *some* DOM activity; It started to feel like a ghost town.  </s>
<s> Thanks and regards, Kasimier Buchcik  </s>
<s> I thought this was resolved a few weeks ago but I didn't find traces of it in the current internal version of the draft.  </s>
<s> I'll have to track this down further.  </s>
<s> For some reasons, the system is now waiting for me to acknowledge the subscriptions to this list so I might have missed yours.  </s>
<s> Philippe  </s>
<s> It has been clarified that writeToString is using the same encoding as the DOMString type itself, i.e. UTF-16.  </s>
<s> You raise an interesting point regarding the value of the XML declaration encoding itself and I don't think we considered it in the past.  </s>
<s> XML requires processors to understand "UTF-8" and "UTF-16" (see section 4.3.3 of XML 1.0 [1]).  </s>
<s> In other words, the values "UTF-16BE" and "UTF-16LE" are not required to be supported.  </s>
<s> Our reason to have them in LSSerializer was to give the ability to choose between LE and BE, but  </s>
<s> not necessarily to have them in the XML declaration.  </s>
<s> As indicated in XML, entities encoded in UTF-16 MUST begin with the Byte Order Mark, so I see no reason why the value of the XML declaration encoding should contain "UTF-16BE" or "UTF-16LE", especially since this introduces some interoperability troubles.  </s>
<s> Proposal: The LSSerializer MUST support the value "UTF-8", "UTF-16", "UTF-16LE", and "UTF-16BE".  </s>
<s> If the value is "UTF-16", the choice between big endian or little endian is platform dependent.  </s>
<s> If the UTF-16 encoding is in use, the value of the XML declaration encoding (if serialized) MUST be "UTF-16" and, as required by XML, the serialized content MUST begin with the Byte Order Mark.  </s>
<s> If the UTF-8 encoding is in use, the value of the XML declaration encoding (if serialized) MUST be "UTF-8", and the serialized content SHOULD NOT begin with the Byte Order Mark.  </s>
<s> * XML uses a MAY instead of SHOULD NOT regarding UTF-8.  </s>
<s> The recommendation for the LSSerializer is not to generate the BOM unless the implementation has some good reasons to do so.  </s>
<s> Philippe [1] http://www.w3.org/TR/2004/REC-xml-20040204/#charencoding  </s>
<s> Philippe Le Hegaret scripsit:  </s>
<s> That means that entities encoded in the encoding named "UTF-16" must begin  </s>
<s> with a BOM.  </s>
<s> Entities in the encodings "UTF-16BE" and "UTF-16LE" must not begin with a BOM, but must have an appropriate encoding declaration.  </s>
<s> John Cowan jcowan@reutershealth.com I am a member of a civilization.  </s>
<s> --David Brin  </s>
<s> Looking again at XML 1.0 3rd, it says that UTF-16 encoded entities MUST being with a BOM.  </s>
<s> Unless I'm misinterpreting the meaning of "UTF-16 encoded entities", I would say that it does include UTF16-BE and UTF16-LE as well.  </s>
<s> Philippe  </s>
<s> Correction, after stopping by Martin Duerst's office: I was misinterpreting the meaning of "UTF16 encoded entities".  </s>
<s> The BOM is indeed not required for UTF-16BE or UTF-16LE.  </s>
<s> Philippe  </s>
<s> I can understand "should not" in this case, but I don't see a need for "must not."  </s>
<s> If that's enforced, then parsers that don't understand the "UTF-16LE" or "UTF16-BE" encoding declarations have little hope of heuristically discovering the actual encoding.  </s>
<s> -Steve Schafer Fenestra Technologies Corp  </s>
<s> Philippe Le Hegaret scripsit:  </s>
<s> The sentence in the previous paragraph: # The terms "UTF-8" and "UTF-16" in this specification do not apply to # character encodings with any other labels, even if the encodings or # labels are very similar to UTF-8 or UTF-16. is intended to cover UTF-16BE and UTF-16LE, as well as CESU-8.  </s>
<s> Only the encodings actually named "UTF-16" and "UTF-8" are allowed without an encoding declaration, and the "UTF-16" encoding actually requires a BOM in XML, though not in plain text generally.  </s>
<s> After all, the whole point of the encodings "UTF-16BE" and "UTF-16LE" is that they MUST NOT begin with a BOM: if the first two bytes are 0xFE 0xFF or 0xFF 0xFE, that represents a U+FEFF character, and if document is not well formed.  </s>
<s> Trust me on this one.  </s>
<s> I was there.  </s>
<s> :-) One Word to write them all, John Cowan jcowan@reutershealth.com One Access to find them, http://www.reutershealth.com  </s>
<s> One Excel to count them all, http://www.ccil.org/~cowan  </s>
<s> And thus to Windows bind them.  </s>
<s> --Mike Champion  </s>
<s> Steve Schafer scripsit:  </s>
<s> Not at all.  </s>
<s> You can heuristically discover it by looking for the XML declaration (ignoring NULs and interpreting the non-NULs as ASCII).  </s>
<s> There are really only five cases for the Appendix F heuristic: 1) There is a UTF-16 or UTF-32 BOM followed by an ASCII encoding declaration with embedded NULs.  </s>
<s> Believe the declared encoding.  </s>
<s> 2) There is a UTF-16 BOM but no encoding declaration.  </s>
<s> The encoding is "UTF-16", and the BOM tells you whether it's big- or little-endian.  </s>
<s> 3) There is an ASCII encoding declaration.  </s>
<s> Believe the declared encoding.  </s>
<s> Skip any UTF-8 BOM that may be present.  </s>
<s> 4) There is an encoding declaration in EBCDIC.  </s>
<s> Believe the declared encoding.  </s>
<s> 5) Otherwise, the encoding is UTF-8.  </s>
<s> Skip any UTF-8 BOM that may be present.  </s>
<s> The UTF-16LE and UTF-16BE encodings require an encoding declaration, so they fall into case 1. CESU-8, which is very like UTF-8, falls into case 3. Henry S. Thompson said, / "Syntactic, structural, John Cowan Value constraints we / Express on the fly."  </s>
<s> jcowan@reutershealth.com Simon St. Laurent: "Your / Incomprehensible http://www.reutershealth.com  </s>
<s> Abracadabralike / schemas must die!" http://www.ccil.org/~cowan  </s>
<s> Hi,  </s>
<s> Yes, I think so.  </s>
<s> RFC 2781 does say: "Text in the "UTF-16LE" charset MUST be serialized with the octets which make up a single 16-bit UTF-16 value in little-endian order.  </s>
<s> Systems labelling UTF-16LE text MUST NOT prepend a BOM to the text."  </s>
<s> But the dilemma I see is that our Delphi implementation needs the DOMString not to have a BOM.  </s>
<s> And this is fine when reading the Load &amp; Save candidate recommendation: (http://www.w3.org/TR/2003/CR-DOM-Level-3-LS-20031107/load-save.html) "When outputting unicode data, whether or not a byte order mark is  </s>
<s> serialized, or if the output is big-endian or little-endian, is implementation dependent."  </s>
<s> Maby it's just my understanding of the DOMString until now, which seemed to be quite bound to the implementing application.  </s>
<s> If I get a Node.nodeValue (in our Delphi implementation) I expect the DOMString to be encoded in UTF-16, little-endian with no BOM.  </s>
<s> If I serialize with  </s>
<s> LSSerializer.writeToString I would get a UTF-16 with a BOM - as the XML  </s>
<s> spec states.  </s>
<s> This would arise problems with DOMString operations, since I cannot predict if the DOMString came from the LSSerializer or not.  </s>
<s> I assumed that the DOMString was designed to be of consistent structure in an application, and that LSOutput.characterStream and LSOutput.byteStream would play the role of a *pure* XML entity.  </s>
<s> So is the DOMString really intended to represent a XML entity or should it be handled more like a interface to the implementing programming language?  </s>
<s> Thanks and regards, Kasimier Buchcik  </s>
<s> Hi,  </s>
<s> This is true if you mean that a BOM must not be existent if the document is labelled "UTF-16LE" or "UTF-16BE", and thus aready serialized.  </s>
<s> IOW if you want to serialize a little-endian encoded entity you are free to declare "UTF-16" and use a BOM *o*r declare "UTF-16LE" and ommit a BOM.  </s>
<s> Regards, Kasimier Buchcik  </s>
<s> By the way phillipe, I think the mails working fine its just no ones mailing!  </s>
<s> Sorry I can't answer your question I'm just an observer for the time being.  </s>
<s> Kevin McDonagh Kevin McDonagh Apple Tv Design info@appletv.co.uk  </s>
<s> Hi,  </s>
<s> Although I might get flamed about repeating a question (I posted it further down the tread), I still need to clarify the format of the DOMString if using LSSerializer.writeToString.  </s>
<s> As you wrote, I see that the declaration needs to be "UTF-16".  </s>
<s> But is it required to use a BOM?  </s>
<s> (http://www.w3.org/TR/2003/CR-DOM-Level-3-LS-20031107/load-save.html) "When outputting unicode data, whether or not a byte order mark is  </s>
<s> serialized, or if the output is big-endian or little-endian, is implementation dependent."  </s>
<s> Unicode 4.0, 2.6 Encoding Schemes: "When a higher-level protocol supplies mechanisms for handling the endianness of integral data types, it is not necessary to use Unicode encoding schemes or the byte order mark.  </s>
<s> In those cases Unicode text is simply a sequence of integral data types."  </s>
<s> "Note that some of the Unicode encoding schemes have the same labels as the three Unicode encoding forms.  </s>
<s> This could cause confusion, so it is important to keep the context clear when using these terms: character encoding forms refer to integral data units in memory or in APIs, and byte order is irrelevant; character encoding schemes refer to byte-serialized data, as for streaming I/O or in file storage, and byte order must be specified or determinable."  </s>
<s> If I get a Node.nodeValue (in our Delphi implementation) I expect the DOMString to be encoded in UTF-16, little-endian with no BOM.  </s>
<s> If I serialize with LSSerializer.writeToString  </s>
<s> I would get a UTF-16 with a BOM - as the XML spec states.  </s>
<s> This would arise problems with DOMString operations, since I would have to check first if some of the DOMStrings has a BOM.  </s>
<s> I assumed that the DOMString was designed to hold integral data and that LSOutput.characterStream and LSOutput.byteStream would be expected to fulfill the requirements of an encoding scheme.  </s>
<s> So, once more: has the DOMString to hold a BOM if serializing with LSSerializer.writeToString?  </s>
<s> Regards, Kasimier Buchcik  </s>
<s> The Group rediscussed this issue and came up with the following proposal (however, I added "byte-order-mark-needed" warning): The following sentences were removed: When outputting XML data, implementations are required to support the encodings "UTF-8", "UTF-16BE", and "UTF-16LE" to guarantee that data is serializable in all encodings that are required to be supported by all XML parsers.  </s>
<s> The following sentences: "When outputting unicode data, whether or not a byte order mark is  </s>
<s> serialized, or if the output is big-endian or little-endian, is implementation dependent."  </s>
<s> should read: Implementations are required to support the encodings "UTF-8", "UTF-16", "UTF-16BE", and "UTF-16LE" to guarantee that data is serializable in all encodings that are required to be supported by all XML parsers.  </s>
<s> When the encoding is UTF-8, whether or not a byte order mark is serialized, or if the output is big-endian or little-endian, is implementation dependent.  </s>
<s> When the encoding is UTF-16, whether or not the output is big-endian or little-endian is implementation dependent, but a Byte Order Mark must be generated for non-character outputs, such as LSOutput.byteStream or LSOutput.systemId.  </s>
<s> If the Byte Order Mark is not generated, a "byte-order-mark-needed" warning is reported.  </s>
<s> When the encoding is UTF-16LS or UTF-16BE, the output is big-endian (UTF-16BE) or little-endian (UTF-16LE) and the Byte Order Mark is not be generated.  </s>
<s> In all case, the encoding declaration, if generated, will correspond to the encoding used during the serialization (e.g. encoding="UTF-16" will appear if UTF-16 was requested).  </s>
<s> No. a DOMString object never contains a BOM, since it is a character oriented output.  </s>
<s> Philippe  </s>
<s> On Thu, 19 Feb 2004 12:08:03 -0500, Philippe Le Hegaret plh@w3.org  </s>
<s> UTF-8 is "non-endian."  </s>
<s> When the encoding is UTF-16LS or UTF-16BE  </s>
<s> Typo: UTF-16LS -- UTF-16LE  </s>
<s> In all case, the encoding declaration, if generated,  </s>
<s> Typo: In all case -- In all cases -Steve Schafer Fenestra Technologies Corp  </s>

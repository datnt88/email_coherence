<s> Hi, during the WG meeting I volunteered to do some tests with the If header  </s>
<s> syntax that Geoff, Stefan and myself have been proposing to do conditional  </s>
<s> PUTs (where both a lock-token and an entity tag is known, and the request  </s>
<s> should succeed if the etag still matches, and the lock-token either matches or the lock is gone).  </s>
<s> A possible syntax for this is: ( opaquelocktoken:14ba870e-f200-0010-d0b9-e8c4edb33ec7:17289 ["89657"]) (Not DAV:no-lock ["89657"]) where: opaquelocktoken:14ba870e-f200-0010-d0b9-e8c4edb33ec7:17289 is a valid lock-token, DAV:no-lock is a known-to-be-invalid lock token and "89657" is the etag obtained from the previous PUT.  </s>
<s> Here are the test results: 1) Moddav in Apache 2.0.44 Found (and reported) two bugs: a) etags in If header validation do not seem to work [1] b) lock tokens are only accepted in the specific syntax that moddav internally uses [2] 2) IIS 5.0  </s>
<s> Identified bug similar to [1].  </s>
<s> Does anybody know how to report bugs in IIS  </s>
<s> with an actual chance that they get fixed?  </s>
<s> (:-) 3) SAP Enterprise Portal Tests pass (admittingly after we fixed to bugs in the If header validation).  </s>
<s> The tests are written in JScript and require MSXML and the Windows Scripting Host (zip file attached).  </s>
<s> Syntax is: cscript update-test.js  </s>
<s> URL (username) (passwd) Joe (Orton), in case you read this: it would be nice if Litmus could add some are all of these tests.  </s>
<s> Julian [1] http://nagoya.apache.org/bugzilla/show_bug.cgi?id=16451 [2] http://nagoya.apache.org/bugzilla/show_bug.cgi?id=16452  </s>
<s> Hi, what I forgot to mention: of the three servers tested (Apache/moddav, IIS 5.0, SAP Enterprise Portal), only one is supplying strong entity tags (ours).  </s>
<s> Julian  </s>
<s> Hi, two updates regarding the situation on Apache/moddav: Issue 1b) has been fixed (not tested yet).  </s>
<s> Issue 1a) is a bit more complicated.  </s>
<s> The problem here is that my test case was obtaining it's entity tags from PUT operations.  </s>
<s> Apache/moddav (when using the filesystem backend) returns weak entity tags which turn into strong tags once a certain time has elapsed.  </s>
<s> Rearranging the code to wait after the PUT and only then retrieve the etag using HEAD indeed provides strong etags, and the test failures disappear.  </s>
<s> So the issue here really has nothing to do with the If header evaluation.  </s>
<s> The issue with IIS may indeed be related -- I'll have to check that tomorrow.  </s>
<s> Julian  </s>
<s> Hi, another update...: 1) "forcing" IIS to use strong etags (by obtaining the etag delayed after the PUT) does not fix the IIS issue.  </s>
<s> 2) I've also added a few test cases that test putting the etag into the "If-Match" header rather than the If header, such as if: ( opaquelocktoken:14ba870e-f200-0010-d0b9-e8c4edb33ec7:20681 ) (Not DAV:no-lock ) if-match: "110969" rather than: if: ( opaquelocktoken:14ba870e-f200-0010-d0b9-e8c4edb33ec7:20681 ["110969"]) (Not DAV:no-lock ["110969"]) This should be equivalent but fails in Apache/moddav ([1]).  </s>
<s> So contrary to what we believed, protecting conditional PUTs using strong etags currently does not interoperate well at all.  </s>
<s> How do we move forward on this issue?  </s>
<s> Julian [1] http://nagoya.apache.org/bugzilla/show_bug.cgi?id=16593  </s>

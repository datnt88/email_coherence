<s> Hi all, Having read the XPath Rec, I found the following paragraph in section 2.3 about node tests: "A QName in the node test is expanded into an expanded-name using the namespace declarations from the expression context.  </s>
<s> This is the same way expansion is done for element type names in start and end-tags except that the default namespace declared with xmlns is not used: if the QName does not have a prefix, then the namespace URI is null (this is the same way attribute names are expanded).  </s>
<s> It is an error if the QName has a prefix for which there is no namespace declaration in the expression context."  </s>
<s> Does this really mean, that I cannot select a node which has a default namespace declared?  </s>
<s> Consider the following example: NS1:DocElement xmlns="http://anywhere.com/default" xmlns:NS1="http://anywhere.com/ns1"  </s>
<s> What should the XPath expression "/descendant::SecondChild" provide as result?  </s>
<s> a) An empty node set, since the expression should select a node with an expanded-name constisting of an empty namespace URI and a local part equal to "SecondChild"?  </s>
<s> b) A node set consisting of a single element node, since the expression should select a node with an expanded-name constisting of the default namespace URI ("http://anywhere.com/default") and a local part equal to "SecondChild"?  </s>
<s> If a) is the answer, we should add a few sentences in the spec, that we recommend to introduce a namespace prefix for the XML-Signature elements, and not to use the default namespace for them.  </s>
<s> Otherwhise it would not be possible to select such elements with XPath expressions.  </s>
<s> Regards, Gregor Gregor Karlinger Phone +43 316 873 5541 Institute for Applied Information Processing and Communications Austria  </s>
<s> Hi Gregor, Actually, it doesn't mean that you can't match elements that are in the default namespace.  </s>
<s> For an example, see [1]  </s>
<s> In the first code example, the Signature is in the default namespace of &amp;dsig;.  </s>
<s> However, the XPath expression has the dsig prefix declared, and the match to the Signature is done using dsig:Signature.  </s>
<s> Thus, matching elements in the default namespace can be done by setting up a prefix with the same URI as the default namespace.  </s>
<s> Incidentally, if [1] resolves to a draft that mentions the subexpression  </s>
<s> (//. | //@* | //namespace::*), note that you no longer need this subexpression as a result of the change of processing model.  </s>
<s> Thanks, John Boyer Development Team Leader, Distributed Processing and XML PureEdge Solutions Inc. Creating Binding E-Commerce v: 250-479-8334, ext.  </s>
<s> 143 f: 250-479-3772 1-888-517-2675 http://www.PureEdge.com  </s>
<s> http://www.pureedge.com/  </s>
<s> [mailto:w3c-ietf-xmldsig-request@w3.org]On  </s>
<s> Behalf Of Gregor Karlinger Hi all, Having read the XPath Rec, I found the following paragraph in section 2.3 about node tests: "A QName in the node test is expanded into an expanded-name using the namespace declarations from the expression context.  </s>
<s> This is the same way expansion is done for element type names in start and end-tags except that the default namespace declared with xmlns is not used: if the QName does not have a prefix, then the namespace URI is null (this is the same way attribute names are expanded).  </s>
<s> It is an error if the QName has a prefix for which there is no namespace declaration in the expression context."  </s>
<s> Does this really mean, that I cannot select a node which has a default namespace declared?  </s>
<s> Consider the following example: NS1:DocElement xmlns="http://anywhere.com/default" xmlns:NS1="http://anywhere.com/ns1"  </s>
<s> What should the XPath expression "/descendant::SecondChild" provide as result?  </s>
<s> a) An empty node set, since the expression should select a node with an expanded-name constisting of an empty namespace URI and a local part equal to "SecondChild"?  </s>
<s> b) A node set consisting of a single element node, since the expression should select a node with an expanded-name constisting of the default namespace URI ("http://anywhere.com/default") and a local part equal to "SecondChild"?  </s>
<s> If a) is the answer, we should add a few sentences in the spec, that we recommend to introduce a namespace prefix for the XML-Signature elements, and not to use the default namespace for them.  </s>
<s> Otherwhise it would not be possible to select such elements with XPath expressions.  </s>
<s> Regards, Gregor Gregor Karlinger Phone +43 316 873 5541 Institute for Applied Information Processing and Communications Austria  </s>
<s> Hi John,  </s>
<s> What is your source for that information?  </s>
<s> I think the paragraph I have cited in my first message, reads quite clear, that the default namespace is not used in XPath: "...except that the default namespace declared with xmlns is not used: if the QName does not have a prefix, then the namespace URI is null (this is the same way attribute names are expanded).  </s>
<s> " I have posted my concerns also in the developer newsgroup of the Apache Xalan project.  </s>
<s> The response I got from Joseph Kesselman, one of the developers, is: "XPath does not use the default namespace declaration.  </s>
<s> If you don't specify a prefix, the name is assumed to be in _no_ namespace (the original default, not the changed default).  </s>
<s> If you want to access a namespaced node, you must use an explicit prefix which maps to that namespace.  </s>
<s> See the XPath spec, section 2.3 (Node Tests), third paragraph or thereabouts."  </s>
<s> Maybe we should ask the editors of XPath of the intended meaning of the sentence above.  </s>
<s> Regards, Gregor Gregor Karlinger Phone +43 316 873 5541 Institute for Applied Information Processing and Communications Austria  </s>
<s> Hi Gregor, Short answer: The attached documents should help demonstrate the point.  </s>
<s> They were produced via the following call: saxon -o testNS.txt  </s>
<s> testNS.xml  </s>
<s> testNS.xsl  </s>
<s> Long answer: Actually, you aren't citing the whole paragraph but just the dependent clause beginning with the word 'except'.  </s>
<s> This dependent clause qualifies the first part of the paragraph.  </s>
<s> The complete paragraph is: "A QName in the node test is expanded into an expanded-name using the namespace declarations from the expression context.  </s>
<s> This is the same way expansion is done for element type names in start and end-tags except that the default namespace declared with xmlns is not used: if the QName does not have a prefix, then the namespace URI is null (this is the same way attribute names are expanded).  </s>
<s> It is an error if the QName has a prefix for which there is no namespace declaration in the expression context."  </s>
<s> [1] [1] http://www.w3.org/TR/xpath#node-tests  </s>
<s> Thus, it is the QName in the node-test that is expanded without the benefit of the default namespace URI, should it be defined for the evaluation context of the XPath expression.  </s>
<s> However, the namespace URI of an element in the input document is available for comparison whether it was specified by explicit or default namespace qualification.  </s>
<s> The attached documents include testNS.xml and testNS.xsl.  </s>
<s> The xml file contains a root document element named Test that has three children with the same local name 'e'.  </s>
<s> The first is unqualified, the second is qualified by default, and the third is qualified by explicit declaration of the prefix 'NS'.  </s>
<s> The xsl file contains three templates.  </s>
<s> The first simply latches onto the root element Test, and applies all templates to its child elements.  </s>
<s> The second template is designed to match elements with local name 'e' and no namespace URI.  </s>
<s> The third template matches elements 'e' that have a namespace URI of testNS (which is the declared value of the NS prefix).  </s>
<s> The result of the transformation appears in testNS.txt.  </s>
<s> The exception in the paragraph of XPath cited above is demonstrated by the fact that the second template only matches the unqualified element 'e' despite the declaration within the second template of 'testNS' as the default namespace URI.  </s>
<s> The fact that the third template (bearing the match expression "NS:e") matches both the second and third elements 'e' demonstrates that input elements retain their namespace URI if it was derived by default and that namespace qualified input elements are matched by namespace URI and local name, regardless of how they obtained their namespace URI.  </s>
<s> Thanks, John Boyer Development Team Leader, Distributed Processing and XML PureEdge Solutions Inc. Creating Binding E-Commerce v: 250-479-8334, ext.  </s>
<s> 143 f: 250-479-3772 1-888-517-2675 http://www.PureEdge.com  </s>
<s> http://www.pureedge.com/  </s>
<s> Hi John,  </s>
<s> What is your source for that information?  </s>
<s> I think the paragraph I have cited in my first message, reads quite clear, that the default namespace is not used in XPath: "...except that the default namespace declared with xmlns is not used: if the QName does not have a prefix, then the namespace URI is null (this is the same way attribute names are expanded).  </s>
<s> " I have posted my concerns also in the developer newsgroup of the Apache Xalan project.  </s>
<s> The response I got from Joseph Kesselman, one of the developers, is: "XPath does not use the default namespace declaration.  </s>
<s> If you don't specify a prefix, the name is assumed to be in _no_ namespace (the original default, not the changed default).  </s>
<s> If you want to access a namespaced node, you must use an explicit prefix which maps to that namespace.  </s>
<s> See the XPath spec, section 2.3 (Node Tests), third paragraph or thereabouts."  </s>
<s> Maybe we should ask the editors of XPath of the intended meaning of the sentence above.  </s>
<s> Regards, Gregor Gregor Karlinger Phone +43 316 873 5541 Institute for Applied Information Processing and Communications Austria  </s>

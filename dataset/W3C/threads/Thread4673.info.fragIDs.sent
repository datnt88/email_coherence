<s> Consider the following query: declare namespace n = "N"; declare namespace m = "M"; declare variable $n:x {"nx"}; declare variable $m:x {"mx"}; declare variable $e { e n:a="{$n:x}" xmlns:n="M"/ }; declare variable $f { f a="{$e/@a}" xmlns="M"/ }; e: {$e} f: {$f} The output I expect is: e: e xmlns:n="M" n:a="mx"/ f: f xmlns="M" a="mx"/ Saxon 7.8 emits: e: e xmlns:n="M" n:a="nx"/ f: f xmlns="M" a=""/ Kawa doesn't handle namespace declaration attributes, but it's next on my list of projects to tackle.  </s>
<s> This is tricky to implement (and for humans to read), because the namespace declaration attribute follows an enclosed expression that makes use of it.  </s>
<s> This means that namespace resolution cannot be done during the first parsing pass.  </s>
<s> XQuery could avoid this complexity, by requiring that namespace declaration attributes come before regular attributes - or at least before any enclosed expressions.  </s>
<s> --Per Bothner per@bothner.com  </s>
<s> http://per.bothner.com/  </s>
<s> Hi Per, Element constructors use the syntax of XML, which does not require namespace declaration attributes to occur before other attributes.  </s>
<s> If we made the change you suggest, suppose that a user wants to write a query by cutting existing XML text and pasting it into a query, adding dynamic content - this user would have to make sure that all namespace declaration attributes occur first, which means editing the text everywhere that this is not the case.  </s>
<s> To me, this seems like an ease-of-use versus ease-of-implementation issue, and the implementation is not all that difficult.  </s>
<s> Jonathan This email message represents my views only, and is not a response from the W3C XML Query Working Group.  </s>
<s> I'm inclined to agree - but the implementation isn't that trivial, especially if you need to fix an existing implementation by adding an extra pass.  </s>
<s> I wanted to see if my understanding matches that of the committee before I go ahead implementing it myself.  </s>
<s> Perhaps it might be worthwhile adding an "Implementation note" (or whatever) in the specification mentioning this issue.  </s>
<s> --Per Bothner per@bothner.com  </s>
<s> http://per.bothner.com/  </s>

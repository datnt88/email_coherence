<s> I'm trying to get a grasp of the group's sentiment on marked sections, and am not sure what all the options and positions are.  </s>
<s> This morning, Charles Goldfarb suggested that there are really two cases: a) conditional marked sections are needed in DTDs, for version control and tweaking b) (R)CDATA marked sections are needed in instances, for non-SGML notations (and, for that matter, for SGML notation -- CDATA marked sections are the simplest way I know to do SGML examples in documentation of a DTD But there appears to be another position: c) some argue that marked sections just complicate life too much for the parser, and can *always* be done away with, possibly by improving the tools we use Have I left out any major positions?  </s>
<s> It seems to me we are close to consensus on some things, but not all.  </s>
<s> - We seem to agree that instances don't need conditional sections.  </s>
<s> - There is some sentiment, not unanimous, that instances don't *have* to have CDATA or RCDATA marked sections, either; there are other ways to get the job done.  </s>
<s> - Some of us think DTDs don't need marked sections at all.  </s>
<s> - Some of us think DTDs need marked sections at all.  </s>
<s> - Some of us think XML must provide support for versioning in DTDs, through marked sections or by some other means.  </s>
<s> More detailed discussion follows.  </s>
<s> A. Conditional Sections and DTD Customization I think everyone agrees that conditional sections don't do much for us in instances -- if you have multiple versions, quite often you want to switch back and forth, as Eve Maler and others have described, which needs version-control elements or effectivity attributes, not marked sections.  </s>
<s> In DTDs, however, conditional inclusion is a major building block allowing for customization and version control.  </s>
<s> In HTML 2.0, it's used to allow a choice between lax and strict content models; in the TEI, it's used to allow the users to choose, at parse time, which of the many possible views of the TEI main DTD should be applied.  </s>
<s> I'm sure any reader of this list can supply further examples.  </s>
<s> By means of marked sections and parameter entities, it's possible to provide multiple views (multiple effective DTDs) from a single set of DTD source files, using technology that every SGML user is guaranteed to have available (i.e. an SGML parser).  </s>
<s> Without marked sections controlled by parameter entities, it would be necessary to write a DTD pre-processor as a stand-alone process, which accepts a view specification and provides a parseable form of the effective DTD.  </s>
<s> That might allow more subtle control of the process, but it would also - require users of complex DTDs to install special-purpose DTD preprocessors - require DTD subsets / views to be pre-generated before parse time - complicate maintenance and update immensely It seems to me that XML needs to offer some support for this kind of parse-time selection, because restricting XML to the world of monolithic DTDs just shuts too many people out.  </s>
<s> Conditional sections do complicate the lexical scanner a bit, but it *is* doable.  </s>
<s> (I.e.  </s>
<s> I managed to figure it out, our mythical CS grad ought to be able to figure it out much more easily.) B. (R)CDATA Marked Sections  </s>
<s> It seems essential that we have ways of representing delimiter strings in XML without having them parsed as delimiters.  </s>
<s> Off the top  </s>
<s> of my head, I can think of several ways to do this in SGML, for a paragraph like this one: The q tag marks a quotation: The e with an acute accent ( ) is coded &amp;eacute;. 1 In the TEI, we tag generic identifiers, and would tag entity names if we were more consistent, and we use CDATA marked sections for examples: The gi q /gi tag marks a quotation: eg ![ CDATA [ ]] /eg The e with an acute accent (&amp;eacute;) is coded ent eacute /ent .  </s>
<s> 2 Entity references: The q tag marks a quotation: q lang='fra' L'&amp;amp;eacute;tat, c'est moi!q The e with an acute accent (&amp;eacute;) is coded &amp;amp;eacute;.  </s>
<s> 3 Empty comments: The  !  </s>
<s> q tag marks a quotation: The e with an acute accent (&amp;eacute;) is coded &amp; !  </s>
<s> eacute;.  </s>
<s> This technique can also be used, substituting processing instructions or a &amp;nil; entity (defined as '') or -- gulp -- marked sections: !  </s>
<s> p =  ?  </s>
<s> p = &amp;nil;p =  ![[]]  </s>
<s> p . 4 CDATA or RCDATA elements: if EG is an RCDATA element, then the start-tag for Q can be given literally, the entity references still need to be escaped, and the end-tag for Q needs to be escaped.  </s>
<s> If EG is a CDATA element, I am not sure it's possible to give this example in this form -- which is why I gave up on CDATA elements in favor of CDATA marked sections.  </s>
<s> 5 External CDATA, SDATA, or NDATA entities (I assume CDATA is the correct choice here, but I am always a bit unsure) !NOTATION ASCII PUBLIC 'ISO 646:1991//NOTATION Internation Reference Version//EN' The gi q /gi tag marks a quotation: &amp;etat; The e with an acute accent (&amp;eacute;) is coded ent eacute /ent .  </s>
<s> 6 Shortrefs: define shortrefs of \  and \&amp; for lt and amp.  </s>
<s> I've seen this suggested; has anyone seen it used?  </s>
<s> Are there other techniques people have seen?  </s>
<s> I began this note intending to argue for CDATA marked sections as harmless, useful, and not all that hard to parse (backsliding already from the ascetic position James Clark talked me into yesterday).  </s>
<s> Having reviewed these options, though, I think I have to admit that (R)CDATA marked sections really are *not* absolutely essential, and thus should (by James Clark's proposed rule) be omitted from XML.  </s>
<s> By another test (would I go to the effort to write a pre-processor for this feature?), they might belong in XML -- some will insist on editing using CDATA sections, and export to XML the way people currently export to HTML.  </s>
<s> If XML has CDATA marked sections, we might be able to publish on the Web *without* an extra export-to-dumb-markup-language step.  </s>
<s> But perhaps James is right: I just need better tools.  </s>
<s> An editor macro to escape the currently selected region, or to de-escape it while I edit an SGML example, would probably do the trick.  </s>
<s> If, in cases of doubt, the rule is to omit the construct, than I seem to have talked myself into saying: Junk CDATA marked sections.  </s>
<s> C. Possible Approaches What are our options for XML?  </s>
<s> We could keep marked sections on the grounds that they are useful and not too hard to parse.  </s>
<s> We could simplify the parsing a bit, e.g. by insisting that CDATA and RCDATA be literals, not entity references, -- or do people switch between CDATA and IGNORE?!  </s>
<s> If we want to lose marked sections, we need to say how to get the required function.  </s>
<s> For CDATA sections, I think either of techniques 2 or 3 above would work, though I suspect someone will want to drop the empty comment from the language, leaving us with technique 2 (sigh).  </s>
<s> For conditional sections, it's harder: - we can revise the declaration rules to provide for customization by other means.  </s>
<s> For example "Multiple element declarations are legal; the first one wins" etc. - we can reinvent the C preprocessor, and say that conditional sections (and perhaps selective expansion of entity references) is handled by a simple pre-processor.  </s>
<s> Dividing up the functionality this way helps keep it manageable; it also allows us to imagine a situation in which the server (normally a Big machine) does the preprocessing, to keep parsing simple for the client (often a Little machine).  </s>
<s> If our motive for keeping XML as light-weight as possible is to ensure that we can write light-weight processors for low-end machines, then this would allow us to have an XML Extra-Lite for those of us with 8086s still on our desks.  </s>
<s> The pre-processor can be pretty light-weight, too, if we make it easy to detect the relevant parameter-entity declarations and ensure that the DTD can otherwise be skipped.  </s>
<s> Drawback: separating some function into a pre-processor could be the thin end of a wedge leading to an XML with optional features, which would lead to interoperability problems.  </s>
<s> We do *not* want optional features: any XML processor handling any XML document is a much more attractive model.  </s>
<s> -C.  </s>
<s> M. Sperberg-McQueen ACH / ACL / ALLC Text Encoding Initiative University of Illinois at Chicago tei@uic.edu  </s>
<s> Case #2 is easily the most readable and useful.  </s>
<s> Like Michael, I've tried some of the others and switched.  </s>
<s> As far as I can glean, James Clark's objection to marked sections apply only to their use in mixed content.  </s>
<s> He has proposed to solve this (and other RE related problems) by abolishing mixed content for XML.  </s>
<s> I think that is an excellent idea.  </s>
<s> I would propose going a step further and dropping all declared content from XML. not just CDATA and RCDATA, but also EMPTY.  </s>
<s> (I would use "(#PCDATA)" instead of EMPTY.  </s>
<s> I realize that it doesn't allow an XML parser to enforce emptiness, but there are many application-specific constraints that even an SGML parser can't enforce.  </s>
<s> Inability to enforce emptiness would be a small price for XML to pay to achieve simple, DTD-free, instance parsing.) Charles F. Goldfarb * Information Management Consulting * +1(408)867-5553 13075 Paramount Drive * Saratoga CA 95070 * USA International Standards Editor * ISO 8879 SGML * ISO/IEC 10744 HyTime Prentice-Hall Series Editor * CFG Series on Open Information Management  </s>
<s> 1 CDATA marked sections for examples: ![ CDATA [ &amp;hi; p ]] 2 Entity references: &amp;amp;hi; p 3 Empty comments:  !  </s>
<s> P or  ?  </s>
<s> P or &amp;nil;P or  ![IGNORE[]] P 4 CDATA or RCDATA elements: XMP P /XMP 5 External CDATA, SDATA, or NDATA entities: &amp;my-escaped-phrase; 6 Shortrefs: \&amp;ht; \ P  </s>
<s> I haven't seen 6 actually used, though it has some nice features.  </s>
<s> Doing this of course does not mean XML needs to support SHORTREF; XML merely needs to define "\ " and "\&amp;" in the XML grammar; SGML could then achieve compatibility by using SHORTREF in its domain.  </s>
<s> Another option is to set MSSCHAR in your SGML declaration, say, to '\'.  </s>
<s> It works basically like backslash in C: the following character is not recognized as starting any delimiter.  </s>
<s> Unfortunately, I have been given to understand that it differs in one crucial respect: the backslash (or other MSSCHAR character) remains in the parsed result as a data character.  </s>
<s> This is not so bad as long as you can configure your downstream processor (browser/indexer/etc) to get rid of it later.  </s>
<s> On the other hand, the fact that  and / are not recognized before a whitespace character (due to contextual constraints), means that you can just insert a blank space after them to escape them, and have a formatting option (or requirement) that a single space is always discarded after  or /.  </s>
<s> This would live outside the domain of the parser/formal language entirely, but would be pretty trivial, and pretty easy to explain.  </s>
<s> I hope note, since if one switches between CDATA and IGNORE you invite disaster, since IGNORE marked sections can nest but CDATA can't.  </s>
<s> Thus, if you set %flag to IGNORE, this works: ![ %flag; [ there AT&amp;T ]] but if you change %flag to CDATA, the company name will produce a syntax error (or reference the "T" entity, or the #DEFAULT entity...).  </s>
<s> If no entity reference happens to be around, then SGML recognizes the (unmatched) ]] on the last line, but it is not considered an error that it was found with no marked section still open for it to close, so it is effectively ignored.  </s>
<s> Such behaviors also effect the "5-line Perl script writer" Jon has mentioned....  </s>
<s> I think I vote for the space convention or the shortrefs.  </s>
<s> But I'm not sure.  </s>
<s> Steve  </s>
<s> Yes, we have a client who is successfully using marked sections to control the all-possible legal case.  </s>
<s> They encode SGML document that model via marked section language that could appear in legal banking documents (variants for each state and the federal government).  </s>
<s> Each marked section is controlled by a parameter entity.  </s>
<s> These parameter entities are hooked into an expert system using storage managers (available in James Clark's SP).  </s>
<s> Thus, when they parse a document, they get the appropriate language for the banking transaction at hand.  </s>
<s> In short, they using marked sections to control variants.  </s>
<s> There is another solution to this.  </s>
<s> The solution involves DSSSL and HyTime and is what my talk an SGML '96 will be about.  </s>
<s> Its basically a transformation/merge model.  </s>
<s> So, if you have DSSSL, the above goes away.  </s>
<s> The reason I bring this up is there is quite a few industries that have to solve the documentation problem I outline above.  </s>
<s> They want to be able to have a publishing system that allows them to say: "here's my situation, gimmie my documents!" ...and out poofs the correct legal language.  </s>
<s> My opinion of marked section in instances is that they are nasty.  </s>
<s> You get into this whole issue of computability.  </s>
<s> I can never gauranty that my documents will always parse under all possible variants.  </s>
<s> The combinatorics of the test cases becomes in-practical very fast.  </s>
<s> Preprocessors have all kinds of hack-like advantages.  </s>
<s> My question would be if we need a preprocessor, what are we doing wrong?  </s>
<s> In the case of the client I described above, it turns out that a transformation model is much more elagant and proveable.  </s>
<s> You can parse every document and be assured that it is valid.  </s>
<s> Though, it needs a leap in technology OTOH, it is very nice to be able to: ![ IGNORE [ FOO I don't have a clue what I should be doing at this point in the document.  </s>
<s> So I left it to you.  </s>
<s> ]] There are all kinds of times when you need to just "shut off" a portion of a document in a production system because it make things explode.  </s>
<s> R. Alexander Milowski http://www.copsol.com/  </s>
<s> alex@copsol.com  </s>
<s> Copernican Solutions Incorporated (612) 379 - 3608  </s>

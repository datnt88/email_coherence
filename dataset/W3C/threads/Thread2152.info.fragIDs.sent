<s> I've put up a server that (I think) understands HTTP/1.2 features keepalive and Transfer-Encoding.  </s>
<s> (Because I haven't seen an official copy of the forthcoming draft, I can't be sure.) It's at and serves content identical to the normal www.research.att.com server.  </s>
<s> Here's what you can try:  </s>
<s> 1) If there's a Connection: keepalive request header, the server will hold the connection open for 10 seconds.  </s>
<s> 2) If - there's a Connection: keepalive request header, - the protocol version in the Full Request line is HTTP/1.2, and  </s>
<s> - the request is a GET on a CGI the server will use Transfer-Encoding: chunked to send the output.  </s>
<s> Try 3) The URL http://www.research.att.com:8000/digest-test refers to a resource that is protected by Digest authentication.  </s>
<s> The user is "protected".  </s>
<s> Password is "try-me-out".  </s>
<s> The nonce expires after five minutes.  </s>
<s> Try it out.  </s>
<s> Bug reports are welcome.  </s>
<s> Dave Kristol  </s>
<s> 1) If there's a Connection: keepalive request header, the server will hold the connection open for 10 seconds.  </s>
<s> This might be a bit short.  </s>
<s> My trace-based curves show a fairly sharp "knee" in mean requests/connection at somewhat higher timeouts, around 1-2 minutes.  </s>
<s> I assume you're closing idle connections as necessary when your total connection count exceeds a threshold.  </s>
<s> If not, then the 10-second timeout is probably necesary.  </s>
<s> I can't remember if we've discussed this on the group-wide mailing list, but I've suggested to some people that the keep-connection header include the IP address of the client or proxy that generates it.  </s>
<s> This ensures that requests made via an old-style proxy are not help open (which would effectively delay the response).  </s>
<s> It does require that proxies supporting the persistent-connection model have to rewrite this header, but that seems relatively benign.  </s>
<s> -Jeff  </s>
<s> As you mentioned in your paper there are two sources of such requests: requests for inlined images and subsequent hits on links by a user.  </s>
<s> I'm shooting for the first batch, I admit.  </s>
<s> In the future, with authentication and payment additions to HTTP, the short keepalive will address a larger proportion of the same-server traffic.  </s>
<s> Do you have any measurements for which of the two sources produces more of the same-server hits?  </s>
<s> Dave Kristol  </s>
<s> There's a slight syntactic difference between your implementation and the one we've done between Spyglass and NCSA.  </s>
<s> Just as an FYI: here's a copy of a mail I sent recently which explains how our implementations work.  </s>
<s> I'm also exchanging mails with Alex Hopmann to try and resolve the syntactic differences there as well.  </s>
<s> Both your implementation and Alex's draft specify a multipart response as an alternative to an accurate Content-length.  </s>
<s> That's fine -- we just have implemented it yet.  </s>
<s> Here's how current implementations work.  </s>
<s> NCSA Mosaic 2.6, NCSA HTTPd 1.5, and Enhanced Mosaic 2.1 all support this and interoperate together, and all implementations were done independently.  </s>
<s> We didn't share code with NCSA at all.  </s>
<s> Information on the NCSA implementation is at If the client wants the connection kept alive, it sends the following header with its request: Connection: Keep-Alive  </s>
<s> If the server recognizes this and wants to leave the connection open, it sends back: Connection: Keep-Alive  </s>
<s> It may only send this header back if the it also sends back a Content-Length header which the client may assume to be accurate.  </s>
<s> If the connection is left open, then the client may send more requests along the same connection.  </s>
<s> Any time the Connection: Keep-Alive header is sent and received back, then the connection should stay open.  </s>
<s> The NCSA 1.5 server implementation also sends back Keep-Alive: timeout=n, max=m  </s>
<s> but Enhanced Mosaic 2.1 ignores these.  </s>
<s> Eric W. Sink Senior Software Engineer, Spyglass eric@spyglass.com  </s>
<s> All opinions expressed here are my own.  </s>
<s> Okay, I changed my server to behave as below:  </s>
<s> I'll accept this from HTTP/1.0 clients.  </s>
<s> I'll return this.  </s>
<s> Right.  </s>
<s> My variant remains: if it's CGI output and client says protocol is HTTP/1.2, I'll chunk the output (Transfer-Encoding: chunked).  </s>
<s> Okay. But there's a potential problem here.  </s>
<s> If the server sends the response header, then encounters some kind of problem, it may be forced to close the connection, thus "lying".  </s>
<s> I'll add this later.  </s>
<s> Not there yet.  </s>
<s> Dave Kristol  </s>
<s> Fine.  </s>
<s> I forgot to mention: Either client or server can close the connection when necessary, with the other side being required to cope.  </s>
<s> Eric W. Sink Senior Software Engineer, Spyglass eric@spyglass.com  </s>
<s> All opinions expressed here are my own.  </s>
<s> As you mentioned in your paper there are two sources of such requests: requests for inlined images and subsequent hits on links by a user.  </s>
<s> I'm shooting for the first batch, I admit.  </s>
<s> In the future, with authentication and payment additions to HTTP, the short keepalive will address a larger proportion of the same-server traffic.  </s>
<s> Do you have any measurements for which of the two sources produces more of the same-server hits?  </s>
<s> I did not break down the traces by file name, so I don't have explicit results for inlined images vs. subsequent clicks.  </s>
<s> But in the paper I plot "requests arriving for already-open connections" vs. idle timeout.  </s>
<s> Generally, a large fraction of the gain (almost half) comes with timeouts greater than 10 seconds.  </s>
<s> This implies either of two things: (1) Many clients were delaying ca. 10 seconds before retrieving inlined images.  </s>
<s> (2) there were a lot of subsequent hits in the 10-100 second range.  </s>
<s> Hypothesis #1 seems rather unlikely, so I'd bet on #2. -Jeff  </s>
<s> If the connection is left open, then the client may send more requests along the same connection.  </s>
<s> Any time the Connection: Keep-Alive header is sent and received back, then the connection should stay open.  </s>
<s> Okay.  </s>
<s> But there's a potential problem here.  </s>
<s> If the server sends the response header, then encounters some kind of problem, it may be forced to close the connection, thus "lying".  </s>
<s> The basic rule for a persistent-connection HTTP has to be that either client or server (or proxy, for that matter) is allowed to close any connection at any time.  </s>
<s> This isn't "lying", this is life.  </s>
<s> The word "should" (as in "should stay open") in IETF-speak usually has the meaning "do this unless you cannot".  </s>
<s> I think we need to word the spec using "may"; neither side can compel the other to keep a connection open.  </s>
<s> -Jeff  </s>
<s> ] From: Jeffrey Mogul mogul@pa.dec.com ] Subject: Re: HTTP/1.2 stuff: try it out!  </s>
<s> ] Date: Wednesday, August 23, 1995 1:56PM ] But in the paper I plot "requests arriving for already-open connections" ] vs. idle timeout.  </s>
<s> Generally, a large fraction of the gain (almost ] half) comes with timeouts greater than 10 seconds.  </s>
<s> This implies ] either of two things: ] (1) Many clients were delaying ca. 10 seconds before retrieving ] inlined images.  </s>
<s> ] (2) there were a lot of subsequent hits in the 10-100 second ] range.  </s>
<s> ] Hypothesis #1 seems rather unlikely, so I'd bet on #2.  </s>
<s> A third hypothesis -- that the previous entity requested took more than 10 seconds to transmit thru the network, thus delaying the arrival of the following request by that amount.  </s>
<s> Is this taken into account by the timeout mechanism in your implementation -- i.e., does the timeout period start when the TCP stack returns to the server from the server's send() call, or when the last byte leaves the server?  </s>
<s> Paul  </s>

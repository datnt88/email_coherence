<s> To summarize: I proposed that XML processors be required to stop passing data (other than error notifications) to applications after the first violation of well-formedness.  </s>
<s> Lots of people disagree.  </s>
<s> I will respond to some detail points below, but let me amplify a bit.  </s>
<s> Some have expressed doubt that the big M and N would really go for this behavior.  </s>
<s> M is on the list, N soon will be, they can speak for themselves, but I am representing what I understand to be their position.  </s>
<s> In the following list, perhaps #4 is the most important.  </s>
<s> 1. HTML only exists to be displayed.  </s>
<s> A botched display is, well, unfortunate.  </s>
<s> XML would not exist if it did not presuppose sophisticated processing by the recipient.  </s>
<s> It seems obvious that such processing cannot be trusted if the document fails to meet even basic standards of well-formedness.  </s>
<s> Java is fragile enough as it is without trying to build in botched-tag-recovery heuristics.  </s>
<s> 2. XML docs are expected to support XML Xpointers.  </s>
<s> Is it sane to try to interpret something like HREF="#HERE,DESCENDENT(1,FOO,BAR,23)" in a non-well-formed doc? 3. XML will be used to support EDI, big-time.  </s>
<s> The OFX format behind Money/Quicken is about to become XML, it seems.  </s>
<s> Obviously, a violation in this case will/should/must lead to instant abort of the transaction.  </s>
<s> 4. The vendors and *serious* information providers at one in wanting to create a non-HTML-like culture of publish-it-right on the Net; one way to do this is to shout, loudly, that there are a few (simple, thank goodness) rules, and they must be obeyed.  </s>
<s> 5. Clearly, authoring systems and the like must be able to deal, transiently, with non-well-formed documents.  </s>
<s> Is the input subsystem of an editor required to be an "XML processor"?  </s>
<s> Why should it?  </s>
<s> 6. Clearly, it is often the case that XML processors, having encountered errors, should in some cases proceed and report on all the following errors that can be detected.  </s>
<s> It does *not* therefore follow that they should merrily go on handing data and markup (of dubious reliability) to the application.  </s>
<s> 7. The vendors want off the "bugwards-compatible" treadmill.  </s>
<s> We should let them and in fact help them.  </s>
<s> 8. HTML still exists as an escape hatch for those who only care that their stuff looks decent on most screens most times.  </s>
<s> Oh come on.  </s>
<s> That would make it be a violation of conformance to output information about invalid portions of the instance aside from its initial fault  </s>
<s> Wrong.  </s>
<s> It would be legal to go on issuing error messages.  </s>
<s> including indexing of what text they contain (malformed or not) and further malformations.  </s>
<s> Right.  </s>
<s> Real world demands will require that processors not be so dainty.  </s>
<s> This is the key point.  </s>
<s> My perception is that this is exactly what the vendors and information providers want.  </s>
<s> Who's going to play cop?  </s>
<s> And if this were useful, wouldn't it be useful only if all parsers encountered the same error first?  </s>
<s> No, because they're allowed to report all the errors they find.  </s>
<s> [if you're] ... trying to avoid anyone making any effort at error recovery, please give up now, immediately.  </s>
<s> That's exactly what I'm trying.  </s>
<s> Do you expect malformed PostScript to produce a valid page, or a birth-date of September 48th to be accepted by a payroll system?  </s>
<s> Another example.  </s>
<s> It is very difficult indeed to devise an input stream that will cause [gtn]roff to complain.  </s>
<s> It is very difficult to hand-author any significant amount of PostScript and not have the first few drafts thrown out with syntax errors.  </s>
<s> Both are successful.  </s>
<s> | the consequences of the second half of that creed have led to intolerable | results in the quality and usability of the data on the Net.  </s>
<s> Name three such results.  </s>
<s> 1. David Siegel. 2. Overlapping FORMs and TABLEs.  </s>
<s> 3. FRAMESET/NOFRAMES 4. Javascript and CSS hidden in comments 5. Internet explorer uses 15 megabytes of memory  </s>
<s> Can any application hope to accomplish meaningful work in this mode if the document does not even  </s>
<s> manage  </s>
<s> to be well-formed!?!?  </s>
<s> It may very well be able to.  </s>
<s> For example, most valid SGML documents are not well-formed XML documents, but an XML parser may well be able to handle some of the constructs that are legal SGML but not legal XML.  </s>
<s> That's a good point; I could see an allowed special-case for *valid* SGML documents.  </s>
<s> Consider unquoted attribute values: an XML processor can easily recover from these.  </s>
<s> I disagree.  </s>
<s> The reliable presence of quotes makes XML attribute processing dramatically easier than SGML's.  </s>
<s> Furthermore, foo attr="val some more text &amp;amp; markup... 20k before the next quotation-mark will send most parsers (including at least SP and Lark) into gibber-mode.  </s>
<s> I think an unquoted attribute value is *precisely* the kind of thing that should remove any expectation that a document can be processed reliably by a receiving application, and which vendors should *not* be asked to heuristic (v?) their way around.  </s>
<s> requiring that the processor not process anything thereafter is totally unreasonable.  </s>
<s> As an implementor my reaction to that is: No way!  </s>
<s> I would not be willing to implement such behaviour whatever the spec says.  </s>
<s> The processor is not forbidden to proceed, looking for more errors (one of the things that SP is really good at) - it is just forbidden to pretend that everything is OK and go on passing bogus data to the application.  </s>
<s> You would be within your rights as an implementor to ignore this, but I, as an application builder, would not assign any significant client processing role to a component that insisted on trying to guess the meaning of egregiously broken data.  </s>
<s> The XML spec isn't perfect: it has bugs and things that aren't clear.  </s>
<s> XML parsers aren't perfect either.  </s>
<s> The result is there will be cases where one implementation thinks a document is well-formed, but another doesn't.  </s>
<s> The requirement you suggest would be disastrous in this situation.  </s>
<s> That is a good and troubling point.  </s>
<s> On the other hand, for the basics - proper tag/attribute syntax, nesting, and so on - it seems pretty likely that well-formedness should be *very* unambiguous.  </s>
<s> And on balance I am less troubled by the possibility of disagreement between processors, than by another another I-can-process-buggier- documents-than-you rat-race, or the possibility of downloading malformedness-recovery heuristics in every Java applet.  </s>
<s> What about an XML editor ?  </s>
<s> Of course, I might be in a situation where I am, temporarily, in a state where I have no well-formdness.  </s>
<s> Right, I agree; although an XML editor that produces valid output probably cannot use a pure XML processor, in the sense the spec uses, to read its input anyhow.  </s>
<s> The whole editing/authoring system, seen globally from the outside, probably qualifies as an XML processor, in that it will not emit documents that are not well-formed.  </s>
<s> [or I won't use it]  </s>
<s> Furthermore error messages only make sense if you know the context of them.  </s>
<s> I want to show my user the output of the parser that shows where exactly the error occured.  </s>
<s> You can provide the line-number, of course, but you would have to go back to the original document, load it non-parsed, so that you can exactly show the user where the error occured.  </s>
<s> Exactly.  </s>
<s> This is exactly what Emacs+SP does, and it seems like the correct behavior to me.  </s>
<s> So what I would like to focus this disucssion on is a taxonomy of error events.  </s>
<s> If we can come up with a list of errors, the class they belong to, and possible ways to handle these errors in terms of actions of the application, I guess many people would be happy.  </s>
<s> That would make sense, and I could go for that.  </s>
<s> I am suggesting a simpler solution, in the spirit of XML.  </s>
<s> Sean McGrath:  </s>
<s> I think it is hugely important to say "this is not well formed" but overly spartan to then say "so fix it and try again!".  </s>
<s> Yes, I agree; emit all the helpful error messages, the more the better - just don't go on, at the same time, passing data to the application as though nothing's wrong.  </s>
<s> Peter Murray-Rust:  </s>
<s> My basic tenet is that an XML document is either WF or it isn't.  </s>
<s> If there is one error, then the result is a null document.  </s>
<s> If that isn't true then I think we lose a large number of people who see XML as a robust and reliable way of passing information.  </s>
<s> I wouldn't go that far... I'd say "a null document plus error messages".  </s>
<s> To make things simple, I wouldn't even say "a null document", because that would forbid the processor from giving the app *anything* until he'd read the whole thing, to make sure it's WF.  </s>
<s> Peter Flynn:  </s>
<s> [M &amp; N] have no-one but themselves to blame for this.  </s>
<s> The facts of the situation were explained to them ad nauseam in person and over the wires long before the Web passed the point of inflection on its growth curve.  </s>
<s> Before we expend a large amount of effort on this, can someone confirm that it stands some chance of being listened to.  </s>
<s> Yes; and they have learned by experience.  </s>
<s> I wouldn't be advancing this is I wasn't PRETTY DAMN SURE that this is exactly what these people want.  </s>
<s> I dunno, the forgiving behavior of N&amp;M may in the big picture have been the right thing to do; perhaps an important part of the success of the Web.  </s>
<s> I.e. we may have a terrible hangover now, but we had fun last night so to speak.  </s>
<s> Joe and Jill Homepage are not likely to give the proverbial tinker's cuss whether their documents are well-formed or not, if the browsers are as forgiving and tolerant as N or M. The browsers are going to have to offer significant new features to compensate for the penalty of having the parser gag on invalid syntax.  </s>
<s> Joe &amp; Jill should go on using HTML.  </s>
<s> I myself will probably go on using HTML for all sorts of quick-post things.  </s>
<s> The significant new features (most of which involve smarts on the client to process richer data) require basically sound data; seems like a good trade-off to me.  </s>
<s> Sean McGrath again:  </s>
<s> I was simply making the point that the likes of nsgmls foo.sgm | grep -c "^(BAR$" can be a useful thing to do even if foo.sgm markup contains errors.  </s>
<s> Sure; but if you replace "grep -c" with some fancy java applet that does a business-critical application, this is no longer useful but highly dangerous.  </s>
<s> -Tim  </s>
<s> On error handling in XML...  </s>
<s> The SoftQuad SGML parser has multiple levels of strictness; at the least strict, it can attempt to continue after certain kinds of error.  </s>
<s> When you use the Author/Editor Validate option, strictness is (obviously) enabled.  </s>
<s> When you open an SGML file, it's less strict.  </s>
<s> In the same way, I can envision an XML parser having two or more levels of strictness: (1) completely strict (2) error recovery, try to soldier on wherever possible (3) no error recovery at all, goes wrong randomly I don't see this as a problem.  </s>
<s> Let's stop arguing over it and allow an XML application to take either route.  </s>
<s> Clearly a Validating XML Parser must support option (1), including full support for a DTD.  </s>
<s> Otherwise, (2) is generally the most useful if you have no control over the documents (e.g. got them over the web and just want to read them) and (3) is easiest to write in Perl.  </s>
<s> So allow them all.  </s>
<s> Lee  </s>
<s> For my money, the old CheckMark parser had both the best error recovery strategy and the best user interface.  </s>
<s> An XML editor that worked the same way would really win my heart....  </s>
<s> It continuously validated the SGML instance, and when it encountered an error it would (a) attempt to recover (mostly successfully), and (b) put a vertical line on the status bar at the top of the screen that showed roughly where the error was.  </s>
<s> So, one would end up with a status bar that looked like this, with white-space equalling valid (heck, well formed) markup: few... big problem... just one... So, one would click on the bar, that would scroll you to the code, you'd get an error message, and you'd make the correction.  </s>
<s> Often, in "big problem" areas, fixing the first error would cause the rest of the errors to "uncascade", and one would experience the extreme gratification of watching one's document seem to correct itself, as the error bars disappeared one by one.  </s>
<s> The only situation where the interface caused problems was when the instance was so hosed that the bar was solid with errors -- and you wouldn't want to be correcting something like that with an interactive parser anyhow.  </s>
<s> Sam Hunting  </s>

<s> Re: IPP Chunked POST Roy T. Fielding (fielding@kiwi.ics.uci.edu)  </s>
<s> Thu, 17 Dec 1998 22:03:24 -0800  </s>
<s> In my opinion, Ken Coar is correct in saying that for a server to be *both* HTTP/1.1 compliant and CGI/1.1 compliant it MUST buffer chunked POST data and provide a Content-Length for the CGI script.  </s>
<s> Sending 411 is HTTP/1.1 compliant.  </s>
<s> Failure to parse the chunked encoding (and puking) would be non-compliance, but requiring a content-length for a given resource is necessary for many reasons (DoS and legacy system protection).  </s>
<s> This is a meaningless distinction.  </s>
<s> Consider this thought experiment: we have  </s>
<s> two HTTP servers, A and B.  </s>
<s> Server A can and does parse the chunked encoding.  </s>
<s> But it sends a 411 "Length  </s>
<s> Required" response with a "Connection: close" header in response to any  </s>
<s> request that does not include a "Content-Length" header.  </s>
<s> This is a compliant  </s>
<s> server.  </s>
<s> Server B understands no transfer-coding except "identity".  </s>
<s> It cannot receive  </s>
<s> or decode the "chunked" transfer-coding.  </s>
<s> It sends a 411 "Length Required"  </s>
<s> response with a "Connection: close" header in response to any request that  </s>
<s> does not include a "Content-Length" header.  </s>
<s> This is a non-compliant server.  </s>
<s> If we look at these servers as black boxes, observing their behavior only  </s>
<s> through their external interfaces, they are virtually indistinguishable  </s>
<s> (unless we look at the product tokens or something).  </s>
<s> So it's meanless to say  </s>
<s> that all HTTP/1.1 applications that receive entities must understand (be able  </s>
<s> to receive and decode) the ?chunked?  </s>
<s> transfer-coding.  </s>
<s> Sending 411 is HTTP/1.1 compliant.  </s>
<s> Failure to parse the chunked encoding (and puking) would be non-compliance, but requiring a content-length for a given resource is necessary for many reasons (DoS and legacy system protection).  </s>
<s> If the purpose of the text was to delineate one lame example from another,  </s>
<s> then I'd agree with you.  </s>
<s> The reason it is there is to prevent an HTTP/1.1  </s>
<s> application from mistakenly thinking the chunked encoding is *no* encoding  </s>
<s> and saving the chunk-sizes as part of the data.  </s>
<s> As far as the protocol  </s>
<s> is concerned, recognizing Transfer-Encoding chunked, and responding with  </s>
<s> 411 and connection close, is equivalent to parsing the chunked encoding.  </s>
<s> Nobody is going to prevent you from building a server that responds with  </s>
<s> 411 to every request without implementing chunked.  </s>
<s> It would be a dumb  </s>
<s> thing to do, but the standard doesn't prevent people from doing dumb things  </s>
<s> (only things that won't interoperate with others via HTTP).  </s>
<s> ....Roy  </s>
<s> Sending 411 is HTTP/1.1 compliant.  </s>
<s> Failure to parse the chunked encoding (and puking) would be non-compliance, but requiring a content-length for a given resource is necessary for many reasons (DoS and legacy system protection).  </s>
<s> That's the clarification I was looking for.  </s>
<s> [Not that it's good news.]  </s>
<s> So, for interoperability, a client always needs to be prepared to fall back to Content-Length with "identity" transfer-coding, and it's just plain out of luck  </s>
<s> (or at least forced to buffer) if it cannot determine the message length in advance.  </s>
<s> Or should it fall back to HTTP/0.9 behavior and signal the end of the message by closing the connection?  </s>
<s> -Carl  </s>
<s> cc: http-wg@hplb.hpl.hp.com Subject: Re: IPP Chunked POST  </s>
<s> Sending 411 is HTTP/1.1 compliant.  </s>
<s> Failure to parse the chunked encoding (and puking) would be non-compliance, but requiring a content-length for a given resource is necessary for many reasons (DoS and legacy system protection).  </s>
<s> have  </s>
<s> luck  </s>
<s> Oops, just realized after sending this that it won't do for the client to close the connection, since it would never be able to get a response.  </s>
<s> So the only real interoperable option is Content-Length/identity.  </s>
<s> Maybe we're just missing an appropriate usage of "SHOULD" in the HTTP spec.  </s>
<s> This needs another editing pass, but roughly:  </s>
<s> "An HTTP/1.1 server SHOULD not only receive and interpret data with a chunked encoding, it SHOULD treat chunked data as if it had received data  </s>
<s> with Content-Length.  </s>
<s> Note, however, that some server implementations will accept data with Content-Length but will reply with "411 Length Required" to chunked data, at least for those URLs that are implemented via CGI 1.x[ref] because of CGI/1.x's requirement that the Content-length be supplied.  </s>
<s> Even in those cases, it would be preferable for implementations to buffer the data in order to compute the length to pass on to the CGI program."  </s>
<s> Larry  </s>
<s> From: kugler@us.ibm.com [mailto:kugler@us.ibm.com]  </s>
<s> Sent: Wednesday, August 18, 1999 8:00 AM Subject: Re: IPP Chunked POST  </s>
<s> Sending 411 is HTTP/1.1 compliant.  </s>
<s> Failure to parse the chunked encoding (and puking) would be non-compliance, but requiring a content-length for a given resource is necessary for many reasons (DoS and legacy system protection).  </s>
<s> to receive and decode) the =93chunked=94 transfer-coding.  </s>
<s> Right, a client can interoperate with any server as long as it sticks to Content-Length.  </s>
<s> But if it cannot determine the message length in advance it's  </s>
<s> probably SOL.  </s>
<s> -Carl  </s>
<s> "Roy T. Fielding" fielding@kiwi.ics.uci.edu on 08/18/99 11:59:21 PM  </s>
<s> yarong@exchange.microsoft.com , http-wg@hplb.hpl.hp.com Subject: Re: IPP Chunked POST  </s>
<s> We might make replying '411 and connection close' to a chunked encoding 'conditionally compliant' rather than 'compliant' because otherwise, as has been pointed out, there are inteorperability problems.  </s>
<s> There is no interoperability problem here.  </s>
<s> The server response is understandable by the client.  </s>
<s> Any server has the right to deny service rather than buffer an unknown amount of data.  </s>
<s> No change is needed to the spec.  </s>
<s> ....Roy  </s>
<s> original article:http://www.egroups.com/group/http-wg/?start=8712  </s>
<s> Sending 411 is HTTP/1.1 compliant.  </s>
<s> Failure to parse the chunked encoding (and puking) would be non-compliance, but requiring a content-length for a given resource is necessary for many reasons (DoS and legacy system protection).  </s>
<s> experiment: we have  </s>
<s> 411 "Length  </s>
<s> any  </s>
<s> compliant  </s>
<s> cannot receive  </s>
<s> Required"  </s>
<s> request that  </s>
<s> non-compliant server.  </s>
<s> only  </s>
<s> indistinguishable  </s>
<s> meanless to say  </s>
<s> (be able  </s>
<s> to receive and decode) the =93chunked=94 transfer-coding.  </s>
<s> another,  </s>
<s> HTTP/1.1  </s>
<s> encoding  </s>
<s> protocol  </s>
<s> with  </s>
<s> encoding.  </s>
<s> with  </s>
<s> things  </s>
<s> Isn't that what Apache does with chunked POSTs?  </s>
<s> No. It is what mod_cgi requires.  </s>
<s> Apache implements chunked in the core, where any module can make use of it if they so desire.  </s>
<s> As I've said many times before, implementing a new protocol service using CGI is a bad idea.  </s>
<s> Making HTTP requirements based on the limitations of CGI is even worse.  </s>
<s> ....Roy  </s>
<s> I don't want to implement a new protocol service using CGI.  </s>
<s> But I'm worried about things like proxies refusing to forward chunked requests.  </s>
<s> I haven't kept up with the Jakarta thing, but it will be interesting to see if the Apache Java servlet implementation supports chunked POST.  </s>
<s> -Carl "Roy T. Fielding" fielding@kiwi.ics.uci.edu on 08/20/99 11:47:01 AM Subject: Re: IPP Chunked POST  </s>
<s> No. It is what mod_cgi requires.  </s>
<s> Apache implements chunked in the core, where any module can make use of it if they so desire.  </s>
<s> As I've said many times before, implementing a new protocol service using CGI is a bad idea.  </s>
<s> Making HTTP requirements based on the limitations of CGI is even worse.  </s>
<s> ....Roy  </s>
<s> First message to the list..  </s>
<s> I bumped into HTTP POST version issues about a month ago, and am looking for a definative reference to some data that defines the standard HTTP POST formats for HTTP/0.9, HTTP/1.0 and HTTP/1.1  </s>
<s> I managed to figured out by brute force that the HTTP version was required on the POST /url line in order to get the server to support multple headers.  </s>
<s> But upgrading the version from 1.0 to 1.1 caused the servers (Apache and NES) to abort with "invalid protocol" messages.  </s>
<s> Web searches, RFC reads, and consultation with Netscape and it's affiliates has not produced an answer.  </s>
<s> Any help would be greatly appreciated... Wilbur Putting A Human Face On Technology ;-) Literally!  </s>
<s> http://www.monmouth.com/~wstreett/FaceIT/  </s>

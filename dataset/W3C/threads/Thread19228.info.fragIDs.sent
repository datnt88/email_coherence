<s> I am trying to build Amaya 8.3 on an AIX 4.1.5  </s>
<s> R2 system using gcc version 3.3.2.  </s>
<s> I am using gtk+ 1.2.10.  </s>
<s> When the build gets to the point of trying to link bin/grm, there are several undefined references.  </s>
<s> The show stopper is the following: ../thotlib/libThotEditor.a(appdialogue.o)(.pr+0x2044):../../thotlib/dialogue/ ppdialogue.c:  </s>
<s> undefined reference to `.TteLoadApplications()'  </s>
<s> I have searched all files in the distribution and can not find any file that contains a subroutine named TteLoadApplications. Other undefined references are ZoomIn and ZoomOut, but I have found these in amaya/init.c.  </s>
<s> Note that init.c is not compiled at this point, and I have not yet tried to compile it.  </s>
<s> Also undefined are the variables appArgc and appArgv.  </s>
<s> As a workaround I added the following to batch/grammar.c: 710a711,712  </s>
<s> int appArgc; char **appArgv;  </s>
<s> 732a735,737  </s>
<s> appArgc = argc; appArgv = argv;  </s>
<s> In addition I had to add the following to the link (g++) command line to get this far: -lThotEditor -lgdk_imlib -lgtk -lgdk -lglib -lX11 -lXext -lpng -ljpeg -ltiff -lz -lungif -lgmodule  </s>
<s> I tried getting the latest source from CVS, but I still could not find any file that had a subroutine named TteLoadApplications.  </s>
<s> Any help would be appreciated.  </s>
<s> Tom schulz Applied Dynamics Intl. schulz@adi.com  </s>
<s> On Tue, 30 Mar 2004 14:57:16 -0500 (EST)  </s>
<s> This function is included in the Amaya/obj/amaya/EDITORAPP.c file generated by the app compiler.  </s>
<s> Are you sure you processed as explained in 1) create a new empty subdirectory obj 2) move into this subdirectory and execute "../configure" 3) launch "make"  </s>
<s> These function calls are protected a _ZOOMSCROLL define and are in a module that is not linked by grm and other compilers.  </s>
<s> int appArgc; char **appArgv;  </s>
<s> appArgc = argc; appArgv = argv;  </s>
<s> Normally you don't need to add any declaration.  </s>
<s> It seems that some includes are not found.  </s>
<s> The configure should add necessary libraries -lThotKernel etc.  </s>
<s> Let me know if things work better or not.  </s>
<s> Irene. Ir?ne Vatton INRIA Rh?ne-Alpes INRIA ZIRST e-mail: Irene.Vatton@inria.fr 655 avenue de l'Europe  </s>
<s> Yes, I did exactly that (I called the subdirectory 'aix').  </s>
<s> I ran configure as ../configure --with-gtk.  </s>
<s> When is the app compiler created and run?  </s>
<s> The file EDITORAPP.c does not exist at the time that grm is being built.  </s>
<s> It looks like the app compiler might be built by Amaya/aix/batch/Makefile, but not until after it tries to build grm.  </s>
<s> Some interestisting lines from the Makefile:  </s>
<s> COMPILERS=../bin/grm ../bin/str ../bin/prs ../bin/tra ../bin/app GRMS = APP.GRM  </s>
<s> PRESEN.GRM STRUCT.GRM TRANS.GRM all : ../bin $(GRMS) $(COMPILERS) \ ../bin/printstr ../bin/rescandialogue APP.GRM : APP.LAN ../bin/grm (DIR=`pwd` ; THOTDIR=$$DIR/$(THOTDIR) ; export THOTDIR ; \ cd ../../batch ; $$DIR/../bin/grm APP)  </s>
<s> I expect that configure is doing something wrong, but there are no error messages when it runs.  </s>
<s> I have captured the on screen output from configure, and could make it or anything else available if that would help.  </s>
<s> I expect that all the other problems have the same cause as this one.  </s>
<s> int appArgc; char **appArgv;  </s>
<s> appArgc = argc; appArgv = argv;  </s>
<s> Tom schulz Applied Dynamics Intl. schulz@adi.com  </s>
<s> On Wed, 31 Mar 2004 17:23:46 -0500 (EST)  </s>
<s> Yes grm is the meta compiler that generates str, prs, tra and app compilers.  </s>
<s> The file APP.LAN defines the grammar of the language A of Thot.  </s>
<s> Make should build grm, then str, ..., then app is launched to generate EDITORAPP.c,  </s>
<s> HTMLAPP.c, etc.  </s>
<s> These files are necessary to compile amaya.  </s>
<s> You could before go into the Amaya directory and launch "autoconf" then go back in the aix subdirectory and execute "../configure" (--with-gtk is the default value).  </s>
<s> I remember also that I launched "gmake MAKE=gmake" on AIX platforms.  </s>
<s> You could also launch "gmake MAKE=gmake -n " to see what gmake tries to do.  </s>
<s> Irene. Ir?ne Vatton INRIA Rh?ne-Alpes INRIA ZIRST e-mail: Irene.Vatton@inria.fr 655 avenue de l'Europe  </s>
<s> That got me looking in the right direction.  </s>
<s> If you need grm to build app, than grm can not depend on a file created by app!  </s>
<s> But the error I had was .../thotlib/libThotEditor.a(appdialogue.o)(.pr+0x2044):../../thotlib/ dialogue/ppdialogue.c: undefined reference to `.TteLoadApplications()' and TteLoadApplications is in EDITORAPP.c which is generated by app.  </s>
<s> Then I noticed that TteLoadApplications was needed by a file in libThotEditor.a which is one of the libraries that I added to the link command in an effort to resolve undefined references.  </s>
<s> I went back to the original link (g++) command and the errors were as follows: ../thotlib/libThotKernel.a(structlist.o)(.pr+0x3510):../../thotlib/base/ structlist.c:  </s>
<s> undefined reference to `.AbsBoxType(_AbstractBox*, unsigned char)' ../thotlib/libThotKernel.a(structlist.o)(.pr+0x37b0):../../thotlib/base/ structlist.c:  </s>
<s> undefined reference to `.GetExtraMargins(_Box*, _AbstractBox*, int*, int*, int*, int*)' ------ 5 skipped ------ ../thotlib/libThotKernel.a(structlist.o)(.pr+0x7ca4):../../thotlib/base/ structlist.c:  </s>
<s> undefined reference to `.AppliedView(_ElementDescr*, _AttributeBlock*, _DocumentDescr*, int)' ../thotlib/libThotKernel.a(presentationapiND.o)(.pr+0x5c):../../thotlib/ presentation/presentationapi.c: undefined reference to `.NumTypePRuleAPI(_PresRule*)' ../thotlib/libThotKernel.a(presentationapiND.o)(.pr+0x1c0):../../thotlib/ presentation/presentationapi.c: undefined reference to `.NumTypePRuleAPI(_PresRule*)' I decided to remove structlist.o and presentationapiND.o from libThotKernel.a in order to see what caused them to be included.  </s>
<s> When I did that, grm linked without error!  </s>
<s> I then put structlist.o and presentationapiND.o  </s>
<s> back in at the end of libThotKernel.a and the errors returned.  </s>
<s> Then I thought that there might be some bug in the GNU linker and switched back to the AIX linker.  </s>
<s> The errors remained (well, the text of the errors changed).  </s>
<s> I then dumped the archive symbol table to see if there are any symbols that are in structlist.o or presentationapiND.o that are also defined in some other file.  </s>
<s> I fould none, so I have no idea why structlist.o and presentationapiND.o are being linked in.  </s>
<s> Currently I am continuing the build with structlist.o and presentationapiND.o  </s>
<s> removed from libThotKernel.a.  </s>
<s> I intend to put them back in as soon as I get a link failure that indicates that they are required.  </s>
<s> I have a very slow machine, so I will not know for a long time how this will work out.  </s>
<s> Tom schulz Applied Dynamics Intl. schulz@adi.com  </s>
<s> On Wed, 31 Mar 2004 17:23:46 -0500 (EST)  </s>
<s> This problem could come from the use of a very old version of sed.  </s>
<s> One solution is to use gsed instead of sed.  </s>
<s> Irene. Ir?ne Vatton INRIA Rh?ne-Alpes INRIA ZIRST e-mail: Irene.Vatton@inria.fr 655 avenue de l'Europe  </s>
<s> I have found that the problem was not with configure at all.  </s>
<s> The problem is that when linking grm, the linker is bringing in structlist.o and presentationapiND.o from libThotKernel.a.  </s>
<s> To resolve the resulting undefined references, I added libThotEditor.a and then other libraries to the link command line.  </s>
<s> The end result of this was an undefined reference to TteLoadApplications which would be in EDITORAPP.c.  </s>
<s> Of course, EDITORAPP.c does not exist at the time that grm is being linked.  </s>
<s> My solution was to remove structlist.o and presentationapiND.o from libThotKernel.a to see what was causing them to be linked in.  </s>
<s> When I did that, grm linked without complaint!  </s>
<s> No errors or warnings at all.  </s>
<s> In fact, the build completed with out any more problems.  </s>
<s> I never had to restore structlist.o and presentationapiND.o to libThotKernel.a.  </s>
<s> My next problem is that amaya does not run, but I will send mail under a different subject for that.  </s>
<s> Tom schulz Applied Dynamics Intl. schulz@adi.com  </s>

I am trying to build Amaya 8.3 on an AIX 4.1.5 
R2 system using gcc version 3.3.2. 
I am using gtk+ 1.2.10. 
When the build gets to the point of trying to link bin/grm, there are several undefined references. 
The show stopper is the following: ../thotlib/libThotEditor.a(appdialogue.o)(.pr+0x2044):../../thotlib/dialogue/ ppdialogue.c: 
undefined reference to `.TteLoadApplications()' 
I have searched all files in the distribution and can not find any file that contains a subroutine named TteLoadApplications. Other undefined references are ZoomIn and ZoomOut, but I have found these in amaya/init.c. 
Note that init.c is not compiled at this point, and I have not yet tried to compile it. 
Also undefined are the variables appArgc and appArgv. 
As a workaround I added the following to batch/grammar.c: 710a711,712 
int appArgc; char **appArgv; 
732a735,737 
appArgc = argc; appArgv = argv; 
In addition I had to add the following to the link (g++) command line to get this far: -lThotEditor -lgdk_imlib -lgtk -lgdk -lglib -lX11 -lXext -lpng -ljpeg -ltiff -lz -lungif -lgmodule 
I tried getting the latest source from CVS, but I still could not find any file that had a subroutine named TteLoadApplications. 
Any help would be appreciated. 
Tom schulz Applied Dynamics Intl. schulz@adi.com 
On Tue, 30 Mar 2004 14:57:16 -0500 (EST) 
This function is included in the Amaya/obj/amaya/EDITORAPP.c file generated by the app compiler. 
Are you sure you processed as explained in 1) create a new empty subdirectory obj 2) move into this subdirectory and execute "../configure" 3) launch "make" 
These function calls are protected a _ZOOMSCROLL define and are in a module that is not linked by grm and other compilers. 
int appArgc; char **appArgv; 
appArgc = argc; appArgv = argv; 
Normally you don't need to add any declaration. 
It seems that some includes are not found. 
The configure should add necessary libraries -lThotKernel etc. 
Let me know if things work better or not. 
Irene. Ir?ne Vatton INRIA Rh?ne-Alpes INRIA ZIRST e-mail: Irene.Vatton@inria.fr 655 avenue de l'Europe 
Yes, I did exactly that (I called the subdirectory 'aix'). 
I ran configure as ../configure --with-gtk. 
When is the app compiler created and run? 
The file EDITORAPP.c does not exist at the time that grm is being built. 
It looks like the app compiler might be built by Amaya/aix/batch/Makefile, but not until after it tries to build grm. 
Some interestisting lines from the Makefile: 
COMPILERS=../bin/grm ../bin/str ../bin/prs ../bin/tra ../bin/app GRMS = APP.GRM 
PRESEN.GRM STRUCT.GRM TRANS.GRM all : ../bin $(GRMS) $(COMPILERS) \ ../bin/printstr ../bin/rescandialogue APP.GRM : APP.LAN ../bin/grm (DIR=`pwd` ; THOTDIR=$$DIR/$(THOTDIR) ; export THOTDIR ; \ cd ../../batch ; $$DIR/../bin/grm APP) 
I expect that configure is doing something wrong, but there are no error messages when it runs. 
I have captured the on screen output from configure, and could make it or anything else available if that would help. 
I expect that all the other problems have the same cause as this one. 
int appArgc; char **appArgv; 
appArgc = argc; appArgv = argv; 
Tom schulz Applied Dynamics Intl. schulz@adi.com 
On Wed, 31 Mar 2004 17:23:46 -0500 (EST) 
Yes grm is the meta compiler that generates str, prs, tra and app compilers. 
The file APP.LAN defines the grammar of the language A of Thot. 
Make should build grm, then str, ..., then app is launched to generate EDITORAPP.c, 
HTMLAPP.c, etc. 
These files are necessary to compile amaya. 
You could before go into the Amaya directory and launch "autoconf" then go back in the aix subdirectory and execute "../configure" (--with-gtk is the default value). 
I remember also that I launched "gmake MAKE=gmake" on AIX platforms. 
You could also launch "gmake MAKE=gmake -n " to see what gmake tries to do. 
Irene. Ir?ne Vatton INRIA Rh?ne-Alpes INRIA ZIRST e-mail: Irene.Vatton@inria.fr 655 avenue de l'Europe 
That got me looking in the right direction. 
If you need grm to build app, than grm can not depend on a file created by app! 
But the error I had was .../thotlib/libThotEditor.a(appdialogue.o)(.pr+0x2044):../../thotlib/ dialogue/ppdialogue.c: undefined reference to `.TteLoadApplications()' and TteLoadApplications is in EDITORAPP.c which is generated by app. 
Then I noticed that TteLoadApplications was needed by a file in libThotEditor.a which is one of the libraries that I added to the link command in an effort to resolve undefined references. 
I went back to the original link (g++) command and the errors were as follows: ../thotlib/libThotKernel.a(structlist.o)(.pr+0x3510):../../thotlib/base/ structlist.c: 
undefined reference to `.AbsBoxType(_AbstractBox*, unsigned char)' ../thotlib/libThotKernel.a(structlist.o)(.pr+0x37b0):../../thotlib/base/ structlist.c: 
undefined reference to `.GetExtraMargins(_Box*, _AbstractBox*, int*, int*, int*, int*)' ------ 5 skipped ------ ../thotlib/libThotKernel.a(structlist.o)(.pr+0x7ca4):../../thotlib/base/ structlist.c: 
undefined reference to `.AppliedView(_ElementDescr*, _AttributeBlock*, _DocumentDescr*, int)' ../thotlib/libThotKernel.a(presentationapiND.o)(.pr+0x5c):../../thotlib/ presentation/presentationapi.c: undefined reference to `.NumTypePRuleAPI(_PresRule*)' ../thotlib/libThotKernel.a(presentationapiND.o)(.pr+0x1c0):../../thotlib/ presentation/presentationapi.c: undefined reference to `.NumTypePRuleAPI(_PresRule*)' I decided to remove structlist.o and presentationapiND.o from libThotKernel.a in order to see what caused them to be included. 
When I did that, grm linked without error! 
I then put structlist.o and presentationapiND.o 
back in at the end of libThotKernel.a and the errors returned. 
Then I thought that there might be some bug in the GNU linker and switched back to the AIX linker. 
The errors remained (well, the text of the errors changed). 
I then dumped the archive symbol table to see if there are any symbols that are in structlist.o or presentationapiND.o that are also defined in some other file. 
I fould none, so I have no idea why structlist.o and presentationapiND.o are being linked in. 
Currently I am continuing the build with structlist.o and presentationapiND.o 
removed from libThotKernel.a. 
I intend to put them back in as soon as I get a link failure that indicates that they are required. 
I have a very slow machine, so I will not know for a long time how this will work out. 
Tom schulz Applied Dynamics Intl. schulz@adi.com 
On Wed, 31 Mar 2004 17:23:46 -0500 (EST) 
This problem could come from the use of a very old version of sed. 
One solution is to use gsed instead of sed. 
Irene. Ir?ne Vatton INRIA Rh?ne-Alpes INRIA ZIRST e-mail: Irene.Vatton@inria.fr 655 avenue de l'Europe 
I have found that the problem was not with configure at all. 
The problem is that when linking grm, the linker is bringing in structlist.o and presentationapiND.o from libThotKernel.a. 
To resolve the resulting undefined references, I added libThotEditor.a and then other libraries to the link command line. 
The end result of this was an undefined reference to TteLoadApplications which would be in EDITORAPP.c. 
Of course, EDITORAPP.c does not exist at the time that grm is being linked. 
My solution was to remove structlist.o and presentationapiND.o from libThotKernel.a to see what was causing them to be linked in. 
When I did that, grm linked without complaint! 
No errors or warnings at all. 
In fact, the build completed with out any more problems. 
I never had to restore structlist.o and presentationapiND.o to libThotKernel.a. 
My next problem is that amaya does not run, but I will send mail under a different subject for that. 
Tom schulz Applied Dynamics Intl. schulz@adi.com 

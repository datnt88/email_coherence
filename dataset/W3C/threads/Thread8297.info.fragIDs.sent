<s> Hi, I note that the issue above ( http://www.webdav.org/wg/rfcdev/issues.htm ) mentions: "Another seems to be to specify what lock to refresh in a lock refresh request."  </s>
<s> RFC2518bis-05 (and possibly earlier versions) resolve this by using the "Lock-Token" header to indicate which lock to refresh (I think this was dicussed during an interop meeting; but this resolution doesn't appear on the issues list like it should!).  </s>
<s> I *do* agree that "Lock-Token" technically is a better choice to select  </s>
<s> the lock to be refreshed, however...: - RFC2518bis is unclear about whether you'll still need to specify the "If" header in the request (because one may argue that the LOCK refresh  </s>
<s> request is modifying the locked state of the resource)  </s>
<s> - RFC2518bis says it is "recommended" to support the old marshalling ("If" header).  </s>
<s> I think for backwards compatibilty with existing client this should be a "REQUIRED".  </s>
<s> Finally, I'm not so sure that this change really makes sense.  </s>
<s> As far as  </s>
<s> I can tell, no widely used server currently implements the new marshalling (I just tested IIS5, Apache/moddav2 and our own).  </s>
<s> Also, clients will likely continue to use the old format anyway, because after  </s>
<s> all it works just fine; and IIS is unlikely to be upgraded anytime soon :-)  </s>
<s> So either 1) roll back the change in RFC2518bis, or  </s>
<s> 2) add both issue and resolution, and also clarify the issues mentioned  </s>
<s> above in new RFC2158bis text  </s>
<s> Best regards, Julian  </s>
<s> Given the behavior of IIS5 and Apache/moddav2, it sounds we're pretty much stuck with the 2518 marshalling, so I'd vote to just roll back the change in 2518bis.  </s>
<s> Cheers, Geoff Julian wrote on 06/02/2004 09:16:27 AM:  </s>
<s> select  </s>
<s> refresh  </s>
<s> as  </s>
<s> after  </s>
<s> soon :-)  </s>
<s> mentioned  </s>
<s> The old way of overloading If seems pretty lame.  </s>
<s> Can't new clients do both?  </s>
<s> Can't new servers detect which approach in being used?  </s>
<s> I wouldn't require servers to support the old way.  </s>
<s> Supporting the old way is common sense but at some point we should encourage the movement to the new approach.  </s>
<s> J.  </s>
<s> Agreed, but it works (if it ain't broke, don't fix it).  </s>
<s> Why are we adding completely new requirements for both servers and clients with the inevitable interoperability issues if the present protocol does what it's supposed to do?  </s>
<s> They could, if we clearly define how.  </s>
<s> So far we haven't.  </s>
<s> Well, that would break Microsoft Office.  </s>
<s> I don't think people will be very interested in a spec revision that doesn't work with it.  </s>
<s> IMHO the only thing we should say is that LOCK without a request body  </s>
<s> *with* an If header will refresh all locks on the resource identified by  </s>
<s> the request URI (possibly deprecating the use of the Time-Out request header here -- I don't think there's a strong use case for changing the timeout after the lock already exists; and as far as I know existing servers do not support it anyway).  </s>
<s> Best regards, Julian  </s>
<s> Make that... "...will refresh all locks on the resource identified by  </s>
<s> the request URI that have been submitted in the 'If' header..." Julian  </s>
<s> We have been conservative about changes in RFC2518bis, generally only changing things where interoperability testing shows that there is a problem.  </s>
<s> In this case, confusion over where to put the lock token in refresh requests came up in actual implementations and early interoperability testing.  </s>
<s> In addition, it was unclear what to do if multiple lock tokens appeared in the If header (the Lock-Token header allows only one).  </s>
<s> IOW, the present protocol didn't quite do what it was supposed to do.  </s>
<s> It doesn't really fit our shared lock model (such as it is) to refresh all locks on the resource.  </s>
<s> Some may have been taken out by other  </s>
<s> users.  </s>
<s> Lisa  </s>
<s> I agree that it is confusing.  </s>
<s> However, popular clients and servers seems to agree on how it works, so why don't we just write that down?  </s>
<s> Yep. It should refresh exactly those that have been submitted in the "If" header.  </s>
<s> Best regards, Julian  </s>
<s> One problem is that popular clients and servers only do exclusive locks, so current practice is not sufficient to answer the unanswered questions in RFC2518.  </s>
<s> We could cut shared locks from WebDAV, require  </s>
<s> that only one resource's lock may be updated by a LOCK refresh request,  </s>
<s> and that would codify existing practice.  </s>
<s> I believe that works even for collection locks since a collection lock may not overlap another exclusive lock.  </s>
<s> So the new requirements would be something like: - The LOCK refresh request MUST address the resource that was locked (the root of the lock)  </s>
<s> - The If header on the LOCK refresh request MUST contain one (and only one) lock token, the token for the lock that is to be refreshed  </s>
<s> - The server MUST reject the request if the request-URI and token do not match  </s>
<s> Lisa  </s>
<s> Yes.  </s>
<s> I'd say it's harmless if it contains more lock tokens.  </s>
<s> The server can figure out which one actually identifies a lock on the request resource.  </s>
<s> Yes. Seems that we agree except for the minor point above; in practice I don't think that clients *will* submit multiple lock tokens in a refresh request, so this shouldn't be an issue.  </s>
<s> Best regards, Julian  </s>
<s> Well, the bigger issue then is whether to toss out shared locks.  </s>
<s> If they're not interoperably implemented, and if we're indeed trying to go to draft standard, then they need to go.  </s>
<s> lisa  </s>
<s> We discussed that before.  </s>
<s> We have both servers (Apache/moddav, SAP Netweaver, Xythos??) and clients (Adobe GoLive, SAP Netweaver) implementing them, so there doesn't seem to be any issue with it... Best regards, Julian  </s>
<s> I keep forgetting that, because it hasn't been done in interop tests, to my knowledge.  </s>
<s> Here's what we'll need: - Interop test reports from a couple independent pairs of server/clients, outlining what tests worked - Explanation of how servers refresh locks if the client submits multiple lock tokens in the If header in a LOCK refresh request - Any other clarifications necessary for shared locks... Lisa  </s>
<s> OK, here's my attempt to summarize what Lisa and I discussed.  </s>
<s> I think this should be used as resolution for the following issues: - LOCK_BODY_SHOULD_BE_MUST - LOCKS_SHOULD_THEY_USE_AN_IF_HEADER_TO_VERIFY Note that the description below does *not* change the original semantics; it's just a clarification that seems to be in sync with current implementations (and that's what we should be looking for when updating the protocol)...: 1) A LOCK request with message body is a LOCK create request.  </s>
<s> A LOCK request without a message body is a LOCK refresh request.  </s>
<s> 2) A LOCK refresh request refreshes those locks on the request resource whose lock tokens are submitted in the "If" header and whose lock-root is the resource identified by the request URI.  </s>
<s> A server MAY support using the Time-Out header to set a new timeout, but clients can not rely on that behaviour.  </s>
<s> 2a) In the case of a shared lock it's technically feasable to submit lock tokens for multiple locks to be refreshed in one "If" header.  </s>
<s> The semantics for that seem to be clear from 2), but it's doubtful whether a client will ever want to do that.  </s>
<s> IMHO it doesn't make any sense to put in the additional wording to forbid it, though (that's where I disagreed with Lisa...).  </s>
<s> Note that if we stick with this resolution, the LOCK refresh changes in RFC2518bis-05 will need to be rolled back.  </s>
<s> Best regards, Julian  </s>
<s> OK, can we please make a decision?  </s>
<s> Best regards, Julian  </s>

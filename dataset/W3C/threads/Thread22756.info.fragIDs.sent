<s> Hi,  </s>
<s> Is a NodeNamedMap ever used to hold anything but the Attrs of an Element?  </s>
<s> Might an Attr be an entry in more than one  </s>
<s> NamedNodeMap?  </s>
<s> A simply way to implement NamedNodeMap in c is to just add nextAttr and previousAtt members to Node and make NamedNodeMap a struct like: struct DOM_NamedNodeMap { unsigned long length;  </s>
<s> DOM_Node *first; DOM_Node *last;  </s>
<s> If the answers to the above questions are "no" I don't see a problem with this technique.  </s>
<s> Do you?  </s>
<s> Thanks Mike  </s>
<s> Yes -- they are used to hold the entity and notation definitions in the DocumentType node.  </s>
<s> I don't think Attr nodes can appear in more than one map.  </s>
<s> Whether or not this is a reasonable implementation approach depends on how you handle default attributes derived from the DTD; if you support a DTD, this may not be a good approach, especially if you support DOM mutation.  </s>
<s> (And yes, I think mutation should be a separate feature from simple read-access!  </s>
<s> But that's a different topic.) -Fred Fred L. Drake, Jr. fdrake at acm.org PythonLabs at Digital Creations  </s>
<s> Yes, I've since been informed by others that using members of Node to directly implement the NodeList will not work.  </s>
<s> I have a separate data structure for this now.  </s>
<s> It's a little inelegant to perform the pointer manipulations for each operation twice though; once for the NodeList itself and then again to update the members of Node.  </s>
<s> However, I have a new question.  </s>
<s> Imagine a NodeList is returned by getElementsByTagName.  </s>
<s> Then a Node in the DOM tree is modified (e.g. replaced, removed, etc).  </s>
<s> Will these changes be reflected in the NodeList returned by getElementsByTagName?  </s>
<s> If so this requires active communication between the DOM and any outstanding NodeLists.  </s>
<s> Is this true?  </s>
<s> Is there a way to make the view passive so that no active updating of outstanding NodeLists is required?  </s>
<s> Thanks,  </s>
<s> Mike  </s>
<s> From:Fred L. Drake, Jr. [SMTP:fdrake@acm.org]  </s>
<s> Sent:Wednesday, July 11, 2001 2:57 PM Subject:Re: NamedNodeMap  </s>
<s> From the Document Object Model (DOM) Level 2 Core Specification [1]: "NodeList [p.43] and NamedNodeMap [p.44] objects in the DOM are live;  </s>
<s> that is, changes to the underlying document structure are reflected in all relevant NodeList and NamedNodeMap objects.  </s>
<s> For example, if a DOM user gets a NodeList object containing the children of an Element [p.52], then subsequently adds more children to that element [p.98] (or removes children, or modifies them), those changes are automatically reflected in the NodeList, without further action on the user's part.  </s>
<s> Likewise, changes to a Node [p.34] in the tree are reflected in all references to that Node in NodeList and NamedNodeMap objects."  </s>
<s> Christopher Watson Sr. Software Engineer Lightspan, Inc. [1] http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/  </s>
<s> However, I have a new question.  </s>
<s> Imagine a NodeList is returned by getElementsByTagName.  </s>
<s> Then a Node in the DOM tree is modified (e.g. replaced, removed, etc).  </s>
<s> Will these changes be reflected in the NodeList returned by getElementsByTagName?  </s>
<s> If so this requires active  </s>
<s> communication between the DOM and any outstanding NodeLists.  </s>
<s> Is this true?  </s>
<s> Is there a way to make the view passive so that no active updating of outstanding NodeLists is required?  </s>
<s> This is the only interpretation I've ever heard, and I've heard little but griping about it.  </s>
<s> For most purposes, a fairly static NodeList is sufficient; for NodeList objects used to implement the childNodes attribute, there's not much of a problem, but the getElementsByTagName() and getElementsByTagNameNS() return values are problematic.  </s>
<s> My own DOM implementation is non-conforming in this regard, and I haven't heard any complaints from the users.  </s>
<s> I don't think the liveness requirement is described very carefully;  </s>
<s> if I have a node that I remove from the tree, and then add to another location, should the node be included in any NodeList objects returned from getElementsByTagName()?  </s>
<s> It's still "owned" by the document, and I may well stick it back in the tree somewhere.  </s>
<s> I'm sure this is covered somewhere, but this kind of thing ends up being a sticking point for me.  </s>
<s> -Fred Fred L. Drake, Jr. fdrake at acm.org PythonLabs at Digital Creations  </s>
<s> Yes, I'm quite familiar with this.  </s>
<s> The childNodes NodeList easy.  </s>
<s> It's when a select non-continous group of Nodes must be maintained and up to date.  </s>
<s> Ok, I'm glad I'm not the only one that is confused by this.  </s>
<s> The only way to implement this functionality verbatium that I can see would be to have an active NodeLists table for each Node.  </s>
<s> If a Node is  </s>
<s> selected for inclusion in a NodeList a pointer to that list is saved in a list of NodeLists that reference this Node.  </s>
<s> Then, at any time, if that Node is modified, replaced, removed, etc the appropriate action is performed on all active NodeLists for that Node.  </s>
<s> The table could be a hashtable member of Document.  </s>
<s> Whenever a node is freed the table entry is removed (after all it's NodeLists are updated of course).  </s>
<s> I beleive it could be done in an efficient manner actually.  </s>
<s> I think I'll get the basics working first.  </s>
<s> Thanks for your help, Mike  </s>
<s> From:Fred L. Drake, Jr. [SMTP:fdrake@acm.org]  </s>
<s> would  be to have an active NodeLists table for each Node.  </s>
<s> Think about memory management and object lifetime issues before you go that route.  </s>
<s> Joe Kesselman / IBM Research  </s>
<s> Whoops; not for *each* Node.  </s>
<s> Only one hash table per tree would be necessary.  </s>
<s> Mike  </s>
<s> -----Original Message----- From:Fred L. Drake, Jr. [SMTP:fdrake@acm.org]  </s>
<s> I don't think Memory Management would be an issue.  </s>
<s> In your destroyNode function you remove the list of NodeLists and if it's not NULL remove the entry from each .  </s>
<s> Then free the node per usual.  </s>
<s> I'm not really sure what you mean by object lifetime issues though.  </s>
<s> Do you mean their liftimes would be so short that all the extra machinery becomes silly?  </s>
<s> I agree, but I see no alternative.  </s>
<s> Mike  </s>
<s> From:Joseph Kesselman [SMTP:keshlam@us.ibm.com]  </s>
<s> Sent:Wednesday, July 11, 2001 4:48 PM Subject:RE: NamedNodeMap  </s>
<s> I don't know that it would be a problem for you (I vaguely recall you said you were working in C or C++), but it could be a problem for garbage-collected system.  </s>
<s> Circular references were considered a huge problem in older versions of Python because it used only reference counting for GC, and even today the cycle detector is optional (it *does* have a performance penalty, as all "real" GC systems do).  </s>
<s> With non-refcount GC, there can be a lack of temporal proximity between an object becoming garbage and being collected; unless you collect frequently (higher overhead), you can accumulate an enormous amount of garbage very quickly if you use a lot of temporary objects.  </s>
<s> -Fred Fred L. Drake, Jr. fdrake at acm.org PythonLabs at Digital Creations  </s>

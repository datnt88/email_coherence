<s> Dear All, I've seen a fair amount of Q&amp;A on this topic in the DSIG mailing list over the past several months, and the universally stated reason for canonicalizing SignedInfo before Reference validation is to enforce WYSIWYS.  </s>
<s> However, I'm still having trouble understanding how this would really be implemented for same-document fragment Reference URIs where the referenced XML is a sibling subtree of the enclosing document.  </s>
<s> For example: When, at the start of reference validation, XML-C14N (or some other canonicalization) is applied to the SignedInfo, the result is an octet stream.  </s>
<s> In order to proceed with retrieving the referenced object and calculating the digest value, the application will first need to parse the octet stream to recover an XML document with Reference elements in it.  </s>
<s> This results in a new document that does not contain the data object identified in the Reference URI.  </s>
<s> What now?  </s>
<s> Thanks, Ari Kermaier Phaos Technology Corp.  </s>
<s> Hi Vamsi, you could take ds:SignedInfo, canonicalize, re-parse and substitute the original-un-c14nized ds:SignedInfo with the c14nized-re-parsed ds:SignedInfo.  </s>
<s> BTW, for your example, you need to declare the Signature namespace for your signature.  </s>
<s> Christian --On Donnerstag, 11.  </s>
<s> Oktober 2001 19:04 -0400 Vamsi Motukuru  </s>
<s> That would work but, even if you are very strictly following the Core Validation Processing Rules, I don't see why you couldn't just use the fragment URI to get the data from the original document without plugging back in the parsed canonicalized SignedInfo.  </s>
<s> I don't see that it would make sense for the fragment to point at or inside the SignedInfo, although you should check for that and probably fail the signature if you find it's set up that way.  </s>
<s> Even further, it seems to me that most implementations will not allow arbitrary CannonicalizationMethod elements and, in fact, all the ones we have ever specified are such that you would not get in trouble doing the Reference Validation on the original document, then applying CannonicalizationMethod and doing Signature Validation, even though that's not what the Processing Rules say and is not safe for arbitrary CannonicalizationMethod elements... Donald  </s>
<s> From: Christian Geuer-Pollmann geuer-pollmann@nue.et-inf.uni-siegen.de  </s>
<s> Date: Fri, 12 Oct 2001 10:00:12 +0200  </s>
<s> In-reply-to: 001a01c152a9$1d64f1f0$38844ec6@starlan.com  </s>
<s> Message-id: 2153432166.1002880812@pinkpanther  </s>
<s> Hi Donald, You're right.  </s>
<s> I don't see a problem if you use (validate) the References etc. from the original Document and then do signature validation on the canonicalized ds:SignedInfo.  </s>
<s> A colleague of me pointed out that this is not according to the spec, so to strictly follow the spec, we have to c14nize SignedInfo, reparse and substitute for same-document-URIs.  </s>
<s> But well, my implementation does not do this at the moment.  </s>
<s> Does anyone sees a security implication if we do reference validation on the not-c14nized SignedInfo?  </s>
<s> I don't.  </s>
<s> Christian  </s>
<s> Mit freundlichen Gr??en, Christian Geuer-Pollmann Institute for Data Communications Systems University of Siegen Hoelderlinstrasse 3 D-57068 Siegen Germany mail: mailto:geuer-pollmann@nue.et-inf.uni-siegen.de  </s>
<s> web: http://www.nue.et-inf.uni-siegen.de/~geuer-pollmann/  </s>

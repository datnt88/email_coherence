<s> Hi all.  </s>
<s> When cloneNode is called for a Document object, what should docType and  </s>
<s> documentElement refer to if the clone is not deep?  </s>
<s> My inclination is to set  </s>
<s> each to NULL on a shallow clone, and clones of their respective objects in a  </s>
<s> deep clone.  </s>
<s> Tom Otvos Director of Research, EveryWare Development Inc. "Try not!  </s>
<s> Do, or do not.  </s>
<s> There is no 'try'." - Yoda  </s>
<s> Agreed, a shallow clone of a node should't copy any of the children, including the children which have specialized accessor methods... so shallow clone of Document shoul have null docType and documentElement.  </s>
<s> Note that doing deep clone of Document is a problem in DOM Level 1, since  </s>
<s> you have to change the ownerDocument of all the duplicated nodes or it'll throw wrong-document exceptions.  </s>
<s> In fact, this is the only function still "broken" in my implementation -- it's not at all hard to do, I just don't like the aesthetics of having this be the one exception to Level 1's decision not to support copying data from one document to another.  </s>
<s> Joe Kesselman / IBM Research Unless stated otherwise, all opinions are solely those of the author.  </s>
<s> set  </s>
<s> a  </s>
<s> I believe your interpretation is correct.  </s>
<s> Shallow cloneNode clones the target node and its attributes but not the child nodes.  </s>
<s> Since docType and documentElement are both possible child nodes of Document, I don't think they should be cloned.  </s>
<s> Best, Don Park Docuverse  </s>
<s> I sympathize with you position.  </s>
<s> I had to add setOwnerDocument to my Node implementation which propagates down to child nodes and any 'side' nodes (like attributes).  </s>
<s> Best, Don Park  </s>
<s> Yep, it's a choice between setOwnerDoc, or a version of Clone that sets ownerDoc as a side effect (which avoids a second tree-walk), or trying to guess what Level 2 might look like and implement some form of cloneByContent on all the nodes.  </s>
<s> A dozen of one, six-and-a-half of the other... I'll do one of these some time in the next day or two, but I'd love to have a good excuse not to smile .  </s>
<s> It's very much special-case code as far as Level 1 is concerned, and I've been trying to keep my code size down without sacrificing architecture.  </s>
<s> Joe Kesselman / IBM Research Unless stated otherwise, all opinions are solely those of the author.  </s>
<s> Why wouldn't this work...  </s>
<s> The method cloneNode utilizes three protected methods: shallowClone, to do the immediate cloning stuff; an overload of cloneNode that accepts an owner parameter; and a cloneChildren method that clones the children as well as sets their owners.  </s>
<s> So, cloneNode (the original) calls shallowClone, gets the owner from the clone, then calls cloneChildren with the owner.  </s>
<s> The cloneChildren method simply iterates over the children and calls the overloaded cloneNode which, after shallowClone, sets the specified owner.  </s>
<s> The key is that a shallowClone of a Document node immediately sets the owner to the new document, and the recursive calls to cloneNode propogate this new owner down the tree, as the cloning is happening.  </s>
<s> No double tree walk, and the prototype of cloneNode (the one in the spec) does not have to change.  </s>
<s> Yes, I know that the spec defines the accessor of the owner of Document to be NULL, but that does not mean we cannot keep it around anyhow.  </s>
<s> Comments?  </s>
<s> Tom Otvos Director of Research, EveryWare Development Inc. "Try not!  </s>
<s> Do, or do not.  </s>
<s> There is no 'try'." - Yoda Yep, it's a choice between setOwnerDoc, or a version of Clone that sets ownerDoc as a side effect (which avoids a second tree-walk), or trying to guess what Level 2 might look like and implement some form of cloneByContent on all the nodes.  </s>
<s> A dozen of one, six-and-a-half of the other... I'll do one of these some time in the next day or two, but I'd love to have a good excuse not to smile .  </s>
<s> It's very much special-case code as far as Level 1 is concerned, and I've been trying to keep my code size down without sacrificing architecture.  </s>
<s> Joe Kesselman / IBM Research Unless stated otherwise, all opinions are solely those of the author.  </s>
<s> Oh, and I should have also mentioned that the overloaded cloneNode also calls cloneChildren.  </s>
<s> So there is some minor code duplication between the two versions of cloneNode.  </s>
<s> Tom Otvos Director of Research, EveryWare Development Inc. "Try not!  </s>
<s> Do, or do not.  </s>
<s> There is no 'try'." - Yoda  </s>
<s> Tom,  </s>
<s> cloneNode(Document owner, boolean deep) scheme should work as well.  </s>
<s> I just chose the double tree walk scheme because a) double tree walk is costs is insignificant when there is a large number of object instantiation going on, b) cloneNode is likely to be overriden by user's own subclasses so I did not want my users to have to deal with extra details of owner document switching while cloning, and c) I prefer not to introduce unnecessary methods when dealing with design 'glitch' like this.  </s>
<s> Best, Don Park Docuverse  </s>
<s> As I said, it's not hard to do.  </s>
<s> I just begrudge adding code to multiple classes in my implementation of the DOM in order to support _only_ the Document.cloneNode  </s>
<s> operation; it offends my sense of proportion.  </s>
<s> grin The other approach, of course, is to try to guess where DOM Level 2 is going to go in terms of allowing data to be copied from document to document.  </s>
<s> Past conversation has generally guessed that this would be done by providing a "content clone" -- essentially, a copy constructor -- which uses the DOM's public API to extract data from the source and use it to create corresponding nodes native to this implementation (and anchored in this Document).  </s>
<s> Implementing Document.cloneNode based on that, rather than doing a special-case clone-and-reparent, is a larger chunk of code and won't run as fast... but on the other hand it's a more general solution, and represents functionality that the DOM is probably going to acquire anyway at some point.  </s>
<s> Joe Kesselman / IBM Research Unless stated otherwise, all opinions are solely those of the author.  </s>

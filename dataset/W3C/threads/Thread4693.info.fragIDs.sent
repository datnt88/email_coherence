<s> One function we added to our XQuery implementation is eval(), which takes a string and evaluates it as an XQuery expression.  </s>
<s> I'm wondering  </s>
<s> if the working group has considered adding such a function.  </s>
<s> The most obvious use case is a query that needs to be marked up and  </s>
<s> executed later.  </s>
<s> For example, in the NIST test suite, a test looks like:  </s>
<s> {fn:boolean(xs:double("-1.7976931348623157E308"))} So an implementor is somehow expected to read in the whole file and execute it as XQuery.  </s>
<s> If eval is supported, the same file can become fn:boolean(xs:double("-1.7976931348623157E308"))  </s>
<s> And the test may be evaluated with XQuery itself: eval(doc("test.xml")/results/string())  </s>
<s> There are, of course, many other uses.  </s>
<s> The is not merely a "convenience  </s>
<s> method" as it could never be written as a user-defined function.  </s>
<s> Any comments are appreciated.  </s>
<s> --Sarah  </s>
<s> We have looked at the function eval().  </s>
<s> However, we felt that such a function adds too much dynamic behaviour, that we cannot request from every implementation.  </s>
<s> It is also a function that has security issues (such as code insertion)  </s>
<s> and does not work well with statically typed systems.  </s>
<s> Best regards Michael  </s>
<s> like:  </s>
<s> "convenience  </s>
<s> I'm also in favor of an eval() function, and expect most of the better XQuery implementations to provide one.  </s>
<s> Statically, you'd type it as item()*.  </s>
<s> Static typing hasn't prevented the  </s>
<s> introduction of the data() function, which extracts the typed value of a  </s>
<s> sequence without having the most specific static type.  </s>
<s> Also, the security issue is moot; eval() doesn't have permission to do anything the user couldn't already do.  </s>
<s> Javascript and Perl both have eval.  </s>
<s> Code injection is only an issue if eval() takes only a string.  </s>
<s> If it also  </s>
<s> takes variable bindings (possibly the ones already in scope), then one could use parameterized queries and avoid injection.  </s>
<s> But code injection is already an issue for XQuery in general, just as it is for SQL.  </s>
<s> It's inconsistent that the committee long resisted external parameters -- which  </s>
<s> are critical in avoiding query injection -- and now uses injection as an  </s>
<s> argument against eval.  </s>
<s> And finally, I fail to see how eval() is any burden to implementers at all.  </s>
<s> In its simplest form, eval() simply recursively calls their own implementation to compile and execute the query string with the same static and dynamic environment as the original.  </s>
<s> If we're talking implementation  </s>
<s> burdens, let's discuss static typing, arbitrary-precision numerics, formal  </s>
<s> semantics, and the PSVI data model.  </s>
<s> Eval() is the tiniest fleck in the XQuery universe of features.  </s>
<s> If it's  </s>
<s> really such an obstacle, add it to a non-normative list of suggested functions (and put half of the existing F&amp;O there with it).  </s>
<s> Cheers, michael [mailto:public-qt-comments-request@w3.org]  </s>
<s> On Behalf Of Michael Rys We have looked at the function eval().  </s>
<s> However, we felt that such a function adds too much dynamic behaviour, that we cannot request from every implementation.  </s>
<s> It is also a function that has security issues (such as code insertion)  </s>
<s> and does not work well with statically typed systems.  </s>
<s> Best regards Michael  </s>
<s> like:  </s>
<s> "convenience  </s>
<s> I expect some XQuery functions to provide an eval() function.  </s>
<s> However, I (and others) have not considered it a feature that all implementations can or have to provide.  </s>
<s> As to fn:data(): the static result type of fn:data() is actually quite precise (the static type is determined based on the static type of the input argument).  </s>
<s> As to the security issues: There will be XQuery implementations that will have to worry about that (one of the reason why we should not require the standard to require this function.  </s>
<s> As to the inconsistency argument: I don't quite follow you why the position on not wanting external variables somehow should be tied to this discussion.  </s>
<s> Finally, I did not use the argument of it being a burden to implementers.  </s>
<s> Although as you should know, there is more to the cost of implementing than to code it... Best regards Michael  </s>
<s> the  </s>
<s> a  </s>
<s> also  </s>
<s> which  </s>
<s> an  </s>
<s> implementation  </s>
<s> formal  </s>
<s> it's  </s>
<s> insertion)  </s>
<s> wondering  </s>
<s> You may be aware that a number of XSLT implementations have a function like this, and that it is included in the EXSLT library (www.exslt.org)  </s>
<s> under the name dyn:evaluate().  </s>
<s> The XSLT working group decided not to include such a function in the standard.  </s>
<s> This is a shame in some ways because the function can indeed be very useful.  </s>
<s> The reasons for the decision were: it is quite difficult to specify it well, especially to define the static and dynamic context for the function; it makes it difficult to separate the language compiler from the run-time; it introduces significant complexities for typing.  </s>
<s> Also, I think some people felt that it was likely to be used for situations where the correct solution was higher-order functions (which are also not in this version of the spec, and which some people feel are a higher priority than dynamic evaluation).  </s>
<s> Clearly there is nothing to stop implementors adding such functions under their own namespace, or under a third-party namespace such as the one allocated by the EXSLT group.  </s>
<s> Michael Kay  </s>

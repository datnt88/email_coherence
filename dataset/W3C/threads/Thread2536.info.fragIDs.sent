<s> Jim, Jeff, Referring to Issue I would like to link this to Jeff's new section on idempotent methods but as I haven't seen it (and don't believe I will) then please check for consistency in the last proposed paragraph.  </s>
<s> Also, I fail to see why the URI in a location header can invalidate a cached entry as written.  </s>
<s> If a resource is moved and there is a location header in the response, then the cached entry should be updated to reflect this, but this is already described in section 13.4.  </s>
<s> Change section 13.10, 1st paragraph from The effect of certain methods at the origin server may cause one or more existing cache entries to become non-transparently invalid.  </s>
<s> That is, although they may continue to be "fresh," they do not accurately reflect what the origin server would return for a new request.  </s>
<s> to The effect of certain methods performed on a resource may cause one or more existing cache entries to become non-transparently invalid.  </s>
<s> That is, although they may continue to be "fresh," they do not accurately reflect what the origin server would return for a new request.  </s>
<s> Change section 13.10, 4th paragraph from Some HTTP methods may invalidate an entity.  </s>
<s> This is either the entity referred to by the Request-URI, or by the Location or Content-Location response-headers (if present).  </s>
<s> These methods are: o PUT o DELETE o POST In order to prevent denial of service attacks, an invalidation based on the URI in a Location or Content-Location header MUST only be performed if the host part is the same as in the Request-URI.  </s>
<s> to All non-idempotent methods SHOULD invalidate a cached entity identified either by the Request-URI, or by a Content-Location header (if present).  </s>
<s> In order to prevent denial of service attacks, an invalidation based on the URI in Content-Location header MUST only be performed if the host part is the same as in the Request-URI.  </s>
<s> Thanks, Henrik Henrik Frystyk Nielsen, frystyk@w3.org  </s>
<s> World Wide Web Consortium, MIT/LCS NE43-346 545 Technology Square, Cambridge MA 02139, USA  </s>
<s> This would be wrong.  </s>
<s> PUT is idempotent, as is DELETE, and both of them need to invalidate what is in the Request-URI, or Content-Location header (if present).  </s>
<s> I would like to link this to Jeff's new section on idempotent methods but as I haven't seen it (and don't believe I will) then please check for consistency in the last proposed paragraph.  </s>
<s> As Paul Leach pointed out, section 13.10 has nothing at all to do with idempotency; all that matters is whether the method causes a change in the value of a resource.  </s>
<s> It's also important to note that the purpose of the rules in 13.10 is NOT to provide perfect cache consistency when a resource is changed; as the second paragraph of the section states, this is impossible when there are multiple cached paths to the origin server.  </s>
<s> The purpose of 13.10 is to "reduce the likelihood of erroneous behavior."  </s>
<s> With that in mind: Henrik proposes to change section 13.10, 1st paragraph from The effect of certain methods at the origin server may cause one or more existing cache entries to become non-transparently invalid.  </s>
<s> That is, although they may continue to be "fresh," they do not accurately reflect what the origin server would return for a new request.  </s>
<s> to The effect of certain methods performed on a resource may cause one or more existing cache entries to become non-transparently invalid.  </s>
<s> That is, although they may continue to be "fresh," they do not accurately reflect what the origin server would return for a new request.  </s>
<s> I'm not sure this helps.  </s>
<s> It's the effect *at the origin server* that is not necessarily visible to the caches.  </s>
<s> However, it's probably possible to make this a little clearer.  </s>
<s> How about: The effect of certain methods performed on a resource at the origin server may cause one or more existing cache entries to become non-transparently invalid.  </s>
<s> That is, although the cache entries may continue to be "fresh," they do not accurately reflect what the origin server would return for a new request on that resource.  </s>
<s> Henrik proposes to change section 13.10, 4th paragraph from Some HTTP methods may invalidate an entity.  </s>
<s> This is either the entity referred to by the Request-URI, or by the Location or Content-Location response-headers (if present).  </s>
<s> These methods are: o PUT o DELETE o POST In order to prevent denial of service attacks, an invalidation based on the URI in a Location or Content-Location header MUST only be performed if the host part is the same as in the Request-URI.  </s>
<s> to All non-idempotent methods SHOULD invalidate a cached entity identified either by the Request-URI, or by a Content-Location header (if present).  </s>
<s> In order to prevent denial of service attacks, an invalidation based on the URI in Content-Location header MUST only be performed if the host part is the same as in the Request-URI.  </s>
<s> As Paul pointed out, this is wrong, because it is based on the wrong criteria.  </s>
<s> However, the original language is slightly misleading, because the phrase "may invalidate an entry" doesn't quite match the use in the previous paragraph in 13.10: In this section, the phrase "invalidate an entity" means that the cache should either remove all instances of that entity from its storage, or should mark these as "invalid" and in need of a mandatory revalidation before they can be returned in response to a subsequent request.  </s>
<s> So I'd replace: Some HTTP methods may invalidate an entity.  </s>
<s> This is either the entity referred to by the Request-URI, or by the Location or Content-Location response-headers (if present).  </s>
<s> These methods are: with: Some HTTP methods MUST cause a cache to invalidate an entity.  </s>
<s> This is either the entity referred to by the Request-URI, or by the Location or Content-Location response-headers (if present).  </s>
<s> These methods are: Finally, Henrik asks: Also, I fail to see why the URI in a location header can invalidate a cached entry as written.  </s>
<s> If a resource is moved and there is a location header in the response, then the cached entry should be updated to reflect this, but this is already described in section 13.4.  </s>
<s> OK, let's use your example.  </s>
<s> Suppose the effect of a POST method on resource http://x.com/y is to move the resource to a new location server, any cache entries for *either* http://x.com/y  </s>
<s> or to "update the cached entry to reflect this."  </s>
<s> The safest approach is to say "none of the cache entries for any of these URLs can be used without revalidation."  </s>
<s> To be frank, this whole section is (as noted above) somewhat of a lost cause.  </s>
<s> HTTP does not have a formal mechanism for a server to invalidate a cache entry that isn't the Request-URI of the current request, and there are many situations where this might be a useful mechanism.  </s>
<s> We should probably leave it to WEBDAV to hack away at this, although (based on my previous research on cache consistency in distributed file systems) I'm dubious that any version of HTTP/1.x could actually solve the problem.  </s>
<s> -Jeff  </s>

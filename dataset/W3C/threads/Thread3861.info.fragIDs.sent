<s> This is a set of comments on the suite of XQuery-related Working Drafts.  </s>
<s> It is based on perusal of the drafts dated April 30, 2002 (Formal Semantics is March 26, Requirements of Feb 15 2001).  </s>
<s> I paid particular attention to the XML Query and Use-Cases specifications.  </s>
<s> I've given my comments numbers in case somebody wants to call any of them out.  </s>
<s> I apologize in advance for using the contraction "XQuery" throughout.  </s>
<s> Also I use "XSD" to denote W3C XML Schemas.  </s>
<s> TB 1. Maximalism The family of XML Query specification makes no visible effort to hit an 80/20 point.  </s>
<s> It is trying very hard to stake out COMPLETE solution in the XML query space, which is rather courageous given the profound lack of industry experience.  </s>
<s> The immense amount of work that has gone into this specification would have a much higher chance of a positive impact on the world if the features and functions provided in XQuery were reduced by a huge factor, cutting back at least to XPath 1.0's level of semantic richness.  </s>
<s> Furthermore, this specification's size and complexity make it inevitable that its arrival will be delayed by amounts of time that seem unreasonable to those on the outside looking in.  </s>
<s> This will cause problems because vendors who need this functionality will release software based on unstable drafts, creating a combination of conversion and interoperability problems down the road.  </s>
<s> The size and complexity also ensure that when XQuery 1.0 finally arrives, it will be well-populated with bugs, some of which will be highly injurious to interoperability.  </s>
<s> Furthermore, the immense size of the XQuery language as specified here will make implementations difficult and time-consuming.  </s>
<s> This will lead to consideration of conformance levels.  </s>
<s> Industry experience with leveled conformance, specifically in the case of SQL, has been very bad; leveled conformance leads inevitably to interoperability problems.  </s>
<s> A core mandate of the W3C is to deliver specifications that promote interoperability.  </s>
<s> The extreme size and complexity of the current XQuery drafts clearly are harmful to interoperability, for the reasons detailed above.  </s>
<s> Radical surgery should be applied to the XQuery feature set.  </s>
<s> This will lead to a higher-quality, more widely-deployed result with a substantially smaller investment of work.  </s>
<s> TB 2. Spec Suite organization There needs to be an overview somewhere, a starting point, mostly tutorial in nature, that explains the relationships between XQuery, the data model, the use cases, the functions and operators, and XPath 2. Having read all of them at least in part, I remain fairly puzzled as to how they're supposed to fit together.  </s>
<s> TB 3. Function of the "Data Model" and "Formal Semantics" It is not clear that both the Data Model and Formal Semantics specs need to exist, or that they need to have independent lives outside of the XQuery spec.  </s>
<s> In particular, I'm pretty sure that a conformant XQuery implementation could be built with little or no reference to anything but the XQuery and F&amp;O specs, raising questions as to whether all the work on DM and FS are cost-effective.  </s>
<s> The Data Model and Formal Semantics docs are sufficiently complex and hard to understand that they don't seem to serve any tutorial purpose.  </s>
<s> At the very least, the spec suite needs to be very clear as to whether implementors need to read them (in whole or in part), and if so why.  </s>
<s> TB 4. Overlapping material There is a large amount of overlapping material in XQuery, the Data Model, the Formal Semantics, and XPath 2. This has the negative effect that it's really hard to read both XQuery and XPath and pay attention, because the attention wanders as you realize you've already read this 15-page sequence.  </s>
<s> It would be highly desirable if the material that is *not* common could be called out somehow.  </s>
<s> I as an implementor would be very interested in which bits of machinery are XQuery-only, XPath-only, or shared.  </s>
<s> Since the portions that are shared are sensibly generated from a common source, I assume that such a call-out is achievablle.  </s>
<s> I note considerable overlap also in the FS and DM specs with each other and with XQuery.  </s>
<s> The same comment applies.  </s>
<s> TB 5. Use Cases for Type-based operations XQuery defines built-in primitives which operate in terms of data types: "cast", "treat", "assert", and "validate".  </s>
<s> The volume of design that has gone into building this framework is highly out of proportion to the scenarios presented in the Use Cases document.  </s>
<s> In particular, there are no use cases for the "cast", "assert", or "validate" built-ins.  </s>
<s> Almost every other aspect of XQuery has a far richer backing in the use-case document.  </s>
<s> It is difficult to understand how the design of such a framework can proceed intelligently without use-cases in mind.  </s>
<s> The best solution to this problem would be simply to drop most of these type-based operations in the interests of getting a reasonably interoperable XQuery 1.0 done in a reasonable amount of time.  </s>
<s> TB 6. XML Schema Data Types and Duration The reliance on XML Schema basic types seems well-thought-through, although the comprehensibility and ease of implementation of XQuery would be greatly increased by dropping support for some number of XSD basic types, without, it seems, much serious loss of functionality.  </s>
<s> The use of two types derived from XSD's "Duration" type is obviously necessary, but highlights a co-ordination problem.  </s>
<s> Anybody who wants to do computation with duration-typed data is pretty clearly going to want the XQuery version, not the XSD version.  </s>
<s> Since it seems that many different activities want to use XSD basic data types, it is highly unsatisfactory that they are going to have to call out to two specifications, XSD and XQuery.  </s>
<s> As a co-ordination issue, XML Schema should be required to fix this design defect.  </s>
<s> TB 7. PIs and Comments If I read XQuery 2.1.3.2 and 2.3.1.2 correctly, XQuery includes the capability of searching on the presence of comments and on PIs and their targets.  </s>
<s> PI search capability is guaranteed to provoke controversy since there is a body of opinion that PIs are architecturally second-class citizens and anything that promotes their use should be deprecated.  </s>
<s> This should be seriously considered for removal.  </s>
<s> XQuery access to comments seems simply incorrect given that there is no assurance that they will be present in the data model even if they are in the source document, and also because it is highly architecturally unsound to encourage the use of comments for holding information of lasting interest.  </s>
<s> This should be removed without further ado.  </s>
<s> The inclusion of Comment and PI in XQuery is further evidence of lack of attention to 80/20 thinking and cost/benefit trade-offs.  </s>
<s> For similar reasons, all of section 2.8.4 (constructors for CDATA sections, PIs, and comments) should be considered for removal.  </s>
<s> TB 8. Relation to Schema Languages At the moment, by conscious design choice traceable back to the requirements documents, XQuery is quite strongly linked to W3C XML Schemas in several ways.  </s>
<s> In retrospect, this choice was unfortunate.  </s>
<s> Fortunately, the situation can be rectified at moderate cost and with considerable benefit.  </s>
<s> Reasons why the linkage to XML Schema is problematic: - XML Schema is large, complex, and buggy.  </s>
<s> The linkage greatly increases the difficulty of understanding and implementing XQuery.  </s>
<s> - XML Schema is poorly suited to the needs of certain application classes (in particular publishing applications), and there are other schema alternatives available which are much better suited.  </s>
<s> These application classes are also likely to be heavy potential users of XQuery.  </s>
<s> - XML Schema is a radical step forward in declarative constraint technology, full of design choices that are based on speculation rather than experience.  </s>
<s> It is highly unlikely that XSD will be the last word in schema technology for XML, even in those application areas in which it specializes.  </s>
<s> In particular, ISO has a serious effort underway to create standards which describe multiple XML schema languages; it would be disadvantageous if the use of these were incompatible with XQuery.  </s>
<s> Decoupling XQuery from XSD will increase survivability in the face of inevitable (and desirable) evolution in schema languages.  </s>
<s> - Every cross-specification dependency introduces potential versioning problems that will increase the complexity and difficulty of maintaining the specification suite as time goes on.  </s>
<s> To the extent that such dependencies can be reduced, the W3C and the community win.  </s>
<s> Note that in the rather old XQuery requirements doc, section 3.5.5, it says that "Schema" can mean either XML Schema or DTD.  </s>
<s> This is an admirably open viewpoint, and note that since that time, the schema universe has grown.  </s>
<s> There is one dependency from XQuery on XSD which should not be severed, the dependency on atomic data types.  </s>
<s> XQuery clearly needs such a repertory of types, and those provided by XSchema are adequate.  </s>
<s> The remainder of this note discusses the ways in which XQuery is currently linked to XSD and how they might be dealt with.  </s>
<s> Linkage: The XQuery data model is described (in part) using terms defined in XML Schema, and a specific procedure is given for constructing it using the XSD PSVI as input.  </s>
<s> Resolution: This is not a problem; the Data Model is described in enough detail that it could be generated (as the draft notes) by a relational database or a variety of other software modules, and understanding of XSD (aside from the base data types) is not required to understand the data model.  </s>
<s> The construction procedure is not really normative in terms of the operation of XQuery.  </s>
<s> No change seems required.  </s>
<s> Linkage: XQuery (sect.  </s>
<s> 3.1) provides for Schema Imports, to establish the in-scope schema environment.  </s>
<s> It is assumed that these are W3C XML Schemas.  </s>
<s> Resolution: Add a clause to production [80] to identify the schema facility in use, by namespace name or or mime-type, for example: schema "http://www.w3.org/1999/xhtml" of namespace "http://www.w3.org/2001/XMLSchema" at "http:/www.w3.org/1999/xhtml/xhtml.xsd"  </s>
<s> Linkage: XQuery provides type-based querying, where the types are those identified by QNames in the data model.  </s>
<s> Examples from XQuery 2.1.3.2: element person of type Employee attribute color of type xs:integer Resolution 1: The semantics of matching the type identified by the qname depend on the in-scope schema class as identified above.  </s>
<s> XSD matches the type if it's identical to or is a derivation of the named type; other schema languages might have a more flexible notion of type matching.  </s>
<s> Resolution 2: Adjust XQuery to say that the "of type" clause is satisfied if and only if the type given in the query is identical to that found in the data model, requiring only direct qname comparison and bypassing schema semantics.  </s>
<s> Resolution 3: Drop type-based querying in the interests of the speedier delivery of a higher-quality recommendation.  </s>
<s> Linkage: XQuery provides run-time type processing through the "treat", "assert", and "cast" built-ins.  </s>
<s> Resolution 1: The semantics of these functions depend on the class of the in-scope schema as identified above.  </s>
<s> Resolution 2: Drop these primitives from XQuery 1.0 - they have weak support in the use cases anyhow.  </s>
<s> Linkage: XQuery provides run-time validation and type-checking through the "validate" built-in.  </s>
<s> Resolution 1: The semantics of this function depend on the class of the in-scope schema as identified above.  </s>
<s> Resolution 2: Drop this primitive from XQuery 1.0 - it has weak support in the use cases anyhow.  </s>
<s> Best regards, Tim Bray  </s>
<s> Thanks for this contribution, Tim.  </s>
<s> It echoes what a number of people are saying inside the WG.  </s>
<s> I hope we'll give it the attention it deserves.  </s>
<s> It's not going to be easy to cut back: when 20% of a group really want a feature and the other 80% of the group consider it superfluous but harmless, the tendency is to put it in (the gHorribleKludge syndrome).  </s>
<s> And the large  </s>
<s> number of documents, I think, is a consequence of the large number of creative and talented individuals who want to contribute to this effort: it's hard to do anything about the root cause of this particular problem!  </s>
<s> The only part of your comments where I tend to disagree with you is TB 7. Wherever there is something in XML that can't be retained through an XSLT transformation (DOCTYPE, CDATA sections, entity references), we get user complaints.  </s>
<s> If we left out more (comments, PIs) we would get more  </s>
<s> complaints.  </s>
<s> I don't think it would be right for XQuery to choose a smaller subset of XML to include in its data model than the subset supported by XSLT, XPath, and the InfoSet.  </s>
<s> In fact, I thought the whole aim of the InfoSet concept was that we should all support the same definition as to which constructs in an XML document are information-bearing and which are not.  </s>
<s> Michael Kay (personal response)  </s>
<s> From: "Kay, Michael" Michael.Kay@softwareag.com  </s>
<s> Just speaking generally, without any comment on the particular situation in the WG, I think we should be careful not to think that featuritus comes just from committee- compromises or personalities, which cannot be helped.  </s>
<s> (Nor from Stockholm Syndrome :-) It is very important that a WG should not be too bound by the decisions it makes earlier in its life.  </s>
<s> For example, a WG had rules that it required a simple majority to vote something in but an absolute majority to vote something out, as I believe Robert's rules suggest for committees where the members have an economic stake in the outcome.  </s>
<s> This rule seems good, because it prevents sudden and repeated changes in tack, thus wasting developer time.  </s>
<s> But its effect can be harmful for standards-making.  </s>
<s> The drafts are prototypes, and sometimes prototypes, even very advanced ones, reach a stage where it become clear that the pig needs a sharper stick to finish it off.  </s>
<s> So committee rules themselves can promote that a Working Group finds it easier to enhance, refine and restate, rather than remove, features.  </s>
<s> This of course may apply as much to use-cases and requirements as it does to features.  </s>
<s> I hope the chairs of WGs will keep their eyes on this issue.  </s>
<s> It is quite possible for supposedly equitable committee rules (such as the one above, being applied in an inappropriate circumstance) to prevent "echoes" from being heard.  </s>
<s> Cheers Rick Jelliffe  </s>
<s> As I should have said (but didn't) I was really impressed by the quality of the thinking that XQuery evidences and I think it'll end up highly useful.  </s>
<s> It's just crystal-clear that it would be better if there were less of it.  </s>
<s> Yes, it's difficult and strenuous to cut back on features but the rewards are very high in terms of interoperability.  </s>
<s> And if I may make one point that highly influenced the end-game when we were finishing up XML 1.0 in 1998: if you leave something out, you can always put it in later.  </s>
<s> The reverse is not true.  </s>
<s> I can see this point, and it sounds (mostly) like something on which  </s>
<s> reasonable people may disagree.  </s>
<s> With the exception of XQuery on comments, which is nondeterministic, unsafe, and positively encourages bad practice.  </s>
<s> It has no place whatsoever in XQuery and is highly likely  </s>
<s> to run into trouble in the AC or the XML community.  </s>
<s> Also it's totally unsound architecturally.  </s>
<s> -Tim  </s>
<s> Xpath 1 supports comments (if the parser reports them, all parsers used with xslt 1 do report these as far as can see).  </s>
<s> It is therefore necessary that Xpath2 does the same.  </s>
<s> Xquery could of course not do so, but wouldn't this be an unneeded difference between the two languages?  </s>
<s> Supporting comments in Xpath1/XSLT1 turns out to be very useful.  </s>
<s> A very common use case is to make "identity transformations" with minor adjustments, perhaps updating from one version of a dtd to the next.  </s>
<s> Documents often contain comments for good reason and there is no reason why these transforms should drop the comments.  </s>
<s> David (Not a member of the WG but signed up to this list) This message has been checked for all known viruses by Star Internet delivered through the MessageLabs Virus Scanning Service.  </s>
<s> For further information visit http://www.star.net.uk/stats.asp  </s>
<s> or alternatively call Star Internet for details on the Virus Scanning Service.  </s>

<s> Scott Boag wrote,  </s>
<s> Just because I have a method that is passed a node, doesn't mean I can't cast to node to a given implementation, and be optimized, but otherwise throw an exception if the given implementation isn't supported.  </s>
<s> So whose implementation will you cast to to get hold of those optimized query hooks?  </s>
<s> Yours, obviously.  </s>
<s> But what about ours?  </s>
<s> Jonathan and Mikes?; Suns?  </s>
<s> etc. etc.  </s>
<s> And do you expect me to support _your_ implementation when for  </s>
<s> all I know you'll be changing those non-public query hooks from week to week?  </s>
<s> Adding an XPath query API to the DOM allows optimized XPath queries to be _portable_.  </s>
<s> That might not matter to you, but it  </s>
<s> does to quite a few of us.  </s>
<s> Cheers, Miles Miles Sabin Cromwell Media Internet Systems Architect 5/6 Glenthorne Mews msabin@cromwellmedia.com http://www.cromwellmedia.com/  </s>
<s> Scott Boag wrote,  </s>
<s> Right, using my optimizations.  </s>
<s> Which won't be available to our XPath processor ... so we'd never be able to recommend your DOM in conjunction with our tools.  </s>
<s> But what about ours?  </s>
<s> Jonathan and Mikes?; Suns?  </s>
<s> etc. etc.  </s>
<s> In the case of my XPath implementation, I would support these via the public DOM interfaces (yes, it would be slower).  </s>
<s> Which means you won't be able to recommend our tools in conjunction with yours.  </s>
<s> No, not if you don't support generic DOMs.  </s>
<s> Well, I'd support a generic DOM, but wouldn't expect the results to be particularly exciting performance-wise.  </s>
<s> Running an XPath query against a DB-based DOM via the existing public API would be painful, to put it mildly.  </s>
<s> I don't think having a method on the Node object vs. having a method on an XPath object that takes a node as a context makes one smidgen of difference in terms of optimization or portability.  </s>
<s> On the contrary, the method with context is more portable.  </s>
<s> I'm afraid I have to disagree.  </s>
<s> Delegating queries to DOM  </s>
<s> implementations allows them to be resolved using internal  </s>
<s> information which is simply not available via the public API.  </s>
<s> Interoperability is about more than a common API: the API has to expose functionality in a _practically_ usable form across different implementations.  </s>
<s> Anything else would be an invitation to vendors to develop proprietary extensions.  </s>
<s> According to your argument, anything that is ever optimized must be a method on the DOM.  </s>
<s> Where there's a significant chunk of functionality which would be widely used and which would benefit from close integration with a DOM implementation, then, yes, I would advocate the development of an _optional_ DOM module to support it, tho' not necessarily overseen by the DOM WG.  </s>
<s> This isn't a new idea.  </s>
<s> A significant part of Level 2 could, in principle, have been implemented externally to the DOM Level 1 API, but with unacceptable performance implications.  </s>
<s> One of the main motivations for introducing optional modules was precisely to avoid that problem.  </s>
<s> Cheers, Miles Miles Sabin Cromwell Media Internet Systems Architect 5/6 Glenthorne Mews msabin@cromwellmedia.com http://www.cromwellmedia.com/  </s>
<s> Scott Boag wrote,  </s>
<s> Here's an argument for your side: void foo(Node n1, Node n2) NodeIterator n1i = ((XPath)n1).locate("name/address",  </s>
<s> ...); // uses your implementation NodeIterator n2i = ((XPath)n2).locate("name/address",  </s>
<s> ...); // uses my implementation i.e. in this case, the method didn't know or care which implementation it was using.  </s>
<s> Using an external implementations would make this harder, as you would have to match the Node implemenation to the XPath implementation.  </s>
<s> That's the sort of thing I'd been thinking about.  </s>
<s> But: the only thing I'm committed to is delegating the query to the _implementation_.  </s>
<s> Whether that's done by invoking a method on Node, or via some other route is far less important.  </s>
<s> You could have something like:  </s>
<s> [snip: DOMImplementation based method]  </s>
<s> Which is way ugly.  </s>
<s> As compared to:  </s>
<s> [snip: Node based method] How about a Document based variant, if(node.getOwnerDocument().supports("http://www.w3.org/TR/xpath")) DocumentXPath doc = (DocumentXPath)node.getOwnerDocument();  </s>
<s> XPathQuery query = doc.createQuery("name/address");  </s>
<s> NodeIterator ni1 = query.execute(node,  </s>
<s> someContext); // etc. // try again with a diffent root Node and context but // same query instance (allows implementation to compile // query and reuse).  </s>
<s> NodeIterator ni2 = query.execute(otherNode,  </s>
<s> someOtherContext); // etc. Remind me what the context was supposed to be for.  </s>
<s> I don't follow.  </s>
<s> If you have an XPath implementation you're free to support Level 1 DOMs whatever happens in Level 3. Equally you're free to use that XPath implementation in the implementation of any Level 3 XPath query API.  </s>
<s> I don't think anyone was suggesting that you'd _have_ to have an XPath implementation which could _only_ be used with exactly one DOM.  </s>
<s> Or am I missing something?  </s>
<s> Cheers, Miles Miles Sabin Cromwell Media Internet Systems Architect 5/6 Glenthorne Mews msabin@cromwellmedia.com http://www.cromwellmedia.com/  </s>

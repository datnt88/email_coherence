<s> I thought I'd send some comments in now that it's last call.  </s>
<s> Briefly, what I saw (I focussed on the core) looks good -- addresses many (but not all) of the issues I had with the level 1 work, and I'm glad to see that things went along smoothly even in my absence!  </s>
<s> :-) Of particular note:  </s>
<s> * The system and public IDs are really for the "document type's external subset", not for the "document type", as it's now written.  </s>
<s> DTDs often consist of many components,  </s>
<s> each with their own identifiers.  </s>
<s> As written, those IDs could refer to one of dozens of identifiers -- not useful.  </s>
<s> I'd like to see DomImplementation and DocumentType describe this correctly (a small editorial change).  </s>
<s> * I can't see how I'd write a chunk of code that'll know it can use Level 2 features ... e.g. it's portable and needs to work with both L1 and L2. I'd like to see a "DOM" feature (for DOMImplementation) be defined, which would report on which level is supported.  </s>
<s> * It's confusing to have feature definitions scattered all over the spec.  </s>
<s> I'd like to see them collected in one table at one place, so their overall scope is more readily understood.  </s>
<s> * I still don't see why there's no solution for getting access to a system default DOM implementation, at least for Java.  </s>
<s> I'm posting an implementation in a followup post.  </s>
<s> I'd like to see something like this in the org.w3c.dom  </s>
<s> Java package.  </s>
<s> Thanks for the good work! - Dave LookI like the report format, but I still feel like I need the table of contents to have clickable links to let me get to each of the documented classes.  </s>
<s> This structure (sans such TOC support) is relatively hard to navigate.  </s>
<s> 1.1.7Namespaces  </s>
<s> ... it may be useful to note that the DOM has adopted an 'early binding' model of namespace URIs to elements.  </s>
<s> With early binding, the URIs are permanently bound to elements as they get created.  </s>
<s> Late binding is more like what one would get by moving text around in a text editor -- the URI bindings are context-dependant.  </s>
<s> (So there are significant ramifications...) Also, I'm glad to see the simplification of having the namespace support be in the core interfaces versus being separate.  </s>
<s> Life is much easier that way!  </s>
<s> 1.2General re compatibility ... I don't see how I can write a chunk of code that'll know to act differently if it's using DOM Level 2 or DOM Level 1. SUGGESTION: have a DOMImplementation 'feature".  </s>
<s> "DOM" would have values "1.0" (for DOM L1) or "2.0" (L2).  </s>
<s> 1.2DOMException ... ambiguous re whether the other numeric codes are reserved to W3C or not.  </s>
<s> They should be.  </s>
<s> Similar comment for "Node" ... nobody except W3C should be defining new numeric codes for "nodeType".  </s>
<s> 1.2DomImplementation ... createDocumentType() seems to have no accomodation for an internal subset.  </s>
<s> I'd suggest at least correcting the text; it's not the "document type system identifier" (or public ID), but the "external subset system identifier" (or public identifier).  </s>
<s> Also, having the "feature" identifiers scattered throughout the document is suboptimal.  </s>
<s> At least list the features from each chapter up at the front of the chapter, in a table to visually highlight them.  </s>
<s> 1.2Document ... refers to "invalid" characters.  </s>
<s> "Illegal" would be more correct (with reference under DOMException to XML, HTML, and related specs for what that means).  </s>
<s> Of course the INVALID_CHARACTER_ERR name is grandfathered... 1.2Document.importNode  </s>
<s> ...  </s>
<s> I'm rather uncomfortable with that name "import" since that implies the same object is in use (e.g. if I import something from Canada).  </s>
<s> "copy" is the appropriate word, and is even used in the documentation more than once.  </s>
<s> "import" suggests the wrong thing.  </s>
<s> 1.3DocumentType ... as above on DomImplementation, the text should say the IDs are for the "document type's external subset", 7Traversal ...  </s>
<s> I'm still not a fan of this stuff, but at least it's optional.  </s>
<s> (Seems like it should integrate with the view mechanism in some places, but doesn't -- oops.) App CJava Binding ... I ** REALLY ** think it'd be useful to define a standard way to get access to a DOM implementation, so that only parser connectivity really needs to be left to nonstandard APIs.  </s>
<s> There doesn't seem to be a "feature" identifier for the range facility ... I sure hope that doesn't mean it's part of the DOM L2 core!! (I suggest "Range" to identify that optional module.) - Dave  </s>
<s> I didn't see any response to my earlier query re events; should I expect one?  </s>
<s> Here are some further observations about the event portion of the specification -- based in part on the task of trying to understand the spec well enough to implement it !! - Dave 6.2It appears that there's no way to guarantee that an ancestor will get an event -- both capturing and bubbling permit other nodes to interfere with event reporting.  </s>
<s> This seems ungood in general; there ought to be _one_ mechanism whereby event reporting isn't subject to interference.  </s>
<s> 6.3.1I'm  </s>
<s> curious in general why EventListener.handleEvent() is defined to handle _all_ events rather than having separate interfaces that directly handle the different sorts of events (a MouseEventListener, MutationEventListener, etc).  </s>
<s> That's how Swing does this stuff, and it's generally handy to have such "pre-dispatched" frameworks -- it can be faster, too!  </s>
<s> 6.2.2Event capture ... the text is unclear what preventCapture() achieves.  </s>
<s> The third para says that if you call it, no further targets lower in the tree will get events, which seemingly includes both the "deliver to target" phase (which is elsewhere said to be "guaranteed") and event bubbling.  </s>
<s> It makes sense to me to see the preventCapture() method only have effect during the capture phase.  </s>
<s> If so, its description in 6.2.2 needs updating (no further targets will capture).  </s>
<s> 6.6.4DOMSubtreeModified ... insufficiently specified.  </s>
<s> What event batching is supposed to be performed?  </s>
<s> In what sense may it be used "instead of the more specific events"?  </s>
<s> And for that matter, which "more specific events"?  </s>
<s> I couldn't make any sense of this description at all.  </s>
<s> And there was the hint that it's another one of those really expensive events (like DOMNode**Document) noted below ... 6.6.4DOMNodeRemovedFromDocument ... seems horrendously expensive.  </s>
<s> After delivering an DomNodeRemoved event, that node and all of its descendants (!!!) get one of these.  </s>
<s> Must this really be done?  </s>
<s> It'll increase the cost to support the mutation events substantially.  </s>
<s> 6.6.4DOMNodeInsertedIntoDocument ... correspondingly expensive.  </s>
<s> GeneralThere's no way for applications to define their own events and thus use the event mechanism for any purpose except those that are built in.  </s>
<s> I'd like to see such a standard, perhaps part of the basic "Events" mechanism.  </s>
<s> In the same way that DOM events all have "DOM" prefixes, perhaps they could have a "USER."  </s>
<s> prefix.  </s>
<s> And it'd be desirable for such user events to have a way to include information ... maybe a UserEvent interface could have an Object parameter set in its initUserEvent() method, which has application defined semantics.  </s>
<s> I'm more sympathetic to defining new exception  </s>
<s> codes outside the range  </s>
<s> of the types defined by W3C.  </s>
<s> A similar argument applies to node types; one may as well use the same convention for both.  </s>
<s> It's always better to have an explicit extension mechanism in the spec, so that each application doesn't go off in its own completely incompatible direction.  </s>
<s> I second that motion.  </s>
<s> The DOM chose a dual mechanism for representing types--interfaces and "codes".  </s>
<s> Nothing prevents me from defining a "supernode" interface that extends (or is derived from) Node.  </s>
<s> Nothing should prevent me from defining a corresponding SUPERNODE node type "code".  </s>
<s> How about a real-world example that has nothing to do with a DTD?  </s>
<s> Lets say I write a parser that processes Active Server Pages.  </s>
<s> The syntax used to mark server-side scripts is % //insert your script here % .  </s>
<s> The script marker nodes are custom node types.  </s>
<s> They can be interpreted, executed, color-syntax-edited, etc.  </s>
<s> Some may argue that these things are really processing instructions.  </s>
<s> But they aren't.  </s>
<s> Others may say they are really just comments.  </s>
<s> But they aren't.  </s>
<s> They are script markers.  </s>
<s> Still others might say that since they violate XML syntax rules I can't create a new node type.  </s>
<s> Let me  </s>
<s> worry about that--I'll take the responsibility for making sure that my application/parser/processor are smart enough to handle them.  </s>
<s> I know that they probably won't be added to the DOM in the near future, so let me define a ScriptMarker interface, and a ScriptMarker NODETYPE constant.  </s>
<s> And I'd prefer it if you would tell me which range of values to use so that I don't get in trouble when the DOM adds that newfangled supermetaschemanode in the next release.  </s>
<s> It's a pretty simple request... Do You Yahoo!? Bid and sell for free at http://auctions.yahoo.com  </s>
<s> Help me out here; I unerstood from a lot of reading that XML (as opposed to HTML) had as its primary purpose the definition of a syntax which would facilitate the machine processing and generation of information.  </s>
<s> What exactly does your proposed extension do that you couldn't define an XML namespace to do?  </s>
<s> I have  </s>
<s> to admit the proposal to allow for extensions which allow things I thought the standard already allows for rather surprised me.  </s>
<s> I certainly have no objection; you can do anything you want (the great advantage of computers).  </s>
<s> I  </s>
<s> just don't see from what you wrote why you want to do what you describe, since as far as I can tell, XML already appears to define what you want as a basic feature.  </s>
<s> J. G. Spragge ---------- standard disclaimers apply Essays on capital punishment and network ethics at  </s>
<s> Backward compatibility with a non-standard, but very common syntax.  </s>
<s> I wrote something similar to the following in a previous message, but I haven't seen it show up, so I guess it must not have made to the list server....  </s>
<s> This has been a very long conversation about a simple question:  </s>
<s> Are implementors allowed to extend the NodeType and Exception lists?  </s>
<s> If the answer is yes, the spec should be revised with instructions as to how the lists are extended while maintaining some degree of forward compatibility.  </s>
<s> If the answer is no, then the spec should explicitly state that extension is not allowed, and if conformance tests are developed in the future, they should explicitly test for compliance (although this would be  </s>
<s> extremely time consuming to do correctly).  </s>
<s> Regardless of the answer, the spec should be revised to remove ambiguity.  </s>
<s> Personally, I believe that the DOM should concentrate on functionality and interoperability, rather than on restricting implementations.  </s>
<s> A primary concern for a standard API should be compliance and interoperability, but  </s>
<s> not at the expense of innovation.  </s>
<s> By closing the NodeType list, the DOM API makes extensions available only to typed languages.  </s>
<s> (In Java, I can cast my Element object to a SuperElement when I need to, but I can't access the functionality of SuperElement from ECMAScript because I have no way to determine that a node is a SuperElement).  </s>
<s> The XML specs do not address backward compatibility with the billions of pages that currently exist (HTML, ASP, DTD, etc.).  </s>
<s> One way to deal with this issue is through extending the NodeType list.  </s>
<s> There are very likely other valid solutions.  </s>
<s> But the real issue here is the ability of implementors to extend the DOM.  </s>
<s> The ASP "tag" is an example where backward compatibility may be enhanced by extending DOM.  </s>
<s> Other examples may include a distributed DOM or a persistent DOM, or a biological DOM.  </s>
<s> So again, the real question is: Are implementors allowed to extend the NodeType and Exception lists.  </s>
<s> Jeff Mackay Vtopia, Inc. URL: http://www.vtopia.com  </s>
<s> Implementors can do whatever they want.  </s>
<s> However, the whole purpose of the DOM is to provide users with an interoperable API.  </s>
<s> Implementing and/or using any extension makes this pretty useless.  </s>
<s> So I don't see  </s>
<s> what the benefit of allowing extensions would be.  </s>
<s> Either you care about interoperability and all you can do is to stick with the standard, or you don't and you can use whatever you want.  </s>
<s> There is just no room for applications or implementations being partially interoperable.  </s>
<s> I added a note stating that all other codes are reserved to W3C for possible future use.  </s>
<s> I don't understand.  </s>
<s> If you're already up for using non standard extensions, why can't you simply use a non standard type attribute for that?  </s>
<s> In ECMAScript it is especially easy to add a property to an object.  </s>
<s> Arnaud  </s>
<s> I am finally beginning to understand what Arnaud Le Hors lehors@w3.org  </s>
<s> THE DOM IS NOT AN OBJECT MODEL!  </s>
<s> It is a specification (API) for a class library.  </s>
<s> Specifically it is the API for the class library of Javascript.  </s>
<s> The Infoset is much closer to being a real object model, in that it specifies the necessary and sufficient set of interfaces that _any_ implementation of documents must, somehow, provide.  </s>
<s> An object model is the product of the analysis phase of an OO project; an API is the product of the design phase.  </s>
<s> An API is the specification for a library, which is the product of the implementation phase.  </s>
<s> In a library's specification, like the Java class library or the DOM, it is vitally important to specify a complete set of functions and to nail down the implementation as much as possible, so that application-writers have a rich set of operations with semantics they can count on.  </s>
<s> That's what an API (the programmer's view of a library) is all about.  </s>
<s> Extensions and experimentation are out of place in this context.  </s>
<s> The typical application- writer is using a canned library supplied by a language vendor, and expects a consistent environment on every platform of interest.  </s>
<s> That's a good thing.  </s>
<s> In a _real_ object model like a GUI toolkit or the Infoset, on the other hand, it is important to provide only the _minimum_ interface, and to constrain the implementation as _little_ as possible, so as to provide for the widest possible range of applications.  </s>
<s> A real object model is essentially the basis for a framework; extensions are allowed for and indeed expected.  </s>
<s> With a framework, application writers are expected to get their hands dirty and at least _look_ at the code, if not modify it; usually the application and the classes that implement the object model are written by the same person or group.  </s>
<s> The object model's main function is to ensure that no important details are left out of the implementation.  </s>
<s> That's a good thing, too, but it's a _different_ thing.  </s>
<s> An object model is a specification, just as an API is, but at a different level.  </s>
<s> It is further removed from the implementation, and is not directly useable by an application-writer.  </s>
<s> A good object model simply defines the set of interfaces that are necessary and sufficient in order to to _represent_ the data (documents, in this case) being modeled -- the objects and attributes that any implementation must provide, and that any application can count on having available.  </s>
<s> The object model, in other words, specifies the objects' attributes, very little about their behavior and as little as possible their implementation.  </s>
<s> An object model should make no claims about whether nodelists are ``live'' or static, about whether or not nodes can be freely moved between documents, about whether documents may be traversed in any particular order, about whether structure can be shared, or whether a node remains accessible after an application has abandoned all references to it.  </s>
<s> It should simply ensure  </s>
<s> that, if you are looking at a node in a document, you can tell what sort of node it is and determine _all_ of the relevant information about it.  </s>
<s> The DOM, by contrast, makes no real attempt to be a complete object model  </s>
<s> for documents.  </s>
<s> Converting a document to a DOM tree loses information; it is no longer possible to recover the original document.  </s>
<s> It is impossible to create an arbitrary XML or HTML document, say inside of an editor, and write it out as its author intended.  </s>
<s> There may be some documents that cannot be  </s>
<s> represented at all, perhaps due to their size or to their dynamic nature.  </s>
<s> There are many plausible representations for documents that do not conform to the DOM but are nevertheless useful, and which would benefit from a unifying standard to guide their implementors.  </s>
<s> In fact, the DOM itself would have benefitted greatly from such a standard, not to mention a vigorous application of Occam's Razor.  </s>
<s> All of this suggests that, for my own sanity and for the sake of my application, I should probably abandon any hope or pretense of using the  </s>
<s> DOM. I need DTD's, I need SGML, I need late-bound entities and entity  </s>
<s> references without content, I need application-specific, strongly-typed  </s>
<s> metadata, I need the ability to stream large documents through a document processor with limited memory, and so on.  </s>
<s> For the near term I will continue  </s>
<s> to base my application on my partial implementation of the DOM, and because of its architecture it will always be able to manipulate DOM trees, but eventually my internal representation will cease to look anything like the DOM.  </s>
<s> As the official Javascript class library for browsers, the DOM is simply irrelevant for an XML-based extensible server.  </s>
<s> Most of my comments in this list over the last year or so have been based on the mistaken belief that the DOM was an object model.  </s>
<s> I think a great deal of confusion could have been avoided if the introduction clearly stated that, although the DOM may be moderately language-neutral, it is far from implementation neutral and that the primary goal is to provide a stable class library optimized for a certain specific class of applications.  </s>
<s> The reference set of applications should be specified -- applications outside this set _might_ be able to use the DOM, but if their requirements differ from those of the reference set their needs will simply not be considered.  </s>
<s> It should be made _very_ clear that extensions of any sort are not encouraged, perhaps not even permitted, and that implementors with a different set of requirements should seek elsewhere.  </s>
<s> It is far too late to rename DOM - Browser Scripting Document API, but it would have been far more accurate.  </s>
<s> I think that a document object model (note the indefinite article and lower-case letters) would be a good idea, and I will gladly support and contribute to an effort to construct one.  </s>
<s> Stephen R. Savitzky steve@rsv.ricoh.com  </s>
<s> http://rsv.ricoh.com/~steve/  </s>
<s> Platform for Information Applications: http://RiSource.org/PIA/  </s>
<s> Chief Software Scientist, Ricoh Silicon Valley, Inc. Calif.  </s>
<s> Research Center home: steve@theStarport.org  </s>
<s> URL: http://theStarport.org/people/steve/  </s>
<s> In http://www.w3.org/TR/REC-DOM-Level-1/introduction.html "The Document Object Model (DOM) is an application programming interface (API) for HTML and XML documents."  </s>
<s> In http://www.w3.org/TR/xml-infoset#intro "This document specifies an abstract data set called the XML information set (Infoset), a description of the information available in a well-formed XML document" So, it's not _any_ implementation of documents, but _any_ implementation of XML documents.  </s>
<s> It is impossible to create an arbitrary XML or HTML document, say inside of an editor, and write it out as its author intended.  </s>
<s> Do you have an example ?  </s>
<s> If you mean a document which is not XML or HTML, you're right.  </s>
<s> It's out of the scope of the DOM.  </s>
<s> But, if you really want to add your % script % node in the DOM, write an extension, it's very easy to do : interface StephenNode : Node { readonly attribute unsigned short stephenType; const unsigned short SCRIPT_NODE = 0; interface ScriptNode : StephenNode { // whatever you want I don't see a statement in the DOM about "you should not create your own extension based on the DOM core".  </s>
<s> It's in our requirements.  </s>
<s> See http://www.w3.org/TR/WD-DOM/requirements#ID-1072425801  </s>
<s> It's out of our scope.  </s>
<s> See http://www.w3.org/TR/REC-DOM-Level-1/introduction.html  </s>
<s> I need late-bound entities and entity references without content, I need application-specific, strongly-typed metadata  </s>
<s> Once again, it's in our list.  </s>
<s> But How can we address stronglgy-typed metadata without a recommandation ?  </s>
<s> The XML Schema datatype is not yet a recommandation :  </s>
<s> In http://www.w3.org/TR/REC-DOM-Level-1/introduction.html "One important objective for the Document Object Model is to provide a standard programming interface that can be used in a wide variety of environments and applications."  </s>
<s> Our main goal is interoperability, not memory.  </s>
<s> But if we can have both, it's better.  </s>
<s> Browsers represent 10% in the number of participants in the DOM WG.  </s>
<s> There are several implementations of DOM in Java, C++, Delphi, Perl, Python, C. The DOM is definitively not only a Browser Scripting Document API.  </s>
<s> Browser scripting is one of our goals, but not the only one.  </s>
<s> Regards, Philippe.  </s>
<s> Philippe Le Hegaret - http://www.w3.org/People/LeHegaret/ World Wide Web Consortium (W3C), DOM Activity Lead  </s>
<s> QED.  </s>
<s> Point taken.  </s>
<s> It's still a lot closer to a general object model for documents than the DOM is.  </s>
<s> It is impossible to create an arbitrary XML or HTML document, say inside of an editor, and write it out as its author intended.  </s>
<s> Sure.  </s>
<s> As a web author, I might want to attempt to foil spammers by representing my e-mail address as steve&amp;#x40;rsv.ricoh.com -- note also the symmetric use of  and .  </s>
<s> A conforming DOM implementation will render this as steve@rsv.ricoh.com  </s>
<s> , defeating my intentions.  </s>
<s> To take another example, I may want HTML lists to be output in the ``traditional'' format with omitted end tags: The DOM has no way to represent the fact that the end tags have been omitted.  </s>
<s> For various reasons I may wish to omit end tags in one place, but keep them in in another (perhaps as a flag to some string-based Perl script that modifies the file in some way).  </s>
<s> This is a perfectly legitimate thing to do in a text editor, but it's impossible in an editor based on the DOM.  </s>
<s> Similarly, for stylistic reasons I may wish to distinguish between XML elements that are declared as empty, and those that are not but are simply empty ``by accident''.  </s>
<s> I would represent the first as foo/ and the second as bar /bar .  </s>
<s> This has no effect on the semantics of the document, of course, but as an author using an editor it serves as an invaluable reminder of which empty elements it is permissible to fill in later.  </s>
<s> No. In the first case I mean a document which is too large for its tree to fit in memory.  </s>
<s> It may even be effectively infinite; for example, the output of a process such as a web crawler.  </s>
<s> In the second case, I mean a document in which external entities may have their value changed because of the actions of some other process.  </s>
<s> Possibly the simplest example of this is &amp;time;, which I might want to reflect the exact time when the entity is expanded.  </s>
<s> Another example might involve an external file.  </s>
<s> Then I would have to rewrite my application to cast all nodes as StepenNode and test stephenType instead of nodeType.  </s>
<s> It's ugly.  </s>
<s> But if I can't, within the specification, define new node types I can't write experimental code that won't have to be rewritten if you finally get around to fulfilling those requirements.  </s>
<s> Also, a frozen set of node types will influence you to use a brand-new interface class that doesn't descend from Node (which has already been done for CSSRule and CSSRuleList).  </s>
<s> Why aren't these descended from Node?  </s>
<s> Exactly.  </s>
<s> The scope of the DOM is too limited; I need an object model that can be extended to handle other situations and still be compliant with its specification.  </s>
<s> I need late-bound entities and entity references without content, I need application-specific, strongly-typed metadata  </s>
<s> If you had the ability to define new application-specific node types, you could simply add attribute NodeList metadata; to Node and let the application take care of it.  </s>
<s> This is exactly my point.  </s>
<s> It's no longer possible to have both -- the DOM has taken a memory-intensive path in order to provide a rich interface.  </s>
<s> There needs to be an alternative for those of us who want to make different design decisions without giving up compliance with _some_ non-DOM standard.  </s>
<s> It is the _reference_ goal.  </s>
<s> Whatever the DOM becomes, one of its ironclad requirements is that it has to remain the document-processing API for Javascript.  </s>
<s> Everything else may be subject to reconsideration, but not that.  </s>
<s> That's as it should be: Javascript needs an API for documents, the DOM is it, and if any other application finds it useful, that's great.  </s>
<s> But don't expect _every_ application to find it a good match.  </s>
<s> Stephen R. Savitzky steve@rsv.ricoh.com  </s>
<s> http://rsv.ricoh.com/~steve/  </s>
<s> Platform for Information Applications: http://RiSource.org/PIA/  </s>
<s> Chief Software Scientist, Ricoh Silicon Valley, Inc. Calif.  </s>
<s> Research Center home: steve@theStarport.org  </s>
<s> URL: http://theStarport.org/people/steve/  </s>

<s> The CONTENT-ENCODING issue: has been assigned to myself and Henrik for resolution.  </s>
<s> We're pretty close to solving most of it, except for a seemingly minor concern: How does a client say "don't send me the 'identity' encoding"?  </s>
<s> I.e., "please send me a compressed form or send me nothing."  </s>
<s> (Why would a client want to say "don't send 'identity'"?  </s>
<s> Well, perhaps the bandwidth costs or latency costs are too high.) A month or two ago, I proposed adding an "identity" content-coding so that we could define a way for the client to say that it does NOT want the identity encoding.  </s>
<s> I had originally thought "if the client sends a list of explicitly acceptable encodings, but 'identity' isn't on this list, then this means that it doesn't want 'identity'".  </s>
<s> But that is obviously not going to work.  </s>
<s> For example, existing clients (apparently including Lynx) send Accept-encodings: gzip, compress even though they are presumably willing to take "identity."  </s>
<s> If we were to adopt the rule that I had originally proposed, Lynx clients would suddenly get error returns for most resources!  </s>
<s> Since we certainly do not want break existing clients, the other alternative that I thought of seems simpler, if somewhat odd at first glance: define an explicit way for the client to say "I would rather have 406 than the identity-encoding".  </s>
<s> Here are some ways to do this:  </s>
<s> (a)Accept-Encoding: gzip, compress, no-identity /* an explicit "no identity-encoding wanted" token */  </s>
<s> (b)Accept-Encoding: gzip, compress, strict /* "strict" means "this set, or nothing" */ (c)Accept-Encoding: gzip, compress, identity;q=0.0  </s>
<s> /* allow qvalues here */  </s>
<s> (d)Accept-Encoding-Strict: gzip, compress /* define new header to avoid compatibility questions */  </s>
<s> Which one to choose?  </s>
<s> (d) is least likely to cause trouble, but it also means that the client has to guess the origin-server version.  </s>
<s> We have no reliable way to do this, so in practice (d) would not really encourage the use of compression.  </s>
<s> (c) seems closest to existing practice, although it's possible that some existing servers might choke on the qvalue.  </s>
<s> (a) and (b) mean roughly the same thing, and are certainly not going to cause compatibility problems, but they are a little kludgey.  </s>
<s> We're already likely to propose that Accept-Encoding allow the use of "*" to mean "whatever you want to send."  </s>
<s> So a slight variation on (c) would be (e)Accept-Encoding: gzip, compress, *;q=0 I.e., the "coding" *;q=0 is semantically equivalent to the "strict" token in (b) above, but somewhat closer to the form of the other Accept-* headers.  </s>
<s> My own preference is for one of these two approaches: (c)Accept-Encoding: gzip, compress, identity;q=0.0  </s>
<s> (e)Accept-Encoding: gzip, compress, *;q=0 However, neither of these will work if any existing servers or proxies would choke on a qvalue in an Accept-Encoding header.  </s>
<s> Also, while (e) is cleaner in some ways, it also is infeasible if any existing servers or proxies would choke on a "*" here.  </s>
<s> Comments?  </s>
<s> As soon as possible, please!  </s>
<s> -Jeff  </s>
<s> P.S.: We may have to include a Note to client implementors that sending a qvalue for a content-coding from the set {"compress", "gzip", "x-compress", "x-gzip"} might be misinterpreted by older servers, and so is not recommended.  </s>
<s> At least, the one older server source that I looked at (Apache_1.1b3) looks like it will treat Accept-encoding: gzip;q=1.0 as a request for a content-coding that it doesn't know about.  </s>
<s> I dislike the * proposal intensely.  </s>
<s> Best leave punctuation for use in regular expressions and separators.  </s>
<s> It is always a mistake to use a punctuation mark to stand for a symbol IMHO.  </s>
<s> identity is OK by my reconning although NULL is shorter and may be more descriptive in this context.  </s>
<s> There are already numerous places in RFC2068 where the "*" syntax is used as a "wildcard", including OPTIONS method Accept: Accept-Language: If-Match: If-None-Match: Vary: And its use has also been last-called in the Content-Range header.  </s>
<s> To me, it seems odd that Accept-Charset and Accept-Encoding don't already allow a "*" value, given that Accept and Accept-Language do.  </s>
<s> -Jeff  </s>
<s> I think this is the best.  </s>
<s> it allows the case to be handled where the source form is accepted but not ideal.  </s>
<s> Consider the case where the rank of preferences is gzip / source / compress where gzip is prefered, and the source form prefered over unix compress.  </s>
<s> I think this is a more realistic case than "don't want the source at all".  </s>
<s> Ugh! Please, no more headers unless there is a serious problem with one already defined!  </s>
<s> I dislike the * proposal intensely.  </s>
<s> Best leave punctuation for use in regular expressions and separators.  </s>
<s> It is always a mistake to use a punctuation mark to stand for a symbol IMHO.  </s>
<s> identity is OK by my reconning although NULL is shorter and may be more descriptive in this context.  </s>
<s> Phill  </s>
<s> Date: Mon, 21 Jul 97 15:59:25 MDT From: Jeffrey Mogul mogul@pa.dec.com  </s>
<s> (a)Accept-Encoding: gzip, compress, no-identity /* an explicit "no identity-encoding wanted" token */  </s>
<s> (b)Accept-Encoding: gzip, compress, strict /* "strict" means "this set, or nothing" */ Note that any older server will ignore the `strict' or the `no-identity', so you still might get uncompressed content.  </s>
<s> (c)Accept-Encoding: gzip, compress, identity;q=0.0  </s>
<s> /* allow qvalues here */ (d)Accept-Encoding-Strict: gzip, compress /* define new header to avoid compatibility questions */ This breaks existing servers to some extent, and I really think it's ugly and really don't like it.  </s>
<s> (e)Accept-Encoding: gzip, compress, *;q=0 I.e., the "coding" *;q=0 is semantically equivalent to the "strict" token in (b) above, but somewhat closer to the form of the other Accept-* headers.  </s>
<s> My own preference is for one of these two approaches: (c)Accept-Encoding: gzip, compress, identity;q=0.0  </s>
<s> (e)Accept-Encoding: gzip, compress, *;q=0 I like (c) and (e), though I wouldn't be able to agree that they are good if any server will choke on them.  </s>
<s> Of course, I don't quite see why I would need to reject the identity encoding.  </s>
<s> P.S.: We may have to include a Note to client implementors that sending a qvalue for a content-coding from the set {"compress", "gzip", "x-compress", "x-gzip"} might be misinterpreted by older servers, and so is not recommended.  </s>
<s> At least, the one older server source that I looked at (Apache_1.1b3) looks like it will treat Accept-encoding: gzip;q=1.0 as a request for a content-coding that it doesn't know about.  </s>
<s> Sad.  </s>
<s> I'd like E-scape to advertise that it can handle compress, but prefers gzip (because patents mean that a compress implementation can't be free from fear of lawsuits unless royalties are paid; whereas gzip doesn't seem to have this problem).  </s>
<s> (a)Accept-Encoding: gzip, compress, no-identity /* an explicit "no identity-encoding wanted" token */  </s>
<s> (b)Accept-Encoding: gzip, compress, strict /* "strict" means "this set, or nothing" */ Note that any older server will ignore the `strict' or the `no-identity', so you still might get uncompressed content.  </s>
<s> Of course.  </s>
<s> I probably should have stated that the ability to say "don't send me 'identity'" is an optimization, and not always available (because of the situation you suggest).  </s>
<s> -Jeff  </s>
<s> Jeffrey Mogul:  </s>
<s> I like (a) best.  </s>
<s> The trouble with adding q values to this header is that it makes selecting the `best' encoding much more complicated (decoding short floats and finding the highest one is too complicated to do in a simple shell script, for example), and this would discourage the deployment of servers which know about encodings.  </s>
<s> I think that the knowledge that `gzip is better than compress is better than identity' can just as well be implemented at the server side, and implementing it there will be much cheaper.  </s>
<s> Another reason I like (a) is that there won't be any compatibility problems with existing servers.  </s>
<s> Koen.  </s>
<s> JM The CONTENT-ENCODING issue: JM http://www.w3.org/pub/WWW/Protocols/HTTP/Issues/#CONTENT-ENCODING JM has been assigned to myself and Henrik for resolution.  </s>
<s> We're pretty JM close to solving most of it, except for a seemingly minor concern: JM How does a client say "don't send me the 'identity' encoding"?  </s>
<s> I don't think this is a serious enough concern to merit doing anything at all.  </s>
<s> If this is not possible that's just fine.  </s>
<s> That having been said, the q-value solution would seem the best to me.  </s>
<s> I prefer not to use '*' for this, so my choice from your alternatives would be: JM (c)Accept-Encoding: gzip, compress, identity;q=0.0  </s>
<s> Our server doesn't currently do anything with Accept-Encoding (our customers generally don't have the storage to devote to storing multiple encodings, and don't want the CPU spending time creating them) so we have no backward compatibility issue.  </s>
<s> Scott Lawrence EmWeb Embedded Server lawrence@agranat.com  </s>
<s> Agranat Systems, Inc. Engineering http://www.agranat.com/  </s>
<s> In a previous episode Koen Holtman said... :: Jeffrey Mogul: ::  </s>
<s> ::  (a)Accept-Encoding: gzip, compress, no-identity ::  /* an explicit "no identity-encoding wanted" token */  </s>
<s> :: I like (a) best.  </s>
<s> The trouble with adding q values to this header is :: that it makes selecting the `best' encoding much more complicated :: (decoding short floats and finding the highest one is too complicated :: to do in a simple shell script, for example), and this would :: discourage the deployment of servers which know about encodings.  </s>
<s> I find this a very persuasive argument.. Content Encodings are something we are intending to deal with aggressively in current and upcoming server extension projects.. (CGI, fast CGI, nsapi, whatever..) If this is the type of functionality that's going to be handled by a lot of different applications (as opposed to a handful of base web servers) simplicity is paramount... that unfortunately means no q values.  </s>
<s> -P  </s>
<s> I also vote for no q-values.  </s>
<s> Perhaps identity/no-identity could be shortened to id/no-id.  </s>
<s> John Franks Dept of Math.  </s>
<s> Northwestern University john@math.nwu.edu  </s>
<s> JM The CONTENT-ENCODING issue: JM http://www.w3.org/pub/WWW/Protocols/HTTP/Issues/#CONTENT-ENCODING JM has been assigned to myself and Henrik for resolution.  </s>
<s> We're pretty JM close to solving most of it, except for a seemingly minor concern: JM How does a client say "don't send me the 'identity' encoding"?  </s>
<s> On further reflection, I really think that we should just not provide this capability at all.  </s>
<s> The server should always be free to just send the resource as is in response to the request.  </s>
<s> If the server has or can create a version of the resource in one of the acceptable encodings, it should send that, but I think that the implicit 'identity' coding (sent with no Content-Encoding header) should always be an acceptable response.  </s>
<s> If there is an Accept-Encoding header in the request, it should be interpreted as meaning that the listed encodings are acceptable in addition to the implicit 'identity'.  </s>
<s> I can't quite puzzle out from the reference on the issues list what the problem with this approach is.  </s>
<s> Scott Lawrence EmWeb Embedded Server lawrence@agranat.com  </s>
<s> Agranat Systems, Inc. Engineering http://www.agranat.com/  </s>
<s> I'm in favor of keeping it simple and just having no way of saying "don't send me the identity encoding".  </s>
<s> From: koen@win.tue.nl (Koen Holtman) Date: Tue, 22 Jul 1997 09:39:19 +0200 (MET DST) Jeffrey Mogul:  </s>
<s> I like (a) best.  </s>
<s> The trouble with adding q values to this header is that it makes selecting the `best' encoding much more complicated (decoding short floats and finding the highest one is too complicated to do in a simple shell script, for example), and this would discourage the deployment of servers which know about encodings.  </s>
<s> I think it can be done in a shell script.  </s>
<s> Noah Friedman is a sysadmin I know who is very good at writing shell scripts.  </s>
<s> I'm sure he could write an adaquate script within a few hours.  </s>
<s> Furthurmore, I think there are a lot of deployed servers which know about q values for content-types.  </s>
<s> If the code can't be recycled, then the people who wrote it don't know what they're doing.  </s>
<s> I think that the knowledge that `gzip is better than compress is better than identity' can just as well be implemented at the server side, and implementing it there will be much cheaper.  </s>
<s> Probably true.  </s>
<s> However, there will be cases where identity is better than any compressed setting, if you are on a very fast link, and the server or client has a relatively slow processor.  </s>
<s> These are very few; for a modem connection, even with a 386 I'd want compression.  </s>
<s> So I think that encoding that knowlege in the server is reasonable.  </s>

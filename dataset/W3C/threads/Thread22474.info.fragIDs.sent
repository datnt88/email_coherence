<s> I have a question about interface EntityReference.  </s>
<s> EntityReference definition has following sentence.  </s>
<s> (on WD-DOM -19980720) The replacement value, if it is available, will appear  </s>
<s> in the child list of the EntityReference.  </s>
<s> If two or more entity references which reference same entity appered in one document, many copies of replacement value are created in the DOM object tree?  </s>
<s> KAZUMI Saito FUJITSU Laboratories Ltd.  </s>
<s> Since replacement value doesn't change after the entity has been created, I think you'd wind up with many _references_ to the replacement value but only need one copy.  </s>
<s> True?  </s>
<s> Two are created in the logical DOM object tree.  </s>
<s> You may, of course, come up with some efficient implementation-specific sharing mechanism but when the user walks the tree past the EntityReference, they will see an Entity for each EntityReference.  </s>
<s> Lauren  </s>
<s> as long as the user sees an Entity each time they walk through the EntityReference, you can implement the actual object any way you want.  </s>
<s> So yes, your interpretation matches mine.  </s>
<s> There is often a difference between the logical structure of the DOM (what the script writer sees) and the implementation of that structure.  </s>
<s> Lauren  </s>
<s> It is very difficult to implement this any way but by making actual copies, because each occurrance of the Entity has to have, or appear to have, the correct parentNode and sibling links.  </s>
<s> On the other hand, it's very _easy_ to implement if you have a TreeIterator or some such, because then the iterator can hide the actual structure and descend into the Entity rather than its reference.  </s>
<s> That's what we're doing in our implementation.  </s>
<s> We are essentially filtering documents, so we have to be able to reconstruct them on the output in a form identical to the input.  </s>
<s> We leave the EntityReference nodes in the tree, and our iterators do the replacement on the fly.  </s>
<s> This brings up a weak point in both the XML and the DOM specs -- no consideration at all is given to the possibility that one might want to _output_ a document, in which case replacing each EntityReference with its corresponding Entity is WRONG.  </s>
<s> The whole assumption is that the parser is a front-end for an application that doesn't want to know about the _real_  </s>
<s> structure of the document.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> XML provides a mechanism for text componentization that is explicitly designed to be invisible to the application.  </s>
<s> XLink provides a mechanism that the application can "see" and manipulate and choose to use or not use.  </s>
<s> If you want these "first class transclusions" then you should use XLink and not text entities.  </s>
<s> Paul Prescod  </s>
<s> My point is that there is more than one kind of application.  </s>
<s> Applications that _consume_ XML files do not need to "see" entity references.  </s>
<s> However, applications that _produce_ or _edit_ XML files _must_ be able to manipulate  </s>
<s> entity references directly.  </s>
<s> The failure to make this distinction in the  </s>
<s> specification is a serious problem, because it means that an XML editor, for example, cannot possibly conform to the specification!  </s>
<s> What's even worse, an XML editor cannot make use of an XML parser or DOM class library that conforms to the specification (unless I have seriously misread something).  </s>
<s> I think that this fact should be sufficient to prove that the specification is inadequate.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> Not necessarily, though it should *appear* as though there are many copies.  </s>
<s> Changes to the Entity in the DocumentType object should be  </s>
<s> reflected throughout the tree.  </s>
<s> An XML editor can add to the specification.  </s>
<s> You're not limited to the Level 1 DOM interfaces.  </s>
<s> I don't think that this is true - my company is working on an XML editor, for example, and there are other companies working on the DOM specification that are also working on XML or SGML editors.  </s>
<s> It is more likely that we haven't documented it all properly.  </s>
<s> (But of course, it's not impossible that we completely missed something vital).  </s>
<s> We know that an XML editor would need to add functionality to the DOM interfaces to be able to be an editor.  </s>
<s> And it is planned to add this  </s>
<s> functionality to the DOM as soon as we can.  </s>
<s> Since we can only do a few  </s>
<s> things at a time, we figured it was best to finalize what we can do now, and then start work on the rest of the requirements with at least something to show for our efforts of the last 18 months.  </s>
<s> We are also planning on adding back iterators in a future level, and potentially other things to make life easier for server-style applications that have large documents.  </s>
<s> But for now, we need to get the current spec out, limited though it may be in functionality.  </s>
<s> We can always add functionality later.  </s>
<s> It's harder to undo the mistakes that would likely happen if we tried to do too much too fast.  </s>
<s> No DOM implementation is *limited* to the DOM interfaces - you are free to add what you think you need.  </s>
<s> When we start work on the rest of the DOM, it would be good if you could then share with us any information as to what worked, and what didn't, in your implementations.  </s>
<s> And what you think we should add, or not add.  </s>
<s> Lauren  </s>
<s> Right.  </s>
<s> The DOM requirements are geared more toward editor vendors who wish to expose the DOM APIs via their extension/scripting languages than toward those who wish to write an editor on top of the DOM.  </s>
<s> We hope to make the latter more feasible in Level 2, but for the moment editor vendors would have to "embrace and extend" the DOM with proprietary APIs in order to implement a working product.  </s>
<s> You couldn't write a browser on top of the Level 1 DOM either, but that's not its purpose.  </s>
<s> It *should* be possible to write scripts, JavaBeans, etc. that do useful things and work equally well across a number of browsers and editors, and that *is* the DOM's purpose.  </s>
<s> Mike Champion  </s>
<s> The specification clearly states: EntityReference objects are inserted into the DOM by the XML processor whenever the processor sees a reference to an entity other than the pre-defined character entities in the XML specification.  </s>
<s> The replacement value, if it is available, will appear in the child list of the EntityReference.  </s>
<s> One might hedge this by saying that the replacement value of an entity is ``not available'' to an editor even if it's in the DTD, but that's a pretty severe distortion of the spec.  </s>
<s> The requirement to replace and re-insert character entities is also a pain in the neck.  </s>
<s> We're ignoring it, of course, in the interests of efficiency, but it's another distortion, and another reason our application simply doesn't conform.  </s>
<s> So your editor lets you define entities in the DTD and put corresponding references in your document.  </s>
<s> What does it do when it encounters a reference in the course of saving or displaying the document?  </s>
<s> The only correct thing according to the spec would appear to be to replace it.  </s>
<s> (I can see replacing the entity when you do a search; this just demonstrates that both behaviors have to be permitted.)  </s>
<s> It would be sufficient to mention in the spec that not every application is _required_ to put the replacement value of every EntityReference in its children, nor to invisibly replace references to character entities.  </s>
<s> The problem is not _adding_ functionality to the DOM, but _removing_ it.  </s>
<s> In the interests of efficiency and of correct behavior in a document-processing application, we're simply _not doing_ many of the things the specification says we have to do.  </s>
<s> If they were optional instead of mandatory, we would be conforming to the spec.  </s>
<s> We will be able to implement every interface (they're a subset of what we need), but not all of the methods will have the specified behavior.  </s>
<s> That's probably what you are doing, too.  </s>
<s> This is correct, and what I'm saying is that there is specified behavior that is both difficult to implement and incorrect for some applications.  </s>
<s> Remove it, and add it back _correctly_ later.  </s>
<s> I'll be glad to.  </s>
<s> There's an excellent chance ( 90% probability) that our application will be released as open source later this year.  </s>
<s> At that point we'll have 50-100K lines of Java code to share, and some interesting war stories.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> DOM1 not doing everything: Makes sense to me.  </s>
<s> But the more I look at it, the more I'd argue that live index-based NodeLists belong in that second category, if they're needed at all.  </s>
<s> Live isn't bad.  </s>
<s> Array-like isn't bad.  </s>
<s> The combination of both with a "gather" call is murderous.  </s>
<s> Is there any chance we could talk you into changing the NodeList.item()  </s>
<s> call back into a tree-walking first()/next()/previous()/last() API?  </s>
<s> Among other justifications, that's going to be cheaper to process if it turns out that we only needed the first few responses from ...ByTagName().  </s>
<s> Does integer indexing really have an advantage that justifies its additional cost in both implementation and computation costs?  </s>
<s> I can't think of one.  </s>
<s> (I know I'm coming into this discussion late, and I'm not on the committee, so if in fact this has already been hashed out please feel free to just tell me so.  </s>
<s> But to this novice's eyes, it looks like you're making life much harder for yourselves -- and us -- than is really necessary.)  </s>
<s> The are some on the committee who agree with you 100% on this one; and others who equally can't see why we want next/previous at all, because they think that index-based lookups and navigation are much more natural to the user... so we ended up with both methods in effect.  </s>
<s> (all those next/previous-walking methods on Node).  </s>
<s> Yes, the getElementsByTagName is an exception, but when we do the full filter/query system (planned for Level 2) we'll also probably have iterators to hold the results of those, so getElementsByTagName might become completely superfluous.  </s>
<s> Lauren  </s>
<s> You raise some good points here that I'll bring up in the committee.  </s>
<s> Lauren  </s>
<s> manipulate  </s>
<s> As you say: Next/prevous on Node is functionally _different_ than next-previous on a ByTagName NodeList.  </s>
<s> The latter does not currently exist in the spec; only integer access (with all the associated pain) is supported.  </s>
<s> I have confidence that Level 2 will address this.  </s>
<s> I just wish Level 1 wasn't asking us to implement a substantial chunk of code which we expect and hope to throw away.  </s>
<s> Of course there's always the other approach to resolving the conflict: Is it Really Necessary that NodeList be "live"?  </s>
<s> How often is this going to matter, and is it in fact the behavior you want (as opposed to requesting a new NodeList when you know that changes have been made that you need to respond to)?  </s>
<s> On a slightly different note, here's a suggestion from a friend: Have you considered picking up some of the Model/View/Controller ideas and applying them to the DOM?  </s>
<s> Specifically, it might make sense to add the ability to register some flavor(s) of TreeChangeListener, which would be called when the relevant portion of the document was altered.  </s>
<s> That will become especially necessary when you start dealing with multiple access, and particularly if the integer indices are preserved -- you'll have to know what happened in order to adjust those appropriately.  </s>
<s> To be more correct, all the direct descendants of an EntityReference have to have the "correct" parent and siblings.  </s>
<s> Entity only lives in DocumentType.  </s>
<s> the _real_  </s>
<s> This is less true of the DOM.  </s>
<s> The ability to naively write out a document and get pretty much the right structure has been an important goal.  </s>
<s> The main reason for making NodeList live is so that scripts can start accessing the document while it's still being loaded, and not have to poll the NodeList every so often to see if there are now five H3's in the document where only three had turned up before.  </s>
<s> It's not meant to be the solution to multi-threading problems; in fact Level 1 assumes that only one thread at a time can access the document so that you are in charge of everything that changes (apart from the process loading in the document which can't delete anything or move it around).  </s>
<s> We've talked a bit about MVC and I'm sure we'll talk more about it when we get to multi-threading.  </s>
<s> Feel free to remind us when we get closer - we'll be doing our best to keep this mailing list up to date with what we're working on so that we get to pick all of your brains about the best ways to do things.  </s>
<s> Lauren  </s>
<s> This is a syntactic vs. semantic distinction (with entities being syntactic).  </s>
<s> The DOM *does* try to mirror certain parts of the syntactic structure of a document, so the above is not strictly correct.  </s>
<s> If NodeList is live only for purposes of processing-during-read, it can be simplified _tremendously_ since read only involves appends -- not insertions, not deletions, and hence no shifts in the index-to-node mapping.  </s>
<s> There seems to be some differences of opinion about whether all NodeLists are live.  </s>
<s> I think this is a matter which can usefully be left unresolved.  </s>
<s> If this is really the intent, it should say so.  </s>
<s> This merely specifies that the NodeList returned by getElementsByTagName should be computed lazily in a context where the document may not be entirely present in memory, and does _not_ require that it be "live" across all possible modifications to the document.  </s>
<s> The latter is a much stronger requirement, and much harder to implement.  </s>
<s> The former can be ignored completely by an application that parses the entire document before processing it.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> In message "RE: EntityReference", Gavin Thomas Nicol wrote...  </s>
<s> Thank you, I recognized some problems about EntityRefernce implementation.  </s>
<s> Why "The replacement value, if it is available, will appear in the child list of the EntityReference" ?  </s>
<s> I have believed the DOM Object tree is another representation of XML (text) file.  </s>
<s> Then EntityReference needs only entity's identifier not replacement value, I think.  </s>
<s> x x x  </s>
<s> I think I'll second the confusion.  </s>
<s> Given that the application processing the EntityRef knows what kind of node it's processing, why does the value need to be attached as an actual Child rather than being available via a method invocation on the EntityRef itself (which would leave the implementation relatively unconstrained)?  </s>
<s> Again, apologies if this has all been hashed over in the past; feel free to say "Oh, not that again" and ignore me...  </s>
<s> (BTW, in your copious spare time grin!  </s>
<s> it'd be Real Nice to have an annotated DOM spec -- like the annotated XML spec now available -- where you could put standard explanations of why particular design decision were made and other commentary which doesn't really belong in the spec per se.  </s>
<s> The answers posted here would probably be a good start on those footnotes.)  </s>
<s> OH NO! NOT THIS AGAIN ... yup, we've been around this track a few times.  </s>
<s> There are numerous reasonable ways to do this, and we decided that this is the cleanest.  </s>
<s> Remember that we try to balance the needs of the users and the implementers, the old-time SGML weenies and the HTML users born again as XML users, etc.  </s>
<s> I'm planning to write a bestselling self help book "DOM for the Confused" to do just that.  </s>
<s> In the great tradition of our industry, I've helped make it impossible for ordinary mortals to understand the DOM unless they buy my book ;~) Seriously, that's a reasonable idea.  </s>
<s> Mike  </s>
<s> This neatly illustrates a point I have been trying to make for some time, namely that the behavior required by the specification is appropriate for some DOM applications, BUT NOT ALL.  </s>
<s> In a scripting application, which the DOM is clearly aimed at, replacing entity references with their values, keeping nodelists up-to-date with a file being read in, and constructing nonce parents for nodes under construction, are all appropriate.  </s>
<s> What I want to see is SOME consideration in the specification for different kinds of applications, such as server-side processing, document transformation, syntactic verification, indexing, and editing, for which these behaviors are NOT appropriate.  </s>
<s> I want the specification to make it clear that these behaviors are OPTIONAL, and required only in applications where they make sense.  </s>
<s> Please note: I'm not asking for any extensions, and I'm not asking for any changes whatever in the attributes and methods defined in the interfaces.  </s>
<s> All I'm asking for is changes in the _descriptions of the semantics_ of those interfaces, and mainly by changing "is" or "must" to "may".  </s>
<s> Is that too much to ask?  </s>
<s> What I really want is the right to claim that my code "implements the DOM" instead of having to say: "implements the interfaces defined by the DOM specification, but with the major changes in the semantics necessary for an efficient implementation of my application".  </s>
<s> I think that the DOM continues in its present course, it is in danger of becoming the ``Scripting Object Model'' and being essentially useless for any other purpose.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> NO -- you are not balancing the needs of the users and the implementors of the DOM, you are balancing the needs of the users and implementors of client-side scripting languages.  </s>
<s> The DOM has, at least potentially, many more applications than just being the semantic model behind Javascript, and it would be nice if those of us who are trying to build real, working document-processing applications could get at least a _little_ input into the process.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> For better or worse, the Level 1 DOM is being driven by the need for a standard that allows Dynamic HTML scripts that interoperate between the NS and MS browsers.  </s>
<s> We are, to a certain extent, rushing the spec out the door to avoid missing the window of opportunity provided by the 5.0 releases of the browsers, because if we miss it, the opportunity is gone forever.  </s>
<s> Clearly full-blown XML support and serious consideration of server-side processing has suffered from this.  </s>
<s> Level 2 *can* address these issues much more effectively, and one possibility for Level 2 is a minimal DOM (perhaps synchronized with some subset of XML that others may be defining).  </s>
<s> It's  </s>
<s> important for people who care about them to make their needs known, via  </s>
<s> their W3C reps, by joining the W3C, by regularly looking for Level 2 information on our Web site and participating on this mailing list, etc.  </s>
<s> Just how much time do we have?  </s>
<s> In the interests of moving things along, let me make some very specific suggestions: 1. in Document under "getElementsByTagName" add: In an application in which a Document is being read in or constructed in parallel with other processing, the NodeList returned by getElementsByTagName must be ``live'' in the sense of being continually appended to whenever a new Element with the given tag  </s>
<s> name is added to the Document.  </s>
<s> 2. in Node: add: boolean inDocument(); This will allow ``orphan'' nodes to be identified without requiring each Document to have an identifiable DocumentFragment that contains newly-created nodes.  </s>
<s> It does not preclude such a fragment, however.  </s>
<s> clarify: whether the "name" attribute of an Element is the same as the the result of getTagName on that Element.  </s>
<s> replace: attribute wstring nodeValue; with: attribute wstring data; attribute NodeList nodeValue; There needs to be some verbiage to the effect that if a node has children, then nodeValue must contain the result of substituting all entity references with their values in those children, and data must contain the result of converting nodeValue to a string.  </s>
<s> If the Node  </s>
<s> is an EntityReference, then its nodeValue must be the nodeValue of the corresponding Entity.  </s>
<s> (Alternatively, nodeValue could be added to Entity, EntityReference, and Attribute, but I think it's better in Node.) The effect of this is to permit both string-valued nodes like Text and node-valued nodes like Entity and EntityReference.  </s>
<s> This will also make it possible to remove the "data" attribute from Data.  </s>
<s> Another effect will be to make the substitution of entity references with their values take place lazily at the point where those values are actually used.  </s>
<s> It might be better if there were a method, getValue(), instead of the attribute nodeValue().  </s>
<s> 3. in EntityReference: replace: ``The replacement value, if it is available, will appear in the child list of the EntityReference.'' with: ``The replacement value, if it is available, will appear in the nodeValue of the EntityReference.'' 4. It would be useful if there were an extension of NodeList corresponding to what used to be EditableNodeList, i.e. a NodeList you could modify.  </s>
<s> I'm doing the latter now.  </s>
<s> Unfortunately our small research group is a subsidiary of a large company, so it will take a while before I can move the necessary two requests (for full and affiliate memberships) through a set of management on either side of the Pacific.  </s>
<s> Stephen R. Savitzky Chief Software Scientist, Ricoh Silicon Valley, Inc., steve@rsv.ricoh.com  </s>
<s> California Research Center home: steve@starport.com  </s>
<s> URL: http://www.starport.com/people/steve/  </s>
<s> Essentially none.  </s>
<s> The spec must go to the W3C ASAP, by the middle of next week at the latest.  </s>
<s> We're discussing this, although there seems to be some confusion as to why this is necesary to you and others who have suggested it.  </s>
<s> As for your other suggestions, I'll take a close look at them the next pass thru the spec.  </s>
<s> Not to worry.  </s>
<s> There are no such things as "character entities" in XML.  </s>
<s> There are "character references", the "&amp;#nnnn" and "&amp;#xnnnn" things, but there are no "character entities" that they refer to.  </s>
<s> What the above quotation from the DOM WD presumably means is that references to "lt", "gt", "quot", "apos", and "amp" need not be treated as Entity objects, but can be incorporated in Text nodes.  </s>
<s> Likewise with character references, since they are not references to entities.  </s>
<s> So it's only references to declared parsed entities (and only internal entities at that, if the reference is still to Attribute nodes).  </s>
<s> John Cowanhttp://www.ccil.org/~cowancowan@ccil.org  </s>
<s> You tollerday donsk?  </s>
<s> N.  </s>
<s> You tolkatiff scowegian?  </s>
<s> Nn.  </s>
<s> You spigotty anglease?  </s>
<s> Nnn.  </s>
<s> You phonio saxo?  </s>
<s> Nnnn.  </s>
<s> Clear all so! 'Tis a Jute.... (Finnegans Wake 16.5)  </s>

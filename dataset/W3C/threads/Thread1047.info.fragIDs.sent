<s> Tidy mis-formats text between pre and /pre when that text contains br .  </s>
<s> I don't know what produced this original; it's clearly ugly (but correct) HTML.  </s>
<s> See the attached files: pre-text.html is the original; pre-tidy.html is the output of HTML Tidy for Linux/x86 (vers 1st September 2002; built on Sep 4 2002, at 23:33:09).  </s>
<s> Ed GouldAgileTV Corporation ed@agile.tv333  </s>
<s> Ravenswood Avenue, Bldg.  </s>
<s> 202  </s>
<s> Thanks, I added this to the bug tracker.  </s>
<s> Yes, I checked that one out and shook my head.  </s>
<s> I think there are two problems: one, the br tags need to be removed and replaced with a simple newline (if there isn't one already there) and, two, the tab-to-space conversion isn't working quite right.  </s>
<s> I am not sure whether we should remove the br .  </s>
<s> It's valid to use it  </s>
<s> inside pre and I am not even aware of any deprecatation of this practise; maybe it'd be better to leave it to the user to fix it.  </s>
<s> Anyway, if it is replaced, it must be replaced by \n, no matter of preceding or following newlines in order to emulate browser behaivour.  </s>
<s> I did not notice any problem with the tabs.  </s>
<s> What's wrong with them?  </s>
<s> Are they replaced by the wrong number of spaces?  </s>
<s> I remember we discussed this before and I proposed to change the default number of spaces.  </s>
<s> Did we reach consensus on that?  </s>
<s> Or is something else going wrong here?  </s>
<s> Ok, my mistake.  </s>
<s> Broke down and read the DTD - again.  </s>
<s> In HTML 3.2 the following are allowed inside PRE elements.  </s>
<s> TT | I | B | U | STRIKE | EM | STRONG | DFN | CODE | SAMP | KBD | VAR | CITE A | APPLET | BASEFONT | BR | SCRIPT | MAP INPUT | SELECT | TEXTAREA Yow! Basically, %text/%inline less images and fonts.  </s>
<s> HTML 4 is similar.  </s>
<s> In my test, the left-right alignment (the primary reason for using pre ) was messed up.  </s>
<s> The Pre-Tidy sample lined up nicely in both IE6 and NS6.  </s>
<s> The input has lots of tabs and _no_ newlines.  </s>
<s> So a) I think the code is not  </s>
<s> adding the right number of spaces and b) any time we add a newline where  </s>
<s> there wasn't one before, perhaps we should take away a br .  </s>
<s> Either that, or do not add newlines at all.  </s>
<s> take it easy, Charlie  </s>
<s> But differently, IE 6.0 ignores sub-sequent br s while Opera 6.0 and Mozilla 1.0 insert a newline wherever they find a br .  </s>
<s> The http://tidy.sourceforge.net/docs/quickref.html is wrong, while tab-size defaults to 8 (changed after the mentioned discussion) it is documented as defaulting to 4. If you replace all br with \n Tidy won't mess up anything hence that's where to look at.  </s>
<s> The point is, surely, that there *is no* "right number of spaces".  </s>
<s> Tabs should not be used inside PRE, precisely because there is no way  </s>
<s> to tell the rendering system what the tab boundaries are.  </s>
<s> If I code \t\tText \t More text then I have no right to make assumptions about how the two pieces of text will line up: it depends on the tab stops, which are undefined (and not definable).  </s>
<s> If both IE and NS have the same defaults as my editor, that's luck.  </s>
<s> HTML4.01 section 9.3.4 last para:  </s>
<s> The horizontal tab character (decimal 9 in [ISO10646] and [ISO88591] ) is usually interpreted by visual user agents as the smallest non-zero number of spaces necessary to line characters up along tab stops that are every 8 characters.  </s>
<s> We strongly discourage using horizontal tabs in preformatted text since it is common practice, when editing, to set the tab-spacing to other values, leading to misaligned documents.  </s>
<s> "Usually", not "required to be".  </s>
<s> Mapping br to \n is of course another can of worms altogether.  </s>
<s> Got ya. br br == br in IE. Good eye.  </s>
<s> Yup. Leaving the " br " might be messing up the left-right (column) alignment.  </s>
<s> I tried a tweak to avoid putting out newlines right after br for pre-formatted mode.  </s>
<s> It had no real effect.  </s>
<s> I also tried adding a b /b here and there.  </s>
<s> My current theory is that Tidy is including the element names in it's character count.  </s>
<s> This makes sense for pretty  </s>
<s> printing, but not for pre-formatted elements.  </s>
<s> take it easy, Charlie  </s>
<s> Hi Fred, Good to see you there.  </s>
<s> Well, "usually" is the bread and butter of Tidy.  </s>
<s> I mean, you're right.  </s>
<s> There are no guarantees (apparently).  </s>
<s> But we do try to follow the principle of "interoperable compliance with the least surprise".  </s>
<s> Also, there is an option for tab-size (in chars), so you can always tweak it to your liking.  </s>
<s> Agree about the worms.  </s>
<s> I am hesitant to map br to \n and not do anything about all the other markup allowed in pre that will still mess up the layout.  </s>
<s> take it easy, Charlie  </s>
<s> The horizontal tab character (decimal 9 in [ISO10646] and [ISO88591] ) is usually interpreted by visual user agents as the smallest non-zero number of spaces necessary to line characters up along tab stops that are every 8 characters.  </s>
<s> We strongly discourage using horizontal tabs in preformatted text since it is common practice, when editing, to set the tab-spacing to other values, leading to misaligned documents.  </s>

<s> I have been asked to communicate to this group the HTML Working Group's feelings about using XPointer to index into HTML (i.e. the SGML version, not XHTML).  </s>
<s> As I understand it, it is particularly in reference to elements such  </s>
<s> as tbody which may or may not be in the markup.  </s>
<s> The group discussed this topic recently.  </s>
<s> Many thanks to Masayasu Ishikawa for his comments, many of which are echoed here.  </s>
<s> We understand the motivation for wanting to annotate HTML.  </s>
<s> But: Firstly a technical caveat: The abstract to XPointer says that it's for "a  </s>
<s> resource whose Internet media type is one of text/xml, application/xml, text/xml-external-parsed-entity, or application/xml-external-parsed-entity".  </s>
<s> Unless we update RFC 2854, "XPointer for HTML" would be non-conformant.  </s>
<s> (http://www.w3.org/TR/2001/CR-xptr-20010911/#abstract)  </s>
<s> Secondly, an observation: most HTML documents are seriously broken.  </s>
<s> Trying  </s>
<s> to create a robust mapping from broken HTML to XML is a minefield we do not  </s>
<s> wish to step on.  </s>
<s> Thirdly, because of the difference between XML and SGML, XHTML and HTML have  </s>
<s> different but compatible content models.  </s>
<s> This means that an XHTML document  </s>
<s> served as text/html will have a different parse tree to that of the  </s>
<s> physically same document served as text/xml or application/xhtml+xml.  </s>
<s> This  </s>
<s> means that depending on the mime type you would need different XPointers to  </s>
<s> get to the same element.  </s>
<s> However, if you persist, let us observe that the DTD for HTML 4.01 says of  </s>
<s> tbody : !ELEMENT TABLE - - (CAPTION?, (COL*|COLGROUP*), THEAD?, TFOOT?, TBODY+) (http://www.w3.org/TR/html401/struct/tables.html#edef-TBODY)  </s>
<s> This says that tbody is an element with optional begin and end tags.  </s>
<s> This means that whether or not tbody is present in the markup, it is present in  </s>
<s> the document, and therefore in the tree.  </s>
<s> On the other hand, the DTD for XHTML says: !ELEMENT table (caption?,  </s>
<s> (col*|colgroup*), thead?, tfoot?,  </s>
<s> (tbody+|tr+)) (http://www.w3.org/MarkUp/Group/2002/REC-xhtml1-20020301/dtds.html#a_dtd_XHT  </s>
<s> ML-1.0-Strict)  </s>
<s> This says that tbody is an optional element: if it is not in the markup it  </s>
<s> is not in the tree.  </s>
<s> (We had to do it this way, because XML does not give you optional tags).  </s>
<s> Therefore the answer to the question "what should an XPointer into HTML look  </s>
<s> like?" is a very loud "it depends".  </s>
<s> Best wishes, Steven Pemberton Chair, W3C HTML Working Group  </s>
<s> "Steven Pemberton" steven.pemberton@cwi.nl  </s>
<s> "a  </s>
<s> application/xml-external-parsed-entity".  </s>
<s> So no matter about HTML documents, XHTML ones can't be annotated either?  </s>
<s> (RFC 3236 defines application/xhtml+xml )  </s>
<s> Trying  </s>
<s> not  </s>
<s> but neither is such a thing necessary to be able to use XPointer like constructs on HTML documents, as you say, they are obviously not XPointers because XPointers are only defined on XML documents (and even  </s>
<s> then on a very restricted set of MIME-types.) All you need to do is be  </s>
<s> able to indentify elements in the parse tree, XPointer like syntax is good for this, especially if the document has id's.  </s>
<s> There are of course other problems with XPointer, that to me have much more serious implications than this, that of what a URI points to, is not a particular XML representation so can't have an XPointer dangling off of it, it's a Resource, which may contain all sorts of different things, including non XML representations.  </s>
<s> have  </s>
<s> document  </s>
<s> This  </s>
<s> XPointers to  </s>
<s> Well of course you would, they're different documents!  </s>
<s> However if the  </s>
<s> Pointer is  </s>
<s> xpointer(id('Moomin')) then it will happily point to the same element within the Resource (assuming the resources are appropriately authored,  </s>
<s> and content negotiation on the document returned from the URI is logical.)  </s>
<s> of  </s>
<s> markup it  </s>
<s> tags).  </s>
<s> look  </s>
<s> This seems very confused to me, in one part you define xpointer to only  </s>
<s> work with the idea that a URI returns a particular document (not a particular resource) and now you argue against xpointers in HTML documents by comparing them with XHTML - the differences betwenn XHTML  </s>
<s> and HTML are irrelevant to the purposes of XPointers in HTML - in HTML,  </s>
<s> we know there's a TBODY in the parse tree, in an XHTML document we know  </s>
<s> there's not unless it's in the source document.  </s>
<s> Those differences are  </s>
<s> irrelevant to whether you can point to a particular part of an HTML parse  </s>
<s> tree.  </s>
<s> The question is not how does XPointer into HTML compare to XPointer into  </s>
<s> XHTML, but can we point to something in an HTML document?  </s>
<s> Jim.  </s>
<s> XHTML may also be served as text/xml, so in that case XPointer can be used.  </s>
<s> As Masayasu points out, XPointer needs to be updated to refer to RFC 3023.  </s>
<s> If the document has id's then you can just use a URI, problem solved.  </s>
<s> But I  </s>
<s> thought a more general solution was being sought.  </s>
<s> the  </s>
<s> No, the same document, served with different media types.  </s>
<s> It is the same  </s>
<s> document, but the result of the media types means it gets parsed differently.  </s>
<s> As I said, if the document has ids, the problem is solved.  </s>
<s> I'm sorry if I said something that upset you.  </s>
<s> I don't know what I said to  </s>
<s> engender such rancour.  </s>
<s> I was asked to comment on using XPointer into HTML, especially in the context of TBODY.  </s>
<s> If that is not the problem, I will keep quiet.  </s>
<s> Best wishes, Steven Pemberton Chair, W3C HTML Working Group  </s>
<s> "Steven Pemberton" steven.pemberton@cwi.nl  </s>
<s> But I  </s>
<s> Having id's makes pointing to a child of an element with an id or a range within elements with id's more reliable, obviously if you're pointing to just an id it's trivial as you say.  </s>
<s> same  </s>
<s> Can you have an xhtml1.1 document that is served as text/html ?  </s>
<s> If not the point is of somewhat historical interest as we're talking about a  </s>
<s> subset of xhtml 1.0 documents are we not?  </s>
<s> authored,  </s>
<s> No it is not, by your argument different fragment depending on whether the resource has an xhtml or html mime-type.  </s>
<s> only  </s>
<s> XHTML  </s>
<s> HTML,  </s>
<s> know  </s>
<s> are  </s>
<s> parse  </s>
<s> into  </s>
<s> to  </s>
<s> You've said nothing to upset me - but your confused arguments over XPointer and HTML have left more questions (many of which have been raised before, and gone un-answered) than answers - A large number of comments on XPointers have arisen in the thread, perhaps rather than limit yourself to commenting on XPointer into HTML and the context of TBODY you could comment on all the issues raised - those are the ones that are actually concerning www-annotation and wai-er after all.  </s>
<s> Jim.  </s>
<s> Please be careful with terminology here: a URI plus fragment ID is a URI-reference, according to the BNF and terminology used in RFC 2396 [1].  </s>
<s> Of course.  </s>
<s> A better question is whether XHTML 1.1 served as either text/html, text/xml, or application/xhtml+xml makes any sense; but that's out of scope for this discussion, I feel.  </s>
<s> Perhaps.  </s>
<s> If it's sent as text/xml (or any of the MIME types covered by XPointer), then if there's a Moomin ID declared, then it points to that fragment of content.  </s>
<s> If on the other hand it's sent as a MIME type not covered by XPointer, then it's basically going to point to something "undefined".  </s>
<s> The URI specification [URI] notes that the semantics of a fragment identifier (part of a URI after a "#") is a property of the data resulting from a retrieval action, and that the format and interpretation of fragment identifiers is dependent on the media type of the retrieval result.  </s>
<s> For documents labeled as text/html, the fragment identifier designates the correspondingly named element; any element may be named with the "id" attribute, and A, APPLET, FRAME, IFRAME, IMG and MAP elements may be named with a "name" attribute.  </s>
<s> This is described in detail in [HTML40] section 12. ]]] - http://www.ietf.org/rfc/rfc2854.txt  </s>
<s> If a document is served as text/html and the fragment that you wish to identify is not named in the aforementioned manner, then you can't point to it; it's as simple as that.  </s>
<s> But the argument isn't as clear cut as that, as we all know.  </s>
<s> text/html and text/xml representations can be served together as variants of a single resource.  </s>
<s> In this case, the URI-ref:- Is utterly broken.  </s>
<s> The semantics of the URI-ref seem to depend greatly upon a retrieval action, and in this case, the semantics of the XPointer change depending upon one's accept headers.  </s>
<s> Accepting text/html means that the pointer is undefined, and accepting text/xml means that the pointer is defined.  </s>
<s> This is a problem with XPointer - it doesn't work very well with conventional HTTP machinery that has been around for years.  </s>
<s> Or rather, it only works when you necessarily limit yourself to sending a single (and perhaps fixed) variant.  </s>
<s> Many people believe that fragments must be persistent; in the case of XPointer, that means that your XML document had better not change one iota.  </s>
<s> So, if you want to use XPointer, you have to do so on a resource that has a single fixed XML representation.  </s>
<s> That's absurd.  </s>
<s> So, now you want to create a similar scheme for HTML.  </s>
<s> Now, since I've been working with you on the EARL project, I certainly understand what the rationale behind this is :-) We need to be able to refer to pieces of HTML documents in order to say things about them - perhaps in the context of an EARL eevaluation, or perhaps outside of it.  </s>
<s> Using some kind of pointer mechanism would be fine if (as noted above) people were constrained to sending their HTML document without any variants, and without changing the document in such a way that would break the HTML pointer.  </s>
<s> And really I'm just clarifying for the sake of people external to this discussion who may lack the context.  </s>
<s> Jim, I remember you saying to me that the requirement for HTML pointer is simply of being able to point into a *single* representation of HTML, and that the requirement for XPointer is of being able to point into a single represenation of XML.  </s>
<s> But many people don't seem to get it, and that's a bit of a shame, so it needs to be underlined at every opportunity.  </s>
<s> So the answer to your question is that, yes, the generic idea of an HTML pointer is good, useful, and architectually sound, but that one shouldn't abuse it in the manner that XPointer have abused theirs.  </s>
<s> In fact, you can't abuse HTML pointer since there is no way that you can make an amendment to the HTML media type RFC.  </s>
<s> Win-win.  </s>
<s> As for the canonicalization issues, that's a tough one.  </s>
<s> As Steven has pointed out, some HTML document are just so broken that even HTML tidy throws up all over them.  </s>
<s> OTOH, some documents are valid HTML, and for those a regular HTML pointer is certainly possible, given work.  </s>
<s> So, I suggest that you might want to look into the following algorithm:- 1) If the representation validates according to one of the standard HTML DTDs, then use a standard canonicalization, and an HTML pointer.  </s>
<s> 2) If the representation doesn't validate, then you have two choices:- 2a) Attempt to canonicalize it anyway, and use an HTML pointer 2b) Point to the piece of information using a column and line number, a regular expression, or something else based on the reduced hash experiments that Nick started working on.  </s>
<s> I hope that helps.  </s>
<s> [1] http://www.ietf.org/rfc/rfc2396.txt  </s>
<s> Kindest Regards, Sean B. Palmer @prefix : http://purl.org/net/swn# .  </s>
<s> :Sean :homepage http://purl.org/net/sbp/ .  </s>

<s> Ref: http://www.apache.org/~fielding/uri/rev-2002/rfc2396bis.html  </s>
<s> I have read section 2 about 11 times and now have a persistent nagging headache that just won't quit.  </s>
<s> I now approximately half the time am convinced that I think that I understand what it's trying to say, but I'd have a hard time justifying it with text from the RFC.  </s>
<s> It seems to me that the RFC defines - very clearly - the syntax of a URI.  </s>
<s> However, the explanation of how those characters and escape sequences might have got there is pretty well opaque to me.  </s>
<s> In explaining matters of character encoding, section 2.1 envisions something sort of standing behind the URI, the phrase original character is used (occasionally in quotes), as well as "original character sequences" (not in quotes).  </s>
<s> So maybe there's a notion of an "original URI" hiding behind the URI?  </s>
<s> This is confusing because the "original URI" might differ from the actual URI because (a) it contains ASCII characters which are reserved, e.g. '/' or '%' (b) it contains non-ASCII characters (c) it contains non-character octets A question: what gets painted on the side of a bus?  </s>
<s> The URI or the "original" behind it?  </s>
<s> The answer is probably "The URI", except for case (b), when it might become an IRI with the native non-ASCII characters appearing on the side of the bus.  </s>
<s> (c) is kind of confusing and counter-intuitive, but is the only way I can explain the baffling language about mapping from characters to octets, and the phrase in 2.2 "The data for a URI component".  </s>
<s> If section 2 were redrafted as follows, all the ambiguity and hand-waving would be squashed like a bug.  </s>
<s> 2. Characters and URIs [New title] A URI consists of a restricted set of characters, primarily chosen to aid transcribability and usability both in computer systems and in non-computer communications.  </s>
<s> Characters used conventionally as delimiters around a URI are excluded.  </s>
<s> The restricted set of characters consists of digits, letters, and a few graphic symbols chosen from those common to most of the character encodings and input facilities available to Internet users.  </s>
<s> uric = reserved / unreserved / escaped Within a URI, characters are either used as delimiters or to represent strings of data (octets) within the delimited portions.  </s>
<s> [Same as now except lose last 2 sentences].  </s>
<s> 2.1 Encoding of Characters In the general case, there are many mappings between characters as abstractions comprising the smallest atomic units of text and the octets used to store them in a computer.  </s>
<s> The US-ASCII standard specifies not only a set of characters but a particular mode of storage where each character's numeric value (in the range 0-127) is stored directly in a single octet.  </s>
<s> Note that many widely deployed systems for storing characters which include non-ASCII characters nonetheless store ASCII characters as specified by US-ASCII directly one per octet.  </s>
<s> This includes Shift-JIS, EUC, UTF-8, and ISO-8859 (all parts).  </s>
<s> This RFC does not mandate the use of any particular mapping between its character set and octets of computer storage.  </s>
<s> 2.2 The Characters in the URI Scheme The "scheme" part of a URI consists of a sequence of ASCII characters which represent nothing except themselves.  </s>
<s> 2.3 The Characters in Non-Scheme Parts of the URI The ASCII characters making up a component of a URI other than the scheme may represent an arbitrary sequence of octets.  </s>
<s> The definitions of URI schemes MUST specify the interpretation of the characters in the components of URIs of that scheme.  </s>
<s> There are some constraints on these interpretations: - The interpretation MUST conform to the productions in this RFC, i.e. cannot rely on using a character which is forbidden to appear in the component.  </s>
<s> - The interpretation must be consistent: two instances of a URI component which are equal in length and made of pairwise-identical ASCII characters MUST represent the same octets.  </s>
<s> - The character "%" MUST always be followed by two hexadecimal values encoding the numeric value of a single octet.  </s>
<s> The hexadecimal digits 'A' through 'F' are used identically to the digits 'a' through 'f', so that two URI components which differ only in the case of hexadecimal digits used in %-encoded octets may safely be considered identical.  </s>
<s> 2.4 Textual URIs Many schemes may wish to constrain the components of URIs to encode textual data, consisting only of characters from Unicode (ISO10646).  </s>
<s> This section describes a procedure for encoding textual data for use in URIs.  </s>
<s> Schemes which describe textual URIs SHOULD use the procedure described in this section to generate URI components from textual data.  </s>
<s> - ASCII characters which may legally appear in the component MUST appear directly as themselves, i.e. 'a' may not be encoded as %61.  </s>
<s> - ASCII characters which may not legally appear in the component MUST be %-encoded using the numeric value specified by the US-ASCII standard, using the upper-case hexadecimal digits 'A' - 'F'.  </s>
<s> i.e. ' ' must always be encoded as %3C.  </s>
<s> - Non-ASCII characters MUST be converted to a sequence of octets as specified by UTF-8, with each octet then %-encoded.  </s>
<s> I.e. ?  </s>
<s> (U+00C7 LATIN CAPITAL LETTER C WITH CEDILLA) must always be encoded as %C7%65.  </s>
<s> I think most of the rest of section 2 is pretty well OK.  </s>
<s> Cheers, Tim Bray (ongoing fragmented essay: http://www.tbray.org/ongoing/)  </s>
<s> "Tim Bray" proposed:  </s>
<s> My understanding is that the decision on whether or not an ASCII character 'may legally appear' (at any particular position in the URI) is not at all well defined and is scheme-specific.  </s>
<s> Witness the several recent requests to this list by Israel Viente re: file:/e:/xxx.pdf  </s>
<s> versus file:/e%3a/xxx.pdf  </s>
<s> and the like - I don't think anyone was able to give him quick, unambiguous answers.  </s>
<s> Unless and until the URI RFC _and_ all schemes can be shown to have completely unambiguous syntaxes in this respect, developers will have to 'play safe' and escape questionable characters.  </s>
<s> So, much as I respect absolutism in specifications, I don't believe 'MUST' can be used here.  </s>
<s> Chris Haynes  </s>
<s> Scheme-specific I believe.  </s>
<s> "Not well defined" seems like a symptom of a broken scheme.  </s>
<s> This would tend to support the general feeling that the "file:" URI scheme is basically broken.  </s>
<s> Further evidence of that fact is that there is very poor interoperability in the field.  </s>
<s> I see your point, but if a scheme is so broken that a programmer can't be sure what needs escaping, then it needs fixing.  </s>
<s> Cheers, Tim Bray (ongoing fragmented essay: http://www.tbray.org/ongoing/)  </s>
<s> Am Samstag, 08.03.03, um 01:09 Uhr (Europe/Berlin) schrieb Tim Bray:  </s>
<s> "Shadow URI"?  </s>
<s> ;) There is also chapter 1.5 (Transcribability) which uses the term URI both for the thing on the side of a bus and a string conforming to the EBNF rules of the RFC.  </s>
<s> Also, the last sentence of 1.5 should probably also be removed since now 6.3 recommends UTF-8 usage.  </s>
<s> Regards, Stefan  </s>
<s> Am Sonntag, 09.03.03, um 00:23 Uhr (Europe/Berlin) schrieb Tim Bray:  </s>
<s> There is the problem, I mentioned, with ":" in path components.  </s>
<s> ":" is not reserved in path-segment, but is reserved in the rel-segment.  </s>
<s> So, de-/resolver need to take special care about escaped ":" octets/characters?  </s>
<s> So with base "http://example.org/x/y"  </s>
<s> URI ref "z%25test" would need to be resolved to "http://example.org/x/z:test"?  </s>
<s> //Stefan  </s>

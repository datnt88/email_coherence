<s> (The previous version had some confusing typos; this is a corrected message.) Consider the interface CharacterData from DOM Level 1.  </s>
<s> The method deleteData has an unsigned long parameter named count.  </s>
<s> The technical report says that if the specified count is negative the exception INDEX_SIZE_ERR should be raised.  </s>
<s> But since count is an unsigned long, it makes no sense to say an exception should be raised if the count is negative; an unsigned long can't be negative.  </s>
<s> In practice, this creates a problem for language binding implementors.  </s>
<s> For example, the W3C DOM test suite has an ECMAScript test that attempts to pass a negative number to deleteData, and expects INDEX_SIZE_ERR.  </s>
<s> But conceptually, it's the ECMAScript DOM language binding that is going to encounter the need to convert the negative number to an unsigned long, and I think it may be unreasonable to expect the language binding to know that it should raise a DOMException INDEX_SIZE_ERR in this case, since the process of converting argument types shouldn't be required to know details of individual DOM methods.  </s>
<s> I was unable to find any standard that defines what should happen to values of inappropriate types that are passed through a language binding.  </s>
<s> I expect that's outside the scope of the DOM technical report.  </s>
<s> There's definitely a problem here, but I'm not sure what can be done to the DOM technical report to fix this.  </s>
<s> Perhaps the idea of using unsigned long as the type in the CharacterData interface is the problem; it's certainly inconsistent to talk about a negative count if a count is an unsigned long.  </s>
<s> This issue exists for the substringData, insertData, deleteData, and replaceData methods of the interface CharacterData, and the splitText method of the interface Text. -- Darin  </s>
<s> I agree completely, IMO the DOM spec is broken and should not talk about throwing exceptions in impossible situations.  </s>
<s> We've run into this in Mozilla too (it just so happens that a Mozilla developer asked me about this same issue yesterday), and we can (and probably will) make our binding layer throw an exception if a negative value is passed as an unsigned type, but that exception will absolutely *not* be a DOM exception.  </s>
<s> jst  </s>
<s> I believe that clause is there because some bindings -- Java being one of them -- simply do not have the concept of untyped integers.  </s>
<s> The IDL lays out the desired behavior; the text provides a recommendation of how to  </s>
<s> achieve that behavior when you can't enforce it through the type system.  </s>
<s> The only alternative would have been to not specify the value as untyped in the IDL, forcing _every_ binding to test sign and throw the exception when passed a negative value.  </s>
<s> I believe that was, in fact, suggested and rejected; if you have a typesystem it's nice to be able to take advantage of it.  </s>
<s> Yeah, it could probably be explained better.  </s>
<s> But I don't think it's broken, and I don't think it's fixable at this late date.  </s>
<s> Joe Kesselman, IBM Next-Generation Web Technologies: XML, XSL and more.  </s>
<s> "The world changed profoundly and unpredictably the day Tim Berners Lee got bitten by a radioactive spider." -- Rafe Culpin, in r.m.filk  </s>
<s> Agreed.  </s>
<s> I don't think there's anything that really can be fixed here, but DOM Level 3 (and maybe arratas to older versions) could explain the intended behavior better here, and IMO the DOM TS should not make an implementation fail if it doesn't throw a *DOM exception* when a negative value is passed as an unsigned type.  </s>
<s> jst  </s>
<s> Tests that pass negative numbers to parameters declared as unsigned have an assertion that they are only applicable to bindings that exclusively used signed values.  </s>
<s> Typically, it looks something like this: Both the Java and ECMAScript frameworks accept tests where signed="true" since neither supports unsigned values, however frameworks for other bindings may dismiss those tests as not applicable.  </s>
<s> Unfortunately, most languages that support unsigned integers do not raise an exception on an attempt to cast a negative value to unsigned.  </s>
<s> This results in the same programing error having substantially different outcomes on different bindings.  </s>
<s> For example, if CharacterData.substringData(0, -1) will raise an exception on Java and ECMAScript implementations, but would return the entire string on implementations that silently converted -1 to a very large positive integer.  </s>
<s> If I were designing a binding for a language that did not raise an exception on a conversion of a negative number to unsigned and also allowed function overloading, I would consider creating a signed variant of each function that performed range checking an raised the appropriate DOMException.  </s>
<s> For example, class CharacterData // signed wrapper function, called when uncast expressions or literals are used in call DOMString substringData(int offset, int count) { if (offset  0) throw DOMException(INDEX_SIZE_ERR); if (count  0) throw DOMException(INDEX_SIZE_ERR); substringData((unsigned int) offset, (unsigned int) count); DOMString substringData(unsigned int offset, unsigned int count) { // actual implementation  </s>
<s> But it does have the concept of indices, and it does already have an appropriate Exception to raise: IndexOutOfBoundsException If the language does not have the proper typing means to handle the spec, the language should still be called on for resolving this "unsigned" issue rather than the DOM.  </s>
<s> The Java implementation ought to work around Java's limitation by handling this index as Java already does handle every other index natively - by offering an int argument and throwing an IndexOutOfBoundsException if the argument is negative.  </s>
<s> This would resolve the DOM compliance test issue, as the DOM index exception would no longer be necessary.  </s>
<s> -Chris "SoopahMan" Moschini  </s>
<s> While I agree that a language level exception refering to "index out of range" can be used in most (all?) cases in the DOM where unsigned input arguments are passed, such an exception can not be thrown in non-DOM-specific binding layers such as XPConnect in Mozilla.  </s>
<s> In such cases, the binding layer doesn't know if the argument is an index or simply just an unsigned int (used for something other than an index).  </s>
<s> jst  </s>

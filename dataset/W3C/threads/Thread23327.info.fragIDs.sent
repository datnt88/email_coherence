<s> I found the descripton of the CustomEvent interface in the Last Call draft of the Level 3 Events spec too be very confusing.  </s>
<s> I was only able to figure it out after reading the note about it in the description of DocumentEvent.createEvent().  </s>
<s> I suggest you add more description to CustomEvent itself.  </s>
<s> In particular, please say when it is necessary to implement this interface.  </s>
<s> David Flanagan  </s>
<s> Here is a try for section 1.4.1 (1.6.1 is in the future version).  </s>
<s> I hope it's easier to understand the purpose of CustomEvent: 1.6.1.  </s>
<s> Event creation In most cases, the events dispatched by the DOM Events implementation are also created by this implementation.  </s>
<s> It is however possible to simulate events such as mouse events by creating the Event objects and dispatch them using the DOM Events implementation.  </s>
<s> The DOM Events model provides two ways for creating Events.  </s>
<s> An application can either create Events objects that are known to the implementation, or create its own objects and have them dispatched by the DOM Events implementation.  </s>
<s> Creating Event objects that are known to the DOM Events implementation is done using DocumentEvent.createEvent.  </s>
<s> The application must then initialize the object by calling the appropriate initialization method before invoking EventTarget.dispatchEvent.  </s>
<s> The Events objects created must be known by the DOM Events implementation otherwise an event exception is thrown.  </s>
<s> The DOM application might want to create its own Event objects, in order to change the default Event implementation provided by the DOM Events implementation or to generate new event types with specific contextual information.  </s>
<s> In any case, the application is responsible for creating and initializing the Event object.  </s>
<s> The application can then dispatch the event using the DOM Events implementation by using EventTarget.dispatchEvent.  </s>
<s> However, the DOM Events implementation requires to have access to two attributes in the Event object in order to accomplish the dispatch appropriately: Event.currentTarget and Event.eventPhase.  </s>
<s> Those attributes are defined as readonly in the Event interface since event listeners must not change them and it is the responsability of the DOM Events implementation to update them during the event flow.  </s>
<s> Therefore, implementing the Event interface when creating its own events is not enough for an application since the DOM Events implementation will not be able to update the current phase and the current node during the dispatch.  </s>
<s> This problem could be resolved using two techniques: by extending the object definition of the Event implementation provided by the DOM Events implementation, or by the CustomEvent interface.  </s>
<s> The first method has the disadvantage to bind the application to a specific DOM Events implementation while the second method is a generic one and can be used with any DOM Level 3 Events implementation.  </s>
<s> Interface DocumentEvent (introduced in DOM Level 2) The DocumentEvent interface provides a mechanism by which the user can create an Event object of a type supported by the implementation.  </s>
<s> It is expected that the DocumentEvent interface will be implemented on the same object which implements the Document interface in an implementation which supports the Event model.  </s>
<s> IDL Definition // Introduced in DOM Level 2: interface DocumentEvent { Event createEvent(in DOMString eventType) raises(DOMException); // Introduced in DOM Level 3: EventListenerGroup createEventListenerGroup(); // Introduced in DOM Level 3: boolean canDispatch(in DOMString namespaceURI, in DOMString type); Methods canDispatch introduced in DOM Level 3 Test if the implementation will generate events of a specified type.  </s>
<s> Parameters namespaceURI of type DOMString Specifies the Event.namespaceURI of the event.  </s>
<s> type of type DOMString Specifies the Event.type of the event.  </s>
<s> Return Value boolean true if the implementation will generate and dispatch this event type, false otherwise.  </s>
<s> No Exceptions createEvent Parameters eventType of type DOMString The eventType parameter specifies the name of the DOM Events interface to be supported by the created event object, e.g. "Event", "MouseEvent", "MutationEvent" ... If the Event is to be dispatched via the dispatchEvent method the appropriate event init method must be called after creation in order to initialize the Event's values.  </s>
<s> As an example, a user wishing to synthesize some kind of UIEvent would call createEvent with the parameter "UIEvent".  </s>
<s> The initUIEventNS method could then be called on the newly created UIEvent object to set the specific type of user interface event to be dispatched, {"http://www.w3.org/2001/xml-events", "DOMActivate"} for example, and set its context information, e.g. detail in this example.  </s>
<s> The createEvent method is used in creating Events when it is either inconvenient or unnecessary for the user to create an Event themselves.  </s>
<s> In cases where the implementation provided Event is insufficient, users may supply their own Event implementations for use with the dispatchEvent method.  </s>
<s> However, the DOM implementation needs access to the attributes currentTarget and eventPhase of the Event interface to propagate appropriately the event in the DOM tree.  </s>
<s> Therefore users Event implementation might need to support the CustomEvent interface for that effect.  </s>
<s> Note: For backward compatibility reason, "UIEvents", "MouseEvents", "MutationEvents", and "HTMLEvents" feature names are valid values for the parameter eventType and represent respectively the interfaces "UIEvent", "MouseEvent", "MutationEvent", and "Event".  </s>
<s> Return Value Event The newly created event object.  </s>
<s> Exceptions DOMException NOT_SUPPORTED_ERR: Raised if the implementation does not support the Event interface requested.  </s>
<s> createEventListenerGroup introduced in DOM Level 3 This method creates a new EventListenerGroup for use in the addEventListenerNS and removeEventListenerNS methods of the EventTarget interface (see also Stopping the event flow).  </s>
<s> Return Value EventListenerGroup The newly created EventListenerGroup object.  </s>
<s> No Parameters No Exceptions Interface CustomEvent (introduced in DOM Level 3) The CustomEvent interface gives access to the attributes Event.currentTarget and Event.eventPhase.  </s>
<s> It is intended to be used by the DOM Events implementation to access the underlying current target and event phase while dispatching the event in the tree.  </s>
<s> The methods contained in this interface are not intended to be used by a DOM application, especially during the dispatch on the Event object.  </s>
<s> Changing the current target or the current phase may conduct into unpredictable results of the event flow.  </s>
<s> The DOM Events implementation should invoke both methods before invoking each event listener on the current target to protect DOM applications from malicious event listeners.  </s>
<s> IDL Definition // Introduced in DOM Level 3: interface CustomEvent : Event { void setCurrentTarget(in Node target); void setEventPhase(in unsigned short phase); Methods setCurrentTarget The setCurrentTarget method is used by the DOM Events implementation to change the value of Event.currentTarget.  </s>
<s> Parameters target of type Node Specifies the new value for the Event.currentTarget attribute.  </s>
<s> No Return Value No Exceptions setEventPhase The setEventPhase method is used by the DOM Events implementation to change the value of Event.eventPhase.  </s>
<s> Parameters phase of type unsigned short Specifies the new value for the Event.eventPhase attribute.  </s>
<s> No Return Value No Exceptions Philippe  </s>
<s> Philippe, Thanks for the new text explaining CustomEvent.  </s>
<s> It is indeed much clearer.  </s>
<s> My only suggestion is that you rewrite the sentences beginning with "This problem could be resolved using two techniques...".  </s>
<s> This part of the text is a distraction discussion of options considered in the design, rather than a simple description of the final specification.  </s>
<s> David Flanagan  </s>

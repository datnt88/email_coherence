Amaya has an XML parsing issue that causes it to not report an error that should be reported in order to be conformant From XML spec: [Definition: *Validating processors* must, at user option, report violations of the constraints expressed by the declarations in the DTD http://www.w3.org/TR/REC-xml#dt-doctype , and failures to fulfill the validity constraints given in this specification.] 
To accomplish this, validating XML processors must read and process the entire DTD and all external parsed entities referenced in the document.. 
By that definition (if Amaya uses a validating XML processor), it must report if whitespace appears before the XML declaration. 
[1] |document| ::= |prolog http://www.w3.org/TR/REC-xml#NT-prolog element http://www.w3.org/TR/REC-xml#NT-element Misc http://www.w3.org/TR/REC-xml#NT-Misc *| [22] |prolog| ::= |XMLDecl http://www.w3.org/TR/REC-xml#NT-XMLDecl ?Misc http://www.w3.org/TR/REC-xml#NT-Misc * (doctypedecl http://www.w3.org/TR/REC-xml#NT-doctypedecl Misc http://www.w3.org/TR/REC-xml#NT-Misc *)?| [23] |XMLDecl| ::= |' ?xml' 
VersionInfo http://www.w3.org/TR/REC-xml#NT-VersionInfo EncodingDecl http://www.w3.org/TR/REC-xml#NT-EncodingDecl ? 
SDDecl http://www.w3.org/TR/REC-xml#NT-SDDecl ? 
S http://www.w3.org/TR/REC-xml#NT-S ? 
'? '| Notice that according to the above excerpts, there can be no whitespace before an XML declaration. 
To reproduce: 1. Create an XHTML document. 
2. Edit it in source view to add a space before ?xml. Actual Results: The document is parsed as if that constraint was not there. 
Expected Results: A message similar to the following should be given: XML Parsing Error: xml processing instruction not at start of external entity Location: file:///F:/Documents%20and%20Settings/Brant%20Gurganus/My%20Documents/Personal/brant.xhtml 
Line Number 1, Column 2: ?xml 
version="1.0" 
encoding="UTF-8"? 
Please not that the above sample is from Mozilla which is not a validating processor and by the definition of such is not required to check for this. 
Brant Langer Gurganus 
This hasn't got anything to do with validity, but with well-formedness, so Amaya must report the error anyway. 
The productions seem to be clear, however, Opera und IE don't complain about whitespace either in XML mode. 
Actually I believe it is just validating processors that must report it because the error is outside the document root and non-validating processors only need to check well-formedness within the document root. 
"Non-validating processors are required to check only the document entity http://www.w3.org/TR/REC-xml#dt-docent , including the entire internal DTD subset, for well-formedness." 
"The *document entity* serves as the root of the entity tree and a starting-point for an XML processor http://www.w3.org/TR/REC-xml#dt-xml-proc ." 
It sounds to me that the XML prolog is outside the document entity. 
Although I am still unclear on what exactly the document entity is, so I might have this wrong. 
Brant Langer Gurganus 
Hello Brant, This bug is now fixed. 
Actually, it was due to a modification I made before the last release to manage the BOM issue. 
Amaya 'only' uses a well-formedness processor for XML documents and checks validity for some known formats like XHTML, SVG and MathML. 
Regards, Laurent Carcone 

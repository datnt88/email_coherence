<s> Amaya has an XML parsing issue that causes it to not report an error that should be reported in order to be conformant From XML spec: [Definition: *Validating processors* must, at user option, report violations of the constraints expressed by the declarations in the DTD http://www.w3.org/TR/REC-xml#dt-doctype , and failures to fulfill the validity constraints given in this specification.]  </s>
<s> To accomplish this, validating XML processors must read and process the entire DTD and all external parsed entities referenced in the document..  </s>
<s> By that definition (if Amaya uses a validating XML processor), it must report if whitespace appears before the XML declaration.  </s>
<s> [1] |document| ::= |prolog http://www.w3.org/TR/REC-xml#NT-prolog element http://www.w3.org/TR/REC-xml#NT-element Misc http://www.w3.org/TR/REC-xml#NT-Misc *| [22] |prolog| ::= |XMLDecl http://www.w3.org/TR/REC-xml#NT-XMLDecl ?Misc http://www.w3.org/TR/REC-xml#NT-Misc * (doctypedecl http://www.w3.org/TR/REC-xml#NT-doctypedecl Misc http://www.w3.org/TR/REC-xml#NT-Misc *)?| [23] |XMLDecl| ::= |' ?xml'  </s>
<s> VersionInfo http://www.w3.org/TR/REC-xml#NT-VersionInfo EncodingDecl http://www.w3.org/TR/REC-xml#NT-EncodingDecl ?  </s>
<s> SDDecl http://www.w3.org/TR/REC-xml#NT-SDDecl ?  </s>
<s> S http://www.w3.org/TR/REC-xml#NT-S ?  </s>
<s> '? '| Notice that according to the above excerpts, there can be no whitespace before an XML declaration.  </s>
<s> To reproduce: 1. Create an XHTML document.  </s>
<s> 2. Edit it in source view to add a space before ?xml. Actual Results: The document is parsed as if that constraint was not there.  </s>
<s> Expected Results: A message similar to the following should be given: XML Parsing Error: xml processing instruction not at start of external entity Location: file:///F:/Documents%20and%20Settings/Brant%20Gurganus/My%20Documents/Personal/brant.xhtml  </s>
<s> Line Number 1, Column 2: ?xml  </s>
<s> version="1.0"  </s>
<s> encoding="UTF-8"?  </s>
<s> Please not that the above sample is from Mozilla which is not a validating processor and by the definition of such is not required to check for this.  </s>
<s> Brant Langer Gurganus  </s>
<s> This hasn't got anything to do with validity, but with well-formedness, so Amaya must report the error anyway.  </s>
<s> The productions seem to be clear, however, Opera und IE don't complain about whitespace either in XML mode.  </s>
<s> Actually I believe it is just validating processors that must report it because the error is outside the document root and non-validating processors only need to check well-formedness within the document root.  </s>
<s> "Non-validating processors are required to check only the document entity http://www.w3.org/TR/REC-xml#dt-docent , including the entire internal DTD subset, for well-formedness."  </s>
<s> "The *document entity* serves as the root of the entity tree and a starting-point for an XML processor http://www.w3.org/TR/REC-xml#dt-xml-proc ."  </s>
<s> It sounds to me that the XML prolog is outside the document entity.  </s>
<s> Although I am still unclear on what exactly the document entity is, so I might have this wrong.  </s>
<s> Brant Langer Gurganus  </s>
<s> Hello Brant, This bug is now fixed.  </s>
<s> Actually, it was due to a modification I made before the last release to manage the BOM issue.  </s>
<s> Amaya 'only' uses a well-formedness processor for XML documents and checks validity for some known formats like XHTML, SVG and MathML.  </s>
<s> Regards, Laurent Carcone  </s>

fn:distinct-values does not say how values of type xdt:untypedAtomic are handled. 
I suggest we use the same rule that we use for aggregate functions, namely "Values of type xdt:untypedAtomic are cast to the type of the other items in $arg. 
If all values in $arg are of type xdt:untypedAtomic they are converted to xs:string." 
But we have other threads that point out that this is a really bad rule, because it prevents a pipelined implementation. 
It must be possible to 
process untypedAtomic values without looking ahead to discover the types of 
all other items in the sequence. 
This means that each aggregate function 
must have a "default type", and untypedAtomic values should be converted to 
the default type. 
For fn:distinct-values, the only sensible default type is string. 
Michael Kay 
I think the rules for fn:distinct-values should be: 
* untypedAtomic values are cast to string 
* non-comparable values are allowed, and treated as distinct 
Michael Kay 
-----Original Message----- From: Ashok Malhotra Sent: Sunday, August 10, 2003 8:30 AM Subject: RE: MS-FO-LC1-100: Promotion of untyped values in 
fn:distinct- 
are 
handled. 
I suggest we use the same rule that we use for aggregate functions, namely "Values of type xdt:untypedAtomic are cast to the 
of the other items in $arg. 
If all values in $arg are of type xdt:untypedAtomic they are converted to xs:string." 
All the best, Ashok 
-----Original Message----- From: public-qt-comments-request@w3.org 
[mailto:public-qt-comments- 
request@w3.org] On Behalf Of 
Michael Rys 
Sent: Wednesday, July 09, 2003 2:33 AM Subject: MS-FO-LC1-100: Promotion of untyped values in 
fn:distinct- 
Class: Technical Section 15.1.11: 
Are values of type xdt:untypedAtomic promoted? 
If 
so 
how? 
*untypedAtomic values are cast to string Just for comparison or also in the result? 
Good question. 
Since the most likely scenario is that if any values are untyped, then all values are untyped, it probably makes most sense to leave them as untyped in the result. 
Michael Kay Michael From: Kay, Michael [mailto:Michael.Kay@softwareag.com] 
Subject: RE: MS-FO-LC1-100: Promotion of untyped values in fn:distinct-values? 
I think the rules for fn:distinct-values should be: * untypedAtomic values are cast to string * non-comparable values are allowed, and treated as distinct Michael Kay 
-----Original Message----- From: Ashok Malhotra Sent: Sunday, August 10, 2003 8:30 AM Subject: RE: MS-FO-LC1-100: Promotion of untyped values in 
fn:distinct- 
handled. 
I suggest we use the same rule that we use for aggregate functions, namely "Values of type xdt:untypedAtomic are cast to the 
of the other items in $arg. 
If all values in $arg are of type xdt:untypedAtomic they are converted to xs:string." 
All the best, Ashok 
-----Original Message----- From: public-qt-comments-request@w3.org 
[mailto:public-qt-comments- mailto:public-qt-comments- 
request@w3.org] On Behalf Of 
Michael Rys 
Sent: Wednesday, July 09, 2003 2:33 AM Subject: MS-FO-LC1-100: Promotion of untyped values in 
fn:distinct- 
Class: Technical Section 15.1.11: 
Are values of type xdt:untypedAtomic promoted? 
If 
so 
how? 

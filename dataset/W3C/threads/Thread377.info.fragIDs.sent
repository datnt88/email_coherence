<s> Matthew Brealey has had problems with his mail configuration, and for some reason his post below -- intended for the Tidy list -- ended up on www-style.  </s>
<s> So I am posting this here on his behalf: Behalf Of Matthew Brealey ONE: Tidy destroys the following example when clean: yes: This has a class that will give this element have a border; older browsers will at least get the indentation.  </s>
<s> To: This has a class that will give this element have a border; older browsers will at least get the indentation.  </s>
<s> When clean: no, this is the (better) result: This has a class that will give this element have a border; older browsers will at least get the indentation.  </s>
<s> However, even this is unsatisfactory, because the author that tidies their  </s>
<s> page in Tidy will be surprised to find their page destroyed in Internet Explorer 3.0 (though not 3.01, 3.02 or 3.03), as used by approximately 3% of the WWW.  </s>
<s> For this browser treats ems as pixels (as indeed do all 3.0?  </s>
<s> versions), which is not of itself catastrophic because it will just not get indentation, but what is a real problem is that it interprets all  </s>
<s> margins as relative to the left of the canvas.  </s>
<s> Thus:  </s>
<s> Default margin -------------|Normal Body will be rendered here  </s>
<s> --|Two pixels in - where tidied OL and UL elements will be placed  </s>
<s> This problem is made even worse when the author has specified a larger-than-normal margin on BODY because the effect is made that much more dramatic.  </s>
<s> The worst of it is that those who deliberately shun CSS (and with very good reason - who wouldn't sacrifice the advantages of maintainability at the altar of pages that actually work - if your pages crash, are made unreadable or don't work due to the abominable support for CSS in browsers, you lose business; if you don't take advantage of the secondary advantages that CSS provides of maintainability, you only lose a few minutes of your time) and who abuse the OL and UL elements will be the  </s>
<s> most affected because they are less likely to have valid div  </s>
<s> style="margin-left: whatever" (or a class) for indentation.  </s>
<s> I would like to see an option to leave the (invalid) OL and UL elements as they are.  </s>
<s> TWO:  </s>
<s> Another thing that need fixing is that Tidy doesn't check that STYLE or LINK rel="stylesheet" declares the type attribute.  </s>
<s> THREE: It is also arguable that it should also give a warning if META http-equiv="Content-Style-Type" content="text/css" is missing when the style attribute is used; however, one author in a million might actually have it as a true HTTP header, so for them such a warning would be erroneous.  </s>
<s> FOUR: Furthermore, something that really annoys me is that when I accidentally omit a closing tag, Tidy thinks that I didn't know that the element couldn't span block elements and therefore inserts literally hundreds of  </s>
<s> (for example) b s and /b s.  </s>
<s> Thus, where I have Some b bold text - accidentally missed off the ' /b ' /p , it thinks that I wanted the boldness to span the whole of the rest of the document, and as a result I have to manually remove the hundreds of tags it adds (on one particularly extreme occasion it converted one of my (very complex and difficult to recreate) test pages into a whole load of PRE elements, and because of restrictions on the elements that can occur within PRE applied my style declarations on BR thereby destroying several hours of work).  </s>
<s> I believe this 'feature' will occur with every block and inline element except for P, DIV, OL, UL, LI, DL, DD and DT.  </s>
<s> I do wish Tidy wouldn't think that its users are idiots and don't know that inline elements can't span block ones and that pre can't enclose  </s>
<s> other block elements, and would simply just add the missing /b , but not  </s>
<s> embolden the rest of the document, or trigger an error and terminate (or even an option idiot - boolean - idiot: yes treats the user like an idiot, idiot: no simply adds the closing tag in its correct location).  </s>
<s> FIVE: As a matter of principle I abhor PRE, since it frequently results in nasty scroll bars, which really annoys viewers of pages.  </s>
<s> However, it can be tiresome when I have a code listing to have to put a br after every line and put in non-breaking spaces for indentation.  </s>
<s> As a result, what I would like is for Tidy to do the task that bores me so: the conversion of PRE into a P element with br and &amp;nbsp; to replace the spaces and carriage returns in the PRE.  </s>
<s> The option to do this should, IMO, be set via a convert-pre option in Tidy's config file.  </s>
<s> This should take the values yes, no or identifier , where identifier is a HTML class, as in p class="identifier" .  </s>
<s> This option is important, since I like my code to have less leading than my P elements, and so therefore the class is useful for doing things like P.code {line-height: 1.2} to reduce my normal P {line-height: 1.5}.  </s>
<s> If the convert-pre option were simply to be made a boolean variable, then yes should result in p class="pre" .  </s>
<s> SIX: Further to this on the subject of pre , Tidy destroys the CSS white-space: pre declaration.  </s>
<s> This is because it does not recognise that in: Some pre formatted text the white space is meaningful.  </s>
<s> To cope with this, I would suggest that if an ID or class begins with should be treated as preformatted (and no, one shouldn't use the PRE attribute for preformatted text, because it gives no indication as to the content of the element - BLOCKCODE and BLOCKSAMP would be good, PRE = bad).  </s>
<s> SEVEN: Action is a required attribute for FORM; Tidy does not point this out.  </s>
<s> EIGHT: Tidy breaks the STYLE element - it converts non-ASCII (or non-whatever encoding the document is expressed as being in) characters such as ?  </s>
<s> to character references, but they aren't valid there.  </s>
<s> Correct would be to express them as a (hexadecimal) CSS escape; e.g., \E1 in this case.  </s>
<s> However, since no browser (except the nascent Mozilla 5) supports them, there is rarely a need to convert them since the CSS nmchar macro allows {nonascii} where {nonascii} is [\200-\377] (Octal codes; the 377 should be read as 4177777 (Octal) (because of Flex limitations)).  </s>
<s> NINE: Similarly ID - it converts characters like ?  </s>
<s> to character references, but as ID is based on the NAME token, character references are not valid there.  </s>
<s> TEN:  </s>
<s> It would be useful for Tidy to check the validity of class and ID tokens; for example, many people use invalid classes such as class="1invalididentifier" or "-invalid" - these will (correctly) be ignored by many browsers.  </s>
<s> Similarly for ID - check that it is a valid SGML  </s>
<s> NAME token.  </s>
<s> ELEVEN: Why doesn't clean: yes remove BASEFONT?  </s>
<s> TWELVE: Tidy's conversion of FONT size="n" is inappropriate.  </s>
<s> For example, font size=1 is mapped to font-size: 70%.  </s>
<s> This is inappropriate because font-size: 70% depends on the font-size of the ancestor, which Tidy does not know, whereas font size=1 is the same wherever it is used in a document.  </s>
<s> Similarly font size="+n" - this is relative to the current font size , and not to the CSS font-size; for example, div style="font-size: 100000px" font size="+2" means 2 more than the current font size - the font-size declaration has no effect.  </s>
<s> Perhaps most seriously, some p font size /p s are mapped to H2, H3, H1.  </s>
<s> This is inappropriate because it is not clean layout - it will wreck any nice heading order (i.e., going from h1 to h2 to h3, etc. according to the structure of the document) that the author has.  </s>
<s> Furthermore, H1 has far more margin than P. In addition, headings vary radically in font size and formatting; for example, in my style sheets I have H1 {margin-left: -4%; margin-top: morethanp; line-height: lessthanp; margin-bottom: lessthanp; font-size: radicallydifferentfromnormal}, so to get the P element mapped to the probably/possibly structurally inappropriate H? element is undesirable.  </s>
<s> THIRTEEN: There is a danger that the classes chosen will be redefined.  </s>
<s> For example: This is text If that were to be tidied, the result would be: This is text .c1  </s>
<s> {font-family: Tahoma} If on a later date the file were to be re-tidied with this: This is text , the result would be: This is text .c1  </s>
<s> {font-family: Verdana} , which would redefine the first example - Tidy does not check to see whether the classes it uses have been used have been used before - it starts from c1 each time it tidies.  </s>
<s> FOURTEEN  </s>
<s> If hide-endtags: yes and clean: yes, Tidy drops highly meaningful BODY tags; for example:  </s>
<s> or body style="background: red" with clean: yes is mapped to: body.c1  </s>
<s> {background: red} , but without any BODY for the class to refer to!  </s>
<s> In this case this is appropriate: body {background: red} because the BODY is unique to the document.  </s>
<s> FIFTEEN:  </s>
<s> Why doesn't clean clean TABLE backgrounds?  </s>
<s> SIXTEEN:  </s>
<s> Tidy is destroying my pages - it is adding type="text/javascript" to my SCRIPT language="jscript1.2"  </s>
<s> element.  </s>
<s> Although type is required, if you add it Internet Explorer will ignore the (yes I know deprecated) language attribute, which causes serious problems - there should be an option to stop  </s>
<s> it doing this.  </s>
<s> From Matthew Brealey (http://members.tripod.co.uk/lawnet (for law)or Do You Yahoo!? Talk to your friends online with Yahoo!  </s>
<s> Messenger.  </s>
<s> IMO, this would be a bad idea.  </s>
<s> The purpose of Tidy is to *clean up* invalid (and unwellformed) markup.  </s>
<s> (Note that Tidy inserting 'style="margin-left: 2em"' is, I believe, a bug -- with or without IE3's em-is-a-pixel problem.)  </s>
<s> Agreed.  </s>
<s> Tidy thinks very highly of its users.  </s>
<s> Seriously, the problem has to do with the common HTML-perceived-as-a-formatting-language hack of: That's the mess Tidy was designed to clean up.  </s>
<s> It can't read your mind.  </s>
<s> It does handle a large *majority* of cases with aplomb.  </s>
<s> [ a lot of suggestions re NAME tokens, etc. snipped ]  </s>
<s> Tidy is not (at least at this point in time) an HTML validator.  </s>
<s> I *always* check my my documents with a validator after Tidying.  </s>
<s> Two good online validators are: (Note: the first one above is really excellent -- it allows, for example, file uploading -- but it seems to be down at the moment.) Or try Liam Quinn's excellent (offline) Windows app:  </s>
<s> Then I would not request hide-endtags.  </s>
<s> How should Tidy know what is "meaningful" to you?  </s>
<s> According the HTML DTDs, the endtag for BODY is optional...  </s>
<s> Agreed.  </s>
<s> Also BODY attributes, TD BGCOLOR, etc. Somewhere this was discussed (the Tidy web page?  </s>
<s> here?).  </s>
<s> I think the objection given was that there wasn't enough CSS support in the installed base to warrant it.  </s>
<s> I think a possible solution is to to add "all" as a clean option, so that clean: all moves *everything* presentational to CSS.  </s>
<s> I disagree, for the same reason as given before: Tidy's purpose is to fix invalid markup, not to cowtow to current or future buggy browsers.  </s>
<s> Should Tidy start intentionally emitting invalid [x]HTML, I suspect you'll see its popularity wane.  </s>
<s> /Jelks  </s>
<s> Matthew Brealey seems to be having major problems using Tidy, and I offer my sympathies - we still use Explorer 3 at work, and so I, too, have to resort to "tricks" to get a reasonable result.  </s>
<s> However, Tidy is designed to clean up illegal code, yet he seems to be asking that it leaves it illegal!  </s>
<s> This would defeat the whole object, and I couldn't condone that.  </s>
<s> I would suggest he uses the error output file to see what Tidy believes is wrong, and correct what is reasonable by hand.  </s>
<s> Regards, Peter  </s>
<s> To me, this feature is extremely valuable, as FrontPage 98 in particular  </s>
<s> loves to span block elements with inline ones.  </s>
<s> Tidy does a perfect job in  </s>
<s> cleaning up this auto-generated mess.  </s>
<s> Perhaps what is desired is alternate behavior, depending on whether the HTML source file is generated by hand or by machine.  </s>
<s> As a proposal, (although *not* Tidy's own tag :-) would engender one of two behaviors: the  </s>
<s> current insertion of extra inline tags if the GENERATOR tag is present  </s>
<s> (implying a machine-generated source), and simple termination of the inline element if the GENERATOR tag is absent.  </s>
<s> -- Dave Bryan  </s>
<s> their  </s>
<s> as  </s>
<s> IMO, this would be a bad idea.  </s>
<s> The purpose of Tidy is to *clean up* invalid (and unwellformed) markup.  </s>
<s> (Note that Tidy inserting 'style="margin-left: 2em"' is, I believe, a bug -- with or without IE3's em-is-a-pixel problem.)  </s>
<s> Agreed.  </s>
<s> Tidy thinks very highly of its users.  </s>
<s> Seriously, the problem has to do with the common HTML-perceived-as-a-formatting-language hack of: p This paragraph will be italicized, because italics is on.  </s>
<s> /p p And so will this one.  </s>
<s> /p p Italics has now been turned off.  </s>
<s> /p That's the mess Tidy was designed to clean up.  </s>
<s> It can't read your mind.  </s>
<s> It does handle a large *majority* of cases with aplomb.  </s>
<s> [ a lot of suggestions re NAME tokens, etc. snipped ]  </s>
<s> Tidy is not (at least at this point in time) an HTML validator.  </s>
<s> I *always* check my my documents with a validator after Tidying.  </s>
<s> Two good online validators are: (Note: the first one above is really excellent -- it allows, for example, file uploading -- but it seems to be down at the moment.) Or try Liam Quinn's excellent (offline) Windows app:  </s>
<s> Then I would not request hide-endtags.  </s>
<s> How should Tidy know what is "meaningful" to you?  </s>
<s> According the HTML DTDs, the endtag for BODY is optional...  </s>
<s> Agreed.  </s>
<s> Also BODY attributes, TD BGCOLOR, etc. Somewhere this was discussed (the Tidy web page?  </s>
<s> here?).  </s>
<s> I think the objection given was that there wasn't enough CSS support in the installed base to warrant it.  </s>
<s> I think a possible solution is to to add "all" as a clean option, so that clean: all moves *everything* presentational to CSS.  </s>
<s> stop  </s>
<s> I disagree, for the same reason as given before: Tidy's purpose is to fix invalid markup, not to cowtow to current or future buggy browsers.  </s>
<s> Should Tidy start intentionally emitting invalid [x]HTML, I suspect you'll see its popularity wane.  </s>
<s> /Jelks  </s>
<s> To me, this feature is extremely valuable, as FrontPage 98 in particular  </s>
<s> loves to span block elements with inline ones.  </s>
<s> Tidy does a perfect job in  </s>
<s> cleaning up this auto-generated mess.  </s>
<s> Perhaps what is desired is alternate behavior, depending on whether the HTML source file is generated by hand or by machine.  </s>
<s> As a proposal, (although *not* Tidy's own tag :-) would engender one of two behaviors: the current insertion of extra inline tags if the GENERATOR tag is present (implying a machine-generated source), and simple termination of the inline element if the GENERATOR tag is absent.  </s>
<s> -- Dave Bryan  </s>
<s> Matthew Brealey seems to be having major problems using Tidy, and I offer my sympathies - we still use Explorer 3 at work, and so I, too, have to resort to "tricks" to get a reasonable result.  </s>
<s> However, Tidy is designed to clean up illegal code, yet he seems to be asking that it leaves it illegal!  </s>
<s> This would defeat the whole object, and I couldn't condone that.  </s>
<s> I would suggest he uses the error output file to see what Tidy believes is wrong, and correct what is reasonable by hand.  </s>
<s> Regards, Peter  </s>
<s> How about an option to suppress the duplication of inlines  </s>
<s> across block elements?  </s>
<s> Note that this behavior is there to  </s>
<s> ensure that cleaned markup renders the same as uncleaned markup in existing browsers.  </s>
<s> It can sometimes be a pain when editing a document in a plain text editor.  </s>
<s> Regards, -- Dave Raggett dsr@w3.org  </s>
<s> http://www.w3.org/People/Raggett World Wide Web Consortium (on assignment from HP Labs)  </s>
<s> I think the consensus here was that differentiating "machine-generated" markup (where a block tag is often incorrectly spanned by an inline tag, and therefore where the inline should be duplicated in the next block) from "hand-generated" markup (where an inline fails to terminate at the next block tag due to inadvertent omission of the terminating tag, and therefore where the inline termination should be inserted) wasn't easily possible from the HTML context.  </s>
<s> Therefore, a configuration option to choose one of these two behaviors would be welcome (with the current behavior as the default -- principle of least surprise).  </s>
<s> -- Dave  </s>

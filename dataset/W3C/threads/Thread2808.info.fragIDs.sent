<s> I got this from wget maintainer.  </s>
<s> As far as I know, proxies aren't supposed to append anything to the requested resource.  </s>
<s> However, I've been off-line for more than a year and I haven't digested the most recent HTTP spec.  </s>
<s> So, could someone tell me if this is legal?  </s>
<s> ----- Forwarded message from Hrvoje Niksic hniksic@srce.hr  </s>
<s> ----- Sender: hniksic@public.srce.hr  </s>
<s> Subject: [Simon Munton simonm@m4data.co.uk ] RE: wget 1.5.3 on Windows 98/NT, using MSVC 6 X-Attribution: Hrvoje From: Hrvoje Niksic hniksic@srce.hr  </s>
<s> Date: 25 Sep 1998 13:58:06 +0200 Message-ID: kigiuicz9o1.fsf@jagor.srce.hr  </s>
<s> User-Agent: Gnus/5.070033 (Pterodactyl Gnus v0.33) XEmacs/21.0 (Danish Landrace) ------- Start of forwarded message ------- Message-ID: c=GB%a=_%p=M4DATA%l=M4EXCH-980925091231Z-6978@m4exch.m4data.co.uk From: Simon Munton simonm@m4data.co.uk Subject: RE: wget 1.5.3 on Windows 98/NT, using MSVC 6 Date: Fri, 25 Sep 1998 10:12:31 +0100 MIME-Version: 1.0 Content-Transfer-Encoding: 7bit What seems to happen is this: part way through the download, there is an error, eg timeout, and it seems that in addition MS proxy server sends a text string that gets put on the end of the downloaded file.  </s>
<s> Something like: "HTTP Proxy error: Connection timed out".  </s>
<s> When wget retries, this error message gets left embedded in the downloaded file.  </s>
<s> So the final file looks like: -------Good Data-------- ---HTTP Proxy error message---- -------Good data---- Hope this makes sense.  </s>
<s> If you'd like me to try and find out more specific details of what's going on, let me know.  </s>
<s> Simon Muntonsimonm@m4data.co.uk Somerset, BA5 3DG, England  </s>
<s> I also use wget through Microsoft Proxy server, which has a habit of sending error messages which get appended to the files being downloaded, and when wget retries getting the file, the downloaded file ends up with these messages in the middle.  </s>
<s> I added a couple of changes to ftp.c and http.c (diffs below), so that they 'back up' by 2048 bytes when retrying, thereby getting rid of the error message embedded in the file.  </s>
<s> (2048 seems to work for me).  </s>
<s> I don't understand this part.  </s>
<s> How does the server send these error messages, and exactly how do they get "appended to the files"?  </s>
<s> Hrvoje Niksic hniksic@srce.hr  </s>
<s> | Student at FER Zagreb, Croatia Mix 2 table spoons sugar with 1 spoon salt.  </s>
<s> Put it in a bottle and stick a fuse into it.  </s>
<s> Say "Shit!" when it doesn't detonate.  </s>
<s> ------- End of forwarded message ------- ----- End forwarded message ----- .-. .-. Life is a sexually transmitted disease.  </s>
<s> dave@fly.cc.fer.hr  </s>
<s> From your description, it does sound like a bug in their proxy.  </s>
<s> - Jim  </s>
<s> On the other hand, the proxy detected an error and attempted to report it.  </s>
<s> The question to me would hinge on whether the proxy then did a connection reset or normal close.  </s>
<s> I don't believe that HTTP is well architected for recovering partial transfers or in some cases even detecting incomplete transfers except those initiated by the client.  </s>
<s> Without architected error recovery, its all up to the implementation.  </s>
<s> Dave Morris  </s>
<s> I agree.  </s>
<s> Consider the plight of an HTTP server running a gateway.  </s>
<s> Suppose the gateway (CGI) produces some of its output but doesn't finish in a reasonable amount of time.  </s>
<s> How can the server report an error once it has begun its response?  </s>
<s> I suspect that's more or less what happened to the MS proxy.  </s>
<s> Dave Kristol  </s>
<s> the behavior described below was exhibited in Microsoft Proxy Server 1.0.  </s>
<s> Proxy Server 2.0 'fixes' this by just closing the connection if we get a timeout / reset from the server.  </s>
<s> I also use wget through Microsoft Proxy server, which has  </s>
<s> a habit of  </s>
<s> sending error messages which get appended to the files being downloaded, and when wget retries getting the file, the downloaded file ends up with these messages in the middle.  </s>
<s> I added a  </s>
<s> couple of  </s>
<s> changes to ftp.c and http.c (diffs below), so that they  </s>
<s> 'back up' by  </s>
<s> 2048 bytes when retrying, thereby getting rid of the error message embedded in the file.  </s>
<s> (2048 seems to work for me).  </s>
<s> I don't understand this part.  </s>
<s> How does the server send these error messages, and exactly how do they get "appended to the files"?  </s>
<s> Hrvoje Niksic hniksic@srce.hr  </s>
<s> | Student at FER Zagreb, Croatia Mix 2 table spoons sugar with 1 spoon salt.  </s>
<s> Put it in a bottle and stick a fuse into it.  </s>
<s> Say "Shit!" when it doesn't detonate.  </s>
<s> The proxy is broken.  </s>
<s> The only thing it needs to do to "report" a dropped connection is to close its own connection with the client.  </s>
<s> That is why we have both content-length and the chunked encoding.  </s>
<s> It is all up to the implementation in any case.  </s>
<s> Partial transfers are easily and completely recoverable for HTTP/1.1.  </s>
<s> The only thing it is missing is some indication of the reason why the connection was dropped, but that is hard to do without multiplexing or a separate control channel.  </s>
<s> That was wisely left for a major protocol revision.  </s>
<s> ....Roy  </s>

<s> Hi i am using Jtidy(html tidy) to get a DOM out of some html files and then i get all Links (all Elements with nodename "a").Now i want to take this dom and want it to process with XSLT when i use the following Code i get the following Exception XSLTProcessor processor = XSLTProcessorFactory.getProcessor(); processor.process(new  </s>
<s> XSLTInputSource(doc),new XSLTInputSource(new FileInputStream(xslPath)), new XSLTResultTarget(new FileOutputStream(outputFile))); XSL Error: Cannot use a DTMLiaison for a input DOM node... pass a org.apache.xalan.xpath.xdom.XercesLiaison instead!  </s>
<s> XSL Error: SAX Exception org.apache.xalan.xslt.XSLProcessorException: at org.apache.xalan.xslt.XSLTEngineImpl.error(XSLTEngineImpl.java:1799) at org.apache.xalan.xslt.XSLTEngineImpl.error(XSLTEngineImpl.java:1691)  </s>
<s> atorg.apache.xalan.xslt.XSLTEngineImpl.getSourceTreeFromInput(XSLTEngineImpl.java:919) at org.apache.xalan.xslt.XSLTEngineImpl.process(XSLTEngineImpl.java:643) at DOMToHtmlSerializer.serialize(DOMToHtmlSerializer.java:39) at HtmlLinkValidator.validate(HtmlLinkValidator.java:56) at Main. init (Main.java:44) at Main.main(Main.java:55)  </s>
<s> Ok i thought , if he want it that way i pass a xerces liasion XercesLiaison xl = new XercesLiaison(); XSLTProcessor processor = XSLTProcessorFactory.getProcessor(xl); processor.process(new  </s>
<s> XSLTInputSource(doc),new XSLTInputSource(new FileInputStream(xslPath)), new XSLTResultTarget(new FileOutputStream(outputFile))); than i get the following exception XSL Error: SAX Exception org.apache.xalan.xslt.XSLProcessorException:  </s>
<s> XercesLiaison can not handle nodes of type class org.w3c.tidy.DOMDocumentImpl at org.apache.xalan.xslt.XSLTEngineImpl.error(XSLTEngineImpl.java:1753) at org.apache.xalan.xslt.XSLTEngineImpl.error(XSLTEngineImpl.java:1717) at org.apache.xalan.xslt.XSLTEngineImpl.process(XSLTEngineImpl.java:746) at DOMToHtmlSerializer.serialize(DOMToHtmlSerializer.java:39) at HtmlLinkValidator.validate(HtmlLinkValidator.java:56) at Main. init (Main.java:44) at Main.main(Main.java:55) org.apache.xalan.xslt.XSLProcessorException:  </s>
<s> XercesLiaison can not handle nodes of type class org.w3c.tidy.DOMDocumentImpl " Why is JTidy using its own DOMDocumentImpl(org.w3c.tidy.DOMDocumentImp) and not the DOMDocumentImpl from w3c(org.w3c.dom.DOMDocumentImp) ?? ( This would have saved my a lot of time  </s>
<s> Now what can i do ?  </s>
<s> Solution 1: write the tidy-dom to disk and the reparse it with any xml-parser , and the process it Solution 2. write a wrapper wich changes the tidy-dom to an pure org.w3c.dom.Document and then process it Solution 3 : Search for another tool doing it Hmm can anyone of u , especially the developers of this too / libraryl, tell me what to do?  </s>
<s> Hello The answer is fairly simple: tidy's DOM implementation is not compatible with W3C recommendation.  </s>
<s> BR VA PS I think you should write a translator from tidy's implementation into standard one (just copy the tree).  </s>
<s> Out of dumb curiousity, can anyone familiar w/ JTidy internals tell us what  </s>
<s> are the major impediments to W3C DOM compatibility?  </s>
<s> Hello The answer is fairly simple: tidy's DOM implementation is not compatible with W3C recommendation.  </s>
<s> BR VA PS I think you should write a translator from tidy's implementation into standard one (just copy the tree).  </s>
<s> We have several issues here.  </s>
<s> First, are the DOM classes that are shipped with JTidy itself.  </s>
<s> With the exception of the DOMException class, the rest of the stuff in the DOM package are all interfaces.  </s>
<s> There is no problem at all with deleting these classes and replacing them with the official W3C DOM classes and, in fact, I'll do that shortly.  </s>
<s> The next problem that we have is developing implementations for each of those interfaces so that we can implement DOM support.  </s>
<s> JTidy is a faithful port of the released version of HTML Tidy (more on this later).  </s>
<s> So, the JTidy parse tree mirrors the c Tidy parse tree.  </s>
<s> This  </s>
<s> tree is NOT a DOM tree but is a specialized HTML tree which suits Tidy's purposes.  </s>
<s> In order to maintain compatability with c Tidy and make it easy to  </s>
<s> retrofit maintenance and enhancements from the c version to the java  </s>
<s> version, we have left the tree alone.  </s>
<s> The parse tree is a central data structure and monkeying with it would generate a lot of porting issues.  </s>
<s> So, instead, what Andy did was create a peer node, called an Adapter,  </s>
<s> when needed.  </s>
<s> The idea is that when we needed to represent something in the DOM, we created a DOM node which was basically a thin wrapper on the corresponding Tidy node but which implemented the DOM methods and took  </s>
<s> into account the differences between the Tidy node tree structure and the DOM node tree structure.  </s>
<s> The Adapter node contains a reference to  </s>
<s> the Tidy node and vice-versa and the DOM nodes are only created as  </s>
<s> needed so there is no overhead if you're not using the DOM support.  </s>
<s> This is how things were when Andy was unable to continue with the JTidy development.  </s>
<s> Along came DOM level 2 and more and more requests for DOM 1 features that were not implemented in the initial release.  </s>
<s> In addition,  </s>
<s> we had people using XalanJ1, for example, that needed a separate liaison  </s>
<s> class to interface with each DOM model so someone would have needed to  </s>
<s> create a TidyLiaison to support Xalan.  </s>
<s> As a result of the increasing feature set and complexity of the DOM, I suggested that it would be a good idea to just have JTidy implement the SAX2 XMLReader interface so that it could throw off SAX2 events to a SAX2 ContentHandler.  </s>
<s> Then, the user could plug in Xerces or whatever other XML parser implementation they wanted, provided that it supplied a ContentHandler, which Xerces does, and build their own DOM tree and have a real DOM and JTidy wouldn't have to worry about keeping up with all of  </s>
<s> the DOM features.  </s>
<s> As a bonus, you'd get SAX2 support as well.  </s>
<s> This way, JDOM could be supported as well, I believe, using their SAXBuilder.  </s>
<s> Down the road it would be nice for Tidy to implement JAXP as well but  </s>
<s> that's another story.  </s>
<s> I merrily started coding up the XMLReader support last December but have been delayed for several reasons.  </s>
<s> I am now almost in a position to get back into it in a few more days and I hope to have it ready about two  </s>
<s> weeks after that.  </s>
<s> For now, the next best thing is to write out the XHTML output from Tidy  </s>
<s> and then read it in using your favorite XML parser.  </s>
<s> It's not a fantastic solution but it does work.  </s>
<s> In the meantime, I've followed with great interest the impressive activity over on SourceForge and on this list as well with respect to the HTML Tidy project.  </s>
<s> Of course, we'd like to port over the  </s>
<s> improvements and changes to HTML Tidy at some point.  </s>
<s> I haven't seen any mention of a release schedule.  </s>
<s> Have I just missed this discussion.  </s>
<s> I'd rather wait until the HTML Tidy folks get to a point where you're comfortable with the stability and feature set and ready for a release rather than trying to port the changes over as they occur and try to hit a moving target.  </s>
<s> Sorry this post was so long but I didn't have time to make it shorter :) Gary  </s>
<s> We would love to have you involved!  </s>
<s> We haven't discussed any release schedule yet - there is plenty more to do  </s>
<s> with what is already on our plate.  </s>
<s> But speaking for myself, I was thinking the following : 1) Finish importing known bug reports up to 1st June 2001 - I expect this will take another week or 2. 2) Get as many of these bugs fixed as possible (Sebastian Lange will be back from vacation tomorrow, hint hint grin ). 3) Import Dave Raggett's latest changes into the source code base.  </s>
<s> 4) Release a new version.  </s>
<s> I can't see that happening at the current rate until probably August.  </s>
<s> 5) Import bugs reports from past 1st June 2001.  </s>
<s> 6) Start seriously thinking about a library version of Tidy.  </s>
<s> 7) Fix more bugs, possibly implement some of the feature requests, and items on Dave Raggett's pending list.  </s>
<s> 8) Release, lather, rinse, repeat... Comments?  </s>
<s> Regards, Terry  </s>
<s> Hi thx you for your long posting , it was found it really intersting to get to know how tidy works and why they have their own DOM-implementation  </s>
<s> Hmm i was already doing i that way but i thought there would be another solution for this problem.  </s>
<s> Bye, Holger  </s>
<s> Hi Gary, Thanks for this background.  </s>
<s> Clearly, you have given the subject a great deal of careful thought.  </s>
<s> The SAX-based approach makes a great deal of sense.  </s>
<s> DOM compatibility is an issue for the C version of Tidy as well.  </s>
<s> You may  </s>
<s> have noticed the discussions on this list.  </s>
<s> For much the same reasons, these discussions seemed to gravitate to the SAX adapter method as well.  </s>
<s> I think the tracking issue will go both ways.  </s>
<s> I think we should look to JTidy for direction on the library interface and implementation.  </s>
<s> Ditto for  </s>
<s> the SAX adapter, of course.  </s>
<s> take it easy, Charlie We have several issues here.  </s>
<s> First, are the DOM classes that are shipped with JTidy itself.  </s>
<s> With the exception of the DOMException class, the rest of the stuff in the DOM package are all interfaces.  </s>
<s> There is no problem at  </s>
<s> all with deleting these classes and replacing them with the official W3C DOM  </s>
<s> classes and, in fact, I'll do that shortly.  </s>
<s> The next problem that we have is developing implementations for each of those interfaces so that we can implement DOM support.  </s>
<s> JTidy is a  </s>
<s> faithful port of the released version of HTML Tidy (more on this later).  </s>
<s> So, the JTidy parse tree mirrors the c Tidy parse tree.  </s>
<s> This tree is NOT a  </s>
<s> DOM tree but is a specialized HTML tree which suits Tidy's purposes.  </s>
<s> In order to maintain compatability with c Tidy and make it easy to retrofit  </s>
<s> maintenance and enhancements from the c version to the java version, we have  </s>
<s> left the tree alone.  </s>
<s> The parse tree is a central data structure and monkeying with it would generate a lot of porting issues.  </s>
<s> So, instead, what Andy did was create a peer node, called an Adapter, when  </s>
<s> needed.  </s>
<s> The idea is that when we needed to represent something in the DOM, we created a DOM node which was basically a thin wrapper on the corresponding Tidy node but which implemented the DOM methods and took into  </s>
<s> account the differences between the Tidy node tree structure and the DOM node tree structure.  </s>
<s> The Adapter node contains a reference to the Tidy node  </s>
<s> and vice-versa and the DOM nodes are only created as needed so there is no overhead if you're not using the DOM support.  </s>
<s> This is how things were when Andy was unable to continue with the JTidy development.  </s>
<s> Along came DOM level 2 and more and more requests for DOM 1 features that were not implemented in the initial release.  </s>
<s> In addition, we  </s>
<s> had people using XalanJ1, for example, that needed a separate liaison class  </s>
<s> to interface with each DOM model so someone would have needed to create a TidyLiaison to support Xalan.  </s>
<s> As a result of the increasing feature set and complexity of the DOM, I suggested that it would be a good idea to just have JTidy implement the SAX2 XMLReader interface so that it could throw off SAX2 events to a SAX2 ContentHandler.  </s>
<s> Then, the user could plug in Xerces or whatever other XML parser implementation they wanted, provided that it supplied a ContentHandler, which Xerces does, and build their own DOM tree and have a real DOM and JTidy wouldn't have to worry about keeping up with all of the  </s>
<s> DOM features.  </s>
<s> As a bonus, you'd get SAX2 support as well.  </s>
<s> This way, JDOM could be supported as well, I believe, using their SAXBuilder.  </s>
<s> Down the road it would be nice for Tidy to implement JAXP as well but that's  </s>
<s> another story.  </s>
<s> I merrily started coding up the XMLReader support last December but have been delayed for several reasons.  </s>
<s> I am now almost in a position to get back into it in a few more days and I hope to have it ready about two weeks  </s>
<s> after that.  </s>
<s> For now, the next best thing is to write out the XHTML output from Tidy and  </s>
<s> then read it in using your favorite XML parser.  </s>
<s> It's not a fantastic solution but it does work.  </s>
<s> In the meantime, I've followed with great interest the impressive activity over on SourceForge and on this list as well with respect to the HTML Tidy project.  </s>
<s> Of course, we'd like to port over the improvements and changes to  </s>
<s> HTML Tidy at some point.  </s>
<s> I haven't seen any mention of a release schedule.  </s>
<s> Have I just missed this discussion.  </s>
<s> I'd rather wait until the HTML Tidy folks get to a point where you're comfortable with the stability and feature  </s>
<s> set and ready for a release rather than trying to port the changes over as they occur and try to hit a moving target.  </s>
<s> Sorry this post was so long but I didn't have time to make it shorter :) Gary  </s>
<s> what  </s>
<s> Well, you're welcome to look at the JTidy DOM implementation, though I hope to deprecate it when the SAX support gets established.  </s>
<s> We're on sourceforge as JTidy.  </s>
<s> Gary  </s>
<s> I've looked at it, but not in depth.  </s>
<s> Thanks to Terry's hard work, I'm behind on my Tidy bug list grin .  </s>
<s> So I'll wait patiently to see you bring out for SAX.  </s>
<s> Charlie Well, you're welcome to look at the JTidy DOM implementation, though I hope to deprecate it when the SAX support gets established.  </s>
<s> We're on sourceforge as JTidy.  </s>
<s> Gary  </s>
<s> for  </s>
<s> at  </s>
<s> DOM  </s>
<s> a  </s>
<s> retrofit  </s>
<s> have  </s>
<s> into  </s>
<s> node  </s>
<s> we  </s>
<s> class  </s>
<s> the  </s>
<s> that's  </s>
<s> weeks  </s>
<s> and  </s>
<s> to  </s>
<s> schedule.  </s>
<s> feature  </s>
<s> Holger -- First, you are using an old version of XalanJ.  </s>
<s> I would recommend upgrading to the current version as soon as you can.  </s>
<s> The old version requires a Liaison class and none has been constructed for Tidy that I know of.  </s>
<s> A XercesLiaison will not work with the JTidy DOM.  </s>
<s> Second, I've explained how the Tidy DOM works in another email.  </s>
<s> It builds its own nodes which are wrapped with a small set of small DOM interface classes.  </s>
<s> You ask why we don't use the W3C implementation classes like org.w3c.dom.DOMDocumentImp.  </s>
<s> The fact is that there are no W3C implementation classes as far as I know.  </s>
<s> The w3c simply provides interfaces here, not concreate implementations.  </s>
<s> For now, you're sort of stuck with your solution 1. HTH, Gary  </s>
<s> In my first HTML::Parser::Tidy hack, I had something like void _process_tree(CHANDLER* hdl, Lexer *lexer, Node *node) { Node *content; if (node == null) return; if (node- type == TextNode) _fire_characters_e(hdl- handlers[E_CHARACTERS], lexer, node); else if (node- type == RootNode) { for (content = node- content; content != null; content = content- next) _process_tree(hdl, lexer, content); else if (node- type == StartTag) { _fire_start_element_e(hdl- handlers[E_START_ELEMENT], node); for (content = node- content; content != null; content = content- next) _process_tree(hdl, lexer, content); _fire_end_element_e(hdl- handlers[E_END_ELEMENT], node); else { printf("uups, type: %d\n", node- type); This traverses the given Tidy Node* and fires the appropriate SAX events to the given Perl SAX handler e.g. to rebuild a DOM structure with XML::Handler::BuildDOM or XML::XPath::Builder, see the XML::Parser::PerlSAX for more informations.  </s>
<s> Something that drove me nuts was this: void _fire_characters_e(SV* handler, Lexer *lexer, Node *node) { HV* hash; STRLEN len = 0; uint i, count, bytes, c = 0, pos = 0; char *p; New(42, p, (node- end - node- start + 6), char); for (i = node- start; i  node- end;) bytes = 1; c = (unsigned char)lexer- lexbuf[i]; if (c  0x7F) { bytes += GetUTF8((unsigned char *)lexer- lexbuf + i, &amp;c); for (count = 0; count  bytes; count++) { p[pos+count] = lexer- lexbuf[i+count]; i += bytes; pos += bytes; p[pos] = '\0'; hash = newHV(); hv_store(hash, "Data", 4, newSVpv(p, len), 0); _fire_event(handler, hash); Safefree(p); Since node- end isn't the real end but the start of the last UTF-8 sequence... Anyway, as you can see, adding SAX support is quite easy.  </s>
<s> I don't think it's a good idea (since it would mean a lot of work with small use) to add DOM support to Tidy.  </s>
<s> If someone is likely to do so anyway, we could have another dom.c that provides this functionality.  </s>
<s> Nearly all information required for DOM Level 1 support is stored in the Node*.  </s>
<s> Bj?rn H?hrmann { mailto:bjoern@hoehrmann.de } http://www.bjoernsworld.de am Badedeich 7 } Telefon: +49(0)4667/981028 { http://bjoern.hoehrmann.de  </s>
<s> 25899 Dageb?ll { PGP Pub.  </s>
<s> KeyID: 0xA4357E78 } http://www.learn.to/quote/  </s>

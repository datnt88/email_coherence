<s> Hi,  </s>
<s> This could likely be a problem that has been debated a lot in the past but I  </s>
<s> would appreciate if someone explained  </s>
<s> (or pointed to a previous explanation on the mailing list or elsewhere) what  </s>
<s> the current thinking is regarding this.  </s>
<s> The ebXML Messaging Services Specification (  </s>
<s> of the ebXML message (an XML structure based on SOAP) and the ds:Signature  </s>
<s> element is embedded into the signed ebXML message.  </s>
<s> The signed ebXML message is subject to modification, passing through a sequence of intermediary SOAP and ebXML processors before reaching the ultimate recipient, which also validates the signature.  </s>
<s> One such modification that is difficult to predict is change in whitespace (indentation, CRLF characters) in the ebXML message.  </s>
<s> The ds:SignedInfo element is itself subject to such modification (being part of the ebXML message).  </s>
<s> A proposed modification to the ebXML Messaging Specification suggests this XSL transform in the ds:Reference element: xsl:stylesheet version="1.0"  </s>
<s> xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xsl:strip-space elements='*'/ !-- Strip trivial whitespace in all elements.  </s>
<s> -- the signature has been made robust to changes in trivial whitespace in the ebXML message but outside the embedded ds:SignedInfo elements.  </s>
<s> However, because the ds:SignedInfo elements are not processed by any XSL transform (but by  </s>
<s> the algorithm specified in ds:CanonicalizationMethod, for which we are using  </s>
<s> whitespace in ds:SignedInfo invalidates the signature.  </s>
<s> To give some context on how ebXML Messaging uses XMLDSIG, I have included an  </s>
<s> sample signature element (taken from an ebXML example in the ebXML specification), later in this email.  </s>
<s> The first guess would be that by using a 'smarter' canonicalization algorithm for the ds:SignedInfo element, the ds:SignedInfo  </s>
<s> element can also be made robust to changes in trivial whitespace.  </s>
<s> Rather than use the schema-unaware canonicalization  </s>
<s> algorithm ( http://www.w3.org/TR/2001/REC-xml-c14n-20010315 ), it would seem  </s>
<s> that a different canonicalization algorithm  </s>
<s> could be written which, being aware of the XMLDSIG schema, could do a better  </s>
<s> job of eliminating trivial whitespace.  </s>
<s> This 'smarter' CanonicalizationMethod algorithm might certainly not be smart  </s>
<s> enough to always know whether a particular whitespace character is significant or not.  </s>
<s> However, if such an algorithm was created that simply removed all whitespace where an element has textual content consisting entirely of whitespace (the kind xsl:strip-space would remove), people that don't have  </s>
<s> very sophisticated Transform elements (that could get mangled) would be able  </s>
<s> to benefit from it.  </s>
<s> In other words, a 'smarter' XMLDSIG schema-aware CanonicalizationMethod algorithm could be published with the caveat that changes in whitespace in descendants of ds:SignedInfo would become irrelevant.  </s>
<s> In situations where this might be a problem,  </s>
<s> the earlier schema-unaware canonicalization algorithm could be used instead.  </s>
<s> Just as an example, the stylesheet presented earlier, which is a parameter  </s>
<s> to the ds:Transform element does not contain any whitespace that needs to be preserved and so a CanonicalizationMethod algorithm that removed all trivial whitespace would not hurt us but actually benefit us a lot.  </s>
<s> Here is a typical Signature element, as it is used by the ebXML Messaging Specification.  </s>
<s> CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/ SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#dsa-sha1"/ Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/ Transform Algorithm="http://www.w3.org/TR/1999/REC-xpath-19991116" not(ancestor-or-self::()[@SOAP:actor= urn:oasis:names:tc:ebxml-msg:actor:nextMSH]  </s>
<s> ancestor-or-self::()[@SOAP:actor=  </s>
<s> http://schemas.xmlsoap.org/soap/actor/next])  </s>
<s> Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/ DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/ DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/  </s>
<s> I was just trying to convey my thoughts on this matter.  </s>
<s> Thanks for taking the time to read this email.  </s>
<s> Regards, Sanjay J. Cherian Sterling Commerce Irving, TX  </s>
<s> Hi Sanjay, The "meta" question of allowing transforms over SignedInfo certainly has  </s>
<s> been a topic of discussion in the past with some advocating for this functionality.  </s>
<s> However, the option we proceeded with was to avoid such complexity in the core xmldsig processing and to limit processing to a  </s>
<s> handful of well specified and vetted canonicalizations instead of arbitrary  </s>
<s> transforms.  </s>
<s> I expect proposals for infoset and schema augmented/typed canonicalizations  </s>
<s> to be made eventually.  </s>
<s> I've not considered handling white-space text nodes as you suggest, though I think it would be simple to specify and implement.  </s>
<s> (I wouldn't consider  </s>
<s> it "smarter", just different.  </s>
<s> And what is considered "trivial" to some is  </s>
<s> consider important to others.  </s>
<s> So I'd call it a alternative canonicalization that removes text nodes consisting solely of whitespace characters.)  </s>
<s> Note, I think the behaviour of schema "collapsing" (all whitespace replaced by a single '#x20' ) is different than that specified by xsl:strip-space (actually removes the text node).  </s>
<s> Also, schema collapsing applies to type string (and its derived types) and consequently (I don't think) would collapse the white-space between elements (or mixed content) -- unless I'm missing something else in schema that you are referring to.  </s>
<s> Under what circumstances are you loosing the white space?  </s>
<s> Regardless, why not generate your XML and use xml:space="preserve" at the root?  </s>
<s> That's what it is for!  </s>
<s> smile/ Joseph Reagle Jr. http://www.w3.org/People/Reagle/ W3C Policy Analyst mailto:reagle@w3.org  </s>
<s> IETF/W3C XML-Signature Co-Chair http://www.w3.org/Signature/ W3C XML Encryption Chair http://www.w3.org/Encryption/2001/  </s>
<s> Hi, There are several questions here.  </s>
<s> On Transforming SignedInfo: We deliberately made a general transform chain unavailable on SignedInfo, at least among the mandatory or recommended to implement algorithms, because it is a geneal Artificial Intelligence problem to figure out if such transforms are safe.  </s>
<s> Note that they could completely screw around with all your References, Signature Algorithm, and themsevles.  </s>
<s> So they can trivially arrange for the post-transform  </s>
<s> version signature to always succeed or always fail and to look generally secure.  </s>
<s> So, for any application allowing Transforms over  </s>
<s> SignedIfno to be secure, you probably need a complete description of all allowed sets of Transforms... Anyway, to discourage this, we permitted only CanonnicalizationMethod.  </s>
<s> But, of course, it is an algorithm so it can actually do  </s>
<s> anything. (IE, you could define a CanonicalizationMethod that took a Transforms as an explicit parameter.) On WhiteSpace:  </s>
<s> As I see it, if intermediaries are going to generally reformat things  </s>
<s> to be pretty, then it is kind of hopeless to try to be secure.  </s>
<s> I believe there are actually three types of white space.  </s>
<s> White space inside tags is truly insignificant.  </s>
<s> It isn't even handed to applications.  </s>
<s> Then there is white space in the content of something with element only content that appears between content elements or before the first or after the last content element.  </s>
<s> This is defined by the XML spec as "insignificant", although only a validating parser can tell that.  </s>
<s> Nevertheless, such white space is required to be given to the application.  </s>
<s> Since the application can do anything with it, that it is flagged as "insignificant" has no security meaning.  </s>
<s> And if you have a non-valiating parser or if the element has mixed content, then it doesn't even have this meaningless "insignificant" flag affixed to it.  </s>
<s> Finally, there is actual content white space, which can also be changed if some intermediate node pretty printed a foo bar /a as foo bar for example.  </s>
<s> Your suggestion: If you guys want to define a canonicalization function that deletes all pure white space text nodes and make support of it required for your application, you can do so.  </s>
<s> But I'm not sure of your logic in doing so but not dropping leading and trailing white space and/or changing internal runs of white space to one space or something else canonical.  </s>
<s> And I don't see how this can be safe and secure.  </s>
<s> You may know the schema for SignedInfo but it is harder to know the schema for every parameter of every Transform someone might use.  </s>
<s> Donald From: "Cherian, Sanjay" Sanjay_Cherian@stercomm.com Message-ID: 40AC2C8FB855D411AE0200D0B7458B2B04D636BD@scidalmsg01.csg.stercomm.com  </s>
<s> Date: Thu, 20 Dec 2001 10:32:54 -0600  </s>
<s> Hi, If you want to sign a character string so that it can't change, you are welcome to do so.  </s>
<s> The question is, what is the something you sign?  </s>
<s> XML isn't a character string.  </s>
<s> It is a very complex structure and many aspects of its external character string representation are, by definition, so insignificant that conformant XML paresers are not allowed to communicate then to an application.  </s>
<s> If you want to create binary signatures on binary messages sent through binary channels, where some of the data just happens to be XML, you can secure all the bits.  </s>
<s> If you want to create XML signatures on XML sent through XML channels, a signature securing all the bits is uselessly brittle.  </s>
<s> That's why XML digital signatures, which by definition are in XML syntax and are handled as XML, need various forms of XML canonicalization.  </s>
<s> So the "thing" you sign for XML has to be a canonicalization of the XML or it isn't a useful XML signature.  </s>
<s> Higher level trust and business aspect mechanisms are out of scope for the XMLDSIG working group except possibly as a input to requirements for the base cryptographic facility XMLDSIG provides.  </s>
<s> If you believe that it needs to provide a means of "signing every bit" with no canonicalization, your needs are met because it can be used that way.  </s>
<s> Donald From: Steve Mathews SMathews@conclusive.com Message-ID: 5246684B3A2FD511BE2E00D0B7A9280E1A7601@mailgb01.gb.conclusive.com  </s>
<s> Date: Mon, 7 Jan 2002 13:50:43 -0000  </s>

<s> Hi, I've been running into some issues with XMLDSIG (specifically, portability of signatures) which make it difficult to use in a few situations.  </s>
<s> XPath states that an element's namespace axis includes all non-overridden namespace declarations from all ancestors.  </s>
<s> C14N then states that we must write these out during canonicalization, whether or not they are used.  </s>
<s> This means, as we know, that signatures cannot be successfully moved into documents which have other namespaces in force.  </s>
<s> I have an application that generates signed contracts:  </s>
<s> I then ship the contract off for remote processing: SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"  </s>
<s> The contract signature is now invalid.  </s>
<s> The signer has no knowledge of the enveloping that will be used during transport, if any, so it can't generate a signature that will be valid in this context.  </s>
<s> According to XPath and (I think) the XML info set, when the recipient reads in this SOAP document, every element will receive a namespace axis consisting of all inherited namespace attributes.  </s>
<s> So, my fundamental question is: Is it sufficient for me to de-parent the Contract in DOM for it to lose these inherited namespaces?  </s>
<s> In practice, it is (using one particular parser).  </s>
<s> It is not clear to me whether this is strictly correct according to all the relevant specs.  </s>
<s> Even if it is sufficient for me to do this, is it acceptable that the XML document on the wire isn't signatorially valid, and that the recipient  </s>
<s> must know where to deparent the document for things to become valid?  </s>
<s> I think that this might be worth a paragraph in the spec because I believe it will be a common problem as XMLDSIG becomes more widely adopted.  </s>
<s> Merlin Baltimore Technologies plc will not be liable for direct, special, indirect or consequential damages arising from alteration of the contents of this message by a third party or as a result of any virus being passed on.  </s>
<s> In addition, certain Marketing collateral may be added from time to time to promote Baltimore Technologies products, services, Global e-Security or appearance at trade shows and conferences.  </s>
<s> This footnote confirms that this email message has been swept by Baltimore MIMEsweeper for Content Security threats, including computer viruses.  </s>
<s> Hi Joseph, If we expect interopability over such ported signatures, should we amend the spec with any text to this end?  </s>
<s> A lot of applications won't need to remove a signature from its original location, but it could be useful to add an editors' note to say that moving such signatures to a different context can break a signature due to a change of namespace context, and perhaps that this is necessary due to the impossibility of assessing the namespaces in use by the signed content.  </s>
<s> John Boyer  </s>
<s> Senior Product Architect, Software Development Internet Commerce System (ICS) Team PureEdge Solutions Inc. Trusted Digital Relationships v: 250-708-8047 f: 250-708-8010 1-888-517-2675 http://www.PureEdge.com  </s>
<s> http://www.pureedge.com/  </s>
<s> Hi,  </s>
<s> While it may be true that many apps will not need to move signatures from context to context, many may (unwittingly) do so.  </s>
<s> For example, when transporting signed documents over SOAP to remote Web services.  </s>
<s> I think an editors' note should explicitly state that, in situations like this, signatures must either be computed in their final context, or they must be separated from any new context before verification.  </s>
<s> I'd also like to establish whether the latter is even possible.  </s>
<s> Because if it is not, then the editors' note should recommend that signatures _must_ be computed in their final context.  </s>
<s> I know this is just pedantic and is abundantly clear to us, but I've already encountered interop problems as a result of this, so I'd like to see it made explicit in our spec.  </s>
<s> Take the following signature containing an embedded SOAP envelope: ... soap:Envelope xmlns:soap="&amp;soap;" ... /soap:Envelope ... Embed it in a SOAP envelope for transport to a Web service: ... Signature xmlns="&amp;dsig;" ... soap:Envelope xmlns:soap="&amp;soap;" ... /soap:Envelope ... /Signature ... According to XPath, this is identical to: ... Signature xmlns="&amp;dsig;" ... soap:Envelope ... /soap:Envelope ... /Signature ...  </s>
<s> I'm not sure that an XML parser is required to distinguish between these two documents.  </s>
<s> If it is not, then there is no way to extract this signature from its new context.  </s>
<s> In this case, we should make this clear to potential users of dsig.  </s>
<s> Merlin r/JBoyer@PureEdge.com/2001.05.17/09:03:01  </s>
<s> Baltimore Technologies plc will not be liable for direct, special, indirect or consequential damages arising from alteration of the contents of this message by a third party or as a result of any virus being passed on.  </s>
<s> In addition, certain Marketing collateral may be added from time to time to promote Baltimore Technologies products, services, Global e-Security or appearance at trade shows and conferences.  </s>
<s> This footnote confirms that this email message has been swept by Baltimore MIMEsweeper for Content Security threats, including computer viruses.  </s>
<s> This is definitely an important application scenario.  </s>
<s> Do you mean via specs, or in your implementation?  </s>
<s> (Or do you mean your implementation doesn't distinguish between the two examples you give and you are wondering if others' don't/do?) Regardless, if we expect this to interoperate, I think we have to specify the behavior one way or the other -- and John seems to be advocating that the desired behavior results from the present processing?  </s>
<s> I presume this would be part of the processing in section 3.2.2?  </s>
<s> 3.2.2 Signature Validation 1. Obtain the keying information from KeyInfo or from an external source.  </s>
<s> 2. Obtain the canonical form of the SignatureMethod using the CanonicalizationMethod and use the result (and previously obtained KeyInfo) to validate the SignatureValue over the SignedInfo element.  </s>
<s> /+Note, if the Signature is not the root element of the document, ancestor namespace context, which may change if the Signature is intended to be portable (e.g., transported in an XML message), may affect the canonicalized form of the SignedInfo and consequently its signature validity.  </s>
<s> +/ /+Signatures that are intended to be portable portable signatures must/?/should: 1. be processed in their final context.  </s>
<s> (What exactly is the final context, is this equivalent to the document subset with Signature at it's root?) 2. the Signature should be generated in a particular portable form.  </s>
<s> (Rob's solution wasn't general?  </s>
<s> -- and using the same prefix is rather constraining/hackish?) Joseph Reagle Jr. http://www.w3.org/People/Reagle/ W3C Policy Analyst mailto:reagle@w3.org  </s>
<s> IETF/W3C XML-Signature Co-Chair http://www.w3.org/Signature W3C XML Encryption Chair http://www.w3.org/Encryption/2001/  </s>
<s> Joseph,  </s>
<s> CoreValidation 3.2.2 Signature Validation 1. Obtain the keying information from KeyInfo or from an external source.  </s>
<s> 2. Obtain the canonical form of the SignatureMethod using the CanonicalizationMethod and use the result (and previously obtained KeyInfo) to validate the SignatureValue over the SignedInfo element.  </s>
<s> /+Note, if the Signature is not the root element of the document, ancestor namespace context, which may change if the Signature is intended to be portable (e.g., transported in an XML message), may affect the canonicalized form of the SignedInfo and consequently its signature validity.  </s>
<s> +/ /+Signatures that are intended to be portable portable signatures must/?/should: 1. be processed in their final context.  </s>
<s> (What exactly is the final context, is this equivalent to the document subset with Signature at it's root?) I have not thought a lot about the consequences of the following idea, but anyway: Should we add an additional rule both to the processing rules for signature generation and validation, that the SignedInfo element should be isolated from its context prior to computing the canonicalized representation?  </s>
<s> 2. the Signature should be generated in a particular portable form.  </s>
<s> (Rob's solution wasn't general?  </s>
<s> -- and using the same prefix is rather constraining/hackish?) Liebe Gruesse/Regards, DI Gregor Karlinger Phone +43 316 873 5541 Institute for Applied Information Processing and Communications Austria  </s>
<s> Hi Gregor and Donald, Obviously, I would be an advocate for adding an XPath transform to the C14N transform.  </s>
<s> I proposed this at our third FtF, but it made some people nervous at the time (and I can understand that; better safe than  </s>
<s> sorry).  </s>
<s> However, I think we all know now that the procedure is quite safe provided the following additional step is taken: after a c14n transform's xpath transform, add an implicit transform that ensures the signature element and all of its descendant elements, attributes, and at least the xmldsig namespace are in the resultant node-set.  </s>
<s> W.r.t. the  </s>
<s> problem you are trying to solve, this limits the scope of the XPath to namespace filtering, but with same document signatures, it eliminates the need to have a separate Reference, do a double hash calculation, etc. Cheers, John Boyer  </s>
<s> John,  </s>
<s> I cannot follow here.  </s>
<s> Could you please explain more detailed?  </s>
<s> Thanks, Gregor  </s>

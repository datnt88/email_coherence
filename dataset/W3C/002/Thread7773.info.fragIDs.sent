<s> Looking over the minutes from the Oslo, it appears that the main technical issue on the advanced collection specification was circular bindings.  </s>
<s> We need to try to settle what we want the specification to say about circular bindings.  </s>
<s> Currently, the specification requires servers to detect cycles when processing requests with Depth: infinity, and to respond with 506 (Loop Detected).  </s>
<s> Questions raised at Oslo were: 1. Whether it would be better to prevent circular bindings from being created in the first place.  </s>
<s> There was discussion of the relative costs of preventing cycles for any method that creates a new binding vs. detecting them during Depth: infinity processing.  </s>
<s> Do people have opinions about whether it would be prohibitively expensive to prevent a cycle from being created by BIND or MOVE on a collection?  </s>
<s> There was discussion of possible legitimate uses for cycles.  </s>
<s> Can people offer examples of real scenarios requiring collections to contain themselves (directly or indirectly)?  </s>
<s> 2. Whether we should allow Depth: infinity requests to succeed even when loops are encountered.  </s>
<s> (Possibly a parameter was being suggested, allowing clients to direct the server whether to ignore cycles.) Jason also suggested in earlier e-mail that there is really no reason why a request should fail when it encounters a cycle during Depth: infinity.  </s>
<s> For DELETE, MOVE, COPY, and LOCK if the server can detect the cycle (which is presumed to be easy), it can do the right thing with it and report success.  </s>
<s> For PROPFIND, we could just have the server report 506 for a single response element whenever it encounters a collection for the second time, and not go into that collection.  </s>
<s> Similarly for SEARCH, it seems that the server could simply not search the collection a second time when it encounters a loop, and report success.  </s>
<s> If we decide to let cycles be created, should we change the spec to have Depth: infinity operations succeed?  </s>
<s> Or add a header to let clients specify whether to succeed or fail when a cycle is encountered?  </s>
<s> 3. General uneasiness about the impact of cycles on all methods that can have Depth: infinity, including new ones being introduced in versioning and perhaps in future extensions.  </s>
<s> Can anyone point out specific cases in versioning / configuration management where the existence of cycles might be a problem?  </s>
<s> Or in any other functional area that we might tackle in the future?  </s>
<s> --Judy Judith A. Slein Xerox Corporation jslein@crt.xerox.com  </s>
<s> (716)422-5169 800 Phillips Road 105/50C Webster, NY 14580  </s>
<s> A useful note from Jason.  </s>
<s> Jason also suggested in earlier e-mail that there is really no reason why a request should fail when it encounters a cycle during Depth: infinity.  </s>
<s> For DELETE, MOVE, COPY, and LOCK if the server can detect the cycle (which is presumed to be easy), it can do the right thing with it and report success.  </s>
<s> For PROPFIND, we could just have the server report 506 for a single response element whenever it encounters a collection for the second time, and not go into that collection.  </s>
<s> One other thing that I said was that there are two cases to consider... 1) if the loop includes the request URI... and 2) if the loop only includes elements that are pure descendents of the request URI.  </s>
<s> The same thing goes for the destination URI in a copy.  </s>
<s> If the destination URI (or more precisely, the "parent" of the destination URI) is not included in the loop, the deletion phase of the COPY is pretty easy.  </s>
<s> But consider if if the destination (and it's parent) is in a loop.... /a/b/c/d/b/c/d/b/c/d/.... if /a/b/c/d is the destination, then a deletion is probably also going to remove various links and leave us with /a/b/ before we try to actually begin copying at /a/b/c/d.... but wait! we can't copy to /a/b/c/d unless /a/b/c exists.  </s>
<s> Now if /a/b/c is the destination, once again the deletion phase will leave us with /a/b/.  </s>
<s> And the COPY should work just fine.  </s>
<s> Now let's take the above situation and also say that there exists /e/c/d/b/c/d/b/c/d/... And let's say the destination is /e/c/d/.  </s>
<s> That's the same destination resource as in the troublesome first situation, but we are using a different URI to specify it.  </s>
<s> The deletion phase leaves us with /a/b/ and /e/c/ and the subsequent COPY phase can be pulled off.  </s>
<s> with much of the same result that we would have expected in that first scenario.  </s>
<s> Now let's us consider this previous siutation, where there is an /e/c, but let's make the destination URI the same as the first situation: /a/b/c/d/.  </s>
<s> Once again, we are left with /a/b and /e/c/ after the deletion phase.  </s>
<s> Are we allowed to go through with the COPY phase?  </s>
<s> The parent resource still exists... but the URI that was used to specify it doesn't.... Hmmmm.  </s>
<s> :-) Anyway, my point is that if the request URI (or the destination URI) is included in a loop, that can pose real problems that aren't as easily resolved as loops that reside entirely decendants of request URI.  </s>
<s> We should be aware of these distinctive classes of loops.  </s>
<s> Another observations that's not related to loops but that my example reminds me of.  </s>
<s> In the rfc2518 we say that a COPY performs a implicit delete at the destination.  </s>
<s> That has the possibly unfortunate side effect that if a portion of the destination subtree is shared via bindings with another portion of the URI space, that sharing is lost.  </s>
<s> For that reason down the road I think we should have an operation that is much like DOS's XCOPY /s.  </s>
<s> I don't want to delay the spec now for that.  </s>
<s> It can be added later.  </s>
<s> BTW, this also reminds me that with AdvColl, it is possible that a portion of the source tree and the destination might be common.  </s>
<s> And that initial deletion phase of the COPY might actually essentially delete a portion of the source tree.  </s>
<s> It's probably a red herring, but it's probably also something we should mention in the spec.  </s>
<s> From: ccjason@us.ibm.com [mailto:ccjason@us.ibm.com] ... this also reminds me that with AdvColl, it is possible that a portion of the source tree and the destination might be common.  </s>
<s> And that initial deletion phase of the COPY might actually essentially delete a portion of the source tree.  </s>
<s> It's probably a red herring, but it's probably also something we should mention in the spec.  </s>
<s> I agree that it is something that should be explicitly mentioned (and disagree that it is a red herring :-).  </s>
<s> In particular, I'd suggest some words to the effect that a COPY should be semantically equivalent to a COPY to a temporary URL (that identifies a null resource) followed by a MOVE from the temporary URL to the destination URL.  </s>
<s> Since this situation can arise even in the base WebDAV spec, it probably would be worth adding this wording there as well, but minimally it should appear in the Adv.  </s>
<s> Col. specification.  </s>
<s> Cheers, Geoff  </s>
<s> ... this also reminds me that with AdvColl, it is possible that a portion of the source tree and the destination might be common.  </s>
<s> And that initial deletion phase of the COPY might actually essentially delete a portion of the source tree.  </s>
<s> It's probably a red herring, but it's probably also something we should mention in the spec.  </s>
<s> I agree that it is something that should be explicitly mentioned (and disagree that it is a red herring :-).  </s>
<s> In particular, I'd suggest some words to the effect that a COPY should be semantically equivalent to a COPY to a temporary URL (that identifies a null resource) followed by a MOVE from the temporary URL to the destination URL.  </s>
<s> Geoff, I don't understand your wording.  </s>
<s> Whoops.  </s>
<s> Yes, I do.  </s>
<s> The COPY would create a new instance of the resources that were in the source tree.  </s>
<s> The MOVE would UNBIND the destination and rebind the newly created copy to the destination URI.  </s>
<s> (Am I using our "bind" vocabulary/object-model correctly?  </s>
<s> :-)) Got it.  </s>
<s> Of course, that's the AdvColl.  </s>
<s> way of explaining it.  </s>
<s> And it still has this odd behavior with the the DELETE phase if we use your wording with RFC2518... so we still should flag it there.  </s>
<s> Hopefully we can move to AdvColl. and not worry too much about this.  </s>
<s> (It's only a problem for AdvColl if the UNBIND of the MOVE phase destroys a binding that happens to be in the source tree.  </s>
<s> Fortunately that one binding is the only thing that gets destroyed (at least explicitly) as a result of the COPY.  </s>
<s> I said explicitly because a bunch of resources might lose their only mapping(s) as a result of that unbind and thus become inaccessable in the absense of versioning.) The caveat is... even with AdvColl, I think we need to define what COPY/MOVE do across machines that don't cooperate on bindings.  </s>
<s> Your definition of COPY seems to work across machines as long as we say the COPY phase copies to a temporary location on the *destination* machine.  </s>
<s> MOVE across machines is another matter.  </s>
<s> We should say if we allow MOVE if the intended semantics can't be achieved.  </s>
<s> Or if best effort is acceptable.  </s>
<s> Or if the client can specify if best-effort is acceptable.  </s>
<s> Judy: Would you add this topic to the "action item" list for the adv.  </s>
<s> col.  </s>
<s> spec?  </s>
<s> Thanks!  </s>
<s> From: ccjason@us.ibm.com ... this also reminds me that with AdvColl, it is possible that a portion of the source tree and the destination might be common.  </s>
<s> And that initial deletion phase of the COPY might actually essentially delete a portion of the source tree.  </s>
<s> gmc/ I'd suggest some words to the effect that a COPY should be semantically equivalent to a COPY to a temporary URL (that identifies a null resource) followed by a MOVE from the temporary URL to the destination URL.  </s>
<s> jcl/ ... I think we need to define what COPY/MOVE do across machines that don't cooperate on bindings.  </s>
<s> Your definition of COPY seems to work across machines as long as we say the COPY phase copies to a temporary location on the *destination* machine.  </s>
<s> MOVE across machines is another matter.  </s>
<s> We should say if we allow MOVE if the intended semantics can't be achieved.  </s>
<s> Or if best effort is acceptable.  </s>
<s> Or if the client can specify if best-effort is acceptable.  </s>
<s> gmc/ Since COPY produces a new set of resources (which won't be locked or have existing bindings to them), I don't think any of the cross-server problems should apply here.  </s>
<s> Cheers, Geoff  </s>
<s> Recursion alert: MOVE is defined in terms of COPY.  </s>
<s> |John Stracke | http://www.ecal.com  </s>
<s> |My opinions are my own.  </s>
<s> | |Chief Scientist |===============================================| |eCal Corp. |I am destined to build a bridge to China out of| |francis@ecal.com|live sheep.  </s>
<s> |  </s>

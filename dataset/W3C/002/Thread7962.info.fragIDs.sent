<s> Past discussions have shown that servers frequently have trouble implementing PROPFIND 'allprop'.  </s>
<s> Jim asked me to summarize the past discussion &amp; list the open issues so that we can get this fixed, if it can be fixed, in revisions to 2518.  </s>
<s> There are already cases where not all properties will be returned: RFC2518: "In the case of allprop and propname, if a principal does not have the right to know whether a particular property exists then the property should be silently excluded from the response."  </s>
<s> John Stracke's proposal for reducing/specifying the scope of 'allprop', and discussion of the motivation: - http://lists.w3.org/Archives/Public/w3c-dist-auth/1999JulSep/0092.html - http://lists.w3.org/Archives/Public/w3c-dist-auth/1999JulSep/0310.html  </s>
<s> It has been a point of discussion for Advanced Collections: - http://lists.w3.org/Archives/Public/w3c-dist-auth/1999JanMar/0008.html "Clients need to know whether the property is computed on the fly before requesting it.  </s>
<s> There is no way to find out.  </s>
<s> The impact of computing on the fly is especially significant when a client requests allprop.  </s>
<s> There may be other properties that are computed on the fly as well.  </s>
<s> DAV:getetag is computed, and some versioning history properties may also be computed."  </s>
<s> Also in Versioning: - http://lists.w3.org/Archives/Public/w3c-dist-auth/1999JanMar/0075.html "There has also been a massive growth in the number of available DAV properties.  </s>
<s> PROPFIND allprop operations may lead to very large responses even with Depth: 1, which would slow down performance for users due to network speeds.  </s>
<s> It might be worthwhile to add this facet to the open issue ALLPROP_AND_COMPUTED." Also in ACLs, Babich argues that clients who request 'allprop' don't really want to see the ACL property, thus they ought to specifically ask for it.  </s>
<s> - http://lists.w3.org/Archives/Public/w3c-dist-auth/1998JulSep/0101.html  </s>
<s> Several server implementors have voiced the opinion that 'allprop' should be "put out of its misery" (GMC) or at least weakened.  </s>
<s> Often this is because of standard or custom properties that must be calculated by the server (e.g. 'lockdiscovery'), and the calculation can become extraordinarily expensive with an 'allprop' of depth: infinity.  </s>
<s> The only server-side argument for keeping 'allprop' is that server-to-server COPY requires it; but if anybody has implemented this yet and can't use 'propname' instead, please speak up.  </s>
<s> Summary: There thus seems to be a consensus among server implementors and those designing new features for DAV.  </s>
<s> What's missing in order to resolve this issue for fixing RFC2518 is input from clients.  </s>
<s> 1.  </s>
<s> Is anybody aware of clients that rely on particular properties being returned in 'allprop'?  </s>
<s> If the properties relied upon include any more than the set DAV:{creationdate, displayname, getcontentlanguage, getcontentlength, getcontenttype, getetag, getlastmodified} (the properties required for DAV level 1 support) I would be very surprised.  </s>
<s> Thus, servers may be able to restrict the required property set to this set.  </s>
<s> 2. Is anybody aware of clients that rely on 'allprop', rather than 'propname', for property discovery?  </s>
<s> This would be a more serious issue if major client implementations actually rely on doing property discovery using 'allprop', and attempt this against various implementations of WebDAV servers.  </s>
<s> These seem to be our options for modifying RFC2518 (remember, it has to be a simple mod): - deprecate 'allprop' and tell clients not to use it, but to use 'propname' instead - define 'allprop' to be the set of properties required for DAV level 1 support (although servers could freely return more properties if desired) - explicitly allow servers to return an error code (507?) for properties that were too expensive to calculate for a 'allprop' request, but still allowing the client to do property discovery through 'allprop' Please voice your preferences among these options, objections, or other ideas.  </s>
<s> thanks, Lisa Xythos  </s>
<s> Various replies below Regards Tom Wright Xerox All comments are my own opinions and not really from my company.  </s>
<s> Greg,  </s>
<s> Given that the default configuration of mod_dav prevents a Depth:infinity PROPFIND, I'd guess that a rejection of Depth:infinity is a definite possibility.  </s>
<s> What does GoLive do when it gets the rejection?  </s>
<s> Do you simply skip that feature, send a bunch of Depth:1 requests, or something else?  </s>
<s> We do *not* send a bunch of Depth:1 requests, some WebDAV functionality  </s>
<s> is simply  </s>
<s> *not* working in GoLive 5 when the server is not willing to respond to  </s>
<s> depth infinity  </s>
<s> requests.  </s>
<s> We have simply tried to implement the WebDAV protocol as it is  </s>
<s> described in  </s>
<s> RFC2518 and RFC2518 does *not* allow a server to deny a depth infinity  </s>
<s> access.  </s>
<s> At  </s>
<s> the point in time when the "DavDepthInfinity" flag was introduced into  </s>
<s> mod_dav it was  </s>
<s> much too late for us to implement such a "bunch of Depth:1  </s>
<s> requests"-solution because  </s>
<s> we were right before GM.  </s>
<s> And I think this is a general problem.  </s>
<s> There are a lot of very huge  </s>
<s> products of huge  </s>
<s> companies out there which support WebDAV and I am very lucky about that  </s>
<s> especially  </s>
<s> because I think that the idea of WebDAV is very powerful and advanced.  </s>
<s> But  </s>
<s> we all have  </s>
<s> to keep in mind that a huge product has a well defined life cycle and  </s>
<s> workflow which  </s>
<s> cannot be changed frequently.  </s>
<s> And of course a product cannot be changed  </s>
<s> when it is  </s>
<s> already in the box.  </s>
<s> So when some changes take place in the protocol or its  </s>
<s> important  </s>
<s> implementations like mod_dav and this will effect negatively or even break  </s>
<s> products  </s>
<s> which are already in the box or right before GM, a customer who have paid  </s>
<s> for the  </s>
<s> product has to wait at least for the next product release (which will take  </s>
<s> months or e ven years).  </s>
<s> Though Issuing patches is a well known tried an trusted appropach to this kind of problem.  </s>
<s> So I think it's very important to get some degree of stability and  </s>
<s> continuity in the  </s>
<s> WebDAV protocol and its implementations which does not mean to let the  </s>
<s> protocal  </s>
<s> unchanged during the next years but we should keep its key features.  </s>
<s> Otherwise a lot  </s>
<s> of companies will think twice before they implement WebDAV support and -  </s>
<s> without any  </s>
<s> doubt - every protocol needs a widespread acceptance from commercial  </s>
<s> companies and  </s>
<s> products to be succesful.  </s>
<s> All of your responses are missing the point Hartmut.  </s>
<s> If a server generates a 2 or 4 Gigabyte XML response in response to your thousands of files on the server, 1) its going to hog the server, and even cause it to fail if your building XML in memory, 2) clog the network with traffic and 3) how on earth is the client going to cope with parsing a 2 or 4 gig ( or larger ) XML response, are you simply hoping that you never get a response so large that you cant handle it ?  </s>
<s> Sending a few hundred byte request ( which may be reasonable to the user ) can result in potentially crippling the server, network or client with unexpectedly large amounts of data, after all most users have no idea of the size of the response before hand.  </s>
<s> I agree we need to do our best to maintain backwards compatability, but it sounds like your check all in one go approach is a naive implementation.  </s>
<s> There is simply no need to retrieve more than a directory ( ala depth 1 ) of files/folders properties at a time.  </s>
<s> Heck you dont even need webdav to do this, using if-modified-since is good enough for files, unless you need to check properties as well.  </s>
<s> Your arguement about it being efficient is hard to understand.  </s>
<s> Whats efficent, your use of server and client resources, network band width etc ?  </s>
<s> I am actually implementing propfind as we speak, and have full sympathy with your position and agree we must not break backwards compatibility, however the current spec is 1) a draft and 2) not considerate of resources, after all they are not infinite.  </s>
<s> I am suprised greg has not argued the case of infinite depth and got the spec changed!!  </s>
<s> Maybe the best compromise is as shaun suggested is to have a new status code, saying i have done a depth 1 instead of a depth infinity propfind response, the rest is up to you kind of code, some new 200 code perhaps.  </s>
<s> The current situation of allowing infinite depth allprop with an unknown number of properties for an unknown number of resources is 'silly'.  </s>
<s> The protocol is not just for clients, servers have to implement it also, and they need to be able to throatle malicious/unintentional requests which will potentially flood the network and cripple the server/client.  </s>
<s> As a whole, i hope Jim is reading these emails, as there is clearly a number of people unhappy with the current specification.  </s>
<s> Maybe it should be changed before the next release?  </s>
<s> Best regards Tom  </s>
<s> I think this should be split into 2 threads (as someone suggested earlier) and so I will attempt to do so here :) 1) Depth infinity searches.  </s>
<s> I can see some very good uses for depth infinity searches and can also see the large DOS attack.  </s>
<s> To alleviate the situation I will suggest (again) that we add a 507 Insufficient Storage status code response to a Propfind.  </s>
<s> This will allow a server to respond with partial results when the result set is to large.  </s>
<s> This was how DASL suggested that servers handle the Result Set Truncation possibility of searches that were to large, and since Propfind is nothing but a limited search, I believe the 507 works well in this case also.  </s>
<s> In this way the server is free to answer as much as they can, and still give a proper error condition.  </s>
<s> In cases where the depth infinity is not rather large, the 207 is returned as normal.  </s>
<s> In the case of LARGE depth infinity propfinds, the 507 is returned with partial propfind data.  </s>
<s> Kevin [mailto:w3c-dist-auth-request@w3.org]On  </s>
<s> Behalf Of Wright, Tom Various replies below Regards Tom Wright Xerox All comments are my own opinions and not really from my company.  </s>
<s> -----Original Message----- Greg,  </s>
<s> Given that the default configuration of mod_dav prevents a Depth:infinity PROPFIND, I'd guess that a rejection of Depth:infinity is a definite possibility.  </s>
<s> What does GoLive do when it gets the rejection?  </s>
<s> Do you simply skip that feature, send a bunch of Depth:1 requests, or something else?  </s>
<s> We do *not* send a bunch of Depth:1 requests, some WebDAV functionality  </s>
<s> is simply  </s>
<s> *not* working in GoLive 5 when the server is not willing to respond to  </s>
<s> depth infinity  </s>
<s> requests.  </s>
<s> We have simply tried to implement the WebDAV protocol as it is  </s>
<s> described in  </s>
<s> RFC2518 and RFC2518 does *not* allow a server to deny a depth infinity  </s>
<s> access.  </s>
<s> At  </s>
<s> the point in time when the "DavDepthInfinity" flag was introduced into  </s>
<s> mod_dav it was  </s>
<s> much too late for us to implement such a "bunch of Depth:1  </s>
<s> requests"-solution because  </s>
<s> we were right before GM.  </s>
<s> And I think this is a general problem.  </s>
<s> There are a lot of very huge  </s>
<s> products of huge  </s>
<s> companies out there which support WebDAV and I am very lucky about that  </s>
<s> especially  </s>
<s> because I think that the idea of WebDAV is very powerful and advanced.  </s>
<s> But  </s>
<s> we all have  </s>
<s> to keep in mind that a huge product has a well defined life cycle and  </s>
<s> workflow which  </s>
<s> cannot be changed frequently.  </s>
<s> And of course a product cannot be changed  </s>
<s> when it is  </s>
<s> already in the box.  </s>
<s> So when some changes take place in the protocol or its  </s>
<s> important  </s>
<s> implementations like mod_dav and this will effect negatively or even break  </s>
<s> products  </s>
<s> which are already in the box or right before GM, a customer who have paid  </s>
<s> for the  </s>
<s> product has to wait at least for the next product release (which will take  </s>
<s> months or e ven years).  </s>
<s> Though Issuing patches is a well known tried an trusted appropach to this kind of problem.  </s>
<s> So I think it's very important to get some degree of stability and  </s>
<s> continuity in the  </s>
<s> WebDAV protocol and its implementations which does not mean to let the  </s>
<s> protocal  </s>
<s> unchanged during the next years but we should keep its key features.  </s>
<s> Otherwise a lot  </s>
<s> of companies will think twice before they implement WebDAV support and -  </s>
<s> without any  </s>
<s> doubt - every protocol needs a widespread acceptance from commercial  </s>
<s> companies and  </s>
<s> products to be succesful.  </s>
<s> All of your responses are missing the point Hartmut.  </s>
<s> If a server generates a 2 or 4 Gigabyte XML response in response to your thousands of files on the server, 1) its going to hog the server, and even cause it to fail if your building XML in memory, 2) clog the network with traffic and 3) how on earth is the client going to cope with parsing a 2 or 4 gig ( or larger ) XML response, are you simply hoping that you never get a response so large that you cant handle it ?  </s>
<s> Sending a few hundred byte request ( which may be reasonable to the user ) can result in potentially crippling the server, network or client with unexpectedly large amounts of data, after all most users have no idea of the size of the response before hand.  </s>
<s> I agree we need to do our best to maintain backwards compatability, but it sounds like your check all in one go approach is a naive implementation.  </s>
<s> There is simply no need to retrieve more than a directory ( ala depth 1 ) of files/folders properties at a time.  </s>
<s> Heck you dont even need webdav to do this, using if-modified-since is good enough for files, unless you need to check properties as well.  </s>
<s> Your arguement about it being efficient is hard to understand.  </s>
<s> Whats efficent, your use of server and client resources, network band width etc ?  </s>
<s> I am actually implementing propfind as we speak, and have full sympathy with your position and agree we must not break backwards compatibility, however the current spec is 1) a draft and 2) not considerate of resources, after all they are not infinite.  </s>
<s> I am suprised greg has not argued the case of infinite depth and got the spec changed!!  </s>
<s> Maybe the best compromise is as shaun suggested is to have a new status code, saying i have done a depth 1 instead of a depth infinity propfind response, the rest is up to you kind of code, some new 200 code perhaps.  </s>
<s> The current situation of allowing infinite depth allprop with an unknown number of properties for an unknown number of resources is 'silly'.  </s>
<s> The protocol is not just for clients, servers have to implement it also, and they need to be able to throatle malicious/unintentional requests which will potentially flood the network and cripple the server/client.  </s>
<s> As a whole, i hope Jim is reading these emails, as there is clearly a number of people unhappy with the current specification.  </s>
<s> Maybe it should be changed before the next release?  </s>
<s> Best regards Tom  </s>
<s> I support the use of 507 to indicate a server wishes to truncate the PROPFIND.  </s>
<s> I assume that if a server will respond with partial results, that the 507 will be returned under the appropriate response elements (whose properties were omitted), while the overall status of the request would be a 207.  </s>
<s> Cheers, Geoff Date: Sun, 26 Nov 2000 14:59:17 -0800 From: Kevin Wiggen wiggs@wiggenout.com  </s>
<s> I think this should be split into 2 threads (as someone suggested earlier) and so I will attempt to do so here :) 1) Depth infinity searches.  </s>
<s> I can see some very good uses for depth infinity searches and can also see the large DOS attack.  </s>
<s> To alleviate the situation I will suggest (again) that we add a 507 Insufficient Storage status code response to a Propfind.  </s>
<s> This will allow a server to respond with partial results when the result set is to large.  </s>
<s> This was how DASL suggested that servers handle the Result Set Truncation possibility of searches that were to large, and since Propfind is nothing but a limited search, I believe the 507 works well in this case also.  </s>
<s> In this way the server is free to answer as much as they can, and still give a proper error condition.  </s>
<s> In cases where the depth infinity is not rather large, the 207 is returned as normal.  </s>
<s> In the case of LARGE depth infinity propfinds, the 507 is returned with partial propfind data.  </s>
<s> Kevin  </s>

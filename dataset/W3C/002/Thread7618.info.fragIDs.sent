<s> On a slightly different topic: why is a refresh done using locktokens gathered from the If: header, rather than the more obvious  </s>
<s> Lock-Token:  </s>
<s> header?  </s>
<s> I can't recall our original rationale.  </s>
<s> We might have been thinking  </s>
<s> that,  </s>
<s> since the lock had to exist for the request to be honored, this effectively made the locks existence a precondition, and preconditions are  </s>
<s> expressed  </s>
<s> using the If header.  </s>
<s> So do we need to define server behavior if more than one lock is  </s>
<s> specified  </s>
<s> in the If header?  </s>
<s> fyi: mod_dav refreshes all of them.  </s>
<s> Interesting.  </s>
<s> And what type of body do you use for success?  </s>
<s> Do you only support it if the locks are on the same resource?  </s>
<s> And how do you respond if some of the refreshes failed?  </s>
<s> So do we need to define server behavior if more than one lock is  </s>
<s> in the If header?  </s>
<s> fyi: mod_dav refreshes all of them.  </s>
<s> We return a DAV:lockdiscovery element (as defined) which contains multiple DAV:activelock elements (as defined).  </s>
<s> We refresh any locks that are extent on that resource and that we find in the If: header.  </s>
<s> In other words, we'll refresh direct locks and those inherited from Depth:infinity locks further up in the namespace.  </s>
<s> On error, we return a single status code (not a multistatus).  </s>
<s> That's because a refresh is not being applied to multiple resources -- just multiple locks on *one* resource.  </s>
<s> Cheers, -g Greg Stein, http://www.lyra.org/  </s>
<s> We return a DAV:lockdiscovery element (as defined) which contains multiple DAV:activelock elements (as defined).  </s>
<s> We refresh any locks that are extent on that resource and that we find in the If: header.  </s>
<s> In other words, we'll refresh direct locks and those inherited from Depth:infinity locks further up in the namespace.  </s>
<s> On error, we return a single status code (not a multistatus).  </s>
<s> That's because a refresh is not being applied to multiple resources -- just multiple locks on *one* resource.  </s>
<s> And what about if the if header references several locks on different resources?  </s>
<s> A = the set of locktokens found in the If: header B = the set of locktokens found on the resource (directly and/or through inherited locks) mod_dav refreshes the intersection.  </s>
<s> By "on different resources", if you mean the Request-URI and the resource locked with a Depth:infinity lock (implied by the inherited lock on the Request-URI), then yes.  </s>
<s> If you mean locks implied by a Tagged-List in the If: header, then that just doesn't make sense :-) Happy Thanksgiving, -g  </s>
<s> Greg Stein, http://www.lyra.org/  </s>
<s> If you mean locks implied by a Tagged-List in the If: header, then that just doesn't make sense :-) That's what I meant.  </s>
<s> I don't know if it makes sense or not, but I'm perfectly willing to say that "it" is not supported.  </s>
<s> And I agree that it seems somewhat odd that we use the IF header to determine  </s>
<s> what locks are to be refreshed.  </s>
<s> I would think this should work just as UNLOCK  </s>
<s> does.  </s>
<s> That's not to say people can't use an IF header, but that's not how  </s>
<s> they specify which of the locks is to be refreshed.  </s>
<s> The IF header would  </s>
<s> only  </s>
<s> be for consistancy checking if the client wanted the refresh to be  </s>
<s> contingent  </s>
<s> on the presence of a specified lock on some specified resource.  </s>
<s> Now I also recognize that changing this might break some clients/servers.  </s>
<s> Before we could change this, we'd have to come to a consensus that we're willing to change our implementations.  </s>
<s> J.  </s>
<s> Hrm; I guess it could make some sense to impute the URIs in a tagged-list as some kind of input parameter.  </s>
<s> We do with the locktokens, after all :-)  </s>
<s> IMO, this would have been the clearest way to do this.  </s>
<s> It's that pedantic trap again.  </s>
<s> As JimW explained "well, we saw it as a precondition, and preconditions are specified with the If: header, and ..."  </s>
<s> Well, Office 2000 uses LOCKs and could be argued as one of the more popular clients :-).  </s>
<s> If it doesn't send a Lock-Token header, then we're out of luck.  </s>
<s> The spec would then need to specify behavior in the absence of the Lock-Token header.  </s>
<s> Anybody know if it sends a Lock-Token header when it refreshes its lock?  </s>
<s> Personally: I'd be fine changing mod_dav.  </s>
<s> Simply a lot of stuff, and I really think its the clearest mechanism for the protocol.  </s>
<s> Cheers, -g Greg Stein, http://www.lyra.org/  </s>
<s> From: ccjason@us.ibm.com  </s>
<s> UNLOCK  </s>
<s> only  </s>
<s> contingent  </s>
<s> I agree with Jason (and others) that this would be the preferable way for a lock refresh to work.  </s>
<s> Cheers, Geoff  </s>
<s> Anyone that has a locking server or locking client (or knows of one) that would be significantly affected by this alteration or by any other locking changes, please send me a note or post it to this list.  </s>
<s> I'll add you to the locking mailing list.  </s>
<s> I just like to make sure I have a complete list of servers/clients (with email addresses) that are resistant to changes to locking due to 2518 compatibility issues and client base.  </s>
<s> --- note from Geoff Clemm follows ----- From: ccjason@us.ibm.com  </s>
<s> UNLOCK  </s>
<s> how  </s>
<s> only  </s>
<s> contingent  </s>
<s> I agree with Jason (and others) that this would be the preferable way for a lock refresh to work.  </s>
<s> Cheers, Geoff  </s>
<s> Anyone that has a locking server or locking client (or knows of one) that would be significantly affected by this alteration or by any other locking changes, please send me a note or post it to this list.  </s>
<s> I'll  </s>
<s> add you to the locking mailing list.  </s>
<s> I just like to make sure I have a complete list of servers/clients (with email addresses) that are resistant to changes to locking due to 2518 compatibility issues and client base.  </s>
<s> Just in reply to my note above and something Kevin said subsequently about compatibility with clients.  </s>
<s> The transition path could be... Clients use both IF and token header for a while until servers have drifted to the new convention.  </s>
<s> After that, just token headers are used.  </s>
<s> Servers accept token header.  </s>
<s> If not there, they use the if header.  </s>
<s> Eventually the servers would just accept token headers.  </s>
<s> Noone would need to break.  </s>
<s> But I'd like to know if there is even a need for a transition strategy.  </s>
<s> This change would not affect the Python WebDAV server, because it does not implement lock refreshing at all.  </s>

<s> I've never seen a clear resolution on whether property changes ought to result in ETag changes or not, although it's been discussed in the past on and off the main list.  </s>
<s> This is really a core WebDAV issue, but I'm cc'ing the versioning list because the versioning model seems to suggest a particular model.  </s>
<s> First I'll tediously recap all the various arguments I've heard/used so far... jump to the conclusions if you wish!  </s>
<s> Arguments for changing ETag when properties change In versioning, when any of the regular dead properties of a resource change, a new version is created.  </s>
<s> Thus, a new version might have exactly the same body as the previous version, only one or more property value is changed.  </s>
<s> This suggests that at least some properties are considered part of the resource itself.  </s>
<s> More strongly, it pretty well forces the ETag to change, doesn't it?  </s>
<s> Um, or does it?  </s>
<s> What about the Etag on the VCR, anyway?  </s>
<s> The implementation architecture argument: a server may store properties inside the file which also contains the resource body, and use information about this file (e.g. last-changed stamp) to create the ETag.  </s>
<s> This kind of architecture does not easily allow the ETag to remain the same when the properties change.  </s>
<s> The sophisticated WebDAV client argument: for sophisticated WebDAV clients that do something like backup or replication, and care very much about properties, there's currently no way to tell if the property set has changed.  </s>
<s> It would be desirable for this kind of client if some kind of indication changed, so that the client could tell when it's not necessary to download properties at all (in most backup/replication scenarios, no changes at all is the common case, so it makes sense to optimise).  </s>
<s> Arguments for keeping ETag same when properties change Frequently-changing properties argument: It's pretty clear that one could define resource properties which should NOT result in the ETag changing.  </s>
<s> E.g. a custom calculated property like "last-accessed-date" or "last-accessed-by" should not result in a change in the Etag every time the resource is accessed.  </s>
<s> So maybe it's easier not to change the ETag for any property changes.  </s>
<s> The principle of 'least surprise' and efficiency for existing HTTP clients: Since many WebDAV resources seem to be widely accessed by HTTP clients, it would be a shame to force them to download a new body for a WebDAV resource if only the properties change.  </s>
<s> The HTTP client expects the body to change when the ETag changes, and performs unnecessary work if the ETag changes when the body does not.  </s>
<s> This argument also holds true for the bulk of existing WebDAV clients which, as far as I can tell, do not store properties locally and thus are more efficient if the ETag stays the same when properties change.  </s>
<s> In other words, most existing WebDAV clients don't care about knowing when properties change.  </s>
<s> The precedent argument: Neither xythos nor mod_dav changes the etag when it gets a PROPPATCH.  </s>
<s> I don't know about other servers.  </s>
<s> The implementation architecture argument, from the opposite side: a server may store properties somewhere outside the file, and use the file information (e.g. last-changed stamp) to create the ETag.  </s>
<s> This kind of architecture does not easily allow the ETag to change when the properties change.  </s>
<s> Arguments for doing nothing Implementations have already done one thing or the other.  </s>
<s> It's too late.  </s>
<s> The most we could require of servers would be something like "SHOULD NOT" change the etag, or maybe even weaker.  </s>
<s> Arguments for doing Something Clients should at least be able to tell whether they can count on the ETag changing when properties change.  </s>
<s> Conclusions My suggestion is to add a _client_ requirement to the WebDAV proposed standard when it gets updated.  </s>
<s> E.g. "WebDAV clients MUST NOT rely on the ETag changing in order to know when properties on the resource have changed."  </s>
<s> This is a pretty conservative suggestion, since it's pretty clear when looking at existing WebDAV server implementations, that clients can't rely on the ETag changing when props change anyway.  </s>
<s> Putting such a statement in the spec just makes it clear, and avoids client developers having to test various servers to try to find out, or making poor assumptions.  </s>
<s> Given this, I don't think it's necessary to make any requirement on servers.  </s>
<s> Servers are free to do whatever is most efficient or easiest, as long as the ETag changes in the way required by RFC2616.  </s>
<s> Versioning may want to address this issue separately.  </s>
<s> Since changing dead properties creates a new version, I would assume the ETag would change.  </s>
<s> A regular HTTP client doing a GET on such a VCR would see a new ETag even if the body has not changed.  </s>
<s> However, my assumption may be  </s>
<s> wrong, thus, please clarify in DeltaV!  </s>
<s> If clients need to know reliably when properties _do_ change (backup and replication scenarios come to mind), we could get together and invent some kind of ETag-analog for properties.  </s>
<s> I'd be interested in this kind of feature, but I don't expect it's within the scope of any work currently being undertaken by the working groups.  </s>
<s> Lisa Dusseault  </s>
<s> ...which is probably a Bad Thing, since ETags are used for cache validation.  </s>
<s> What's worse, a little extra complication for the people editing the site or a lot of extra load for the servers as people read the site?  </s>
<s> |John Stracke | http://www.ecal.com  </s>
<s> |My opinions are my own.| |Chief Scientist |=============================================| |eCal Corp. |You!  </s>
<s> Out of the gene pool!  </s>
<s> | |francis@ecal.com| |  </s>
<s> In response to Lisa and John's note...  </s>
<s> I tend to agree with Lisa and John.  </s>
<s> Just to reiterate another way...  </s>
<s> We should probably treat GET etags as denoting changes in the result of response to a GET.  </s>
<s> In the case of a live/dynamic resource... we'd still follow this rule.  </s>
<s> Such a resource has two URL's.  </s>
<s> One to access the source code of the resource and another to access the product/output of the resource.  </s>
<s> I would suggest that each URL treat the ETag in a way that is consistant with the GET response for that URL. -- I'm not sure if I want to suggest this for the getetag property though.  </s>
<s> Different values depending on what URL you are using?  </s>
<s> As Lisa said... someone can make a proposal for properties that goes beyond this.  </s>
<s> I can imagine all kinds of innovative stuff, but I would recommend that be defered until WebDAV ver 2. J.  </s>

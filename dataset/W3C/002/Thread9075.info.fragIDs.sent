<s> I currently have an XML file that we create that includes several files (such as Word, Excel, PDF...) that are stored inline with BASE64 encoding.  </s>
<s> Each of these files can be electronically signed by multiple parties using a standard digital signature (which hashes the content of a file with some metadata like timestamps, IP addresses, etc.) generated for each party.  </s>
<s> Clearly, I don't want to have to repeat the encoded file as an element in each Object.SignatureProperties for since the file can have multiple electronic signatures attached (each are independent of the other signatures).  </s>
<s> Should I do this by creating an Object element that contains just the encoded file (one Object element per file), and then create multiple Signature elements (one per each electronic signature) such that is has a Reference pointing to the Object.SignatureProperties?  </s>
<s> From the schema, it doesn't seem that this is possible since the Object element is inside the Signature element.  </s>
<s> I see something about "detached signatures," but it's just complex enough that I'm not sure how I should be attacking this.  </s>
<s> Thanks, David  </s>
<s> David, could you give a pseudo example?  </s>
<s> I don't even understand why you are  </s>
<s> placing these encoded material in a SignatureProperties.  </s>
<s> I thought that you were supposed to do this by creating a Manifest and then have each signer sign that, creating a Signature element for each one.  </s>
<s> Alternatively, you could construct a common SignedInfo and then have each signer incorporate that in their Signature element.  </s>
<s> SignatureProperties would make sense only if you were trying to have a later signer include one or more of the earlier signatures in his signed document, and we don't have a SignatureProperty name for that action in the spec.  </s>
<s> If they're independent signatures, you wouldn't want to use that feature at all.  </s>
<s> Tom Gindin "David Wall" dwall@Yozons.com  </s>
<s> @w3.org on 07/25/2002 07:49:49 PM Please respond to "David Wall" dwall@Yozons.com  </s>
<s> Sent by: w3c-ietf-xmldsig-request@w3.org  </s>
<s> Subject: Multiple signatures on multiple files I currently have an XML file that we create that includes several files (such as Word, Excel, PDF...) that are stored inline with BASE64 encoding.  </s>
<s> Each of these files can be electronically signed by multiple parties using a standard digital signature (which hashes the content of a file with some metadata like timestamps, IP addresses, etc.) generated for each party.  </s>
<s> Clearly, I don't want to have to repeat the encoded file as an element in each Object.SignatureProperties for since the file can have multiple electronic signatures attached (each are independent of the other signatures).  </s>
<s> Should I do this by creating an Object element that contains just the encoded file (one Object element per file), and then create multiple Signature elements (one per each electronic signature) such that is has a Reference pointing to the Object.SignatureProperties?  </s>
<s> From the schema, it doesn't seem that this is possible since the Object element is inside the Signature element.  </s>
<s> I see something about "detached signatures," but it's just complex enough that I'm not sure how I should be attacking this.  </s>
<s> Thanks, David  </s>
<s> are  </s>
<s> Here's an example (with the attachment, logo, signature and public keys truncated for space) of what I have today.  </s>
<s> I think I have an understanding now of how to do this better, using Signature elements that reference the common data elements, but I'm not sure.  </s>
<s> Of course, I'd prefer to keep my data format and then wrap the signature elements we have with XML Signature elements.  </s>
<s> message xmlns="http://www.authorchats.com"  </s>
<s> version="1" fromEmail userId="8592082075648" ![CDATA[d.wall@authorchats.com]]  </s>
<s> /fromEmail attachment version="1" ownerUserId="8592082075648" messageId="10737424333" originalName ![CDATA[Sales Rep Agreement Leo Falcon.doc]] /originalName createdTimestamp seconds="1018055722" 04/05/02 5:15 PM PST /createdTimestamp signature version="3" ownerId="8592082075648" linkedToId="10737419338" signerUserId="8592082075961" realSignedTimestamp seconds="1018279613" 04/08/02 8:26 AM PDT /realSignedTimestamp emailFullDisplayName confirmed="true" paidConfirmed="false" ![CDATA[ preText ![CDATA[By typing my name clicking the Add my signature button, I agree to be bound to the terms described in the attached sales representative agreement.]]  </s>
<s> /preText digitalSignature Hp1Wa6W3BAS+OT5...snip...fTgdWD5yhWlaRBA== /digitalSignatu re signerPublicKey signature version="3" ownerId="8592082075648" linkedToId="10737419338" signerUserId="8592082075648" realSignedTimestamp seconds="1018055915" 04/05/02 5:18 PM PST /realSignedTimestamp emailFullDisplayName confirmed="true" paidConfirmed="true" ![CDATA[David A. E. Wall d.wall@authochats.com  </s>
<s> ]] /emailFullDisplayName digitalSignature Ah1R1lJ/P/GayP1kb+Ffldb6KzVGJJj...snip...oJZTMaRlw== /digi talSignature signerPublicKey logoData size="17124" /9j/4AAQSkZJRgABAQ...snip...l+L8X4vzOs6X4vxfi/M6zr//Z /logoData Note that the body, rawData, digitalSignature, signerPublicKey and logoData elements are base64 encoded binary.  </s>
<s> Most of the elements that contain "user-supplied" input are wrapped in CDATA to avoid problems with whitespace and special characters (avoiding doing transforms as we output this database data into XML).  </s>
<s> The first signature element, for example, since it's inside the attachment element, is the first electronic signature for that attachment.  </s>
<s> It's composed of the elements: attachment.messageId,  </s>
<s> attachment.id,  </s>
<s> fileSize, createdTimestamp, signedWithName, realSignedTimestamp, originalName, contentType, rawData, preText, and postText and ipAddr.  </s>
<s> The second signature element signs the same attachment, but only the signedWithName, realSignedTimestamp and ipAddress would generally have different values (not to mention they'd use different public keys!) from those used by the first signer's signature.  </s>
<s> While there are none here, there could be multiple attachment elements, and the message element itself could have one or more signatures that would effectively sign the body element instead of an attachment.rawData  </s>
<s> element.  </s>
<s> Does that make it any more clear?  </s>
<s> Thanks, David  </s>
<s> I still can't say I undestand since you still seem to have your own signature scheme (and use say the first signature is, " composed of the elements: attachment.messageId,  </s>
<s> attachment.id,  </s>
<s> fileSize, createdTimestamp, signedWithName, realSignedTimestamp, originalName, contentType, rawData, preText, and postText and ipAddr."  </s>
<s> How do you know that?  </s>
<s> Regardless, I might have a sense of your larger application, and this pseudo-example demonstrates how might one do such a thing with XML Signatures.  </s>
<s> The following is a message with a header, body, and two attachments.  </s>
<s> Two signature is included, the first is specified and contains two references: one to the first attement, and another to the associated Signature  </s>
<s> Properties.  </s>
<s> If you want to sign the *actual* attachment (instead of the attement element iwth id = "a1") you would need a transform that isolates the element content (e.g., XPath).  </s>
<s> You could further decode the base64 data  </s>
<s> in that element content, as decribed in:  </s>
<s> realSignedTimestamp seconds="1018279613" 04/08/02 8:26 AM PDT /realSignedTimestamp emailFullDisplayName confirmed="true" paidConfirmed="false" ![CDATA[ preText ![CDATA[By typing my name clicking the Add my signature button, I agree to be bound to the terms described in the attached sales representative agreement.]]  </s>
<s> /preText  </s>
<s> Thanks.  </s>
<s> I think I understand how to do this, though it does mean we'll have to rev our signatures (something we've already accounted for with our 'version' attribute).  </s>
<s> We "know" that because it's part of our published standard for how the signature is calculated (and pre-dates XML Signature).  </s>
<s> Of course, we'd like to use XML Signatures since it essentially has the data we have, but also the processing steps defined within so that an external app can recalculate on its own without having to know specifically the order in which data elements were applied to the signature algorithm.  </s>
<s> Today, we publish the info so that it can be verified independently without requiring our software, though few ever make use of another system.  </s>
<s> At least with a standard format, we'll be compatible going forward.  </s>
<s> data  </s>
<s> Has anybody decided whether signing the "real data" versus signing the "hash" has any legal implications?  </s>
<s> My impression from a crypto perspective is that it should be the same since the guarantees are the same, though it's interesting because the person is now digitally signing meta data and a hash of a document, rather than the document itself.  </s>
<s> The question now is whether anybody will care since I think the binding of the party to the document would be of the same quality (after all, the digital signature on the "real data" is just a hash anyway).  </s>
<s> People probably don't care one way or the other since it's all pretty much indecipherable to them, but when lawyers are involved, you just never know!  </s>
<s> David  </s>
<s> Hm, I'm not sure whether I understand it right.  </s>
<s> What do you understand under the trem "sign"?  </s>
<s> If "sign" is the DSA or RSA operation of the signing process, you *never* sign the message directly.  </s>
<s> What happens is that the message is digested and this digest is signed.  </s>
<s> In XML Signature, the hash of the message is collected in an intermediary object, the ds:SignedInfo and this is again hashed and DSA'ed.  </s>
<s> The signing process always involves a cryptographic hash function.  </s>
<s> Signing "real data", i.e. signing the message directly is not such a good idea as it opens the algorithm to some attacks, especially if you use plain RSA (which would be a very bad idea).  </s>
<s> Christian  </s>
<s> idea as it opens the algorithm to some attacks, especially if you use plain RSA (which would be a very bad idea).  </s>
<s> True, but a lot of typical signing includes a hash (RSA/DSA with SHA1), but the SHA1 works against the actual data being signed (in both digital signature and legal sense).  </s>
<s> In XML Signature, there's a two step process of doing an SHA1 on the actual data, and then digital signing (hash the hash and encrypt with the private key), so the digital signature is "signing" a hash, not the original data.  </s>
<s> Anyway, I believe it's sound technically, just wondered if there's anything "odd" from a legal standpoint since the signature is once removed from the data being signed.  </s>
<s> David  </s>
<s> Hi David, I've given this a fair bit of thought in the past, and the group discussions of this issue included a number of members from the legal community.  </s>
<s> The consensus is that there are no problems with our approach.  </s>
<s> I do understand your concern completely, that you are signing a bag of bits that is 'once removed' from the 'actual data'.  </s>
<s> However, there are several points to consider even if we remove the two-step that XML Signature performs: 1) A digital signature itself is generated over a hash of the data.  </s>
<s> The hash is a 'lossy' technique that boils every message down to a constant sized 'fingerprint'.  </s>
<s> The legal community already accepts as technologically sound the application of signature techniques over some metadata (a fingerprint or hash) rather than over the actual data itself.  </s>
<s> 2) Typically, the data being hashed and signed is already removed several steps from the 'actual data' that represents what the user saw, heard or otherwised sensed that comprised the actual agreement.  </s>
<s> For example, consider a web transaction that includes an image showing an object the signer wants to purchase or the company logo of the brand of object the signer believes he is purchasing.  </s>
<s> The signer views a 24-bit color bitmap of the image, which is the 'actual data'.  </s>
<s> But the 'signed data' is a set of XML tags between which appears the base 64 encoding of a JPeg compressed version of the aforementioned bitmap.  </s>
<s> Notice, in particular, that the JPeg compression is a 'lossy' technique.  </s>
<s> Despite these levels of indirection, we find no problem with the approach because there is a well-defined and straightforward set of transformations that allow validation of the actual data against the signed data.  </s>
<s> 3) Even the very idea of signing the ASCII codes for the characters in an English language sentence implies indirection.  </s>
<s> Essentially, "what you see is what you sign", but what we sign is an index into a font map that is not even stored in the document.  </s>
<s> But, as with JPeg images and base 64 encoding, we accept these bags of bits as being the proper representative of what we really want to sign, which is a bunch of dots on the screen.  </s>
<s> And now for the purely philosophical: Even the bunches of dots are only useful because, at the resolution typically used on our computing platforms, the dots meld together to form the symbols that having meaning to us.  </s>
<s> So, the precedent for well-defined indirection has been set long before XML Signature came to the scene.  </s>
<s> John Boyer, Ph.D. Senior Product Architect PureEdge Solutions Inc.  </s>
<s> idea as it opens the algorithm to some attacks, especially if you use plain RSA (which would be a very bad idea).  </s>
<s> True, but a lot of typical signing includes a hash (RSA/DSA with SHA1), but the SHA1 works against the actual data being signed (in both digital signature and legal sense).  </s>
<s> In XML Signature, there's a two step process of doing an SHA1 on the actual data, and then digital signing (hash the hash and encrypt with the private key), so the digital signature is "signing" a hash, not the original data.  </s>
<s> Anyway, I believe it's sound technically, just wondered if there's anything "odd" from a legal standpoint since the signature is once removed from the data being signed.  </s>
<s> David  </s>

<s> If you have strongly held thoughts on any of these issues, let me know (cc the list).  </s>
<s> 1. Presently, the C14N of XML includes expanded general entities which produces a standalone document.  </s>
<s> Obviously parameter entities aren't a problem, but PIs might be.  </s>
<s> Do you care about PIs?  </s>
<s> 2. Should the canonical form include an XML declaration with version number?  </s>
<s> 3. If C14N fails because of the unavailability of an external entity, do XML Signature applications want to know?  </s>
<s> *. Next week the Syntax WG will discuss Don and Hiroshi's n1 vs. hash prefix  </s>
<s> issue.  </s>
<s> *. Dan Connolly committed to adding a requirement to the XML Schema Requirements Document from us and the I18N (internationalization) IG that a datatype have a normalized/C14N form.  </s>
<s> [1] Date: Thu, 17 Jun 1999 09:47:13 -0700 From: Tim Bray tbray@textuality.com  </s>
<s> Subject: C14n issue N2 - Processing Instructions Status:  </s>
<s> Suppose we have PIs in the external DTD subset.  </s>
<s> The document can still be standalone="yes", so in principle we can't put these in the canonical form unless *require* processors to read the external subset.  </s>
<s> So I see the following realistic options.  </s>
<s> Let's hear opinions and nail this down next Wednesday.  </s>
<s> N2-a. Lose PIs from the canonical form entirely N2-b.  </s>
<s> Lose PIs that happen to be in external entities N2-c.  </s>
<s> Lose PIs that happen to be in the DTD, internal or external N2-d.  </s>
<s> Include all PIs, requiring canonicalizers to read all external parts of the DTD.  </s>
<s> Note that both options b and c require information that is not currently provided by the infoset, so we have some liaison work to do.  </s>
<s> I must say that the more I think about this, both selection criteria (it happens to be in the document entity vs. it happens to be in the DTD) seem unsatisfactory to me.  </s>
<s> N2-a and N2-D weren't brought up in the meeting, but the more I think about them, the more I prefer either of them to either of -b and -c.  </s>
<s> I have an action item to ask the Infoset group about enhancing the PI information, but I'll hold on that in case this group suddenly develops wild enthusiasm either for N2-a or N2-d, which would make it unnecessary.  </s>
<s> -Tim [2] Date: Thu, 17 Jun 1999 09:47:13 -0700 From: Tim Bray tbray@textuality.com  </s>
<s> Subject: C14n issue N4 - XML declaration?  </s>
<s> Status: O Should the canonical form include the XML declaration?  </s>
<s> Subsidiary question: if so, which of the encoding and standalone declarations should it include?  </s>
<s> Let's hear opinions and nail this down next Wednesday.  </s>
<s> Minor pro: XML docs with XML declarations are more robustly interchanged Minor con: A couple of dozen extra bytes Serious issue: if we include the XML declaration, that makes the version of XML part of the canonical form.  </s>
<s> The corollory is that should there ever be an XML 1.1 or 2.0, no XML 1.1/2.0 document can ever be canonically equivalent to any XML 1.0 document.  </s>
<s> Is this a good or bad thing?  </s>
<s> Note: if we leave the XML Decl out, and specify that this C14n spec applies *only* to XML 1.0 documents, we can postpone the decision about whether XML1 and XML2 docs can ever be canonically equivalent to the time we write the XML2 c14n spec.  </s>
<s> Sounds good to me.  </s>
<s> -Tim [3] Date: Thu, 17 Jun 1999 09:47:13 -0700 From: Tim Bray tbray@textuality.com  </s>
<s> Subject: C14n issue N3 - c14n processor Status: Should we introduce the notion of a canonicalization processor in the C14n WD, and define an interface to it, maybe only a return value?  </s>
<s> One advantage is that since canonicalization can fail due to inaccessability of external entities, it might be nice to have a deterministic way to find out when this happens.  </s>
<s> On the contra side, every new thing added to the spec increases complexity and the chance of introducing errors, and makes conformant interoperability harder to achieve.  </s>
<s> Let's hear opinions on this and try to nail it down next wednesday.  </s>
<s> -Tim  </s>
<s> Joseph Reagle Jr. Policy Analyst mailto:reagle@w3.org  </s>
<s> XML-Signature Co-Chair http://w3.org/People/Reagle/  </s>
<s> Hi Joseph,  </s>
<s> We can't really know what a particular XML application language will do with PIs, so there must be some way of preserving them in the signature.  </s>
<s> number?  </s>
<s> Based on my previous requirements feedback document, obviously the answer should be yes.  </s>
<s> As I said in the workshop, the XML header should be there and it should include the version as well as the encoding information of the document.  </s>
<s> The elements actually required out of the document should not have their encoding changed.  </s>
<s> (this isn't actually the same as a canonicalizer, but see below).  </s>
<s> For any elements you must sign in a document, you not only need the internal content but *** you also absolutely positively need the entire ancestor path of information, including attribute declarations for namespace and so on***.  </s>
<s> In general we need to be constructing the message to be hashed from the document rather than just canonicalizing the particular elements listed in a manifest while trying to come up with clever ways of inserting all of the information we lose when we delete the ancestor elements.  </s>
<s> Depth, order  </s>
<s> relative to other included sibling elements, ancestor attributes and even  </s>
<s> ancestor tags can alter the meaning of an element.  </s>
<s> *Please see the prior email I sent a few days ago.*  </s>
<s> Ultimately, we need to be able to take the message actually signed and hand it directly to an application that can process that type of document, and ask it to show that document to the verifier since the only thing the signer really signed was the rendered version of the document.  </s>
<s> Few people on this planet will be able to look at markup and say "yes I know exactly what all of those pointy brackets mean and I commit to what this XML markup says".  </s>
<s> If I have one XML document in a file, and it references a second external document, I should be able to create a version of the first document that does not resolve the external references.  </s>
<s> If our manifest includes the first document and the second document, then the signature failure will be of the first order.  </s>
<s> Could we not then do whatever it is that we'd normally do during verification if a resource listed in the manifest is not found?  </s>
<s> For example, some applications will not care whether the resource is available; they will only validate the signature on the manifest.  </s>
<s> Other apps will definitely care about signature closure.  </s>
<s> The application can then decide if there is an error independently of the signed XML spec-- as long as we choose the right method of canonicalization!  </s>
<s> ACTUALLY, WHAT I'M REALLY SAYING IS THAT WE ARE COMPLICATING MATTERS UNNECESSARILY BY TRYING TO CANONICALIZE OUR DOCUMENTS AS PART OF XML SIGNATURES.  </s>
<s> We don't need a canonicalizer.  </s>
<s> The canonical form of a document is the selected way of writing all members of an equivalence class.  </s>
<s> You're trying to say that we want to take any member of an equivalence class and write it in one way.  </s>
<s> This may be possible to do given the rules of XML, but XML is devoid of lexicon, so you really can't tell whether two documents are equivalent until you put it in the context of a particular XML extension language.  </s>
<s> Since the idea is ultimately hopeless, why are we trying to do this?  </s>
<s> Seems like we could get off the ground more quickly by simply requiring that the message generated by our 'writing algorithm' should not change the meaning of the document.  </s>
<s> The canonicalizers you are discussing would be able to do this if they A) generated XML and B) generated the same actual document type as the input.  </s>
<s> These are signature requirements that I've asked for repeatedly, but don't seem to be requirements of canonicalization itself.  </s>
<s> Canonicalization overlaps our purposes, and with careful consideration canonicalization could be made to suit our purposes, but it is not necessary.  </s>
<s> If I have a signed document and someone modifies it, but it is still logically equivalent, they've still modified it and so the darned signature should break!  </s>
<s> Really we're just trying to get around the fact that hashes don't do equivalence classes, and why should we be doing that?  </s>
<s> Once they signed it, we only need to be able to take the unaltered document and perform a verify.  </s>
<s> Since when has 'digital signature' come to mean that a document can be modified in ways that don't affect its meaning?  </s>
<s> No, a document should not be modified, period.  </s>
<s> prefix  </s>
<s> We would not need to do this in signed XML if we dropped the notion of canonicalization from our requirements.  </s>
<s> We just need a good writer of XML.  </s>
<s> Perhaps someone would care to think about discussing this angle...  </s>
<s> W.R.T. generating a signature message, we don't need to generate a standalone document.  </s>
<s> We only need to generate a message that could be processed later by an XML processor, which can make its own decisions about the document, such as following the standalone flag.  </s>
<s> My vote for PIs was only for those appearing in the document because I just want to preserve the documents that someone is trying to sign.  </s>
<s> If that document relies on other documents, then put references to those documents in the manifest.  </s>
<s> After the cryptographic act of verifying the manifest signature, an application that actually tries to regenerate the message and pass it off to the appropriate rendering module can at that time test whether external references in the message were included in the manifest.  </s>
<s> If not, errors.  </s>
<s> If so, then the unavailability of those external references percolates up to the rendering device that would no doubt try to resolve the references as part of reading the document.  </s>
<s> Again, this is different from the canonicalization aspect because I'm not really interested in canonicalization, only document reproducibility.  </s>
<s> Joseph, My proposal on namespace handling was made to satisfy several DSig requirements on C14N.  </s>
<s> One of them which was implicit in my original email  </s>
<s> was the context independence of the canonicalization.  </s>
<s> Because Dsig requires to be able to sign an element of an XML document, all the element names and attribute names must have "distinguished" name regardless of the choice of the namespace prefix.  </s>
<s> After following the discussion between Don and James Clark, however, I realized that James Clark's proposal can also be made context independent as he points out.  </s>
<s> In the light of the increased readability as well as  </s>
<s> avoidance of complexity of introducing the digest algorithm, I think it is  </s>
<s> more reasonable and more preferable to have a C14N definition based on his  </s>
<s> proposal, using generated prefixes such as "n1", "n2", ..., and so on for EACH element.  </s>
<s> Here is a concrete example.  </s>
<s> Document A hello xmlns="http://ibm.com/schemaA"  </s>
<s> xmlns:myns="http://ibm.com/schemaB" myns:goodbye xmlns:yourns="http://ibm.com/schemaC" value="123" yourns:value="456"  </s>
<s> To do context-independent canonicalization, we need to consider all the namespaces used in a single element (but not a subtree).  </s>
<s> For example, see the "myns:goodbye" element.  </s>
<s> This element contains three namespaces  </s>
<s> prefixed by "myns", "yourns", and the default namespace (two of them are inherited from the surronding context).  </s>
<s> The canonicalized form (context-independent version of JC's C14N) of this document is as follows (for readability I added extra spaces for indentation).  </s>
<s> goodbye xmlns="http://ibm.com/schemaB"  </s>
<s> xmlns:n1="http://ibm.com/schemaA" xmlns:n2="http://ibm.com/schemaC" n1:value="123" n2:value="456" publisher xmlns="http://ibm.com/schemaD"  </s>
<s> Addison Wesley /publisher The "goodbye" element uses the three namespaces, each of which is declared in the same document.  </s>
<s> This is actually more readable than any of the hexified versions (either URI or MD5 of URI).  </s>
<s> It is not as long as the hexified versions either if the URIs are not very long.  </s>
<s> Hiroshi Maruyama Manager, Network Applications, Tokyo Research Laboratory Also Associate Professor, Dept. of Computer Science, Tokyo Institute of Technology From: "Joseph M. Reagle Jr." reagle@w3.org  </s>
<s> on 99/06/18 02:41 AM Subject: Three Issues for C14N Consideration If you have strongly held thoughts on any of these issues, let me know (cc the list).  </s>
<s> 1. Presently, the C14N of XML includes expanded general entities which produces a standalone document.  </s>
<s> Obviously parameter entities aren't a problem, but PIs might be.  </s>
<s> Do you care about PIs? 2. Should the canonical form include an XML declaration with version number?  </s>
<s> 3. If C14N fails because of the unavailability of an external entity, do XML Signature applications want to know?  </s>
<s> *.  </s>
<s> Next week the Syntax WG will discuss Don and Hiroshi's n1 vs. hash prefix issue.  </s>
<s> *.  </s>
<s> Dan Connolly committed to adding a requirement to the XML Schema Requirements Document from us and the I18N (internationalization) IG that a datatype have a normalized/C14N form.  </s>
<s> [1] Date: Thu, 17 Jun 1999 09:47:13 -0700 From: Tim Bray tbray@textuality.com  </s>
<s> Subject: C14n issue N2 - Processing Instructions Status: Suppose we have PIs in the external DTD subset.  </s>
<s> The document can still be standalone="yes", so in principle we can't put these in the canonical form unless *require* processors to read the external subset.  </s>
<s> So I see the following realistic options.  </s>
<s> Let's hear opinions and nail this down next Wednesday.  </s>
<s> N2-a.  </s>
<s> Lose PIs from the canonical form entirely N2-b.  </s>
<s> Lose PIs that happen to be in external entities N2-c.  </s>
<s> Lose PIs that happen to be in the DTD, internal or external N2-d.  </s>
<s> Include all PIs, requiring canonicalizers to read all external parts of the DTD.  </s>
<s> Note that both options b and c require information that is not currently provided by the infoset, so we have some liaison work to do.  </s>
<s> I must say that the more I think about this, both selection criteria (it happens to be in the document entity vs. it happens to be in the DTD) seem unsatisfactory to me.  </s>
<s> N2-a and N2-D weren't brought up in the meeting, but the more I think about them, the more I prefer either of them to either of -b and -c.  </s>
<s> I have an action item to ask the Infoset group about enhancing the PI information, but I'll hold on that in case this group suddenly develops wild enthusiasm either for N2-a or N2-d, which would make it unnecessary.  </s>
<s> -Tim [2] Date: Thu, 17 Jun 1999 09:47:13 -0700 From: Tim Bray tbray@textuality.com  </s>
<s> Subject: C14n issue N4 - XML declaration?  </s>
<s> Status: O Should the canonical form include the XML declaration?  </s>
<s> Subsidiary question: if so, which of the encoding and standalone declarations should it include?  </s>
<s> Let's hear opinions and nail this down next Wednesday.  </s>
<s> Minor pro: XML docs with XML declarations are more robustly interchanged Minor con: A couple of dozen extra bytes Serious issue: if we include the XML declaration, that makes the version of XML part of the canonical form.  </s>
<s> The corollory is that should there ever be an XML 1.1 or 2.0, no XML 1.1/2.0 document can ever be canonically equivalent to any XML 1.0 document.  </s>
<s> Is this a good or bad thing?  </s>
<s> Note: if we leave the XML Decl out, and specify that this C14n spec applies *only* to XML 1.0 documents, we can postpone the decision about whether XML1 and XML2 docs can ever be canonically equivalent to the time we write the XML2 c14n spec.  </s>
<s> Sounds good to me.  </s>
<s> -Tim [3] Date: Thu, 17 Jun 1999 09:47:13 -0700 From: Tim Bray tbray@textuality.com  </s>
<s> Subject: C14n issue N3 - c14n processor Status: Should we introduce the notion of a canonicalization processor in the C14n WD, and define an interface to it, maybe only a return value?  </s>
<s> One advantage is that since canonicalization can fail due to inaccessability of external entities, it might be nice to have a deterministic way to find out when this happens.  </s>
<s> On the contra side, every new thing added to the spec increases complexity and the chance of introducing errors, and makes conformant interoperability harder to achieve.  </s>
<s> Let's hear opinions on this and try to nail it down next wednesday.  </s>
<s> -Tim Joseph Reagle Jr. Policy Analyst mailto:reagle@w3.org  </s>
<s> XML-Signature Co-Chair http://w3.org/People/Reagle/  </s>
<s> Hiroshi,  </s>
<s> Does it mean that every element shall explicitly declare its namespace as well as the namespaces of its attributes (if different)?  </s>
<s> I suppose that, in such circumstances, an element will be always bound to the default namespace declared on the element and, therefore, will never contain a namespace prefix.  </s>
<s> In addition, the element will define the namespaces ns x for each of its attribute that is bound to a namespace other than the element's namespace.  </s>
<s> Probably, the rank x for each namespace  </s>
<s> prefix will be allocated on a first reference basis after ordering of the attributes.  </s>
<s> Am I correct?  </s>
<s> Sincerely, Richard D. Brown For  </s>
<s> Thank you Hiroshi.  </s>
<s> I will report this back to the Syntax WG.  </s>
<s> Joseph Reagle Jr. Policy Analyst mailto:reagle@w3.org  </s>
<s> XML-Signature Co-Chair http://w3.org/People/Reagle/  </s>
<s> I have one question for XML-DSIG draft.  </s>
<s> All W3C&amp;IETF XML-DSIG web pages refer to the brown's IETF draft (draft-brown-xml-dsig-00.txt).  </s>
<s> But there exists the the revised version of his draft.  </s>
<s> (Please see I think we should use the revised document as reference.  </s>
<s> What do you think?  </s>
<s> Yoshiaki Kawatsura : E-mail kawatura@bisd.hitachi.co.jp Business &amp; Information Systems Development Division, Hitachi,Ltd.  </s>
<s> Richard,  </s>
<s> Yes. It is necessary if we want the context independence of canonical forms.  </s>
<s> namespace  </s>
<s> Yes, your interpretation is right.  </s>
<s> Alghough it may be a little more efficient if we use the default namespace for the one that is used most frequently in the element (in terms of total of element name and attribute names), giving the default to the element name seems to me streightforward and reasonable.  </s>
<s> The rank x should be unambiguously determined by, for example, the acending order of the UTF-8 encoded namespace (ordering based on attribute names does not work because of possible ties).  </s>
<s> Hiroshi Hiroshi Maruyama Manager, Network Applications, Tokyo Research Laboratory Also Associate Professor, Dept. of Computer Science, Tokyo Institute of Technology From: "Richard D. Brown" rdbrown@globeset.com on 99/06/21 23:56 Please respond to rdbrown@globeset.com  </s>
<s> Subject: RE: Three Issues for C14N Consideration Hiroshi,  </s>
<s> Does it mean that every element shall explicitly declare its namespace as well as the namespaces of its attributes (if different)?  </s>
<s> I suppose that, in such circumstances, an element will be always bound to the default namespace declared on the element and, therefore, will never contain a namespace prefix.  </s>
<s> In addition, the element will define the namespaces ns x for each of its attribute that is bound to a namespace other than the element's namespace.  </s>
<s> Probably, the rank x for each namespace prefix will be allocated on a first reference basis after ordering of the attributes.  </s>
<s> Am I correct?  </s>
<s> Sincerely, Richard D. Brown For  </s>
<s> Yes, but Richard Brown is preparing text and HTML versions of his latest draft so it can be posted as an IETF Internet Draft and W3C Working Draft.  </s>
<s> I believe that will be the best starting point for WG consideration unless someone out there has an alternative draft.  </s>
<s> Thanks, Donald Donald E. Eastlake, 3rd 17 Skyline Drive, Hawthorne, NY 10532 USA home: 65 Shindegan Hill Road, RR#1, Carmel, NY 10512 USA Yoshiaki KAWATSURA kawatura@bisd.hitachi.co.jp on 06/21/99 11:41:43 PM Subject: Reference to the Brown's draft I have one question for XML-DSIG draft.  </s>
<s> All W3C&amp;IETF XML-DSIG web pages refer to the brown's IETF draft (draft-brown-xml-dsig-00.txt).  </s>
<s> But there exists the the revised version of his draft.  </s>
<s> (Please see I think we should use the revised document as reference.  </s>
<s> What do you think?  </s>
<s> Yoshiaki Kawatsura : E-mail kawatura@bisd.hitachi.co.jp Business &amp; Information Systems Development Division, Hitachi,Ltd.  </s>
<s> Joseph, I reviewed your post on the Syntax WG (http://lists.w3.org/Archives/Member/w3c-xml-syntax-wg/1999Jun/0075.html).  </s>
<s> I think you got my point wrong.  </s>
<s> The current WD does provide context independence of canonical forms.  </s>
<s> This is an important property if we want to allow signing a part (a subelement) of an XML document.  </s>
<s> The current WD seems to allow canonicalization of a whole document only.  </s>
<s> Am I wrong?  </s>
<s> Hiroshi Hiroshi Maruyama Manager, Network Applications, Tokyo Research Laboratory Also Associate Professor, Dept. of Computer Science, Tokyo Institute of Technology From: "Joseph M. Reagle Jr." reagle@w3.org  </s>
<s> on 99/06/22 03:55 AM Subject: Re: Three Issues for C14N Consideration  </s>
<s> is  </s>
<s> his  </s>
<s> Thank you Hiroshi.  </s>
<s> I will report this back to the Syntax WG. Joseph Reagle Jr. Policy Analyst mailto:reagle@w3.org  </s>
<s> XML-Signature Co-Chair http://w3.org/People/Reagle/  </s>
<s> Aargh, sorry!  </s>
<s> I read your post as an application of Clark's method instead of a hybrid.  </s>
<s> I didn't note that you capitalized "EACH" in the text below.  </s>
<s> to have a  </s>
<s> C14N definition based on his proposal, using generated prefixes such as  </s>
<s> "n1",  </s>
<s> "n2", ..., and so on for EACH element.  </s>
<s> The Syntax WG is not likely going to be able to reflect this prior to its first public WD.  </s>
<s> Once it is published (so the whole xmldsig group can see it) I recommend sending a new comment to the specification's-comment address (and any other comments) for discussion.  </s>
<s> (Or if people want to continue it here/now: fine.) Since I'm obviously not very good at porting subtly's from private communications between two working groups, I'd recommend discussion on this topic happen on both lists, or if the Syntax WG Chairs oppose, at least keep the dsig list in the cc.  </s>
<s> I don't think so.  </s>
<s> Though it would help if I knew what change to the Tag Processing Algorithm of section 6.1 were required.  </s>
<s> Joseph Reagle Jr. Policy Analyst mailto:reagle@w3.org  </s>
<s> XML-Signature Co-Chair http://w3.org/People/Reagle/  </s>

<s> When using Tidy to convert from html to xhtml I find that it replaces &amp; within url's with &amp;amp; This looks somewhat unexpected to me.  </s>
<s> Is it a bug or is there a reason for it?  </s>
<s> e.g.: a href="search.pl?key1=value1&amp;key2=value2" becomes Regards Kris Van Bruwaene  </s>
<s> Tidy is correcting your html.  </s>
<s> This is nothing to do with conversion.  </s>
<s> I'm w/ Kris on this one.  </s>
<s> Tidy probably shouldn't replace &amp; with &amp;amp; within the text of an href or src attribute.  </s>
<s> I did a test, however, and it appears that the link is not broken by the replacement.  </s>
<s> The browser may substitute the entity w/ the actual character before submitting the URL.  </s>
<s> I just did this quickly, without a functional URL.  </s>
<s> But the URL displayed on the status line of the browser (IE5) appears correct: file:///C:/temp/search.pl?key1=value1&amp;key2=value2  </s>
<s> You can turn off &amp; replacement with the option: tidy --quote-ampersand=no ... take it easy, Charlie  </s>
<s> Tidy is correcting your html.  </s>
<s> This is nothing to do with conversion.  </s>
<s> ... fed with following two lines in the BODY: gives following error:  </s>
<s> Line 10, character 32: ... href="search.pl?key1=value1&amp;key2=value2" original version / ... Error: unknown entity key2  </s>
<s> in other words: the validator complains about the input line, but does not complain about tidy's output.  </s>
<s> Do you need more proof than that?  </s>
<s> I'll give you an example that makes it a bit more evident.  </s>
<s> Admittedly, in the given example both versions behave identically in most browsers.  </s>
<s> But chek the following with your favourite browser, it is syntactically identical to the given example: The expected URL is "search.pl?key=1&amp;amp=2&amp;nbsp=3", but your browser will most certainly render it as "search.pl?key=1&amp;=2 =3".  </s>
<s> That (and because it's said so in the HTML specifications) is why Tidy is correctly replacing "&amp;" with "&amp;amp;" in your HREF and SRC attributes.  </s>
<s> cheers, sebastian  </s>
<s> Sebastian Lange Maybe the first chat site that validates as HTML 4.0 even though user input may contain HTML codes.  </s>
<s> Courtesy to Dave Raggett's HTML Tidy: Tidy your documents ONLINE:  </s>
<s> I don't want to turn this into a bigger deal than it needs to be, but it turns out I spent some time investigating Tidy's replacement of "&amp;" with "&amp;amp;" a few months ago.  </s>
<s> Many of the points have been mentioned by others in this thread.  </s>
<s> - The HTML, XML, and XHTML specs all require "&amp;" to be written as "&amp;amp;".  </s>
<s> This is because "&amp;" can be ambiguous while "&amp;amp;" is not.  </s>
<s> - Most (all?) browsers do NOT require "&amp;" to be written as "&amp;amp;".  </s>
<s> This is because they employ heuristics to resolve an ambiguous "&amp;".  </s>
<s> These heuristics usually work but they introduce inconsistencies, which is probably why the specs didn't use them.  </s>
<s> Most (all?) browsers also accept the unambiguous "&amp;amp;".  </s>
<s> This is entirely about disambiguating the markup syntax.  </s>
<s> Users and web servers should not see "&amp;amp;" in URLs.  </s>
<s> - Tidy's job is to clean up HTML to conform with the specs while preserving what users experience in their browsers.  </s>
<s> So Tidy replaces the illegal "&amp;" with the legal "&amp;amp;", employing the same heuristics as browsers to resolve any ambiguities.  </s>
<s> Again, users and web servers should not see a difference.  </s>
<s> Only people who look at the markup can tell.  </s>
<s> - Still, some people who look at the markup, for their own reasons good or bad, want to see "&amp;" even if it is illegal and possibly ambiguous.  </s>
<s> For those people, Tidy has a quote-ampersand=no option that disables the "&amp;" replacement.  </s>
<s> - The current 4 August 2000 Tidy has a bug that occasionally causes it to botch the "&amp;" replacement.  </s>
<s> I submitted a patch a few months ago: Randy  </s>
<s> There's agreement about naked &amp; being invalid in the specs.  </s>
<s> As a note, it's worth checking to see how you *really* have Tidy configured to catch unexpected behaviour from it.  </s>
<s> The AdjustConfig function will overwrite the setting of some variable to ensure that Tidy's config is "sensible".  </s>
<s> The original email mentioned that xHTML is being output.  </s>
<s> Here's a snippet from AdjustConfig /* XML requires end tags */ if (XmlOut) QuoteAmpersand = yes; HideEndTags = no; It's worthwhile checking your configuration after AdjustConfig has been executed to see how it's really configured to run.  </s>
<s> Adrian  </s>
<s> You learn something new every day.  </s>
<s> Thanks for the postings.  </s>
<s> I don't want to turn this into a bigger deal than it needs to be, but it turns out I spent some time investigating Tidy's replacement of "&amp;" with "&amp;amp;" a few months ago.  </s>
<s> Many of the points have been mentioned by others in this thread.  </s>
<s> - The HTML, XML, and XHTML specs all require "&amp;" to be written as "&amp;amp;".  </s>
<s> This is because "&amp;" can be ambiguous while "&amp;amp;" is not.  </s>
<s> - Most (all?) browsers do NOT require "&amp;" to be written as "&amp;amp;".  </s>
<s> This is because they employ heuristics to resolve an ambiguous "&amp;".  </s>
<s> These heuristics usually work but they introduce inconsistencies, which is probably why the specs didn't use them.  </s>
<s> Most (all?) browsers also accept the unambiguous "&amp;amp;".  </s>
<s> This is entirely about disambiguating the markup syntax.  </s>
<s> Users and web servers should not see "&amp;amp;" in URLs.  </s>
<s> - Tidy's job is to clean up HTML to conform with the specs while preserving what users experience in their browsers.  </s>
<s> So Tidy replaces the illegal "&amp;" with the legal "&amp;amp;", employing the same heuristics as browsers to resolve any ambiguities.  </s>
<s> Again, users and web servers should not see a difference.  </s>
<s> Only people who look at the markup can tell.  </s>
<s> - Still, some people who look at the markup, for their own reasons good or bad, want to see "&amp;" even if it is illegal and possibly ambiguous.  </s>
<s> For those people, Tidy has a quote-ampersand=no option that disables the "&amp;" replacement.  </s>
<s> - The current 4 August 2000 Tidy has a bug that occasionally causes it to botch the "&amp;" replacement.  </s>
<s> I submitted a patch a few months ago: Randy  </s>

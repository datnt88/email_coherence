<s> I think Kent is arguing that from an implementor's point of view, requiring minimal canonicalization is a real pain not because minimal canonicalization is hard to implement,  </s>
<s> but because by making support for minimal canonicalization REQUIRED, it means that an implementor cannot use XML parsing to parse SignedInfo when verifying a Signature.  </s>
<s> If my app receives a Signature with a SignedInfo element that was canonicalized using minimal-c14n, I cannot use an XML parser to isolate the SignedInfo element and then go on.  </s>
<s> After my app has figured out that minimal-c14n was used, I have to use some sort of character-by-character algorithm to ensure I've got the right bytes in the right order.  </s>
<s> Having always used XML-c14n in my code because I've always thought minimal-c14n was generally a bad idea, I never realized just how bad an idea it was to require supporting minimal-c14n as a SignedInfo canonicalization algorithm.  </s>
<s> Kent, who is implementing a full XML Signature Toolkit, has run into this problem directly.  </s>
<s> (Kent if any of the above assertions are invalid, let me know.)  </s>
<s> In summary, by making support for minimal-c14n canonicalization of the SignedInfo element, the spec really makes things painful for XML Signature toolkit implementors.  </s>
<s> If there is someone out there who has actually implemented code that can support minimal-c14n canonicalization of the SignedInfo element, I'd like to hear about it.  </s>
<s> I'm not saying it is  </s>
<s> impossible, just a pain.  </s>
<s> If it has been implemented in a robust, non-painful, way, we need to know about it.  </s>
<s> The upshot of this may in fact be that support for Canonical XML really should be REQUIRED and from an implemenation point of view, should be mandatory for SignedInfo (eg.  </s>
<s> we don't even need a Canonicalization child element, because XML-c14n is mandatory.  </s>
<s> Kent, do you agree with this paragraph.  </s>
<s> Everyone, I know this is a radically different paradigm than what we've believed for months but in my current "Eureka!" state, I'm not sure there isn't a better solution.  </s>
<s> Perhaps after I send this note, I'll be in a "Doh!, why didn't I see that" state but right now I'm not.  </s>
<s> If someone can show me some elegant pseudo-code showing me how one would extract, without XML parsing, the SignedInfo element from an XML Signature, I would be grateful.  </s>
<s> eg.  </s>
<s> Extract the XML Signature SignedInfo element from the following Signature without using XML parsing.  </s>
<s> -- Start of example -- !-- CanonicalizationMethod Algorithm="http://www.w3.org/2000/02/xmldsig#minimal" -- ?x CanonicalizationMethod Algorithm="http://www.w3.org/2000/02/xmldsig#minimal" ?  </s>
<s> CanonicalizationMethod Algorithm="http://www.w3.org/2000/02/xmldsig#minimal" CanonicalizationMethod Algorithm="http://www.w3.org/2000/02/xmldsig#minimal" -- end of example -- OK, I admit the above is probably a worst case scenario, but Toolkits, particularly security Toolkits, have to be able handle worst case scenarios.  </s>
<s> Regards, Ed  </s>
<s> insert /insert which from my point of view basically says if the XML-encoded data is going to go through some form of XML parsing during its processing, then one really needs to do XML-aware canonicalization (eg.  </s>
<s> XML-c14n) before signing it.  </s>
<s> It seems to me what Kent is saying is in accordance with the above  </s>
<s> fragment  </s>
<s> from the spec.  </s>
<s> Kent, John, would you agree or disagree?  </s>
<s> This insertion is acceptable for me though I hope XML Signature could be processed on only XML Information Set.  </s>
<s> Anyway, remove the minimal c14n, or change requirement of the minimal c14n: REQUIRED - RECOMMENDED, please.  </s>
<s> TAMURA Kent @ Tokyo Research Laboratory, IBM  </s>
<s> The issue is not whether one scheme or the other is hard to implement but that the placement of the signature checking module needs to be different for the two schemes.  </s>
<s> If one places the signature checker after having reduced the text to an XML parse tree then one can only support fully c14n messages.  </s>
<s> That is undesirable from a security point of view since c14n is a substantially more complex transformation than cryptography people are generally happy with.  </s>
<s> Without a comprehensive formal analysis of the potential substitution attacks it would take a very long time to gain confidence in the spec.  </s>
<s> It is however quite possible to resolve the conflicting constraints, it is difficult to explain how to do this in ASCII however.  </s>
<s> Briefly, one needs to code the XML parser with separate FSR and parse tree building modules (a good idea in any case).  </s>
<s> The initial FSR module needs to have a switch to divert code through a hash algorithm when required.  </s>
<s> The switch needs to be activated by the signature verifier at the appropriate point.  </s>
<s> It is quite easy to write an integrated parsing / signature verification module in C on this structure without the use of any global variables.  </s>
<s> XML was designed to be very easy to write parse tools for.  </s>
<s> Alternatively if one is perfoming DOM style all in one go parsing then one can reasonably expect to have the entire input text available when performing the parse, supporting verification is then a simple matter of making an index of the position of the current lexeme within the input text avaliable to the parser.  </s>
<s> Phill  </s>
<s> We've been trying to play agnostic between XML as XML, and XML as a character sequence, but I believe the spec should follow the implementations, which seem to be adopting the XML toolkit (XML as XML) route.  </s>
<s> The two problems that exist for that route are security and fragments, and things seem to be falling out as follows (IMHO): Security: You can't do enveloped or partial documents signatures really without operating in the XML as XML paradigm, if that frightens you from a security point of view, use detached.  </s>
<s> (Or see Phil's comment: Fragments: We need some way of serializing the results of DOM/XPath node lists (abstractions).  </s>
<s> Canonical XML only processes full documents, what to do?  </s>
<s> I liked Gregor's proposal: These approaches work well for XML as a refereant being signed, I'm not sure if it's a compelling enough case to make the WG get off the fence (move to the XML as XML or XML as character sequence) yet with respect to SignedInfo, but given the comments from Gregor, Kent, and Ed (based on implementation experience) I'm certainly leaning that way.  </s>

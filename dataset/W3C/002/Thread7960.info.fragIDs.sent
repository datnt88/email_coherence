<s> Hello, I'm currently trying to implement a WebDAV server.  </s>
<s> Getting properties with DAV Explorer works, but Microsofts WebFolder does not recognize my implementation as a valid WebDAV server.  </s>
<s> Something is missing in my implementation of the protocol.  </s>
<s> I append a logfile and hopefully somebody can give me a hint.  </s>
<s> (I'm using Tomcat as servlet engine and http server as well).  </s>
<s> Best regards, Anton Schegg =========== LOGFILE ==================== Establish new connection INFO: client - server OPTIONS / HTTP/1.1 User-Agent: Microsoft Data Access Internet Publishing Provider Cache Manager  </s>
<s> Host: muc01134:8888 Content-Length: 0 Connection: Keep-Alive INFO: server - client HTTP/1.0 200 OK INFO: server - client Status: 200 INFO: server - client  </s>
<s> Allow: GET, HEAD, POST, TRACE, OPTIONS Content-Type: text/plain Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 Content-Language: en  </s>
<s> sender has closed connection: client - server connection closed  </s>
<s> Establish new connection INFO: client - server GET /_vti_inf.html  </s>
<s> HTTP/1.1 Date: Thu, 19 Oct 2000 14:59:59 GMT MIME-Version: 1.0 Accept: */* User-Agent: Mozilla/2.0 (compatible; MS FrontPage 4.0) Host: muc01134:8888 Accept: auth/sicily Content-Length: 0 Connection: Keep-Alive INFO: server - client HTTP/1.0 404 Not Found INFO: server - client Status: 404 INFO: server - client Content-Type: text/html INFO: server - client Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) INFO: server - client Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 INFO: server - client Content-Language: en INFO: server - client INFO: server - client h2 Location: /_vti_inf.html  </s>
<s> /h2 File Not Found br /_vti_inf.html  </s>
<s> sender has closed connection: server - client sender has closed connection: client - server Establish new connection INFO: client - server POST /_vti_bin/shtml.exe/_vti_rpc  </s>
<s> HTTP/1.1 Date: Thu, 19 Oct 2000 14:59:59 GMT MIME-Version: 1.0 User-Agent: MSFrontPage/4.0 Host: muc01134:8888 Accept: auth/sicily Content-Length: 41 Content-Type: application/x-www-form-urlencoded X-Vermeer-Content-Type: application/x-www-form-urlencoded Connection: Keep-Alive method=server+version%3a4%2e0%2e2%2e3717 INFO: server - client HTTP/1.0 404 Not Found INFO: server - client Status: 404 Content-Type: text/html Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 Content-Language: en h2 Location: /_vti_bin/shtml.exe/_vti_rpc  </s>
<s> /h2 File Not Found br /_vti_bin/shtml.exe/_vti_rpc  </s>
<s> sender has closed connection: server - client connection closed Establish new connection INFO: client - server OPTIONS /DAV HTTP/1.1 Accept-Language: de, en-us;q=0.5  </s>
<s> User-Agent: Microsoft Data Access Internet Publishing Provider DAV 1.1 Host: muc01134:8888  </s>
<s> Content-Length: 0 Connection: Keep-Alive INFO: server - client HTTP/1.0 200 OK INFO: server - client Status: 200 INFO: server - client MS-Author-Via: DAV Allow: OPTIONS, GET, HEAD, POST, DELETE, TRACE, PROPFIND, PROPPATCH, COPY, MOVE, LOCK, UNLOCK DAV: 1,2 Content-Type: text/plain Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 Content-Language: en sender has closed connection: client - server connection closed Establish new connection INFO: client - server PROPFIND /DAV HTTP/1.1 Accept-Language: de, en-us;q=0.5  </s>
<s> Content-Type: text/xml Translate: f Content-Length: 0 Depth: 0 User-Agent: Microsoft Data Access Internet Publishing Provider DAV 1.1 Host: muc01134:8888 Connection: Keep-Alive INFO: server - client HTTP/1.0 207 Multi-Status INFO: server - client Status: 207 INFO: server - client INFO: server - client Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 Content-Language: en DAV:getlastmodified Wed, 13 Sep 2000 09:40:34 GMT /DAV:getlastmodified sender has closed connection: server - client sender has closed connection: client - server  </s>
<s> Anton, You may want to change the server to respond with HTTP/1.1 rather than HTTP/1.0 to show that it understands the 1.1 level protocol that is a prerequisite for DAV.  </s>
<s> Regards, Tim Anton Schegg anton.schegg@ixos.de  </s>
<s> on 2000-10-19 03:53:39 PM Please respond to Anton Schegg anton.schegg@ixos.de  </s>
<s> Subject: WebFolder does not recognize my WebDAV server  </s>
<s> Hello, I'm currently trying to implement a WebDAV server.  </s>
<s> Getting properties with DAV Explorer works, but Microsofts WebFolder does not recognize my implementation as a valid WebDAV server.  </s>
<s> Something is missing in my implementation of the protocol.  </s>
<s> I append a logfile and hopefully somebody can give me a hint.  </s>
<s> (I'm using Tomcat as servlet engine and http server as well).  </s>
<s> Best regards, Anton Schegg =========== LOGFILE ==================== Establish new connection INFO: client - server OPTIONS / HTTP/1.1 User-Agent: Microsoft Data Access Internet Publishing Provider Cache  </s>
<s> Manager Host: muc01134:8888 Content-Length: 0 Connection: Keep-Alive INFO: server - client HTTP/1.0 200 OK INFO: server - client Status: 200 INFO: server - client  </s>
<s> Allow: GET, HEAD, POST, TRACE, OPTIONS Content-Type: text/plain Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 Content-Language: en  </s>
<s> sender has closed connection: client - server connection closed  </s>
<s> Establish new connection INFO: client - server GET /_vti_inf.html  </s>
<s> HTTP/1.1 Date: Thu, 19 Oct 2000 14:59:59 GMT MIME-Version: 1.0 Accept: */* User-Agent: Mozilla/2.0 (compatible; MS FrontPage 4.0) Host: muc01134:8888 Accept: auth/sicily Content-Length: 0 Connection: Keep-Alive INFO: server - client HTTP/1.0 404 Not Found INFO: server - client Status: 404 INFO: server - client Content-Type: text/html INFO: server - client Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) INFO: server - client Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 INFO: server - client Content-Language: en INFO: server - client INFO: server - client h2 Location: /_vti_inf.html  </s>
<s> /h2 File Not Found br /_vti_inf.html  </s>
<s> sender has closed connection: server - client sender has closed connection: client - server Establish new connection INFO: client - server POST /_vti_bin/shtml.exe/_vti_rpc  </s>
<s> HTTP/1.1 Date: Thu, 19 Oct 2000 14:59:59 GMT MIME-Version: 1.0 User-Agent: MSFrontPage/4.0 Host: muc01134:8888 Accept: auth/sicily Content-Length: 41 Content-Type: application/x-www-form-urlencoded X-Vermeer-Content-Type: application/x-www-form-urlencoded Connection: Keep-Alive method=server+version%3a4%2e0%2e2%2e3717 INFO: server - client HTTP/1.0 404 Not Found INFO: server - client Status: 404 Content-Type: text/html Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 Content-Language: en h2 Location: /_vti_bin/shtml.exe/_vti_rpc  </s>
<s> /h2 File Not Found br /_vti_bin/shtml.exe/_vti_rpc  </s>
<s> sender has closed connection: server - client connection closed Establish new connection INFO: client - server OPTIONS /DAV HTTP/1.1 Accept-Language: de, en-us;q=0.5  </s>
<s> User-Agent: Microsoft Data Access Internet Publishing Provider DAV 1.1 Host: muc01134:8888  </s>
<s> Content-Length: 0 Connection: Keep-Alive INFO: server - client HTTP/1.0 200 OK INFO: server - client Status: 200 INFO: server - client MS-Author-Via: DAV Allow: OPTIONS, GET, HEAD, POST, DELETE, TRACE, PROPFIND, PROPPATCH, COPY, MOVE, LOCK, UNLOCK DAV: 1,2 Content-Type: text/plain Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 Content-Language: en sender has closed connection: client - server connection closed Establish new connection INFO: client - server PROPFIND /DAV HTTP/1.1 Accept-Language: de, en-us;q=0.5  </s>
<s> Content-Type: text/xml Translate: f Content-Length: 0 Depth: 0 User-Agent: Microsoft Data Access Internet Publishing Provider DAV 1.1 Host: muc01134:8888 Connection: Keep-Alive INFO: server - client HTTP/1.0 207 Multi-Status INFO: server - client Status: 207 INFO: server - client INFO: server - client Servlet-Engine: Tomcat Web Server/3.1 (JSP 1.1; Servlet 2.2; Java 1.1.4;  </s>
<s> Windows NT 5.0 x86; java.vendor=Microsoft  </s>
<s> Corp.) Date: Thu, 19 Oct 2000 14:59:59 GMT+00:00 Content-Language: en DAV:getlastmodified Wed, 13 Sep 2000 09:40:34 GMT /DAV:getlastmodified sender has closed connection: server - client sender has closed connection: client - server  </s>
<s> Hi You have to inform WebFolders that you support WedDav.  </s>
<s> Or else it will look for frontpage extensions (_vtf_inf.html).  </s>
<s> So for the OPTIONS request that is comming first you should respond by giving the headers DAV and MS-Author-Via "DAV :1.1" "MS-Author-Via: DAV" When WebFolders sees this then it will send a PROPFIND webdav request instead of the GET request that you are getting now Cheers D.Madan Mohan  </s>
<s> I think the problem is your Allow: you don't list MKCOL or PROPFIND so the webfolders is thinking you are not a DAV server and is switching into FrontPage Extension mode.  </s>
<s> A good way to find out what you need to return is run a packet tracer and connect with webfolders to a DAV server, like www.sharemation.com and see what they return to make webfolders think it's a DAV server.  </s>
<s> John Glavin RiverFront Software  </s>
<s> Manager  </s>
<s> Oh, geez.  </s>
<s> What has this list come to.  </s>
<s> Three replies, and three incorrect (or close to it) answers... A1: "respond with HTTP/1.1" -- well, this is obviously not a prerequisite because we see that Web Folders *does* end up doing a PROPFIND.  </s>
<s> So it obviously doesn't mind.  </s>
<s> A2: "use 'DAV :1.1' and 'MS-Author-Via: DAV'" -- the former should be the 'DAV: 1,2' header and the latter is not required (it simply optimizes out a round trip).  </s>
<s> We also see in the log below that Anton returns those for the /DAV directory.  </s>
<s> A3: "return MKCOL and PROPFIND in the OPTIONS response" -- he is returning PROPFIND (but not MKCOL).  </s>
<s> Web Folders doesn't need the MKCOL... it already believes there is a DAV server there by the simple evidence that it issues a PROPFIND.  </s>
<s> Sigh.  </s>
<s> Yes, using HTTP/1.1 in the response is a good idea and is technically required (and it will help with connection persistence and request pipelining).  </s>
<s> But it isn't a precondition.  </s>
<s> It would be good to return MKCOL, too.  </s>
<s> I'd also suggest getting rid of that Status: header (it's useless).  </s>
<s> I believe your real problem exists in the Multistatus response.  </s>
<s> You are using the "DAV" namespace *prefix*, but have not placed the elements into the "DAV:" *namespace*.  </s>
<s> Change your outermost element to: That should hopefully do the trick.  </s>
<s> I haven't thoroughly analyzed the body of your multistatus, but a rough glance seems to show it is okay.  </s>
<s> Also, have you seen the Slide project?  </s>
<s> http://jakarta.apache.org/slide/  </s>
<s> Or the Magi-DAV project?  </s>
<s> http://magi.endeavors.org/  </s>
<s> Cheers, -g  </s>
<s> Greg Stein, http://www.lyra.org/  </s>
<s> Hello all, Thanks for the answers.  </s>
<s> Specifying the namespace (xmlns:D="DAV:") in the multistatus response is the solution.  </s>
<s> Confusion was caused probably through the following: I specified "http://muc01134:8888/DAV/" in WebFolder.  </s>
<s> "/DAV/" induces tomcat to invoke my own servlet (because I configured it in that way).  </s>
<s> WebFolder now tries to get a response from "http://muc01134:8888/" before finally going to try "http://muc01134:8888/DAV/".  </s>
<s> This is the reason for having some leading requests (WebFolder checks for frontpage extensions) and responses in my logfile, which are handled by the HTTP-Server itself and without invoking my servlet.  </s>
<s> Best regards, Anton Schegg Oh, geez.  </s>
<s> What has this list come to.  </s>
<s> Three replies, and three incorrect (or close to it) answers... A1: "respond with HTTP/1.1" -- well, this is obviously not a prerequisite because we see that Web Folders *does* end up doing a PROPFIND.  </s>
<s> So it obviously doesn't mind.  </s>
<s> A2: "use 'DAV :1.1' and 'MS-Author-Via: DAV'" -- the former should be the 'DAV: 1,2' header and the latter is not required (it simply optimizes out a round trip).  </s>
<s> We also see in the log below that Anton returns those for the /DAV directory.  </s>
<s> A3: "return MKCOL and PROPFIND in the OPTIONS response" -- he is returning PROPFIND (but not MKCOL).  </s>
<s> Web Folders doesn't need the MKCOL... it already believes there is a DAV server there by the simple evidence that it issues a PROPFIND.  </s>
<s> Sigh.  </s>
<s> Yes, using HTTP/1.1 in the response is a good idea and is technically required (and it will help with connection persistence and request pipelining).  </s>
<s> But it isn't a precondition.  </s>
<s> It would be good to return MKCOL, too.  </s>
<s> I'd also suggest getting rid of that Status: header (it's useless).  </s>
<s> I believe your real problem exists in the Multistatus response.  </s>
<s> You are using the "DAV" namespace *prefix*, but have not placed the elements into the "DAV:" *namespace*.  </s>
<s> Change your outermost element to: That should hopefully do the trick.  </s>
<s> I haven't thoroughly analyzed the body of your multistatus, but a rough glance seems to show it is okay.  </s>
<s> Also, have you seen the Slide project?  </s>
<s> http://jakarta.apache.org/slide/  </s>
<s> Or the Magi-DAV project?  </s>
<s> http://magi.endeavors.org/  </s>
<s> Cheers, -g  </s>
<s> Accidentally caught by the spam filter.  </s>
<s> I've added Joe's new email address to the accept2 list.  </s>
<s> - Jim server The OPTIONS response should include the headers DAV: 1 MS-Author-Via: DAV (the latter is only for best results against MS clients) As others have said, PROPFIND etc in the Allow header (don't know if MS clients check this or not).  </s>
<s> ... then, the PROPFIND response is not right.  </s>
<s> You need to use namespaces properly, e.g. first, and then replace DAV: everywhere below with D:  </s>
<s> ?xml version="1.0"  </s>
<s> encoding="UTF-8"?  </s>
<s> DAV:multistatus DAV:response  </s>

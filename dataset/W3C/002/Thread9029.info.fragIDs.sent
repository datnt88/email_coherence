<s> Dear XML Working Group, I have to solve the following problem with the Enveloped Signature Transform.  </s>
<s> According to the definition of the here() function and XPATH predicate defined in subchapter, it is clear that enveloped signature signs/verifies "all" but not self.  </s>
<s> Is it also possible to sign/verify the same XML document by using more than one enveloped signatures?  </s>
<s> Example:  </s>
<s> Both of these signatures contain enveloped transform and refer to the same "test:a" element.  </s>
<s> According to the specification the first signature should sign the second one and the second one should sign the first.  </s>
<s> The same problem arise during verification phase.  </s>
<s> Is there any reccomendation for this case?  </s>
<s> Regards Pavel Pavel Zavora Software Developer, Systinet (formerly Idoox)  </s>
<s> --On Freitag, 1. Februar 2002 04:51 -0500 Pavel Zavora  </s>
<s> When you add sig1 to the document, you sign the document (which does include sig1 and the data) and exclude sig1.  </s>
<s> Then you add sig2 which signs the document (data + sig1 + sig2) and then exclude sig2; Verification of sig2 will work ok, but verification of sig1 fails: You verify the document (data + sig1 + sig2) and exclude sig1.  </s>
<s> So you verify (data + sig2) which was not signed (only data was signed).  </s>
<s> Solution: Use an XPath which omits all Signature, not only the current one.  </s>
<s> Regards,  </s>
<s> Christian  </s>
<s> Or if you can flexibly place the Signatures, the easiest solution is make them siblings of the signed content (detached) instead of descendents.  </s>
<s> Joseph Reagle Jr. http://www.w3.org/People/Reagle/ W3C Policy Analyst mailto:reagle@w3.org  </s>
<s> IETF/W3C XML-Signature Co-Chair http://www.w3.org/Signature/ W3C XML Encryption Chair http://www.w3.org/Encryption/2001/  </s>
<s> Example:  </s>
<s> The XPath is only for the first ds:Signature??.  </s>
<s> If yes, there are no problem for verification of the first ds:Signature, after adding other ds:Signature, but for the second ds:Signature?  </s>
<s> The second ds:Signature signs also the first, but after adding other ds:Signature, the verification fails Solution: For each ds:Signature use an XPath omits all ds:Signature added after.  </s>
<s> But it really exists an XPath for this problem?? Mauro Arcolini, GapXse  </s>
<s> --On Donnerstag, 7. Februar 2002 11:48 +0100 Mauro Arcolini  </s>
<s> Sorry, I don't understand why the second signature has a problem?  </s>
<s> By adding the second signature to the content which is signed by the first signature, you break signature 1.  </s>
<s> The second signature covers the data _and_ the first signature.  </s>
<s> Christian  </s>
<s> Mauro, The XPath filter "not (ancestor-or-self::ds:Signature)" will remove _all_ signatures from the document, so signatures can be added at will without breaking validity.  </s>
<s> An alternative filter could be constructed using: here()/ancestor::ds:Signature[1]/following-sibling::ds:Signature This would be slow, and would simply remove Signatures added _following_ this signature.  </s>
<s> This would constrain the placement of signatures, but might be more interesting.  </s>
<s> Alternatively, with the enveloped signature transform, new signatures could be added as ds:Object elements within the first signature itself without XPath and without breaking validity.  </s>
<s> Merlin r/arcolini@sec.di.unipi.it/2002.02.07/11:48:36  </s>
<s> Baltimore Technologies plc will not be liable for direct, special, indirect or consequential damages arising from alteration of the contents of this message by a third party or as a result of any virus being passed on.  </s>
<s> This footnote confirms that this email message has been swept by Baltimore MIMEsweeper for Content Security threats, including computer viruses.  </s>
<s> merlin wrotes:  </s>
<s> Yes its'a solution.  </s>
<s> It seems a very good solution, but do you repeat this behaviour if you want add other ds:Signature?,  </s>
<s> i.e. if you want sign the first and the second ds:Signature, without breaking the second, do you add the third ds:Signature as ds:Object element of the second e so on?? Mauro Arcolini, GapXse  </s>

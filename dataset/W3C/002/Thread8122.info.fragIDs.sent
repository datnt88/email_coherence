<s> The recent thread entitled RE: need clarification about COPY to locked resource response cod e and RE: need clarification about COPY to locked resource response cod e recently died down with the following posting.  </s>
<s> I just want to bring it to conclusion and get it on the ISSUES list.  </s>
<s> So we have a proposal on the table regarding error reporting for lock conflicts during COPY/MOVE.  </s>
<s> I'll try to describe it below.  </s>
<s> If a portion of the destination is locked and preventing a portion of the COPY/MOVE, then a 207 Multistatus MUST be returned by the server.  </s>
<s> That MultiStatus response should indicate (with 409 Conflict status) what source resource could not be copied/moved and optionally say something about the locked destination resource the locked that prevented the copy.  </s>
<s> That D:error tag is optional.  </s>
<s> And clearly we'd need the add definitions for the D:error tag and the descendent tags listed in the example above.  </s>
<s> We should work out if the dest URL listed is the root of the lock or the locked resource that was directly affecting the operation.  </s>
<s> We should possibly clarify "protected URL" status codes and what URL is depicted.  </s>
<s> If none of the COPY/MOVE could be done due to a locked destination, then it is acceptable, although obviously not optimal, to simply return a 409 CONFLICT rather than a 207 MULTISTATUS.  </s>
<s> As for *source* locks... Source lock error don't occur for COPY, just MOVE.  </s>
<s> And the 423 LOCKED status code will be used instead of 409 CONFLICT.  </s>
<s> More specifically...  </s>
<s> In the case of a MOVE operations where a portion of the source is locked, the server  </s>
<s> is to respond with 207 MULTISTATUS and the body of that will simply indicate the locked source resources with a 423 LOCKED status.  </s>
<s> In the case that the request (source) URL is locked in a way that prevents any other MOVEs to occur, the server is free to simply reply with a 423 LOCKED rather than a 407 MULTISTATUS.  </s>
<s> In all cases, minimization rules apply.  </s>
<s> I will start a seperate thread for Minimization issues if necessary.  </s>
<s> So does this sound acceptable to everyone?  </s>
<s> J.  </s>
<s> Fine by me.  </s>
<s> Cheers, Geoff  </s>
<s> The recent thread entitled RE: need clarification about COPY to locked resource response cod e and RE: need clarification about COPY to locked resource response cod e recently died down with the following posting.  </s>
<s> I just want to bring it to conclusion and get it on the ISSUES list.  </s>
<s> So we have a proposal on the table regarding error reporting for lock conflicts during COPY/MOVE.  </s>
<s> I'll try to describe it below.  </s>
<s> If a portion of the destination is locked and preventing a portion of the COPY/MOVE, then a 207 Multistatus MUST be returned by the server.  </s>
<s> That MultiStatus response should indicate (with 409 Conflict status) what source resource could not be copied/moved and optionally say something about the locked destination resource the locked that prevented the copy.  </s>
<s> That D:error tag is optional.  </s>
<s> And clearly we'd need the add definitions for the D:error tag and the descendent tags listed in the example above.  </s>
<s> We should work out if the dest URL listed is the root of the lock or the locked resource that was directly affecting the operation.  </s>
<s> We should possibly clarify "protected URL" status codes and what URL is depicted.  </s>
<s> If none of the COPY/MOVE could be done due to a locked destination, then it is acceptable, although obviously not optimal, to simply return a 409 CONFLICT rather than a 207 MULTISTATUS.  </s>
<s> As for *source* locks... Source lock error don't occur for COPY, just MOVE.  </s>
<s> And the 423 LOCKED status code will be used instead of 409 CONFLICT.  </s>
<s> More specifically...  </s>
<s> In the case of a MOVE operations where a portion of the source is locked, the server  </s>
<s> is to respond with 207 MULTISTATUS and the body of that will simply indicate the locked source resources with a 423 LOCKED status.  </s>
<s> In the case that the request (source) URL is locked in a way that prevents any other MOVEs to occur, the server is free to simply reply with a 423 LOCKED rather than a 407 MULTISTATUS.  </s>
<s> In all cases, minimization rules apply.  </s>
<s> I will start a seperate thread for Minimization issues if necessary.  </s>
<s> So does this sound acceptable to everyone?  </s>
<s> J.  </s>
<s> We could use a few more people speaking up... :-)  </s>
<s> It seems reasonable to me, although the details are still to be worked out for a few small things.  </s>
<s> Elias  </s>
<s> How about a more generic version: ... complete DAV:response element for resource causing the conflict This would avoid having to define a whole new set of error conditions...  </s>
<s> I don't think that it makes sense to try to re-use DAV:response in the "explanation" part of the error message, because you don't need another responsedescription, and it is not clear that the HTTP status codes are a useful way of characterizing what about the state of the other resource contributed to the error being described.  </s>
<s> Cheers, Geoff  </s>
<s> How about a more generic version: ... complete DAV:response element for resource causing the conflict This would avoid having to define a whole new set of error conditions...  </s>
<s> Well, we need - the URI and - error information (be it an HTTP status or a DAV:error element).  </s>
<s> DAV:response is a container that can hold both, so why not re-use it?  </s>
<s> The reason not to reuse it is that this is not a "response" element, but rather an "explanation" element (i.e. the same reason you would not re-use a "point" element to represent a "vector" element, even though they both contained 2 integers).  </s>
<s> In particular, it is likely that you will want to extent a "response" in ways that are inappropriate for an "explanation", and vica versa.  </s>
<s> Of course, as with most questions of re-use, it is a value judgement as to "how close" two concepts are to each other, and how likely it is for them to evolve in divergent ways.  </s>
<s> Cheers, Geoff  </s>
<s> Well, we need - the URI and - error information (be it an HTTP status or a DAV:error element).  </s>
<s> DAV:response is a container that can hold both, so why not re-use it?  </s>
<s>  </s>
<s> Of course, as with most questions of re-use, it is a value judgement as to "how close" two concepts are to each other, and how likely it is for them to evolve in divergent ways.  </s>
<s> Well let's go in to a few examples and see if that sways any opinions.  </s>
<s> To review...  </s>
<s> The basic concept of the proposal is that the body of the COPY/MOVE multistatus response will list source resources rather than destination resource.  </s>
<s> But additionally, it can list resouces that contributed to the status as an explanation of the source resource(s) error status.  </s>
<s> Often that will be a destination resource.  </s>
<s> Now for some examples...  </s>
<s> A depth lock above the destination that prevents a COPY/MOVE to the destination.  </s>
<s> How would you list this?  </s>
<s> (I'll let Geoff and Julian make the proposals.)  </s>
<s> A lock on the parent collection of the destination resource.  </s>
<s> A lock on the destination resource.  </s>
<s> A lock below the destination resource whose protected-lock-uri guarantees prevents the destination DELETE phase of the MOVE/COPY from occuring.  </s>
<s> A COPY/MOVE to a destination that doesn't have an immediate parent.  </s>
<s> A depth lock above the source URI that prevents a MOVE.  </s>
<s> A lock of the parent of the source URI prevents a MOVE.  </s>
<s> A lock on the source prevents a MOVE.  </s>
<s> A lock below the source prevents a MOVE due to protected-lock-uri guarantees.  </s>
<s> Same as the above LOCK situations but ACL's instead.  </s>
<s> Can the two approaches handle all of these well?  </s>
<s> Reminder, the issue is just for MOVE/COPY lock issues, but a check of these will let us know if the mechanism is flexible.  </s>
<s> J.  </s>
<s> I'll record it as resolved that the multistatus results will list the source URL not the destination.  </s>
<s> That will move to "Edit" status.  </s>
<s> I'll create an issue item for the proposals for how to document the nature of the errors beyond the status code.  </s>
<s> I'll mark that item as defered to next version of WebDAV unless someone picks up the torch on this one.  </s>
<s> J.  </s>
